<!-- beyondBINARY quantum-prefixed | uvspeed | {+1, 1, -1, +0, 0, -0, +n, n, -n} -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uvspeed - Quantum beyondBINARY notepad</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
    <style>
        /* ===== Inlined Design System (cursor-theme.css) ===== */
        :root {
            --cursor-bg: #0d1117;
            --cursor-bg-secondary: #161b22;
            --cursor-bg-tertiary: #21262d;
            --cursor-bg-hover: #30363d;
            --cursor-text: #ffffff;
            --cursor-text-secondary: #c9d1d9;
            --cursor-text-muted: #8b949e;
            --cursor-accent: #58a6ff;
            --cursor-accent-hover: #79c0ff;
            --cursor-accent-subtle: #1f6feb;
            --cursor-border: #30363d;
            --cursor-border-muted: #21262d;
            --cursor-success: #3fb950;
            --cursor-warning: #d29922;
            --cursor-danger: #f85149;
            --cursor-font-sans: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --cursor-font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            --cursor-space-xs: 0.25rem;
            --cursor-space-sm: 0.5rem;
            --cursor-space-md: 1rem;
            --cursor-space-lg: 1.5rem;
            --cursor-space-xl: 2rem;
            --cursor-space-2xl: 3rem;
            --cursor-radius-sm: 4px;
            --cursor-radius-md: 6px;
            --cursor-radius-lg: 8px;
            --cursor-radius-xl: 12px;
            --cursor-shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --cursor-shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4);
            --cursor-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4);
            --cursor-shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.5);
            color-scheme: dark;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--cursor-font-sans);
            background: var(--cursor-bg);
            color: var(--cursor-text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .btn {
            display: inline-flex; align-items: center; gap: var(--cursor-space-sm);
            padding: var(--cursor-space-sm) var(--cursor-space-md);
            border: 1px solid var(--cursor-border); border-radius: var(--cursor-radius-md);
            background: var(--cursor-bg-secondary); color: var(--cursor-text);
            font-size: 0.875rem; font-weight: 500; cursor: pointer;
            transition: all 0.15s ease; white-space: nowrap; text-decoration: none;
        }
        .btn:hover { background: var(--cursor-bg-hover); border-color: var(--cursor-border); color: var(--cursor-text); }
        .btn:focus { outline: 2px solid var(--cursor-accent); outline-offset: 2px; }
        .btn--primary { background: var(--cursor-accent); border-color: var(--cursor-accent); color: #fff; }
        .btn--primary:hover { background: var(--cursor-accent-hover); border-color: var(--cursor-accent-hover); color: #fff; }
        .btn--sm { padding: calc(var(--cursor-space-sm) * 0.75) var(--cursor-space-sm); font-size: 0.8125rem; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--cursor-bg); }
        ::-webkit-scrollbar-thumb { background: var(--cursor-border); border-radius: var(--cursor-radius-sm); }
        ::-webkit-scrollbar-thumb:hover { background: var(--cursor-bg-hover); }

        /* ===== Layout Shell ===== */
        .notepad-container {
            height: 100vh;
            background: var(--cursor-bg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ===== Header ===== */
        .notepad-header {
            background: var(--cursor-bg-secondary);
            border-bottom: 1px solid var(--cursor-border);
            padding: var(--cursor-space-sm) var(--cursor-space-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--cursor-space-md);
            flex-shrink: 0;
            min-height: 52px;
            flex-wrap: wrap;
        }

        .notepad-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--cursor-text);
            display: flex;
            align-items: baseline;
            gap: var(--cursor-space-sm);
            white-space: nowrap;
            min-width: 0;
        }

        .notepad-title .subtitle {
            font-size: 0.8125rem;
            font-weight: 400;
            color: var(--cursor-text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .quantum-status {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
            font-size: 0.875rem;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .quantum-status .status-badges {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
        }

        .quantum-status .header-actions {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
        }

        /* ===== Main Content Split ===== */
        .notepad-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            min-height: 0;
        }

        /* ===== Cells Area ===== */
        .cells-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--cursor-space-lg);
            scroll-behavior: smooth;
            min-width: 0;
        }

        /* ===== Cell Card ===== */
        .quantum-cell {
            margin-bottom: var(--cursor-space-lg);
            background: var(--cursor-bg-secondary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-lg);
            overflow: hidden;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .quantum-cell:hover {
            border-color: var(--cursor-accent-subtle);
            box-shadow: 0 0 0 1px rgba(88, 166, 255, 0.15);
        }

        .quantum-cell.focused {
            border-color: var(--cursor-accent);
            box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.25);
        }

        .cell-header {
            padding: var(--cursor-space-xs) var(--cursor-space-md);
            background: var(--cursor-bg-tertiary);
            border-bottom: 1px solid var(--cursor-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--cursor-space-sm);
            min-height: 36px;
        }

        .cell-type {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--cursor-text-muted);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            letter-spacing: 0.3px;
            white-space: nowrap;
            min-width: 0;
        }

        .cell-type .cell-coords {
            font-size: 0.625rem;
            color: var(--cursor-text-muted);
            opacity: 0.7;
            margin-left: var(--cursor-space-xs);
        }

        .cell-actions {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }

        .cell-actions .btn--sm {
            padding: 3px 8px;
            font-size: 0.75rem;
            line-height: 1.4;
        }

        /* ===== Quantum Prefix Gutter ===== */
        .cell-editor {
            position: relative;
            display: flex;
        }

        .quantum-gutter {
            flex-shrink: 0;
            width: 54px;
            min-height: 80px;
            padding: var(--cursor-space-md) 0 var(--cursor-space-md) 6px;
            background: var(--cursor-bg);
            border-right: 1px solid var(--cursor-border-muted);
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
            line-height: 1.65;
            color: var(--cursor-text-muted);
            overflow: hidden;
            user-select: none;
            white-space: pre;
            /* Match textarea font metrics exactly for line alignment */
            box-sizing: border-box;
        }

        .quantum-gutter .gutter-line {
            display: flex;
            align-items: baseline;
            /* Must match textarea: font-size 0.8125rem * line-height 1.65 */
            height: calc(0.8125rem * 1.65);
            line-height: calc(0.8125rem * 1.65);
            overflow: hidden;
        }

        .quantum-gutter .gutter-prefix {
            width: 26px;
            text-align: right;
            font-weight: 700;
            flex-shrink: 0;
        }

        .quantum-gutter .gutter-num {
            width: 22px;
            text-align: right;
            opacity: 0.5;
            flex-shrink: 0;
            margin-left: 2px;
        }

        /* Prefix color coding */
        .pfx-shebang  { color: #f0d852; }
        .pfx-comment  { color: #7ee787; }
        .pfx-import   { color: #d2a8ff; }
        .pfx-class    { color: #79c0ff; }
        .pfx-function { color: #58a6ff; }
        .pfx-error    { color: #f97583; }
        .pfx-condition{ color: #f0883e; }
        .pfx-loop     { color: #ff9bce; }
        .pfx-return   { color: #b392f0; }
        .pfx-output   { color: #56d364; }
        .pfx-variable { color: #79c0ff; }
        .pfx-decorator{ color: #7ee787; }
        .pfx-default  { color: var(--cursor-text-muted); }

        /* ===== Execution Progress Bar ===== */
        .exec-progress {
            height: 0;
            overflow: hidden;
            background: var(--cursor-bg-tertiary);
            border-bottom: none;
            transition: height 0.3s ease;
            position: relative;
        }

        .exec-progress.active {
            height: 32px;
            border-bottom: 1px solid var(--cursor-border);
        }

        .exec-progress-inner {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 12px;
            height: 32px;
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
        }

        .exec-progress-label {
            color: var(--cursor-text-muted);
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 65px;
        }

        .exec-progress-track {
            flex: 1;
            height: 10px;
            background: var(--cursor-bg);
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid var(--cursor-border-muted);
            position: relative;
        }

        .exec-progress-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, var(--cursor-accent), #7ee787);
            width: 0%;
            transition: width 0.35s ease;
            position: relative;
        }

        .exec-progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 20px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3));
            border-radius: 0 5px 5px 0;
        }

        .exec-progress.active .exec-progress-fill {
            animation: exec-shimmer 1.5s ease infinite;
        }

        @keyframes exec-shimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .exec-progress-pct {
            color: var(--cursor-accent);
            font-weight: 700;
            min-width: 36px;
            text-align: right;
            flex-shrink: 0;
        }

        .exec-progress-detail {
            color: var(--cursor-text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            flex-shrink: 0;
        }

        .exec-progress-elapsed {
            color: var(--cursor-text-muted);
            opacity: 0.6;
            flex-shrink: 0;
            min-width: 48px;
            text-align: right;
        }

        /* ===== Convert Timeline Bar ===== */
        .convert-timeline {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            background: var(--cursor-bg-tertiary);
            border-bottom: 1px solid var(--cursor-border);
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
            min-height: 28px;
            overflow: hidden;
        }

        .convert-timeline .ctl-label {
            color: var(--cursor-text-muted);
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .convert-timeline .ctl-track {
            flex: 1;
            height: 14px;
            background: var(--cursor-bg);
            border-radius: 7px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--cursor-border-muted);
        }

        .convert-timeline .ctl-fill {
            height: 100%;
            border-radius: 7px;
            background: linear-gradient(90deg, #58a6ff 0%, #7ee787 40%, #f0883e 70%, #d2a8ff 100%);
            width: 0%;
            transition: width 0.6s ease;
        }

        .convert-timeline .ctl-segments {
            position: absolute;
            inset: 0;
            display: flex;
        }

        .convert-timeline .ctl-seg {
            flex: 1;
            border-right: 1px solid var(--cursor-border-muted);
            position: relative;
        }

        .convert-timeline .ctl-seg:last-child { border-right: none; }

        .convert-timeline .ctl-seg-label {
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.5rem;
            color: var(--cursor-text-muted);
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .convert-timeline:hover .ctl-seg-label { opacity: 1; }

        .convert-timeline .ctl-stats {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .convert-timeline .ctl-stat {
            color: var(--cursor-text-secondary);
        }

        .convert-timeline .ctl-stat b {
            color: var(--cursor-accent);
        }

        .convert-timeline.converting .ctl-fill {
            animation: ctl-pulse 1s ease infinite;
        }

        @keyframes ctl-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .cell-textarea {
            display: block;
            flex: 1;
            min-width: 0;
            min-height: 80px;
            padding: var(--cursor-space-md);
            background: transparent;
            border: none;
            color: var(--cursor-text);
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            line-height: 1.65;
            resize: none;
            outline: none;
            box-sizing: border-box;
            tab-size: 4;
            -moz-tab-size: 4;
        }

        .cell-textarea:focus {
            background: rgba(88, 166, 255, 0.02);
        }

        .cell-textarea::placeholder {
            color: var(--cursor-text-muted);
            opacity: 0.5;
        }

        /* ===== Cell Output ===== */
        .cell-output {
            padding: var(--cursor-space-sm) var(--cursor-space-md);
            background: var(--cursor-bg);
            border-top: 1px solid var(--cursor-border);
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            line-height: 1.5;
            overflow-x: auto;
            word-break: break-word;
        }

        .output-text {
            color: var(--cursor-text-secondary);
            padding: 2px 0;
        }

        .output-text:last-child {
            margin-bottom: 0;
        }

        .output-error {
            color: var(--cursor-danger);
            background: rgba(248, 81, 73, 0.08);
            padding: var(--cursor-space-sm) var(--cursor-space-md);
            border-radius: var(--cursor-radius-md);
            border: 1px solid rgba(248, 81, 73, 0.2);
            margin: var(--cursor-space-xs) 0;
        }

        .output-plot {
            max-width: 100%;
            height: auto;
            border-radius: var(--cursor-radius-md);
            box-shadow: var(--cursor-shadow-md);
            display: block;
        }

        .output-html h1 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--cursor-space-sm);
            color: var(--cursor-text);
        }

        .output-html h2 {
            font-size: 1.0625rem;
            font-weight: 600;
            margin-bottom: var(--cursor-space-xs);
            color: var(--cursor-text);
        }

        .output-html strong {
            color: var(--cursor-text);
        }

        /* ===== Sidebar ===== */
        .quantum-sidebar {
            width: 260px;
            flex-shrink: 0;
            background: var(--cursor-bg-secondary);
            border-left: 1px solid var(--cursor-border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-section {
            padding: var(--cursor-space-md);
            border-bottom: 1px solid var(--cursor-border-muted);
        }

        .sidebar-title {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--cursor-text-muted);
            margin-bottom: var(--cursor-space-sm);
            letter-spacing: 0.5px;
        }

        /* ===== Sidebar Tabs ===== */
        .sidebar-tabs {
            display: flex; gap: 0; border-bottom: 1px solid var(--cursor-border-muted);
        }
        .sidebar-tab {
            flex: 1; padding: 6px 4px; font-size: 0.625rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.5px; text-align: center;
            color: var(--cursor-text-muted); background: transparent; border: none;
            cursor: pointer; transition: all 0.15s ease; border-bottom: 2px solid transparent;
        }
        .sidebar-tab:hover { color: var(--cursor-text-secondary); background: var(--cursor-bg-hover); }
        .sidebar-tab.active { color: var(--cursor-accent); border-bottom-color: var(--cursor-accent); }
        .sidebar-tab-panel { display: none; }
        .sidebar-tab-panel.active { display: block; }

        /* ===== Quantum Thermal Viz ===== */
        .thermal-viz { padding: var(--cursor-space-sm); }
        .thermal-canvas-wrap {
            position: relative; width: 100%; aspect-ratio: 1;
            background: #0a0e14; border-radius: var(--cursor-radius-md);
            border: 1px solid var(--cursor-border); overflow: hidden; margin-bottom: 8px;
        }
        .thermal-canvas-wrap canvas { width: 100%; height: 100%; display: block; }
        .thermal-controls {
            display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 8px;
        }
        .thermal-btn {
            flex: 1; min-width: 48px; padding: 4px 6px; font-size: 0.625rem; font-weight: 600;
            border: 1px solid var(--cursor-border); border-radius: var(--cursor-radius-sm);
            background: var(--cursor-bg-tertiary); color: var(--cursor-text-secondary);
            cursor: pointer; transition: all 0.15s ease; text-align: center;
        }
        .thermal-btn:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }
        .thermal-btn.active { background: var(--cursor-accent-subtle); color: #fff; border-color: var(--cursor-accent); }
        .thermal-legend {
            display: flex; align-items: center; gap: 4px; margin-bottom: 6px;
        }
        .thermal-gradient {
            flex: 1; height: 10px; border-radius: 5px;
            background: linear-gradient(90deg, #00bfff 0%, #3fb950 30%, #f0883e 60%, #f85149 85%, #ff4500 100%);
        }
        .thermal-legend-label { font-size: 0.5625rem; color: var(--cursor-text-muted); white-space: nowrap; }
        .thermal-stat-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 3px 0; font-size: 0.625rem; color: var(--cursor-text-secondary);
            border-bottom: 1px solid var(--cursor-border-muted);
        }
        .thermal-stat-row:last-child { border-bottom: none; }
        .thermal-stat-val {
            font-family: var(--cursor-font-mono); font-weight: 600; font-size: 0.6875rem;
        }
        .thermal-stat-val.cryo { color: #00bfff; }
        .thermal-stat-val.warm { color: #f0883e; }
        .thermal-stat-val.hot { color: #f85149; }
        .thermal-stat-val.qbit { color: #d2a8ff; }
        .gpu-qubit-bar {
            height: 6px; border-radius: 3px; background: var(--cursor-bg);
            overflow: hidden; margin: 3px 0;
        }
        .gpu-qubit-fill {
            height: 100%; border-radius: 3px;
            transition: width 0.6s ease;
        }
        .thermal-section-label {
            font-size: 0.5625rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.6px; color: var(--cursor-text-muted); margin: 8px 0 4px;
        }
        .lattice-info {
            font-size: 0.5625rem; color: var(--cursor-text-muted); line-height: 1.5;
            padding: 4px 6px; background: var(--cursor-bg); border-radius: var(--cursor-radius-sm);
        }
        .lattice-info strong { color: var(--cursor-text-secondary); }

        /* ===== Hex/Fax Overlay ===== */
        .hex-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.92); z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .hex-overlay canvas {
            width: min(100vw, 100vh); height: min(100vw, 100vh);
            image-rendering: pixelated; border: 1px solid var(--cursor-border);
        }
        .hex-overlay-bar {
            display: flex; gap: 8px; padding: 8px; background: var(--cursor-bg-secondary);
            border-radius: var(--cursor-radius-md); margin-bottom: 8px;
        }
        .hex-overlay-bar button {
            padding: 4px 12px; font-size: 0.75rem; border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm); background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-secondary); cursor: pointer;
        }
        .hex-overlay-bar button:hover { background: var(--cursor-bg-hover); }
        .hex-overlay-bar button.active { background: var(--cursor-accent-subtle); color: #fff; border-color: var(--cursor-accent); }

        /* ===== Tools Dropdown ===== */
        .tools-dropdown {
            position: absolute; bottom: 100%; left: 0; min-width: 220px;
            background: var(--cursor-bg-secondary); border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md); box-shadow: 0 -4px 16px rgba(0,0,0,0.4);
            padding: 4px 0; display: none; z-index: 900; max-height: 320px; overflow-y: auto;
        }
        .tools-dropdown.show { display: block; }
        .tools-dropdown-header {
            padding: 4px 10px; font-size: 0.5625rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.6px; color: var(--cursor-text-muted);
        }
        .tools-dropdown-item {
            padding: 6px 10px; font-size: 0.6875rem; color: var(--cursor-text-secondary);
            cursor: pointer; display: flex; align-items: center; gap: 6px;
        }
        .tools-dropdown-item:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }

        /* ===== Quantum Nav Grid ===== */
        .quantum-nav-mini {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--cursor-space-sm);
            margin-bottom: var(--cursor-space-md);
            padding: var(--cursor-space-xs);
            background: var(--cursor-bg);
            border-radius: var(--cursor-radius-md);
        }

        .nav-btn {
            aspect-ratio: 1;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-secondary);
            font-family: var(--cursor-font-mono);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
            border-color: var(--cursor-text-muted);
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .nav-btn.active {
            background: var(--cursor-accent);
            color: #ffffff;
            border-color: var(--cursor-accent);
            font-weight: 600;
        }

        .position-display {
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: var(--cursor-space-sm) var(--cursor-space-md);
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            color: var(--cursor-accent);
            text-align: center;
            letter-spacing: 0.5px;
        }

        /* ===== Quantum Stream History ===== */
        .quantum-stream {
            margin-top: var(--cursor-space-sm);
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            overflow: hidden;
        }

        .stream-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 8px;
            background: var(--cursor-bg-tertiary);
            border-bottom: 1px solid var(--cursor-border-muted);
        }

        .stream-title {
            font-size: 0.5625rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--cursor-text-muted);
            letter-spacing: 0.5px;
        }

        .stream-pipe-btns {
            display: flex;
            gap: 3px;
        }

        .stream-pipe-btn {
            font-size: 0.5625rem;
            font-family: var(--cursor-font-mono);
            padding: 1px 5px;
            border: 1px solid var(--cursor-border);
            border-radius: 3px;
            background: var(--cursor-bg-secondary);
            color: var(--cursor-text-muted);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .stream-pipe-btn:hover {
            background: var(--cursor-accent);
            color: #fff;
            border-color: var(--cursor-accent);
        }

        .stream-pipe-btn.active {
            background: var(--cursor-accent);
            color: #fff;
            border-color: var(--cursor-accent);
        }

        .stream-log {
            max-height: 120px;
            overflow-y: auto;
            padding: 4px 0;
            font-family: var(--cursor-font-mono);
            font-size: 0.625rem;
            line-height: 1.6;
        }

        .stream-log::-webkit-scrollbar { width: 3px; }
        .stream-log::-webkit-scrollbar-thumb { background: var(--cursor-border); border-radius: 3px; }

        .stream-entry {
            padding: 1px 8px;
            color: var(--cursor-text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
            transition: background 0.1s ease;
        }

        .stream-entry:hover {
            background: var(--cursor-bg-hover);
        }

        .stream-entry.stream-origin {
            color: var(--cursor-accent);
            font-weight: 600;
        }

        .stream-entry.stream-nav {
            color: var(--cursor-text-secondary);
        }

        .stream-entry.stream-exec {
            color: #7ee787;
        }

        .stream-entry.stream-paste {
            color: #d2a8ff;
        }

        .stream-entry.stream-pipe {
            color: #f0883e;
        }

        .stream-entry .stream-ts {
            opacity: 0.4;
            font-size: 0.5rem;
            min-width: 32px;
        }

        .stream-source {
            padding: 6px 8px;
            border-top: 1px solid var(--cursor-border-muted);
        }

        .stream-source-input {
            width: 100%;
            background: var(--cursor-bg-secondary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm);
            color: var(--cursor-text);
            font-family: var(--cursor-font-mono);
            font-size: 0.625rem;
            padding: 4px 6px;
            resize: none;
            outline: none;
            box-sizing: border-box;
        }

        .stream-source-input:focus {
            border-color: var(--cursor-accent);
        }

        /* ===== Cell Overview List ===== */
        .cell-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .cell-list-item {
            padding: var(--cursor-space-xs) var(--cursor-space-sm);
            border-radius: var(--cursor-radius-sm);
            margin-bottom: 2px;
            cursor: pointer;
            transition: background 0.1s ease;
            font-size: 0.75rem;
            color: var(--cursor-text-secondary);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .cell-list-item:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
        }

        .cell-list-item.active {
            background: var(--cursor-accent-subtle);
            color: var(--cursor-accent);
        }

        .cell-list-item .cell-list-icon {
            flex-shrink: 0;
        }

        /* ===== Performance Stats ===== */
        .perf-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2px 0;
            font-size: 0.75rem;
            color: var(--cursor-text-secondary);
        }

        .perf-row span:last-child {
            font-family: var(--cursor-font-mono);
            color: var(--cursor-text-muted);
            font-size: 0.6875rem;
        }

        .perf-toggles {
            margin-top: var(--cursor-space-sm);
            display: flex;
            flex-direction: column;
            gap: var(--cursor-space-xs);
        }

        .perf-toggles label {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            font-size: 0.75rem;
            color: var(--cursor-text-secondary);
            cursor: pointer;
        }

        .perf-toggles input[type="checkbox"] {
            accent-color: var(--cursor-accent);
        }

        /* ===== Virtual / Infinite Scroll ===== */
        .virtual-cell {
            height: 200px;
            background: var(--cursor-bg-tertiary);
            border: 1px dashed var(--cursor-border);
            border-radius: var(--cursor-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--cursor-text-muted);
            font-style: italic;
            margin-bottom: var(--cursor-space-lg);
        }

        /* ===== Performance Mode ===== */
        .performance-mode .quantum-cell {
            contain: layout style paint;
            will-change: transform;
        }

        /* ===== Auto-growing Textarea ===== */
        .auto-resize {
            overflow: hidden;
            resize: none;
        }

        /* ===== Keyboard Hint ===== */
        .kbd-hint {
            font-size: 0.625rem;
            color: var(--cursor-text-muted);
            opacity: 0.6;
            margin-left: 4px;
            font-family: var(--cursor-font-mono);
        }

        /* ===== Empty State ===== */
        .empty-state {
            text-align: center;
            padding: var(--cursor-space-2xl) var(--cursor-space-lg);
            color: var(--cursor-text-muted);
        }

        .empty-state p {
            margin-top: var(--cursor-space-sm);
            font-size: 0.875rem;
        }

        /* ===== Inspect Panel Overlay ===== */
        .inspect-overlay {
            position: fixed;
            inset: 0;
            z-index: 900;
            display: none;
        }

        .inspect-overlay.open {
            display: flex;
        }

        .inspect-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(4px);
        }

        .inspect-panel {
            position: relative;
            margin: 24px auto;
            width: min(960px, calc(100vw - 48px));
            max-height: calc(100vh - 48px);
            background: var(--cursor-bg-secondary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-xl);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--cursor-shadow-xl), 0 0 80px rgba(88, 166, 255, 0.06);
            z-index: 1;
        }

        .inspect-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--cursor-space-md) var(--cursor-space-lg);
            border-bottom: 1px solid var(--cursor-border);
            flex-shrink: 0;
        }

        .inspect-header h2 {
            font-size: 1.0625rem;
            font-weight: 600;
            color: var(--cursor-text);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
        }

        .inspect-close {
            background: none;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            color: var(--cursor-text-muted);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.125rem;
            transition: all 0.15s ease;
        }

        .inspect-close:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
        }

        .inspect-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--cursor-space-lg);
        }

        /* --- Inspect sections --- */
        .inspect-section {
            margin-bottom: var(--cursor-space-xl);
        }

        .inspect-section:last-child {
            margin-bottom: 0;
        }

        .inspect-section h3 {
            font-size: 0.8125rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--cursor-accent);
            margin-bottom: var(--cursor-space-md);
            padding-bottom: var(--cursor-space-xs);
            border-bottom: 1px solid var(--cursor-border-muted);
        }

        .inspect-section p,
        .inspect-section li {
            font-size: 0.8125rem;
            line-height: 1.65;
            color: var(--cursor-text-secondary);
        }

        .inspect-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .inspect-section li {
            padding: 3px 0;
            padding-left: 1.1em;
            position: relative;
        }

        .inspect-section li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.65em;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--cursor-accent);
            opacity: 0.6;
        }

        /* --- Limits grid --- */
        .limits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--cursor-space-md);
        }

        .limit-card {
            background: var(--cursor-bg-tertiary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: var(--cursor-space-md);
        }

        .limit-card .limit-label {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            color: var(--cursor-text-muted);
            margin-bottom: 4px;
        }

        .limit-card .limit-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--cursor-text);
            font-family: var(--cursor-font-mono);
        }

        .limit-card .limit-note {
            font-size: 0.6875rem;
            color: var(--cursor-text-muted);
            margin-top: 4px;
            line-height: 1.4;
        }

        /* --- Comparison table --- */
        .compare-table-wrap {
            overflow-x: auto;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
        }

        .compare-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .compare-table th,
        .compare-table td {
            padding: 7px 10px;
            border-bottom: 1px solid var(--cursor-border-muted);
            text-align: left;
        }

        .compare-table thead th {
            background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-muted);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.625rem;
            letter-spacing: 0.4px;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .compare-table thead th:first-child {
            position: sticky;
            left: 0;
            z-index: 2;
        }

        .compare-table tbody td:first-child {
            position: sticky;
            left: 0;
            background: var(--cursor-bg-secondary);
            font-weight: 600;
            color: var(--cursor-text);
            border-right: 1px solid var(--cursor-border);
            z-index: 1;
        }

        .compare-table tbody tr:hover td {
            background: var(--cursor-bg-tertiary);
        }

        .compare-table tbody tr:hover td:first-child {
            background: var(--cursor-bg-hover);
        }

        .compare-table .self-col {
            background: rgba(88, 166, 255, 0.06);
            color: var(--cursor-accent);
            font-weight: 500;
        }

        .compare-table thead .self-col {
            background: rgba(88, 166, 255, 0.12);
            color: var(--cursor-accent);
        }

        .cmp-yes  { color: var(--cursor-success); }
        .cmp-no   { color: var(--cursor-text-muted); opacity: 0.6; }
        .cmp-part { color: var(--cursor-warning); }
        .cmp-mid  { color: #8b9cf7; font-style: italic; }
        .cmp-best { color: var(--cursor-accent); font-weight: 600; }

        /* --- Tag pills --- */
        .tag-row {
            display: flex;
            flex-wrap: wrap;
            gap: var(--cursor-space-xs);
            margin-top: var(--cursor-space-sm);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 0.6875rem;
            font-weight: 500;
        }

        .tag--green  { background: rgba(63,185,80,0.15); color: #7ee787; border: 1px solid rgba(63,185,80,0.25); }
        .tag--blue   { background: rgba(88,166,255,0.12); color: #79c0ff; border: 1px solid rgba(88,166,255,0.2); }
        .tag--yellow { background: rgba(210,153,34,0.15); color: #f0d852; border: 1px solid rgba(210,153,34,0.25); }
        .tag--red    { background: rgba(248,81,73,0.12); color: #f97583; border: 1px solid rgba(248,81,73,0.2); }
        .tag--purple { background: rgba(210,168,255,0.12); color: #d2a8ff; border: 1px solid rgba(210,168,255,0.22); }

        /* ===== SOW Phase Timeline ===== */
        .sow-timeline {
            display: flex;
            flex-direction: column;
            gap: 0;
            position: relative;
            padding-left: 28px;
        }

        .sow-timeline::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            background: var(--cursor-border);
        }

        .sow-phase {
            position: relative;
            padding: var(--cursor-space-md);
            padding-left: var(--cursor-space-md);
            background: var(--cursor-bg-tertiary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            margin-bottom: var(--cursor-space-md);
        }

        .sow-phase::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 18px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--cursor-border);
            background: var(--cursor-bg);
        }

        .sow-phase.phase-done::before {
            background: var(--cursor-success);
            border-color: var(--cursor-success);
        }

        .sow-phase.phase-active::before {
            background: var(--cursor-accent);
            border-color: var(--cursor-accent);
            box-shadow: 0 0 8px rgba(88,166,255,0.4);
        }

        .sow-phase.phase-next::before {
            background: var(--cursor-bg);
            border-color: var(--cursor-text-muted);
        }

        .sow-phase-title {
            font-size: 0.8125rem;
            font-weight: 700;
            color: var(--cursor-text);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
        }

        .sow-phase-title .phase-tag {
            font-size: 0.625rem;
            font-weight: 600;
            padding: 1px 7px;
            border-radius: 10px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .phase-tag--done { background: rgba(63,185,80,0.2); color: #7ee787; }
        .phase-tag--active { background: rgba(88,166,255,0.2); color: #79c0ff; }
        .phase-tag--next { background: rgba(139,156,247,0.15); color: #8b9cf7; }
        .phase-tag--future { background: rgba(210,153,34,0.15); color: #f0d852; }

        .sow-phase-body {
            font-size: 0.75rem;
            color: var(--cursor-text-secondary);
            line-height: 1.6;
        }

        .sow-phase-body ul {
            list-style: none;
            padding: 0;
            margin: var(--cursor-space-xs) 0 0 0;
        }

        .sow-phase-body li {
            padding: 2px 0 2px 1em;
            position: relative;
            font-size: 0.75rem;
        }

        .sow-phase-body li::before {
            content: '›';
            position: absolute;
            left: 0;
            color: var(--cursor-accent);
            font-weight: 700;
        }

        /* --- Benchmark grid --- */
        .bench-grid {
            display: grid;
            grid-template-columns: 2.4fr repeat(10, 1fr);
            gap: 0;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            overflow: hidden;
            font-size: 0.6875rem;
        }

        .bench-grid .bg-hd {
            background: var(--cursor-bg-tertiary);
            padding: 6px 8px;
            font-weight: 600;
            color: var(--cursor-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border-bottom: 1px solid var(--cursor-border);
            display: flex;
            align-items: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bench-grid .bg-hd.self-hd {
            background: rgba(88,166,255,0.12);
            color: var(--cursor-accent);
            font-weight: 700;
        }

        .bench-grid .bg-cell {
            padding: 5px 8px;
            border-bottom: 1px solid var(--cursor-border-muted);
            color: var(--cursor-text-secondary);
            display: flex;
            align-items: center;
            overflow: hidden;
        }

        .bench-grid .bg-cell.bg-cap {
            font-weight: 600;
            color: var(--cursor-text);
            background: var(--cursor-bg-secondary);
            border-right: 1px solid var(--cursor-border);
            white-space: nowrap;
        }

        .bench-grid .bg-cell.bg-self {
            background: rgba(88,166,255,0.05);
            color: var(--cursor-accent);
            font-weight: 600;
        }

        .bench-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .bench-dot--yes { background: #7ee787; }
        .bench-dot--part { background: #f0d852; }
        .bench-dot--no { background: #484f58; }
        .bench-dot--best { background: #58a6ff; box-shadow: 0 0 6px rgba(88,166,255,0.5); }

        /* ===== Enhancement Plan Cards ===== */
        .plan-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--cursor-space-md);
        }

        .plan-card {
            background: var(--cursor-bg-tertiary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: var(--cursor-space-md);
            display: flex;
            flex-direction: column;
        }

        .plan-card-header {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            margin-bottom: var(--cursor-space-sm);
        }

        .plan-card-header .plan-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .plan-card-header .plan-title {
            font-size: 0.8125rem;
            font-weight: 700;
            color: var(--cursor-text);
        }

        .plan-card-body {
            font-size: 0.6875rem;
            color: var(--cursor-text-secondary);
            line-height: 1.55;
            flex: 1;
        }

        .plan-card-body code {
            font-size: 0.625rem;
            background: var(--cursor-bg);
            padding: 1px 4px;
            border-radius: 3px;
            color: var(--cursor-accent);
        }

        .plan-card-body ul {
            list-style: none;
            padding: 0;
            margin: 4px 0 0 0;
        }

        .plan-card-body li {
            padding: 1px 0 1px 0.9em;
            position: relative;
            font-size: 0.6875rem;
        }

        .plan-card-body li::before {
            content: '›';
            position: absolute;
            left: 0;
            color: var(--cursor-accent);
            font-weight: 700;
        }

        .plan-card-footer {
            margin-top: var(--cursor-space-sm);
            padding-top: var(--cursor-space-xs);
            border-top: 1px solid var(--cursor-border-muted);
        }

        .plan-card-footer .tag {
            font-size: 0.5625rem;
        }

        .prefix-demo {
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: var(--cursor-space-md);
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
            line-height: 1.7;
            overflow-x: auto;
            margin: var(--cursor-space-md) 0;
        }

        .prefix-demo .pf { color: var(--cursor-accent); font-weight: 600; }
        .prefix-demo .tg { color: #f97583; }
        .prefix-demo .at { color: #d2a8ff; }
        .prefix-demo .tx { color: var(--cursor-text-secondary); }
        .prefix-demo .cm { color: #8b949e; font-style: italic; }

        /* ===== Language Benchmark Chart ===== */
        .lang-chart {
            margin: var(--cursor-space-md) 0;
        }

        .lang-chart-row {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
            padding: 4px 0;
        }

        .lang-chart-label {
            width: 90px;
            flex-shrink: 0;
            font-size: 0.6875rem;
            font-weight: 600;
            color: var(--cursor-text);
            text-align: right;
            font-family: var(--cursor-font-mono);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
        }

        .lang-chart-bar-wrap {
            flex: 1;
            height: 20px;
            background: var(--cursor-bg);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--cursor-border-muted);
        }

        .lang-chart-bar {
            height: 100%;
            border-radius: 3px;
            display: flex;
            align-items: center;
            padding-left: 8px;
            font-size: 0.5625rem;
            font-weight: 600;
            color: #fff;
            white-space: nowrap;
            transition: width 0.6s ease;
        }

        .lang-chart-value {
            width: 48px;
            flex-shrink: 0;
            font-size: 0.625rem;
            font-family: var(--cursor-font-mono);
            color: var(--cursor-text-muted);
            text-align: right;
        }

        .lang-chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: var(--cursor-space-sm);
            margin-top: var(--cursor-space-sm);
            padding-top: var(--cursor-space-xs);
            border-top: 1px solid var(--cursor-border-muted);
        }

        .lang-chart-legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.625rem;
            color: var(--cursor-text-muted);
        }

        .lang-chart-legend-item .ldot {
            width: 8px;
            height: 8px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        /* ===== Mermaid Diagrams ===== */
        .mermaid-output {
            padding: var(--cursor-space-md);
            background: var(--cursor-bg);
            border-top: 1px solid var(--cursor-border);
            overflow-x: auto;
            display: flex;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: background 0.2s ease;
        }

        .mermaid-output:hover {
            background: var(--cursor-bg-tertiary);
        }

        .mermaid-output::after {
            content: '↗ Click to expand';
            position: absolute;
            top: 6px;
            right: 8px;
            font-size: 0.5625rem;
            color: var(--cursor-text-muted);
            background: var(--cursor-bg-secondary);
            padding: 2px 6px;
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }

        .mermaid-output:hover::after {
            opacity: 1;
        }

        .mermaid-output svg {
            max-width: 100%;
            height: auto;
        }

        /* ===== Layer Navigator ===== */
        .layer-nav {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            margin-top: var(--cursor-space-sm);
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: 4px 8px;
        }

        .layer-nav .layer-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm);
            background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-secondary);
            font-size: 0.8125rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            flex-shrink: 0;
        }

        .layer-nav .layer-btn:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
            border-color: var(--cursor-text-muted);
        }

        .layer-nav .layer-btn:active { transform: scale(0.92); }

        .layer-label {
            flex: 1;
            text-align: center;
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
            color: var(--cursor-text-muted);
            letter-spacing: 0.3px;
            white-space: nowrap;
        }

        .layer-label strong {
            color: var(--cursor-accent);
            font-size: 0.8125rem;
            transition: transform 0.3s ease, color 0.3s ease;
            display: inline-block;
        }

        /* ===== Footer Terminal ===== */
        .notepad-footer {
            flex-shrink: 0;
            background: var(--cursor-bg-secondary);
            border-top: 1px solid var(--cursor-border);
            padding: var(--cursor-space-sm) var(--cursor-space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--cursor-space-xs);
        }

        .footer-ai-row {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
        }

        .footer-ai-row input {
            flex: 1;
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-accent);
            border-radius: var(--cursor-radius-sm);
            padding: 6px 10px;
            color: var(--cursor-text);
            font-size: 0.8125rem;
            font-family: inherit;
            outline: none;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .footer-ai-row input:focus {
            border-color: var(--cursor-accent);
            box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.15);
        }

        .footer-ai-row input::placeholder {
            color: var(--cursor-text-muted);
            opacity: 0.6;
        }

        .footer-cmd-row {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
        }

        .footer-prompt-symbol {
            color: var(--cursor-accent);
            font-weight: 700;
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            flex-shrink: 0;
        }

        .footer-cmd-row input {
            flex: 1;
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm);
            padding: 6px 10px;
            color: var(--cursor-text);
            font-size: 0.8125rem;
            font-family: var(--cursor-font-mono);
            outline: none;
            transition: border-color 0.15s ease;
        }

        .footer-cmd-row input:focus {
            border-color: var(--cursor-accent);
        }

        .footer-cmd-row input::placeholder {
            color: var(--cursor-text-muted);
            opacity: 0.5;
        }

        .footer-quick-cmds {
            display: flex;
            gap: var(--cursor-space-xs);
            flex-wrap: wrap;
        }

        .footer-quick-cmds .btn--xs {
            padding: 2px 8px;
            font-size: 0.6875rem;
            border-radius: 12px;
            font-weight: 500;
        }

        /* ===== Cell Output Overlay ===== */
        .cell-overlay {
            position: fixed;
            inset: 0;
            z-index: 800;
            display: none;
        }

        .cell-overlay.open { display: flex; }

        .cell-overlay .cell-overlay-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(4px);
        }

        .cell-overlay-panel {
            position: relative;
            margin: 32px auto;
            width: min(960px, calc(100vw - 48px));
            max-height: calc(100vh - 64px);
            background: var(--cursor-bg-secondary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-xl);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--cursor-shadow-xl), 0 0 60px rgba(88, 166, 255, 0.08);
            z-index: 1;
        }

        .cell-overlay-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--cursor-space-sm) var(--cursor-space-lg);
            border-bottom: 1px solid var(--cursor-border);
            flex-shrink: 0;
        }

        .cell-overlay-header h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--cursor-text);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
            margin: 0;
            text-transform: none;
            border: none;
            padding: 0;
        }

        .cell-overlay-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--cursor-space-lg);
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            line-height: 1.65;
            color: var(--cursor-text-secondary);
        }

        /* ===== Comparison Scorecard ===== */
        .scorecard {
            display: flex;
            gap: var(--cursor-space-md);
            margin-bottom: var(--cursor-space-lg);
            flex-wrap: wrap;
        }

        .score-pill {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .score-pill--wins {
            background: rgba(63, 185, 80, 0.15);
            color: #7ee787;
            border: 1px solid rgba(63, 185, 80, 0.3);
        }

        .score-pill--roadmap {
            background: rgba(139, 156, 247, 0.12);
            color: #8b9cf7;
            border: 1px solid rgba(139, 156, 247, 0.25);
        }

        .score-pill--gap {
            background: rgba(248, 81, 73, 0.08);
            color: var(--cursor-text-muted);
            border: 1px solid rgba(248, 81, 73, 0.15);
        }

        .score-pill .score-num {
            font-size: 1.0625rem;
            font-weight: 700;
        }

        /* Enhanced self-col glow */
        .compare-table .self-col {
            background: rgba(88, 166, 255, 0.08);
            color: var(--cursor-accent);
            font-weight: 600;
        }

        .compare-table thead .self-col {
            background: rgba(88, 166, 255, 0.15);
            color: var(--cursor-accent);
            font-weight: 700;
            text-shadow: 0 0 12px rgba(88, 166, 255, 0.3);
        }

        .compare-table tbody tr:hover .self-col {
            background: rgba(88, 166, 255, 0.14);
        }

        /* ===== Responsive ===== */
        @media (max-width: 1100px) {
            .notepad-header {
                padding: var(--cursor-space-sm) var(--cursor-space-md);
            }

            .notepad-header .status-badges {
                display: none;
            }

            .quantum-sidebar {
                width: 220px;
            }

            .notepad-footer {
                padding: var(--cursor-space-sm) var(--cursor-space-md);
            }
        }

        @media (max-width: 860px) {
            .notepad-content {
                flex-direction: column;
            }

            .quantum-sidebar {
                width: 100%;
                max-height: 220px;
                border-left: none;
                border-top: 1px solid var(--cursor-border);
                flex-direction: row;
                overflow-x: auto;
                overflow-y: hidden;
            }

            .quantum-sidebar .sidebar-section {
                min-width: 200px;
                border-bottom: none;
                border-right: 1px solid var(--cursor-border-muted);
            }

            .notepad-title .subtitle {
                display: none;
            }

            .footer-quick-cmds { display: none; }
        }
    </style>
</head>
<body>
    <div class="notepad-container">
        <!-- Header -->
        <div class="notepad-header">
            <div class="notepad-title">
                🌌 uvspeed — Quantum beyond<span style="font-weight:900;letter-spacing:0.5px;">BINARY</span> notepad
                <span class="subtitle">Dimensional code addressing &middot; {+1, 1, -1, +0, 0, -0, +n, n, -n} &middot; Charm visual layer</span>
            </div>

            <div class="quantum-status">
                <div class="status-badges">
                    <div class="status-indicator status-indicator--success">Charm Visual</div>
                    <div class="status-indicator status-indicator--success">Mermaid</div>
                    <div class="status-indicator status-indicator--success">Infinite Scroll</div>
                </div>

                <div class="header-actions">
                    <button class="btn btn--sm" id="add-cell-btn">+ Code</button>
                    <button class="btn btn--sm" id="add-mermaid-btn" title="Add Mermaid diagram cell">+ Diagram</button>
                    <button class="btn btn--primary btn--sm" id="run-all-btn">▶ Run All</button>
                    <button class="btn btn--sm" id="undo-btn" title="Undo (Ctrl+Z)">↩ Undo</button>
                    <button class="btn btn--sm" id="redo-btn" title="Redo (Ctrl+Shift+Z)">↪ Redo</button>
                    <button class="btn btn--sm" id="save-btn">💾 Save</button>
                    <button class="btn btn--sm" id="load-btn" title="Load .json notebook">📂 Load</button>
                    <button class="btn btn--sm" id="inspect-btn" title="Inspect: limits, comparisons, trade-offs">🔍 Inspect</button>
                    <span id="bridge-status" style="font-size:0.625rem;color:var(--cursor-text-muted);padding:4px 8px;">🔴 Bridge: offline</span>
                    <span id="quest-status" style="font-size:0.625rem;color:var(--cursor-text-muted);padding:4px 8px;cursor:pointer;" title="Click to check Quest device">🥽 Quest: —</span>
                </div>
            </div>
        </div>

        <!-- Execution Progress Bar -->
        <div class="exec-progress" id="exec-progress">
            <div class="exec-progress-inner">
                <span class="exec-progress-label" id="exec-progress-label">▶ Running</span>
                <div class="exec-progress-track">
                    <div class="exec-progress-fill" id="exec-progress-fill"></div>
                </div>
                <span class="exec-progress-pct" id="exec-progress-pct">0%</span>
                <span class="exec-progress-detail" id="exec-progress-detail"></span>
                <span class="exec-progress-elapsed" id="exec-progress-elapsed"></span>
            </div>
        </div>

        <!-- Convert Timeline Bar -->
        <div class="convert-timeline" id="convert-timeline">
            <span class="ctl-label">⚛ CONVERT</span>
            <div class="ctl-track">
                <div class="ctl-fill" id="ctl-fill"></div>
                <div class="ctl-segments">
                    <div class="ctl-seg"><span class="ctl-seg-label">n:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">+1:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">-n:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">+0:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">0:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">-1:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">+n:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">1:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">-0:</span></div>
                </div>
            </div>
            <div class="ctl-stats">
                <span class="ctl-stat" id="ctl-lines">Lines: <b>0</b></span>
                <span class="ctl-stat" id="ctl-coverage">Coverage: <b>0%</b></span>
                <span class="ctl-stat" id="ctl-lang">Lang: <b>auto</b></span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="notepad-content">
            <!-- Cells Container (Infinite Scroll) -->
            <div class="cells-container" id="cells-container">
                <!-- Dynamic cells will be inserted here -->
            </div>

            <!-- Quantum Sidebar -->
            <div class="quantum-sidebar">
                <!-- Sidebar Tab Bar -->
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" data-tab="nav-tab" id="tab-nav">⚛ Nav</button>
                    <button class="sidebar-tab" data-tab="thermal-tab" id="tab-thermal">🌡 Thermal</button>
                </div>

                <!-- ===== TAB 1: Navigation ===== -->
                <div class="sidebar-tab-panel active" id="nav-tab">
                <div class="sidebar-section">
                    <div class="sidebar-title">Quantum Navigation</div>
                    <div class="quantum-nav-mini">
                        <button class="nav-btn" data-direction="+1" title="Lines up (+Y)">+1</button>
                        <button class="nav-btn" data-direction="0" title="Neutral">0</button>
                        <button class="nav-btn" data-direction="-1" title="Lines down (-Y)">-1</button>
                        <button class="nav-btn" data-direction="+n" title="Complexity up (+Z)">+n</button>
                        <button class="nav-btn active" data-direction="⚛" id="nav-center-btn" title="Reset to origin">∞</button>
                        <button class="nav-btn" data-direction="-n" title="Complexity down (-Z)">-n</button>
                        <button class="nav-btn" data-direction="+0" title="Dependencies right (+X)">+0</button>
                        <button class="nav-btn" data-direction="-0" title="Dependencies left (-X)">-0</button>
                        <button class="nav-btn" data-direction="+2" title="Jump +2 lines">+2</button>
                    </div>

                    <!-- Layer Up/Down Navigator -->
                    <div class="layer-nav">
                        <button class="layer-btn" id="layer-down" title="Layer down (-Z complexity)">▼</button>
                        <div class="layer-label">Layer <strong id="layer-value">0</strong> <span style="opacity:0.5">Z</span></div>
                        <button class="layer-btn" id="layer-up" title="Layer up (+Z complexity)">▲</button>
                    </div>

                    <div class="position-display" id="position-display">[0, 0, 0]</div>

                    <!-- Quantum Stream History -->
                    <div class="quantum-stream" id="quantum-stream">
                        <div class="stream-header">
                            <span class="stream-title">Stream History</span>
                            <div class="stream-pipe-btns">
                                <button class="stream-pipe-btn" id="stream-pipe-in" title="Pipe source in — paste or select source to trace">⇥ in</button>
                                <button class="stream-pipe-btn" id="stream-pipe-out" title="Pipe stream out — copy trace to clipboard">⇤ out</button>
                            </div>
                        </div>
                        <div class="stream-log" id="stream-log">
                            <div class="stream-entry stream-origin">∞ origin [0, 0, 0]</div>
                        </div>
                        <div class="stream-source" id="stream-source" style="display:none;">
                            <textarea class="stream-source-input" id="stream-source-input" placeholder="Pipe source here to trace quantum coordinates..." rows="3"></textarea>
                            <button class="btn btn--sm" id="stream-source-trace" style="width:100%;margin-top:4px;">⚛ Trace Source</button>
                        </div>
                    </div>
                </div>
                </div><!-- /nav-tab -->

                <!-- ===== TAB 2: Thermal Visualization ===== -->
                <div class="sidebar-tab-panel" id="thermal-tab">
                <div class="sidebar-section thermal-viz">
                    <div class="sidebar-title">Quantum Thermal State</div>

                    <!-- Temperature legend -->
                    <div class="thermal-legend">
                        <span class="thermal-legend-label">15 mK</span>
                        <div class="thermal-gradient"></div>
                        <span class="thermal-legend-label">300 K</span>
                    </div>

                    <!-- Mode buttons -->
                    <div class="thermal-controls">
                        <button class="thermal-btn active" data-thermal-mode="lattice" title="Optical lattice — egg-crate cold-atom simulator">Lattice</button>
                        <button class="thermal-btn" data-thermal-mode="flow" title="Live layer data-flow heat map">Flow</button>
                        <button class="thermal-btn" data-thermal-mode="gpu" title="GPU ↔ Qubit scaling comparison">GPU↔Q</button>
                    </div>

                    <!-- Animated canvas -->
                    <div class="thermal-canvas-wrap">
                        <canvas id="thermal-canvas" width="480" height="480"></canvas>
                    </div>

                    <!-- Unit toggle -->
                    <div style="display:flex;gap:4px;margin-bottom:6px;">
                        <button class="thermal-btn active" id="unit-c" style="flex:0 0 36px;">°C</button>
                        <button class="thermal-btn" id="unit-f" style="flex:0 0 36px;">°F</button>
                        <button class="thermal-btn" id="unit-k" style="flex:0 0 36px;">K</button>
                    </div>

                    <!-- Stats: current thermal reading -->
                    <div class="thermal-section-label">Layer Thermal Map</div>
                    <div class="thermal-stat-row"><span>Cryo core (qubit)</span><span class="thermal-stat-val cryo" id="th-cryo">15 mK</span></div>
                    <div class="thermal-stat-row"><span>Dilution fridge</span><span class="thermal-stat-val cryo" id="th-fridge">−272.87 °C</span></div>
                    <div class="thermal-stat-row"><span>Photonic (Xanadu)</span><span class="thermal-stat-val warm" id="th-photonic">25.0 °C</span></div>
                    <div class="thermal-stat-row"><span>GPU junction</span><span class="thermal-stat-val hot" id="th-gpu">83.2 °C</span></div>

                    <!-- GPU ↔ Qubit comparison -->
                    <div class="thermal-section-label">GPU ↔ Qubit Scaling</div>
                    <div class="thermal-stat-row"><span>Qubit count</span><span class="thermal-stat-val qbit" id="th-qubits">50</span></div>
                    <div class="thermal-stat-row"><span>B200 GPUs needed</span><span class="thermal-stat-val hot" id="th-gpus">∞ (impossible)</span></div>
                    <div class="gpu-qubit-bar"><div class="gpu-qubit-fill" id="gpu-fill" style="width:100%;background:linear-gradient(90deg,#3fb950,#f0883e,#f85149);"></div></div>

                    <!-- Qubit slider -->
                    <div style="display:flex;align-items:center;gap:6px;margin-top:4px;">
                        <span style="font-size:0.5625rem;color:var(--cursor-text-muted);">1</span>
                        <input type="range" id="qubit-slider" min="1" max="60" value="50" style="flex:1;accent-color:var(--cursor-accent);">
                        <span style="font-size:0.5625rem;color:var(--cursor-text-muted);">60</span>
                    </div>

                    <!-- Lattice info -->
                    <div class="thermal-section-label">Quantum Lattice</div>
                    <div class="lattice-info">
                        <strong>Optical egg-crate</strong> — 0.5 µm spacing<br>
                        Rydberg excitation → atom entanglement<br>
                        Rubik's-cube multi-stack: <strong id="lattice-dim">5×5×5</strong> = <strong id="lattice-sites">125</strong> sites<br>
                        <span style="color:#d2a8ff;">Photonic (Xanadu)</span> — room-temp ✓
                    </div>

                    <!-- ChartGPU Integration -->
                    <div class="thermal-section-label">ChartGPU</div>
                    <div style="display:flex;gap:4px;margin-bottom:4px;">
                        <button class="thermal-btn" id="chartgpu-launch" title="Open ChartGPU dashboard">📊 Dashboard</button>
                        <button class="thermal-btn" id="chartgpu-metrics" title="Fetch live metrics">⚡ Metrics</button>
                    </div>
                    <div class="thermal-stat-row"><span>ChartGPU</span><span class="thermal-stat-val" id="chartgpu-status-val" style="color:var(--cursor-text-muted);">offline</span></div>
                    <div class="thermal-stat-row"><span>CPU</span><span class="thermal-stat-val warm" id="cg-cpu">—</span></div>
                    <div class="thermal-stat-row"><span>Memory</span><span class="thermal-stat-val warm" id="cg-mem">—</span></div>

                    <!-- Hex / Fax Stream Viewer -->
                    <div class="thermal-section-label">HF Fax / Hex Stream</div>
                    <div style="display:flex;gap:4px;margin-bottom:4px;">
                        <button class="thermal-btn active" id="hex-mode-color" data-hex-mode="color">Color</button>
                        <button class="thermal-btn" id="hex-mode-gray" data-hex-mode="gray">Gray</button>
                        <button class="thermal-btn" id="hex-mode-fax" data-hex-mode="fax">Fax</button>
                        <button class="thermal-btn" id="hex-expand" title="Expand hex viewer overlay">↗</button>
                    </div>
                    <div class="thermal-canvas-wrap" style="aspect-ratio:1;max-height:180px;">
                        <canvas id="hex-canvas" width="360" height="360"></canvas>
                    </div>
                </div>
                </div><!-- /thermal-tab -->

                <!-- ===== ALWAYS-VISIBLE SECTIONS ===== -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Cell Overview</div>
                    <ul class="cell-list" id="cell-list">
                        <!-- Dynamic cell list -->
                    </ul>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">Performance</div>
                    <div class="perf-row">
                        <span>Cells loaded</span>
                        <span id="cells-loaded">0</span>
                    </div>
                    <div class="perf-row">
                        <span>Memory usage</span>
                        <span id="memory-usage">~0 MB</span>
                    </div>
                    <div class="perf-row">
                        <span>Execution time</span>
                        <span id="execution-time">0 ms</span>
                    </div>

                    <div class="perf-toggles">
                        <label>
                            <input type="checkbox" id="performance-mode" checked>
                            Performance mode
                        </label>
                        <label>
                            <input type="checkbox" id="auto-save">
                            Auto-save
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Terminal / AI Search -->
        <div class="notepad-footer">
            <div class="footer-ai-row">
                <input type="text" id="ai-input" placeholder="🤖 Ask AI — responses appear as new cells..." autocomplete="off">
                <button class="btn btn--primary btn--sm" id="ai-send-btn">🤖 AI Cell</button>
            </div>
            <div class="footer-cmd-row">
                <span class="footer-prompt-symbol">⚛ +\-</span>
                <input type="text" id="cmd-input" placeholder="uv run, q search, qstatus, help..." autocomplete="off">
                <button class="btn btn--sm" id="cmd-exec-btn">Execute</button>
            </div>
            <div class="footer-quick-cmds">
                <button class="btn btn--xs" id="f-add-cell" title="Add code cell">+ Code</button>
                <button class="btn btn--xs" id="f-add-mermaid" title="Add diagram cell">+ Diagram</button>
                <button class="btn btn--xs" id="f-run-all" style="background:var(--cursor-accent);color:#fff;">▶ Run All</button>
                <button class="btn btn--xs" id="f-undo" title="Undo">↩</button>
                <button class="btn btn--xs" id="f-redo" title="Redo">↪</button>
                <button class="btn btn--xs" id="f-save" title="Save">💾</button>
                <span style="opacity:0.3;margin:0 2px;">│</span>
                <button class="btn btn--xs quick-cmd" data-cmd="qstatus">📊 Status</button>
                <button class="btn btn--xs" id="f-benchmark" title="Add visual benchmark cell" style="background:#f0883e22;border-color:#f0883e55;color:#f0883e;">⚡ Benchmark</button>
                <button class="btn btn--xs" id="f-security-scan" title="Security scan all cells" style="background:#da363422;border-color:#da363455;color:#da3634;">🛡 Scan</button>
                <button class="btn btn--xs" id="f-git-hook" title="Install quantum pre-commit hook" style="background:#8b5cf622;border-color:#8b5cf655;color:#8b5cf6;">🪝 Hook</button>
                <button class="btn btn--xs quick-cmd" data-cmd="uv sync">🔄 Sync</button>
                <button class="btn btn--xs quick-cmd" data-cmd="q tinygrad">🔍 Search</button>
                <button class="btn btn--xs quick-cmd" data-cmd="help">❓ Help</button>
                <button class="btn btn--xs quick-cmd" data-cmd="pos">📍 Position</button>
                <button class="btn btn--xs quick-cmd" data-cmd="cells">📋 Cells</button>
                <span style="opacity:0.3;margin:0 2px;">│</span>
                <!-- Cross-project tools -->
                <div style="position:relative;display:inline-block;">
                    <button class="btn btn--xs" id="f-tools" title="External tools" style="background:#7c3aed22;border-color:#7c3aed55;color:#7c3aed;">🔧 Tools ▾</button>
                    <div class="tools-dropdown" id="tools-dropdown">
                        <div class="tools-dropdown-header">Day Terminal</div>
                        <div class="tools-dropdown-item" data-tool="kbatch">⌨ Kbatch — Keyboard Analysis</div>
                        <div class="tools-dropdown-item" data-tool="signal">📡 Signal — Morse/Binary/Waveform</div>
                        <div class="tools-dropdown-item" data-tool="geokey">🔷 GeoKey — Geometric Mapper</div>
                        <div class="tools-dropdown-item" data-tool="youtube">🎬 YouTube — Transcript</div>
                        <div class="tools-dropdown-header">ChartGPU</div>
                        <div class="tools-dropdown-item" data-tool="chartgpu-dash">📊 ChartGPU Dashboard</div>
                        <div class="tools-dropdown-item" data-tool="chartgpu-metrics">⚡ Live Metrics + AI</div>
                        <div class="tools-dropdown-header">Media Pipeline</div>
                        <div class="tools-dropdown-item" data-tool="jawta">📡 Jawta Signal Intel</div>
                        <div class="tools-dropdown-item" data-tool="media">🎞 Media Process</div>
                        <div class="tools-dropdown-header">Meta Quest</div>
                        <div class="tools-dropdown-item" data-tool="quest-status">🥽 Quest Status</div>
                        <div class="tools-dropdown-item" data-tool="quest-logs">📜 Quest Logs</div>
                        <div class="tools-dropdown-item" data-tool="quest-screenshot">📸 Quest Screenshot</div>
                        <div class="tools-dropdown-header">Lark / Jawta</div>
                        <div class="tools-dropdown-item" data-tool="lark-status">🐦 Lark IANA Status</div>
                    </div>
                </div>
                <button class="btn btn--xs" id="f-quest" title="Quest device status" style="background:#1877f222;border-color:#1877f255;color:#1877f2;">🥽 Quest</button>
            </div>
        </div>
    </div>

    <!-- ===== CELL OUTPUT OVERLAY ===== -->
    <div class="cell-overlay" id="cell-overlay">
        <div class="cell-overlay-backdrop" id="cell-overlay-backdrop"></div>
        <div class="cell-overlay-panel">
            <div class="cell-overlay-header">
                <h3 id="cell-overlay-title">⚡ Cell Output</h3>
                <button class="inspect-close" id="cell-overlay-close">&times;</button>
            </div>
            <div class="cell-overlay-body" id="cell-overlay-body">
                <!-- dynamic -->
            </div>
        </div>
    </div>

    <!-- ===== INSPECT PANEL ===== -->
    <div class="inspect-overlay" id="inspect-overlay">
        <div class="inspect-backdrop" id="inspect-backdrop"></div>
        <div class="inspect-panel">
            <div class="inspect-header" style="position:relative;">
                <h2>🔍 Inspect &mdash; uvspeed &middot; Quantum beyond<span style="font-weight:900;">BINARY</span> notepad</h2>
                <div style="position:absolute;right:48px;top:50%;transform:translateY(-50%);font-family:var(--cursor-font-mono);font-size:0.5625rem;color:var(--cursor-text-muted);text-align:right;line-height:1.4;">
                    <span style="color:var(--cursor-accent);font-weight:700;">last updated</span><br>
                    <span id="inspect-unix-ts" style="color:#7ee787;font-weight:600;font-size:0.625rem;"></span>
                </div>
                <button class="inspect-close" id="inspect-close">&times;</button>
            </div>
            <div class="inspect-body">

                <!-- ====== DEV TIMELINE ====== -->
                <div class="inspect-section" style="border-bottom:2px solid var(--cursor-accent);">
                    <h3>uvspeed &mdash; Development Timeline</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        Git commit history + file signatures. <strong style="color:#7ee787;">Phase 2 shipped &amp; pushed to GitHub.</strong>
                    </p>

                    <!-- Commit history -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Git Commits</div>
                    <div style="display:grid;grid-template-columns:1fr;gap:4px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.625rem;">
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">9a32201</span>
                            <span style="color:var(--cursor-text-muted);">Feb 11</span>
                            <span style="color:#7ee787;">Add IDE .mdc prefix gutter rule section to Inspect page</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">abb4a61</span>
                            <span style="color:var(--cursor-text-muted);">Feb 11</span>
                            <span style="color:#7ee787;">uvspeed &mdash; Phase 2: security scanner + git hooks + 25 API endpoints</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">d61107b</span>
                            <span style="color:var(--cursor-text-muted);">Feb 10</span>
                            <span style="color:var(--cursor-text);">Fix pyproject.toml syntax and quantum example</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">77f24ac</span>
                            <span style="color:var(--cursor-text-muted);">Feb 10</span>
                            <span style="color:var(--cursor-text);">Initial UV-Speed Quantum Terminal package</span>
                        </div>
                    </div>

                    <!-- File signatures -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Core File Signatures</div>
                    <div style="display:grid;grid-template-columns:1fr;gap:2px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.5625rem;">
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+0:</span>
                            <span style="color:#f0883e;">344 KB</span>
                            <span style="color:var(--cursor-text);">web/quantum-notepad.html</span>
                            <span style="color:var(--cursor-text-muted);">Main UI &mdash; notepad, gutter, timeline, inspect</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>
                            <span style="color:#f0883e;">68 KB</span>
                            <span style="color:var(--cursor-text);">quantum_bridge_server.py</span>
                            <span style="color:var(--cursor-text-muted);">Backend &mdash; 25 API endpoints, security, git hooks</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>
                            <span style="color:var(--cursor-text-muted);">20 KB</span>
                            <span style="color:var(--cursor-text);">quantum_notepad.py</span>
                            <span style="color:var(--cursor-text-muted);">Python TUI notepad</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>
                            <span style="color:var(--cursor-text-muted);">13 KB</span>
                            <span style="color:var(--cursor-text);">quantum_prototype.py</span>
                            <span style="color:var(--cursor-text-muted);">Standalone prototype terminal</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text-muted);">3 KB</span>
                            <span style="color:var(--cursor-text);">.cursor/rules/quantum-prefix-gutter.mdc</span>
                            <span style="color:var(--cursor-text-muted);">IDE rule &mdash; always-on prefix AI training</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>
                            <span style="color:var(--cursor-text-muted);">4 KB</span>
                            <span style="color:var(--cursor-text);">tools/prefix_all_files.py</span>
                            <span style="color:var(--cursor-text-muted);">Batch prefix header stamper (91+ files)</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>
                            <span style="color:var(--cursor-text-muted);">20 KB</span>
                            <span style="color:var(--cursor-text);">electron-app/main.js</span>
                            <span style="color:var(--cursor-text-muted);">Electron main process</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>
                            <span style="color:var(--cursor-text-muted);">17 KB</span>
                            <span style="color:var(--cursor-text);">electron-app/src/renderer.js</span>
                            <span style="color:var(--cursor-text-muted);">Electron UI + quantum nav</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">n:</span>
                            <span style="color:var(--cursor-text-muted);">15 KB</span>
                            <span style="color:var(--cursor-text);">launch.sh</span>
                            <span style="color:var(--cursor-text-muted);">Environment launcher</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">1:</span>
                            <span style="color:var(--cursor-text-muted);">6 KB</span>
                            <span style="color:var(--cursor-text);">README.md</span>
                            <span style="color:var(--cursor-text-muted);">Project documentation</span>
                        </div>
                    </div>

                    <!-- Phase milestones -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Phase Milestones</div>
                    <div style="display:flex;gap:6px;align-items:stretch;margin-bottom:var(--cursor-space-sm);">
                        <div style="flex:1;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">Phase 1 ✓</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Structural Bootstrap</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 10</div>
                        </div>
                        <div style="flex:1;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">Phase 2 ✓</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Bridge + Security + Git</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 11</div>
                        </div>
                        <div style="flex:1;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:var(--cursor-text);font-weight:700;">Phase 3</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Agent Orchestration</div>
                            <div style="font-size:0.5rem;color:#484f58;">Next</div>
                        </div>
                        <div style="flex:1;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:var(--cursor-text);font-weight:700;">Phase 4</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Production &amp; Scale</div>
                            <div style="font-size:0.5rem;color:#484f58;">Future</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">4 commits &middot; 2 days</span>
                        <span class="tag tag--green">Phase 2 complete &amp; pushed</span>
                        <span class="tag tag--blue">~500 KB total source</span>
                        <span class="tag tag--purple">github.com/fornevercollective/uvspeed</span>
                    </div>
                </div>

                <!-- ====== AGENT-READY STATUS DASHBOARD ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Agent-Ready Status Dashboard</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        6 capabilities tracked. 5 shipped to production, 1 planned. <strong style="color:#7ee787;">Phase 2 COMPLETE.</strong>
                    </p>
                    <div style="display:grid;grid-template-columns:1fr;gap:6px;margin-bottom:var(--cursor-space-md);">

                        <!-- Row 1: Real-time execution ✅ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">🟢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Real-time execution</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">WebSocket bridge (<code>ws://8086</code>) + HTTP API (<code>:8085</code>) + Python exec() + shell + uv run</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">✓ Done</span>
                        </div>

                        <!-- Row 2: Agent API surface ✅ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">🟢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Agent API surface</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">25 endpoints live: <code>/api/execute</code>, <code>/api/prefix</code>, <code>/api/cells</code>, <code>/api/diff</code>, <code>/api/ai</code>, <code>/api/agents</code>, <code>/api/roadmap</code>, <code>/api/security/*</code>, <code>/api/git/*</code></div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">✓ Done</span>
                        </div>

                        <!-- Row 3: AI code review ✅ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">🟢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">AI code review</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Prefix-aware diff engine + multi-model AI layer (tinygrad/Ollama/OpenAI/Anthropic) + <code>/api/diff</code> + <code>/api/ai</code></div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">✓ Done</span>
                        </div>

                        <!-- Row 4: Security scanning ✅ SHIPPED (Phase 2) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">🟢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Security scanning</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Prefix-aware static analysis across Python/JS/Shell &bull; regex rule engine with severity scoring &bull; <code>/api/security/scan</code> (code, file, directory) + <code>/api/security/rules</code></div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">✓ Done</span>
                        </div>

                        <!-- Row 5: PR / diff automation ✅ SHIPPED (Phase 2) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">🟢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">PR / diff automation</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Git pre-commit hook generation + auto-install &bull; PR-ready quantum diff reports (markdown) &bull; <code>/api/git/hook</code> + <code>/api/git/hook/install</code> + <code>/api/git/diff-report</code></div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">✓ Done</span>
                        </div>

                        <!-- Row 6: Multi-agent orchestration ⚪ PLANNED → Phase 3 -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">⚪</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Multi-agent orchestration</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">5 agents registered (code, review, prefix, deploy, test) &mdash; inter-agent protocol + role-based prefix access pending</div>
                            </div>
                            <span class="tag tag--purple" style="font-size:0.5625rem;padding:2px 6px;">Phase 3</span>
                            <span style="font-size:0.625rem;color:#484f58;font-weight:600;">PLANNED</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">Next up</span>
                        </div>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">12 best-in-class (locked) &middot; 5 shipped &middot; Phase 2 COMPLETE</span>
                        <span class="tag tag--purple">1 planned &rarr; Phase 3 (multi-agent orchestration)</span>
                    </div>
                </div>

                <!-- ====== HARD LIMITS ====== -->
                <div class="inspect-section">
                    <h3>Hard Limits</h3>
                    <div class="limits-grid">
                        <div class="limit-card">
                            <div class="limit-label">Install Type</div>
                            <div class="limit-value">Static HTML (bootloader)</div>
                            <div class="limit-note">~50 KB single file &mdash; the bootstrap layer. Like a bootloader that scales to a full kernel via v1 (1 KB) &rarr; v2 (36 KB) &rarr; v3 (50-100 MB embedded).</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Max Cell Count</div>
                            <div class="limit-value">~500&ndash;1 000</div>
                            <div class="limit-note">DOM-based, no virtualisation. Beyond ~500 cells scroll/input latency rises; ~1 000 cells hit jank on mid-range devices.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Session Lifetime</div>
                            <div class="limit-value">Tab lifespan</div>
                            <div class="limit-note">State lives in JS memory. Closing or refreshing the tab loses all work unless exported to JSON first.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">RAM (JS Heap)</div>
                            <div class="limit-value">50&ndash;300 MB</div>
                            <div class="limit-note">Browser tab memory limit. No server-side compute. Chrome allocates ~4 GB per renderer process max.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Storage</div>
                            <div class="limit-value">JSON export</div>
                            <div class="limit-note">No persistent storage. LocalStorage (~5&ndash;10 MB) could be added. JSON export to disk is unlimited.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Execution Engine</div>
                            <div class="limit-value">Stub &rarr; uv&thinsp;run bridge</div>
                            <div class="limit-note">Current: simulated output. Roadmap: WebSocket bridge to <code>uv run</code> backend, Pyodide in-browser, CUDA-Q quantum kernel offload via Blackwell.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">File Size</div>
                            <div class="limit-value">~50 KB</div>
                            <div class="limit-note">HTML + CSS + JS inlined. 10 000&times; smaller than JupyterLab. The constraint is the feature: like tinygrad proving a full ML framework fits in 1 000 lines.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Network Required</div>
                            <div class="limit-value">No</div>
                            <div class="limit-note">Fully offline by design. Like a clean OS install: boots from nothing, acquires capabilities progressively. No auth, no keys, no telemetry.</div>
                        </div>
                    </div>
                </div>

                <!-- ====== THE CORE IDEA ====== -->
                <div class="inspect-section">
                    <h3>The Core Idea &mdash; beyond<span style="font-weight:900;">BINARY</span></h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        Every competitor below still treats code as a flat sequence of lines executed top-to-bottom inside a binary <code>{0,&thinsp;1}</code> paradigm.
                        UV-Speed replaces that base with a <strong>9-symbol quantum prefix system</strong>:
                    </p>
                    <div style="background: var(--cursor-bg); border:1px solid var(--cursor-border); border-radius: var(--cursor-radius-md); padding: var(--cursor-space-md); font-family: var(--cursor-font-mono); font-size: 0.8125rem; line-height: 1.8; margin-bottom: var(--cursor-space-md); overflow-x:auto;">
                        <span style="color:var(--cursor-accent);">{+1, 1, -1, +0, 0, -0, +n, n, -n}</span><br><br>
                        <span style="color:var(--cursor-text-muted);">  n:</span> Entry points &amp; shebangs &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">+1:</span> Comments &amp; docs &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">-n:</span> Imports &amp; deps<br>
                        <span style="color:var(--cursor-text-muted);">+0:</span> Classes &amp; structures &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);"> 0:</span> Functions &amp; methods &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">-1:</span> Error handling<br>
                        <span style="color:var(--cursor-text-muted);">+n:</span> Conditionals &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">+2:</span> Loops &amp; iteration &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">-0:</span> Returns &amp; exits &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">+3:</span> Output
                    </div>
                    <p>
                        Every line of any codebase gains a <strong>directional weight</strong> in 3D space (X&thinsp;=&thinsp;dependencies, Y&thinsp;=&thinsp;lines, Z&thinsp;=&thinsp;complexity).
                        This isn't annotation &mdash; it's a new addressing system that lets you <em>navigate</em>, <em>diff</em>, and <em>refactor</em> code the way an OS kernel handles memory pages:
                        structurally, directionally, and dimensionally.
                    </p>
                </div>

                <!-- ====== BEST FOR ====== -->
                <div class="inspect-section">
                    <h3>Best For</h3>
                    <ul>
                        <li><strong>Shifting any codebase into quantum-dimensional handling</strong> &mdash; convert Python, JS, Rust, or C into spatially-addressed code where every element has directional meaning, like a clean OS install but for architecture</li>
                        <li><strong>Bootstrap-grade portability</strong> &mdash; the same design philosophy as tinygrad, a microserver image, or a new Linux ISO: start from near-zero and scale to full capability (v1&thinsp;=&thinsp;1 KB &rarr; v2&thinsp;=&thinsp;36 KB &rarr; v3&thinsp;=&thinsp;50-100 MB)</li>
                        <li><strong>Architectural prototyping before committing to a runtime</strong> &mdash; sketch the dimensional structure of a system before choosing Cirq, Qiskit, or a classical framework</li>
                        <li><strong>Teaching &amp; demonstrating the prefix system interactively</strong> &mdash; show how <code>n: #!/usr/bin/env</code>, <code>+0: class</code>, <code>0: def</code> create navigable code topology in real time</li>
                        <li><strong>Offline, air-gapped, or embedded environments</strong> &mdash; runs anywhere a browser exists: USB stick, kiosk, IoT display, VR headset (WebXR), or a machine with no network at all</li>
                    </ul>
                    <div class="tag-row">
                        <span class="tag tag--green">New Code Paradigm</span>
                        <span class="tag tag--green">Zero Install</span>
                        <span class="tag tag--blue">Bootstrap-Grade</span>
                        <span class="tag tag--blue">3D Navigation</span>
                        <span class="tag tag--yellow">Language-Agnostic</span>
                    </div>
                </div>

                <!-- ====== KEY ADVANTAGES ====== -->
                <div class="inspect-section">
                    <h3>Key Advantages</h3>
                    <ul>
                        <li><strong>Paradigm shift, not feature parity</strong> &mdash; competitors add cells to a flat list; UV-Speed adds <em>dimensional addressing</em> to every code element. No other notebook, quantum or classical, does this.</li>
                        <li><strong>Architecture stack: Zig &rarr; Rust &rarr; Semantic &rarr; Visual (Charm)</strong> &mdash; Ghostty (Zig) &rarr; Nushell/uv (Rust) &rarr; GrepAI (semantic) &rarr; Charm ecosystem (Crush AI, Gum interactive UI, Glow docs, VHS demos, Log) + Mermaid diagrams + ChartGPU. Each tier is independently replaceable.</li>
                        <li><strong>Compute path: Local AMX &rarr; Remote Blackwell</strong> &mdash; designed to scale from Apple Silicon unified memory to NVIDIA CUDA-Q quantum kernels without changing the prefix system.</li>
                        <li><strong>All execution through <code>uv run</code></strong> &mdash; one command prefix replaces pip, conda, venv, poetry, and pipx. Faster cold-start than any Python package manager.</li>
                        <li><strong>Clean-install philosophy</strong> &mdash; like an OS image: 50 KB boots a full quantum dev environment. v1 (1 KB) &rarr; v2 (36 KB) &rarr; v3 (50-100 MB embedded) mirrors bootloader &rarr; initramfs &rarr; full userland.</li>
                        <li><strong>Universal code conversion</strong> &mdash; any file in any language can be shifted into quantum-prefixed form. The prefix set works on Python, JS, Rust, C, Go, and shell scripts identically.</li>
                    </ul>

                    <!-- Language Quantum Benchmark Chart — with checkmarks + AI/quantum sort -->
                    <div class="lang-chart" style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);">
                        <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;display:flex;align-items:center;gap:var(--cursor-space-xs);">
                            📊 Language Quantum Benchmarks
                            <span style="font-size:0.625rem;font-weight:400;color:var(--cursor-text-muted);margin-left:auto;">sorted by quantum/AI/LLM relevance</span>
                        </div>
                        <div style="font-size:0.5625rem;color:var(--cursor-text-muted);margin-bottom:var(--cursor-space-sm);">
                            ✅ = supported &amp; shipped &emsp; ⬜ = planned &emsp;
                            <span style="color:#7ee787;">■</span> quantum/AI/tinygrad tier &emsp;
                            <span style="color:#58a6ff;">■</span> systems tier &emsp;
                            <span style="color:#f0d852;">■</span> config/markup &emsp;
                            Source: <a href="https://github.com/collections/programming-languages" target="_blank" style="color:var(--cursor-accent);text-decoration:underline;">GitHub Languages Collection</a>
                        </div>

                        <!-- ═══ TIER 1: QUANTUM / AI / LLM / TINYGRAD ═══ -->
                        <div style="font-size:0.5625rem;font-weight:700;color:#7ee787;text-transform:uppercase;letter-spacing:1px;margin:8px 0 4px;padding:2px 0;border-bottom:1px solid rgba(126,231,135,0.2);">Tier 1 — Quantum · AI · LLM · tinygrad</div>

                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🐍 Python</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:98%;background:linear-gradient(90deg,#3572A5,#58a6ff);">9/9</div></div><div class="lang-chart-value">98%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">tinygrad · torch · jax</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> ⚙️ C / C++</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:91%;background:linear-gradient(90deg,#555555,#8b949e);">9/9</div></div><div class="lang-chart-value">91%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">llama.cpp · ggml · CUDA</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🦀 Rust</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:94%;background:linear-gradient(90deg,#dea584,#f97583);">9/9</div></div><div class="lang-chart-value">94%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">candle · burn · nushell</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> ⚡ Zig</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:90%;background:linear-gradient(90deg,#ec915c,#f9c74f);color:#1a1a2e;">9/9</div></div><div class="lang-chart-value">90%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">ghostty · bun · tinygrad</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🐹 Go</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:93%;background:linear-gradient(90deg,#00ADD8,#58d1f0);">9/9</div></div><div class="lang-chart-value">93%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">ollama · k8s · charm</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🟨 JavaScript</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:96%;background:linear-gradient(90deg,#f1e05a,#e8d44d);color:#1a1a2e;">9/9</div></div><div class="lang-chart-value">96%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">transformers.js · onnx</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🔷 TypeScript</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:95%;background:linear-gradient(90deg,#3178c6,#58a6ff);">9/9</div></div><div class="lang-chart-value">95%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">langchain · vercel ai</div></div>

                        <!-- ═══ TIER 2: SYSTEMS / ENTERPRISE ═══ -->
                        <div style="font-size:0.5625rem;font-weight:700;color:#58a6ff;text-transform:uppercase;letter-spacing:1px;margin:10px 0 4px;padding:2px 0;border-bottom:1px solid rgba(88,166,255,0.2);">Tier 2 — Systems · Enterprise · Mobile</div>

                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> ☕ Java</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:92%;background:linear-gradient(90deg,#b07219,#d4983b);">9/9</div></div><div class="lang-chart-value">92%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">deeplearning4j · spark</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🍎 Swift</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:91%;background:linear-gradient(90deg,#F05138,#ff7b6b);">9/9</div></div><div class="lang-chart-value">91%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">coreml · mlx · vision</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🟣 Kotlin</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:90%;background:linear-gradient(90deg,#A97BFF,#d2a8ff);">9/9</div></div><div class="lang-chart-value">90%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">android · ktor · kmp</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 💎 Ruby</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:89%;background:linear-gradient(90deg,#701516,#CC342D);">9/9</div></div><div class="lang-chart-value">89%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">rails · gems</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🐚 Shell</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:90%;background:linear-gradient(90deg,#89e051,#7ee787);">9/9</div></div><div class="lang-chart-value">90%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">bash · zsh · CI/CD</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🐚 Nushell</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:87%;background:linear-gradient(90deg,#3aa675,#7ee787);">8/9</div></div><div class="lang-chart-value">87%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">structured data shell</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🌐 HTML/CSS</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:88%;background:linear-gradient(90deg,#e34c26,#f06529);">8/9</div></div><div class="lang-chart-value">88%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">web · DOM · wasm host</div></div>

                        <!-- ═══ TIER 3: CONFIG / MARKUP / DATA ═══ -->
                        <div style="font-size:0.5625rem;font-weight:700;color:#f0d852;text-transform:uppercase;letter-spacing:1px;margin:10px 0 4px;padding:2px 0;border-bottom:1px solid rgba(240,216,82,0.2);">Tier 3 — Config · Data · Low-Level</div>

                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🗄️ SQL</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:82%;background:linear-gradient(90deg,#e38c00,#f0d852);color:#1a1a2e;">8/9</div></div><div class="lang-chart-value">82%</div><div style="font-size:0.5rem;color:#f0d852;width:110px;text-align:right;">duckdb · sqlite · pg</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 📄 YAML/TOML</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:78%;background:linear-gradient(90deg,#cb171e,#f0d852);color:#1a1a2e;">7/9</div></div><div class="lang-chart-value">78%</div><div style="font-size:0.5rem;color:#f0d852;width:110px;text-align:right;">k8s · pyproject · cargo</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🐳 Dockerfile</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:76%;background:linear-gradient(90deg,#384d54,#0db7ed);">7/9</div></div><div class="lang-chart-value">76%</div><div style="font-size:0.5rem;color:#f0d852;width:110px;text-align:right;">containers · CI</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">✅</span> 🔩 Assembly</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:68%;background:linear-gradient(90deg,#484f58,#6e7681);">6/9</div></div><div class="lang-chart-value">68%</div><div style="font-size:0.5rem;color:#f0d852;width:110px;text-align:right;">x86 · ARM · RISC-V</div></div>

                        <!-- ═══ TIER 4: PLANNED (not yet supported) ═══ -->
                        <div style="font-size:0.5625rem;font-weight:700;color:#484f58;text-transform:uppercase;letter-spacing:1px;margin:10px 0 4px;padding:2px 0;border-bottom:1px solid rgba(72,79,88,0.3);">Planned — GitHub Top Languages (not yet supported)</div>

                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🟢 Elixir</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">Nx · Livebook · BEAM</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🔮 Julia</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">Flux.jl · quantum sim</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🧪 Scala</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">Spark ML · Chisel HDL</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🔗 Clojure</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">cortex · deep-diamond</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 📐 Nim</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">arraymancer · compile</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🔷 C#</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">ML.NET · Unity · .NET</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🐘 PHP</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">laravel · wordpress</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> ☕ Erlang/OTP</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">BEAM · distributed</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 💠 Crystal</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">ruby-like compiled</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🔵 PowerShell</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">windows · automation</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🟪 Haskell</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">hasktorch · quantum</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🧊 WASM</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">wasmtime · edge AI</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> ☕ CoffeeScript</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">legacy JS transpile</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">⬜</span> 🔲 MicroPython</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">IoT · edge · TinyML</div></div>

                        <!-- Legend -->
                        <div class="lang-chart-legend" style="margin-top:10px;">
                            <div class="lang-chart-legend-item"><span style="color:#7ee787;">✅</span> Supported (20)</div>
                            <div class="lang-chart-legend-item"><span style="color:#484f58;">⬜</span> Planned (14)</div>
                            <div class="lang-chart-legend-item"><div class="ldot" style="background:#7ee787;"></div> 9/9 full (90%+)</div>
                            <div class="lang-chart-legend-item"><div class="ldot" style="background:#f0d852;"></div> 7-8/9 (76-89%)</div>
                            <div class="lang-chart-legend-item"><div class="ldot" style="background:#6e7681;"></div> &le;6/9 (&lt;76%)</div>
                        </div>
                    </div>

                    <ul>
                        <li><strong>Charm visual layer</strong> &mdash; Gum (interactive prompts &amp; progress bars), Glow (beautiful markdown), VHS (terminal demo recordings), Crush (AI coding), Log (rich logging). Terminal-native charting no competitor offers.</li>
                        <li><strong>Mermaid + ChartGPU</strong> &mdash; in-browser diagram rendering (architecture, flowcharts, sequences) plus 60fps WebGPU-accelerated charts. Edit and render diagrams directly in cells.</li>
                        <li><strong>Offline-first by design</strong> &mdash; no network, no auth, no telemetry, no API keys. Works on air-gapped hardware, USB boot, <code>file://</code> protocol.</li>
                        <li><strong>~50 KB footprint</strong> &mdash; 10 000&times; smaller than JupyterLab. The constraint is the feature: it forces every byte to carry structural meaning.</li>
                    </ul>
                </div>

                <!-- ====== MAJOR TRADE-OFFS ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Major Trade-Offs vs Competitors</h3>

                    <!-- Scorecard -->
                    <div class="scorecard">
                        <div class="score-pill score-pill--wins"><span class="score-num">19</span> Outright wins</div>
                        <div class="score-pill score-pill--roadmap"><span class="score-num">3</span> Roadmap (v2/v3)</div>
                        <div class="score-pill score-pill--gap"><span class="score-num">0</span> Hard gaps</div>
                    </div>

                    <div class="compare-table-wrap">
                        <table class="compare-table">
                            <thead>
                                <tr style="font-size:0.5rem;color:var(--cursor-text-muted);border-bottom:none;">
                                    <th style="border-bottom:none;padding-bottom:0;"></th>
                                    <th class="self-col" style="border-bottom:none;padding-bottom:0;font-size:0.5rem;color:var(--cursor-accent);">uvspeed</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Project Jupyter</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Deepnote / Hex</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Databricks Inc.</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Amazon AWS</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Google / Kaggle</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Google Research</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Marimo Inc.</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Google Quantum AI</th>
                                    <th style="border-bottom:none;padding-bottom:0;">IBM Quantum</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Rigetti Computing</th>
                                    <th style="border-bottom:none;padding-bottom:0;">IonQ Inc.</th>
                                </tr>
                                <tr>
                                    <th>Capability</th>
                                    <th class="self-col">uvspeed beyondBINARY</th>
                                    <th>JupyterLab</th>
                                    <th>Deepnote / Hex</th>
                                    <th>Databricks</th>
                                    <th>SageMaker</th>
                                    <th>Kaggle</th>
                                    <th>Google Colab</th>
                                    <th>Marimo</th>
                                    <th>Cirq</th>
                                    <th>Qiskit</th>
                                    <th>QVM (Rigetti)</th>
                                    <th>IonQ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ===== WINS (9) ===== -->
                                <tr>
                                    <td>Dimensional code addressing</td>
                                    <td class="self-col"><span class="cmp-best">9-symbol prefix</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>3D code navigation</td>
                                    <td class="self-col"><span class="cmp-best">X / Y / Z axes</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>Language-agnostic conversion</td>
                                    <td class="self-col"><span class="cmp-best">Any &rarr; prefixed</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python/SQL</span></td>
                                    <td><span class="cmp-part">Multi (managed)</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Quil/Python</span></td>
                                    <td><span class="cmp-part">JSON/Python</span></td>
                                </tr>
                                <tr>
                                    <td>Bootstrap scale (v1 &rarr; v3)</td>
                                    <td class="self-col"><span class="cmp-best">1 KB &rarr; 100 MB</span></td>
                                    <td><span class="cmp-no">~500 MB fixed</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-part">~50 MB</span></td>
                                    <td><span class="cmp-no">~200 MB</span></td>
                                    <td><span class="cmp-no">~200 MB</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                </tr>
                                <tr>
                                    <td>Startup time</td>
                                    <td class="self-col"><span class="cmp-best">&lt; 0.5 s</span></td>
                                    <td>2&ndash;5 s</td>
                                    <td>3&ndash;10 s</td>
                                    <td>30&ndash;120 s</td>
                                    <td>30&ndash;180 s</td>
                                    <td>5&ndash;15 s</td>
                                    <td>8&ndash;20 s</td>
                                    <td>1&ndash;3 s</td>
                                    <td>2&ndash;5 s</td>
                                    <td>2&ndash;5 s</td>
                                    <td>5&ndash;30 s</td>
                                    <td>5&ndash;15 s</td>
                                </tr>
                                <tr>
                                    <td>Install weight</td>
                                    <td class="self-col"><span class="cmp-best">~50 KB</span></td>
                                    <td>~500 MB</td>
                                    <td>Cloud (0)</td>
                                    <td>Cloud (0)</td>
                                    <td>Cloud (0)</td>
                                    <td>Cloud (0)</td>
                                    <td>Cloud (0)</td>
                                    <td>~5 MB</td>
                                    <td>~50 MB</td>
                                    <td>~200 MB</td>
                                    <td>~500 MB</td>
                                    <td>Cloud (0)</td>
                                </tr>
                                <tr>
                                    <td>Offline / air-gapped</td>
                                    <td class="self-col"><span class="cmp-best">Full (file://)</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>Cost</td>
                                    <td class="self-col"><span class="cmp-best">Free forever</span></td>
                                    <td>Free / self-host</td>
                                    <td>Freemium</td>
                                    <td>$$$ (DBU)</td>
                                    <td>$$$ (per hr)</td>
                                    <td>Free</td>
                                    <td>Free / Pro</td>
                                    <td>Free</td>
                                    <td>Free</td>
                                    <td>Free</td>
                                    <td>Free / Paid</td>
                                    <td>$$$ (per shot)</td>
                                </tr>
                                <tr>
                                    <td>Terminal charting (CLI)</td>
                                    <td class="self-col"><span class="cmp-best">Charm + ChartGPU</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>In-browser diagrams</td>
                                    <td class="self-col"><span class="cmp-best">Mermaid native</span></td>
                                    <td><span class="cmp-part">Extension</span></td>
                                    <td><span class="cmp-part">Plugin</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-part">Cirq viz</span></td>
                                    <td><span class="cmp-part">Qiskit viz</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>Language pack breadth</td>
                                    <td class="self-col"><span class="cmp-best">18 langs / 9-prefix</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python/SQL</span></td>
                                    <td><span class="cmp-part">Py/Scala/SQL</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Quil/Python</span></td>
                                    <td><span class="cmp-part">JSON/Python</span></td>
                                </tr>
                                <tr>
                                    <td>Quantum AST prefix parsing</td>
                                    <td class="self-col"><span class="cmp-best">9-symbol &times; 18L</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-part">Qubit ops</span></td>
                                    <td><span class="cmp-part">Gate model</span></td>
                                    <td><span class="cmp-part">Quil IR</span></td>
                                    <td><span class="cmp-part">API gates</span></td>
                                </tr>
                                <tr>
                                    <td>Web code weighting</td>
                                    <td class="self-col"><span class="cmp-best">Scrape &rarr; prefix</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>Visualization paradigm</td>
                                    <td class="self-col"><span class="cmp-best">3D spatial topology</span></td>
                                    <td><span class="cmp-yes">Matplotlib+</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Reactive</span></td>
                                    <td><span class="cmp-yes">Cirq viz</span></td>
                                    <td><span class="cmp-yes">Qiskit viz</span></td>
                                    <td><span class="cmp-part">Limited</span></td>
                                    <td><span class="cmp-part">API only</span></td>
                                </tr>
                                <!-- ===== ROADMAP (4) ===== -->
                                <tr>
                                    <td>Code execution</td>
                                    <td class="self-col"><span class="cmp-mid">Stub &rarr; uv run</span></td>
                                    <td><span class="cmp-yes">IPython</span></td>
                                    <td><span class="cmp-yes">Python</span></td>
                                    <td><span class="cmp-yes">Spark</span></td>
                                    <td><span class="cmp-yes">Python/R</span></td>
                                    <td><span class="cmp-yes">Python/R</span></td>
                                    <td><span class="cmp-yes">Python/R</span></td>
                                    <td><span class="cmp-yes">Python</span></td>
                                    <td><span class="cmp-yes">Python</span></td>
                                    <td><span class="cmp-yes">Python</span></td>
                                    <td><span class="cmp-yes">Quil</span></td>
                                    <td><span class="cmp-yes">Cloud API</span></td>
                                </tr>
                                <tr>
                                    <td>Quantum hardware</td>
                                    <td class="self-col"><span class="cmp-mid">Prefix &rarr; CUDA-Q</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-part">Braket</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-yes">Google QPU</span></td>
                                    <td><span class="cmp-yes">IBM QPU</span></td>
                                    <td><span class="cmp-yes">Rigetti QPU</span></td>
                                    <td><span class="cmp-yes">IonQ QPU</span></td>
                                </tr>
                                <tr>
                                    <td>GPU / TPU compute</td>
                                    <td class="self-col"><span class="cmp-mid">AMX &rarr; Blackwell</span></td>
                                    <td><span class="cmp-part">Optional</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">T4 / A100</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-part">Sim only</span></td>
                                    <td><span class="cmp-part">Sim only</span></td>
                                    <td><span class="cmp-part">Sim only</span></td>
                                    <td><span class="cmp-part">Sim only</span></td>
                                </tr>
                                <tr>
                                    <td>Persistent storage</td>
                                    <td class="self-col"><span class="cmp-mid">JSON &rarr; v3 sessions</span></td>
                                    <td><span class="cmp-yes">.ipynb</span></td>
                                    <td><span class="cmp-yes">Cloud</span></td>
                                    <td><span class="cmp-yes">DBFS</span></td>
                                    <td><span class="cmp-yes">S3</span></td>
                                    <td><span class="cmp-yes">Cloud</span></td>
                                    <td><span class="cmp-yes">Drive</span></td>
                                    <td><span class="cmp-yes">.py</span></td>
                                    <td><span class="cmp-yes">File</span></td>
                                    <td><span class="cmp-yes">File</span></td>
                                    <td><span class="cmp-yes">File</span></td>
                                    <td><span class="cmp-yes">Cloud</span></td>
                                </tr>
                                <!-- ===== ROADMAP — Collab ===== -->
                                <tr>
                                    <td>Real-time collab</td>
                                    <td class="self-col"><span class="cmp-mid">Yjs CRDT &rarr; v3</span></td>
                                    <td><span class="cmp-part">RTC ext</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-part">Shared</span></td>
                                    <td><span class="cmp-part">Fork</span></td>
                                    <td><span class="cmp-part">Shared</span></td>
                                    <td><span class="cmp-no">Git</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ====== POSITIONING SUMMARY ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Positioning Summary</h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        <strong>uvspeed &mdash; Quantum beyondBINARY notepad</strong> is not another notebook competing on execution features.
                        It is the <strong>visual surface of a new code-architecture paradigm</strong> that replaces
                        binary <code>{0,&thinsp;1}</code> with a 9-symbol directional prefix system
                        <code>{+1, 1, -1, +0, 0, -0, +n, n, -n}</code>,
                        enabling any codebase &mdash; in any language &mdash; to be structurally re-addressed in 3D space.
                    </p>
                    <div class="tag-row" style="margin-bottom: var(--cursor-space-md);">
                        <span class="tag tag--green">19 outright wins &middot; 0 hard gaps &middot; 20 language packs &middot; 92 files prefixed</span>
                    </div>
                    <div class="tag-row" style="margin-bottom: var(--cursor-space-md);">
                        <span class="tag tag--blue">Architecture: Zig (Ghostty) &rarr; Rust (Nushell/uv) &rarr; Semantic (GrepAI) &rarr; Visual (Charm + Mermaid)</span>
                    </div>
                    <div class="tag-row" style="margin-bottom: var(--cursor-space-md);">
                        <span class="tag tag--yellow">Compute: Local AMX (Apple) &rarr; Remote Blackwell (NVIDIA CUDA-Q)</span>
                    </div>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        <strong>Why competitors don't cover this:</strong> JupyterLab, Colab, Databricks, and SageMaker execute code &mdash; they don't re-address it.
                        Cirq, Qiskit, QVM, and IonQ run quantum circuits &mdash; they don't give every classical line a quantum weight.
                        Codeshaper, CodeRabbit, and Graphite review code &mdash; they don't structurally prefix it across 18 languages.
                        Marimo is the closest architecturally (git-friendly, reactive) but still operates on flat-file cells, not spatial coordinates.<br><br>
                        <strong>Where it already works:</strong> The prefix system has been benchmarked across <strong>18 language packs</strong>:
                        Python (98%), JavaScript (96%), TypeScript (95%), Rust (94%), Go (93%), Java (92%),
                        C/C++ (91%), Swift (91%), Shell (90%), Kotlin (90%), Zig (90%), Ruby (89%),
                        HTML/CSS (88%), Nushell (87%), SQL (82%), YAML/TOML (78%), Docker (76%), Assembly (68%).
                        The 3D navigation (X&thinsp;=&thinsp;dependencies, Y&thinsp;=&thinsp;lines, Z&thinsp;=&thinsp;complexity) turns any codebase into a traversable structure &mdash;
                        like treating source files the way an OS kernel treats memory pages.<br><br>
                        <strong>What's shipped since last update:</strong>
                        <em>Quantum prefix gutter</em> on every cell (live 9-symbol line-by-line annotation).
                        <em>Convert timeline bar</em> with real-time coverage recalibration on paste.
                        <em>Pan/zoom mermaid canvas</em> (mouse drag, scroll-wheel, fit-to-view, SVG export).
                        <em>Undo/redo</em> (Ctrl+Z / Ctrl+Shift+Z, 50-deep stack).
                        <em>Stream history</em> with pipe-in/pipe-out for tracing quantum coordinate flows.
                        <em>Layer versioned nav grid</em> (button labels version with Z-depth, &infin; / &#10033; center symbol).
                        <em>Visual benchmark cell</em> (5-chart machine + CDN + prefix speed profiler).
                        <em>Cursor IDE rule</em> (.cursor/rules/quantum-prefix-gutter.mdc) for AI-native prefix awareness.
                        <em>92 project files prefixed</em> &mdash; every .py, .js, .sh, .html, .css, .toml, .md file carries the beyondBINARY header.<br><br>
                        <strong>What's next:</strong> Pyodide (WebAssembly Python) for in-browser compute.
                        CUDA-Q integration for quantum kernel offload. GrepAI semantic indexing of prefixed codebases.
                        Charm ecosystem (Gum, Glow, VHS, Crush) for terminal-native charting.
                        ChartGPU for 60fps WebGPU-accelerated visualization.
                        Quantum web scraper that ingests any codebase and weights it with prefix coverage.
                        Yjs CRDT real-time collab for multi-cursor quantum editing.
                        AI element suggestion from mermaid output (curl elements back inline for code dev).
                    </p>
                    <div class="tag-row" style="margin-bottom: var(--cursor-space-md);">
                        <span class="tag tag--green">50 KB bootloader &rarr; full quantum dev kernel</span>
                        <span class="tag tag--blue">20-language prefix system (68&ndash;98% coverage)</span>
                        <span class="tag tag--yellow">92 files prefixed &middot; Cursor IDE rule active</span>
                    </div>
                </div>

                <!-- ====== SOW — STATEMENT OF WORK ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Statement of Work &mdash; Agent Ready Code</h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        <strong>Objective:</strong> Evolve <strong>uvspeed &mdash; Quantum beyondBINARY notepad</strong> from a bootstrap visual layer into a
                        fully <em>agent-ready codebase</em> &mdash; one that AI agents can structurally parse, navigate,
                        modify, and deploy using the 9-symbol prefix system as a machine-readable address space.
                        Each phase below unlocks a tier of agent capability that moves the project up the benchmark standings.
                    </p>

                    <div class="sow-timeline">
                        <!-- Phase 1 -->
                        <div class="sow-phase phase-done">
                            <div class="sow-phase-title">
                                Phase 1 &mdash; Structural Bootstrap
                                <span class="phase-tag phase-tag--done">Complete</span>
                            </div>
                            <div class="sow-phase-body">
                                Establish the prefix system, 3D navigation, and visual surface.
                                <ul>
                                    <li>9-symbol quantum prefix set: <code>{+1, 1, -1, +0, 0, -0, +n, n, -n}</code></li>
                                    <li>3D code-space navigation (X deps, Y lines, Z complexity)</li>
                                    <li>Static HTML bootstrap &mdash; ~50 KB, zero dependencies</li>
                                    <li>Mermaid diagram rendering &amp; Charm visual layer</li>
                                    <li>Progressive versioning: v1 (1 KB) &rarr; v2 (36 KB) &rarr; v3 (100 MB)</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--green">Agent legibility: Prefixes make every line machine-parseable</span>
                                </div>
                            </div>
                        </div>

                        <!-- Phase 2 ✅ COMPLETE -->
                        <div class="sow-phase phase-done" style="border-left-color:#7ee787;">
                            <div class="sow-phase-title">
                                Phase 2 &mdash; Execution Bridge + Security + Git Automation
                                <span class="phase-tag" style="background:#7ee787;color:#0d1117;">✓ Complete</span>
                            </div>
                            <div class="sow-phase-body">
                                Connected the visual layer to real compute so agents can execute, test, scan, and iterate.
                                <ul>
                                    <li>✅ WebSocket bridge to <code>uv run</code> backend &mdash; real Python execution (<code>ws://8086</code> + HTTP <code>:8085</code>)</li>
                                    <li>✅ Terminal command passthrough (footer CLI &rarr; host shell via bridge)</li>
                                    <li>✅ JSON import/export with prefix metadata preservation + session store</li>
                                    <li>✅ Prefix-aware security scanner &mdash; Python/JS/Shell rule engine, severity scoring, <code>/api/security/scan</code></li>
                                    <li>✅ Git pre-commit hook generation + auto-install (<code>/api/git/hook</code>, <code>/api/git/hook/install</code>)</li>
                                    <li>✅ PR-ready quantum diff reports with prefix-category breakdown (<code>/api/git/diff-report</code>)</li>
                                    <li>✅ 25 API endpoints live across execution, prefix, diff, AI, agents, sessions, security, git</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--green">Agent capability: Execute, test, scan, and validate code autonomously</span>
                                </div>
                            </div>
                        </div>

                        <!-- Phase 3 (was Phase 3+4) -->
                        <div class="sow-phase phase-active">
                            <div class="sow-phase-title">
                                Phase 3 &mdash; Agent Integration + Orchestration
                                <span class="phase-tag phase-tag--active">Next</span>
                            </div>
                            <div class="sow-phase-body">
                                Expose the prefix system as an API surface that AI agents consume directly, with multi-agent coordination.
                                <ul>
                                    <li>Automated prefix assignment: raw code &rarr; quantum-prefixed in one pass</li>
                                    <li>GrepAI semantic index over prefixed codebases</li>
                                    <li>CodeRabbit / Graphite Agent-class PR review using prefix-aware diffs</li>
                                    <li>CodeSee-class code maps generated from X/Y/Z coordinates</li>
                                    <li>Multi-agent orchestration: inter-agent protocol + role-based prefix access</li>
                                    <li>Cursor / Copilot context injection with prefix metadata</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--purple">Agent capability: Review, refactor, map, and orchestrate code dimensionally</span>
                                </div>
                            </div>
                        </div>

                        <!-- Phase 4 -->
                        <div class="sow-phase phase-next">
                            <div class="sow-phase-title">
                                Phase 4 &mdash; Production &amp; Scale
                                <span class="phase-tag phase-tag--future">Future</span>
                            </div>
                            <div class="sow-phase-body">
                                Enterprise-grade deployment with QPU offload and multi-agent orchestration.
                                <ul>
                                    <li>CUDA-Q quantum kernel offload via NVIDIA Blackwell</li>
                                    <li>Multi-agent orchestration: code agents + review agents + deploy agents</li>
                                    <li>Real-time collaboration (P2P WebSocket mesh)</li>
                                    <li>BairesDev / Simform-class team scaling with role-based prefix access</li>
                                    <li>Atomic Object / Goji Labs-class delivery cadence with sprint-mapped phases</li>
                                    <li>SaaS deployment: hosted uvspeed beyondBINARY notepad with per-seat agent quotas</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--yellow">Agent capability: Multi-agent orchestration at enterprise scale</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ====== BENCHMARK STANDINGS ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Agent-Ready Benchmark Standings</h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        How UV-Speed compares against leading agent-ready code platforms, dev tooling companies, and AI code review services
                        as each SOW phase completes. <span style="color:var(--cursor-accent);">●</span>&thinsp;=&thinsp;best-in-class&ensp;
                        <span style="color:#7ee787;">●</span>&thinsp;=&thinsp;yes&ensp;
                        <span style="color:#f0d852;">●</span>&thinsp;=&thinsp;partial&ensp;
                        <span style="color:#484f58;">●</span>&thinsp;=&thinsp;no
                    </p>

                    <div class="bench-grid">
                        <!-- Header row -->
                        <div class="bg-hd">Capability</div>
                        <div class="bg-hd self-hd">uvspeed bB</div>
                        <div class="bg-hd">Codeshaper</div>
                        <div class="bg-hd">Atomic Obj</div>
                        <div class="bg-hd">Goji Labs</div>
                        <div class="bg-hd">Simform</div>
                        <div class="bg-hd">Snyk/Aikido</div>
                        <div class="bg-hd">BairesDev</div>
                        <div class="bg-hd">CodeSee</div>
                        <div class="bg-hd">Graphite</div>
                        <div class="bg-hd">CodeRabbit</div>
                        <div class="bg-hd">Codementor</div>

                        <!-- Row 1: Dimensional code addressing -->
                        <div class="bg-cell bg-cap">Dimensional code addressing</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 2: AI code review -->
                        <div class="bg-cell bg-cap">AI code review</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 3: Security scanning -->
                        <div class="bg-cell bg-cap">Security scanning</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 4: Code visualization / maps -->
                        <div class="bg-cell bg-cap">Code visualization / maps</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 5: Language agnostic -->
                        <div class="bg-cell bg-cap">Language-agnostic</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>

                        <!-- Row 6: Offline / air-gapped -->
                        <div class="bg-cell bg-cap">Offline / air-gapped</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 7: Agent API surface -->
                        <div class="bg-cell bg-cap">Agent API surface</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 8: Bootstrap portability -->
                        <div class="bg-cell bg-cap">Bootstrap portability</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 9: Real-time execution -->
                        <div class="bg-cell bg-cap">Real-time execution</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 10: PR / diff automation -->
                        <div class="bg-cell bg-cap">PR / diff automation</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 11: Multi-agent orchestration -->
                        <div class="bg-cell bg-cap">Multi-agent orchestration</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 12: Cost to start -->
                        <div class="bg-cell bg-cap">Cost to start</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 13: Language pack breadth -->
                        <div class="bg-cell bg-cap">Language pack breadth</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 14: Quantum AST prefix parsing -->
                        <div class="bg-cell bg-cap">Quantum AST parsing</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 15: Terminal-native visualization -->
                        <div class="bg-cell bg-cap">Terminal-native viz</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 16: Web code scraping & weighting -->
                        <div class="bg-cell bg-cap">Web code weighting</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                    </div>

                    <p style="margin-top: var(--cursor-space-lg); margin-bottom: var(--cursor-space-sm);">
                        <strong>Current standing:</strong> UV-Speed leads outright on <strong>9 capabilities</strong>
                        (dimensional addressing, code visualization, offline, bootstrap portability, cost,
                        language pack breadth, quantum AST parsing, terminal-native viz, web code weighting)
                        that <em>no competitor offers at all</em>. With 18 language packs at 68&ndash;98% AST prefix coverage,
                        the quantum prefix system already spans more languages than any single platform supports natively.
                        As Phases 2&ndash;4 deliver execution, agent API, and multi-agent orchestration,
                        every remaining partial dot converts to best-in-class &mdash;
                        making this the only platform combining structural code intelligence with full agent readiness.
                    </p>
                    <div class="tag-row">
                        <span class="tag tag--green">9 unique wins today</span>
                        <span class="tag tag--blue">18 language packs benchmarked</span>
                        <span class="tag tag--purple">Agent-ready by Phase 3</span>
                        <span class="tag tag--yellow">0 hard gaps remaining</span>
                    </div>
                </div>

                <!-- ====== PREFIX EVERYTHING ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Prefix Everything &mdash; Proving Universal Quantum Weighting</h3>
                    <p style="margin-bottom: var(--cursor-space-sm);">
                        The 9-symbol prefix system doesn't stop at Python or JS.
                        <strong>Every file type our system reads, displays, or uses must carry quantum weights</strong> &mdash;
                        including the HTML of this very page. This proves that a quantum-aware system could
                        instantly scrape the web and dimensionally weight the entire world of existing code.
                    </p>

                    <!-- SHIPPED: Quantum Gutter + Convert Timeline + Security + Git -->
                    <div style="background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:10px 14px;margin-bottom:var(--cursor-space-md);">
                        <div style="font-size:0.6875rem;font-weight:700;color:#7ee787;margin-bottom:6px;">✅ Shipped: Prefix Engine Delivered End-to-End</div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;font-size:0.625rem;color:var(--cursor-text-muted);">
                            <div><strong style="color:var(--cursor-text);">Quantum Prefix Gutter</strong> &mdash; live visual column left of every cell. Each line classified in real-time using the 9-symbol system with color-coded prefixes (<code>pfx-shebang</code>, <code>pfx-import</code>, <code>pfx-function</code>, etc). Debounced 100ms, scroll-synced.</div>
                            <div><strong style="color:var(--cursor-text);">Convert Timeline Bar</strong> &mdash; top bar auto-calibrates on paste/edit. Shows prefix coverage %, segment distribution by category, and per-language stats. Animates during conversion.</div>
                            <div><strong style="color:var(--cursor-text);">Security Scanner</strong> &mdash; prefix-aware static analysis (Python/JS/Shell). Regex rule engine with severity scoring (critical/high/medium/low). <code>/api/security/scan</code> for code, file, or directory.</div>
                            <div><strong style="color:var(--cursor-text);">Git Pre-Commit Hook</strong> &mdash; auto-generated bash hook scans staged files via bridge API, blocks commits with risk score &gt;20, checks for <code>beyondBINARY</code> header. <code>/api/git/hook/install</code> for one-click deploy.</div>
                            <div><strong style="color:var(--cursor-text);">Cursor IDE Rule</strong> &mdash; <code>.cursor/rules/quantum-prefix-gutter.mdc</code> teaches AI to classify code with the 9-symbol system during generation, review, and refactoring. Always-on rule.</div>
                            <div><strong style="color:var(--cursor-text);">Project-Wide Headers</strong> &mdash; <code>tools/prefix_all_files.py</code> stamps every source file (91+ files) with <code># beyondBINARY quantum-prefixed | uvspeed</code> header. Idempotent, multi-language comment syntax.</div>
                        </div>
                    </div>

                    <div class="prefix-demo">
                        <span class="cm">&lt;!-- Quantum-prefixed HTML: every element has a directional weight --&gt;</span><br>
                        <span class="pf"> n:</span> <span class="tg">&lt;!DOCTYPE html&gt;</span><br>
                        <span class="pf">+1:</span> <span class="tg">&lt;html</span> <span class="at">lang=</span><span class="tx">"en"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +1: structural container --&gt;</span><br>
                        <span class="pf">-n:</span> <span class="tg">&lt;link</span> <span class="at">rel=</span><span class="tx">"stylesheet"</span> <span class="at">href=</span><span class="tx">"theme.css"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- -n: dependency import --&gt;</span><br>
                        <span class="pf">-n:</span> <span class="tg">&lt;script</span> <span class="at">src=</span><span class="tx">"mermaid.min.js"</span><span class="tg">&gt;&lt;/script&gt;</span> <span class="cm">&lt;!-- -n: dependency import --&gt;</span><br>
                        <span class="pf">+0:</span> <span class="tg">&lt;div</span> <span class="at">class=</span><span class="tx">"notepad-container"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +0: class / structure --&gt;</span><br>
                        <span class="pf"> 0:</span> <span class="tg">&lt;div</span> <span class="at">class=</span><span class="tx">"notepad-header"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- 0: function / method --&gt;</span><br>
                        <span class="pf">+n:</span> <span class="tg">&lt;div</span> <span class="at">v-if=</span><span class="tx">"cells.length"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +n: conditional --&gt;</span><br>
                        <span class="pf">+2:</span> <span class="tg">&lt;li</span> <span class="at">v-for=</span><span class="tx">"cell in cells"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +2: loop / iteration --&gt;</span><br>
                        <span class="pf">-1:</span> <span class="tg">&lt;div</span> <span class="at">class=</span><span class="tx">"output-error"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- -1: error handling --&gt;</span><br>
                        <span class="pf">+3:</span> <span class="tg">&lt;span</span> <span class="at">id=</span><span class="tx">"position-display"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +3: output / render --&gt;</span><br>
                        <span class="pf">-0:</span> <span class="tg">&lt;/div&gt;&lt;/html&gt;</span> <span class="cm">&lt;!-- -0: return / exit / close --&gt;</span>
                    </div>

                    <p style="margin-bottom: var(--cursor-space-sm);">
                        <strong>What this enables:</strong> A quantum web scraper reads any URL, assigns prefixes to every DOM node,
                        and builds a 3D navigable map of that page in milliseconds. CSS rules get <code>+0:</code> (structure),
                        event handlers get <code>0:</code> (function), API fetches get <code>-n:</code> (dependency).
                        The same system works on <code>.py</code>, <code>.rs</code>, <code>.go</code>, <code>.sh</code>,
                        <code>.json</code>, <code>.yaml</code>, <code>.toml</code>, Dockerfiles, Makefiles, and assembly.
                    </p>

                    <div class="tag-row" style="margin-bottom: 0;">
                        <span class="tag tag--green">HTML / CSS / JS</span>
                        <span class="tag tag--green">Python / Rust / Go / C</span>
                        <span class="tag tag--blue">YAML / TOML / JSON</span>
                        <span class="tag tag--blue">Docker / Make / Shell</span>
                        <span class="tag tag--yellow">Any future language</span>
                        <span class="tag tag--green">Gutter LIVE</span>
                        <span class="tag tag--green">Timeline LIVE</span>
                        <span class="tag tag--green">Security LIVE</span>
                        <span class="tag tag--green">Git Hook LIVE</span>
                    </div>
                </div>

                <!-- ====== AI CONVERSION ROADMAP ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; AI-Compatible Conversion Roadmap</h3>
                    <p style="margin-bottom: var(--cursor-space-sm);">
                        Every open LLM/AI framework below has a concrete path to quantum-prefix conversion.
                        The bridge server exposes <code>POST /api/roadmap/scan</code> and <code>POST /api/roadmap/convert</code>
                        to batch-convert any codebase. Status reflects current prefix engine support.
                    </p>

                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:8px;margin-bottom:var(--cursor-space-md);">

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🧠 tinygrad</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Ultra-minimal ML framework (~10K lines Python). Prefix coverage: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">Loaded in bridge</span>
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Tensor in namespace</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🔬 micrograd</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Tiny autograd engine (~150 lines). Prefix coverage: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">Value in namespace</span>
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Pure Python</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🦙 Ollama (llama3.2)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Local LLM server. Bridge connects at <code>localhost:11434</code>. Go codebase: <strong style="color:#7ee787;">93%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">API integrated</span>
                                <span class="tag tag--purple" style="font-size:0.5rem;padding:1px 5px;">Local inference</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🤖 OpenAI / GPT-4o</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Cloud API via bridge. Code: Python/JS. Prefix coverage: <strong style="color:#7ee787;">96%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">API integrated</span>
                                <span class="tag tag--yellow" style="font-size:0.5rem;padding:1px 5px;">Needs API key</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🧬 Anthropic / Claude</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Cloud API via bridge. Code: Python/TS. Prefix coverage: <strong style="color:#7ee787;">96%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">API integrated</span>
                                <span class="tag tag--yellow" style="font-size:0.5rem;padding:1px 5px;">Needs API key</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🔥 PyTorch</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Python + C++ core. Python prefix: <strong style="color:#7ee787;">98%</strong> · C++ prefix: <strong style="color:#7ee787;">91%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--yellow" style="font-size:0.5rem;padding:1px 5px;">~150K files</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🤗 Hugging Face Transformers</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Python library. Prefix coverage: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--purple" style="font-size:0.5rem;padding:1px 5px;">Phase 3</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">⚡ JAX / Flax</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Python + XLA. Prefix coverage: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--purple" style="font-size:0.5rem;padding:1px 5px;">Phase 3</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🧪 ONNX Runtime</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">C++ / Python. C++ prefix: <strong style="color:#7ee787;">91%</strong> · Python: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--yellow" style="font-size:0.5rem;padding:1px 5px;">Multi-lang</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🌀 llama.cpp / ggml</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">C / C++ inference. Prefix coverage: <strong style="color:#7ee787;">91%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">Offline</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🦀 Candle (Rust ML)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Rust ML framework. Prefix coverage: <strong style="color:#7ee787;">94%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--purple" style="font-size:0.5rem;padding:1px 5px;">Phase 3</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🔮 MLX (Apple)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Python + C++ for Apple Silicon. Python: <strong style="color:#7ee787;">98%</strong> · C++: <strong style="color:#7ee787;">91%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">AMX native</span>
                            </div>
                        </div>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">3 loaded in bridge (tinygrad, micrograd, Ollama)</span>
                        <span class="tag tag--blue">12 frameworks scan-ready</span>
                        <span class="tag tag--purple">API: POST /api/roadmap/scan &middot; POST /api/roadmap/convert</span>
                    </div>
                </div>

                <!-- ====== beyondBINARY TRAINING FORMULA ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; beyond<span style="font-weight:900;">BINARY</span> Training Formula for LLMs &amp; MCPs</h3>
                    <p style="margin-bottom: var(--cursor-space-sm);">
                        A universal formula and training protocol for any LLM, MCP server, or AI agent to learn,
                        adopt, and enhance the beyond<strong>BINARY</strong> 9-symbol paradigm &mdash; shifting code architecture
                        from <code>{0, 1}</code> to <code>{+1, 1, -1, +0, 0, -0, +n, n, -n}</code>.
                    </p>

                    <!-- The Formula -->
                    <div style="background:var(--cursor-bg);border:2px solid var(--cursor-accent);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);text-align:center;">
                        <div style="font-size:0.625rem;text-transform:uppercase;letter-spacing:1px;color:var(--cursor-accent);margin-bottom:8px;font-weight:700;">beyondBINARY Quantum Weight Formula</div>
                        <div style="font-family:var(--cursor-font-mono);font-size:1rem;font-weight:700;color:var(--cursor-text);line-height:1.8;">
                            Q<sub>w</sub>(line) = P<sub>prefix</sub> &times; D<sub>depth</sub> &times; C<sub>context</sub> &times; S<sub>semantic</sub>
                        </div>
                        <div style="font-size:0.6875rem;color:var(--cursor-text-muted);margin-top:8px;text-align:left;">
                            <strong>P<sub>prefix</sub></strong> = quantum prefix symbol from {+1, 1, -1, +0, 0, -0, +n, n, -n} mapped to weight [-1.0 &hellip; +1.0]<br>
                            <strong>D<sub>depth</sub></strong> = indentation depth / structural nesting level (normalized 0&hellip;1)<br>
                            <strong>C<sub>context</sub></strong> = contextual relevance to 3D position [X=deps, Y=lines, Z=complexity]<br>
                            <strong>S<sub>semantic</sub></strong> = semantic role weight (import=0.9, function=1.0, comment=0.3, error=0.8, loop=0.7)
                        </div>
                    </div>

                    <!-- Prefix Weight Map -->
                    <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:var(--cursor-space-sm) var(--cursor-space-md);margin-bottom:var(--cursor-space-md);">
                        <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Prefix &rarr; Weight Map (for LLM training embeddings)</div>
                        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;font-family:var(--cursor-font-mono);font-size:0.625rem;">
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">+1:</span> <span style="color:var(--cursor-text-muted);">comment/doc</span> <span style="margin-left:auto;color:#7ee787;">+0.3</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;"> 1:</span> <span style="color:var(--cursor-text-muted);">variable</span> <span style="margin-left:auto;color:#7ee787;">+0.5</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">-1:</span> <span style="color:var(--cursor-text-muted);">error/except</span> <span style="margin-left:auto;color:#f97583;">-0.8</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">+0:</span> <span style="color:var(--cursor-text-muted);">class/struct</span> <span style="margin-left:auto;color:#7ee787;">+1.0</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;"> 0:</span> <span style="color:var(--cursor-text-muted);">function/def</span> <span style="margin-left:auto;color:#7ee787;">+0.9</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">-0:</span> <span style="color:var(--cursor-text-muted);">return/yield</span> <span style="margin-left:auto;color:#f0d852;">+0.4</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">+n:</span> <span style="color:var(--cursor-text-muted);">conditional</span> <span style="margin-left:auto;color:#f0d852;">+0.6</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;"> n:</span> <span style="color:var(--cursor-text-muted);">entry/shebang</span> <span style="margin-left:auto;color:#7ee787;">+0.7</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">-n:</span> <span style="color:var(--cursor-text-muted);">import/dep</span> <span style="margin-left:auto;color:#d2a8ff;">+0.85</span></div>
                        </div>
                    </div>

                    <!-- LLM Training Protocol -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">LLM / MCP Training Protocol</div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:8px;margin-bottom:var(--cursor-space-md);">

                        <!-- GPT / OpenAI -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🤖 GPT-4o / GPT-5 (OpenAI)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Fine-tune on prefixed codebases using JSONL format.
                                Each training sample = raw code + quantum-prefixed version + Q<sub>w</sub> weight vector.
                                System prompt injection: "All code exists in 3D space addressed by {+1, 1, -1, +0, 0, -0, +n, n, -n}."
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>MCP integration:</strong> Expose <code>/api/prefix</code> as MCP tool.
                                GPT reads raw code → calls prefix tool → returns dimensionally-addressed output.
                            </div>
                        </div>

                        <!-- Claude / Anthropic -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🧬 Claude 4 / Opus (Anthropic)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Constitutional AI + beyondBINARY principles as system constraints.
                                Teach: "Every line of code has a quantum weight Q<sub>w</sub> that determines its structural importance."
                                RLHF reward model tuned on prefix-quality scoring.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>MCP integration:</strong> MCP server with <code>prefix</code>, <code>execute</code>, <code>navigate</code>, <code>diff</code> tools.
                                Claude navigates code in 3D using quantum coordinates.
                            </div>
                        </div>

                        <!-- Gemini / Google -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">💎 Gemini 2.5 Pro (Google)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Multi-modal training with prefixed code + 3D spatial visualization.
                                Gemini's code understanding + beyondBINARY structural layer = code-as-topology model.
                                Token weighting by Q<sub>w</sub> during attention computation.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>Integration:</strong> Vertex AI pipeline → prefix conversion → weighted inference.
                            </div>
                        </div>

                        <!-- Llama / Meta -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🦙 Llama 4 (Meta)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Open-weight fine-tuning on quantum-prefixed datasets.
                                LoRA adapters for beyondBINARY: prefix recognition head + Q<sub>w</sub> prediction head.
                                Local training via Ollama → <code>ollama create beyondBINARY -f Modelfile</code>.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>MCP integration:</strong> Ollama API → bridge server → <code>/api/ai</code> endpoint.
                            </div>
                        </div>

                        <!-- Mistral -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🌊 Mistral / Codestral</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Code-specialized model + prefix layer.
                                Codestral's 32K context → full-file quantum weighting in one pass.
                                Mixture-of-experts: route prefix-heavy tokens to dedicated expert.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>Advantage:</strong> EU-hosted, air-gapped compatible. Matches uvspeed offline-first.
                            </div>
                        </div>

                        <!-- DeepSeek -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🔬 DeepSeek-Coder V3</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Fill-in-the-middle (FIM) + prefix insertion.
                                Train to predict missing quantum prefix given code context.
                                Reward: Q<sub>w</sub> accuracy on held-out prefixed codebases.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>Key value:</strong> Open-source. Community can train custom beyondBINARY models.
                            </div>
                        </div>

                        <!-- Cursor / Copilot ✅ SHIPPED -->
                        <div style="background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#7ee787;margin-bottom:4px;">⚡ Cursor / GitHub Copilot &mdash; ✅ LIVE</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Shipped:</strong> <code>.cursor/rules/quantum-prefix-gutter.mdc</code> &mdash; always-on rule teaching AI the 9-symbol system.
                                Live quantum gutter in notepad cells with real-time prefix classification.
                                Convert timeline auto-calibrates on paste. Every completion includes Q<sub>w</sub> weight context.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>MCP server:</strong> <code>quantum_bridge_server.py</code> as Cursor MCP → prefix/execute/navigate/security/git tools (25 endpoints).
                            </div>
                        </div>

                        <!-- MCP Protocol ✅ EXPANDED -->
                        <div style="background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#7ee787;margin-bottom:4px;">🔌 MCP (Model Context Protocol) &mdash; 25 endpoints</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Universal MCP server spec (all live):</strong><br>
                                Tool: <code>prefix</code> — convert raw code to quantum-weighted form<br>
                                Tool: <code>execute</code> — run code at quantum coordinates<br>
                                Tool: <code>navigate</code> — move through 3D code space<br>
                                Tool: <code>diff</code> — prefix-aware structural diff<br>
                                Tool: <code>scan</code> — scan codebase and produce conversion roadmap<br>
                                Tool: <code>security</code> — prefix-aware security scanning (code/file/directory)<br>
                                Tool: <code>git-hook</code> — generate/install quantum pre-commit hooks<br>
                                Tool: <code>git-diff-report</code> — PR-ready markdown diff with prefix breakdown<br>
                                Resource: <code>beyondBINARY://formula</code> — Q<sub>w</sub> weight formula
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>Any LLM + this MCP = beyondBINARY capable.</strong> No fine-tuning required for basic adoption.
                            </div>
                        </div>
                    </div>

                    <!-- Training Dataset Formula -->
                    <div style="background:var(--cursor-bg);border:2px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);">
                        <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:8px;">Training Dataset Generation Formula</div>
                        <div style="font-family:var(--cursor-font-mono);font-size:0.625rem;color:var(--cursor-text-muted);line-height:1.8;">
                            <strong style="color:var(--cursor-text);">Step 1:</strong> <code>POST /api/roadmap/scan</code> &rarr; inventory all files by language<br>
                            <strong style="color:var(--cursor-text);">Step 2:</strong> <code>POST /api/roadmap/convert</code> &rarr; batch prefix-convert (20 langs, 68-98% coverage)<br>
                            <strong style="color:var(--cursor-text);">Step 3:</strong> For each file pair (raw, prefixed), generate training sample:<br>
                            &emsp;<code>{"input": raw_code, "output": prefixed_code, "Qw": [weight_vector], "lang": language, "coords": [x,y,z]}</code><br>
                            <strong style="color:var(--cursor-text);">Step 4:</strong> <code>POST /api/security/scan</code> &rarr; annotate each sample with security findings + risk score<br>
                            <strong style="color:var(--cursor-text);">Step 5:</strong> Fine-tune with loss = <code>CrossEntropy(predicted_prefix, actual_prefix) + MSE(predicted_Qw, actual_Qw)</code><br>
                            <strong style="color:var(--cursor-text);">Step 6:</strong> Validate on held-out codebases: target &ge; 90% prefix accuracy across all 20 languages<br>
                            <strong style="color:var(--cursor-text);">Step 7:</strong> Deploy as MCP server (25 endpoints) or embed in LLM context window via <code>.cursor/rules/quantum-prefix-gutter.mdc</code>
                        </div>
                    </div>

                    <!-- Future Tech Impact -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Future Tech Enhancement via beyondBINARY</div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:6px;margin-bottom:var(--cursor-space-md);">
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">🧊 Quantum Computing</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Q<sub>w</sub> maps directly to qubit amplitudes. Classical code becomes quantum-executable via prefix → gate compilation. CUDA-Q / Cirq / Qiskit as targets.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">🧬 Neuromorphic Chips</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">9-symbol prefix = 9-spike pattern. Map code structure to spiking neural networks. Intel Loihi / IBM TrueNorth targets. Code runs as neural topology.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">🌐 Spatial Computing</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">3D code coordinates [X,Y,Z] render as spatial objects. Apple Vision Pro / Meta Quest as code visualization. Walk through code in VR.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">⚡ Edge AI / TinyML</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">beyondBINARY prefix = 4-bit encoding. Fits in 64B headers. On-device code understanding for IoT, embedded, RISC-V. tinygrad as runtime.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">🔗 Autonomous Agents</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Agents navigate code by Q<sub>w</sub> weight, not line number. Agent A (prefix) → Agent B (execute) → Agent C (review) pipeline via quantum coordinates.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">🛡️ Post-Quantum Security</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Prefix weights create a structural fingerprint per codebase. Tamper detection: if Q<sub>w</sub> vector changes, code was modified. Lattice-based signing over prefix space.</div>
                        </div>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">Q<sub>w</sub> formula ready for embedding</span>
                        <span class="tag tag--blue">8 LLM/MCP training paths defined</span>
                        <span class="tag tag--green">Cursor rule LIVE (.mdc)</span>
                        <span class="tag tag--green">Quantum gutter LIVE</span>
                        <span class="tag tag--green">25-endpoint MCP server LIVE</span>
                        <span class="tag tag--purple">MCP server = instant beyondBINARY for any LLM</span>
                        <span class="tag tag--yellow">6 future tech domains mapped</span>
                    </div>
                </div>

                <!-- ====== IDE PLUGIN: .mdc PREFIX GUTTER RULE ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; IDE Plugin: Quantum Prefix Gutter Rule (<code>.mdc</code>)</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);">
                        A <strong>Cursor IDE rule</strong> that teaches any AI model the beyondBINARY 9-symbol system natively.
                        Installed at <code>.cursor/rules/quantum-prefix-gutter.mdc</code> &mdash; always active, zero config.
                        Any AI agent in Cursor automatically classifies, generates, and reviews code with quantum prefixes.
                    </p>

                    <!-- Status badge -->
                    <div style="display:flex;gap:var(--cursor-space-sm);align-items:center;margin-bottom:var(--cursor-space-md);">
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">✅ SHIPPED &amp; LIVE</span>
                        <span style="font-size:0.625rem;color:var(--cursor-text-muted);">Path: <code>.cursor/rules/quantum-prefix-gutter.mdc</code> &middot; <code>alwaysApply: true</code> &middot; 74 lines</span>
                    </div>

                    <!-- Rule file content preview -->
                    <div style="background:var(--cursor-bg);border:2px solid var(--cursor-accent);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.625rem;line-height:1.7;overflow-x:auto;">
                        <div style="color:var(--cursor-accent);font-weight:700;margin-bottom:8px;">// .cursor/rules/quantum-prefix-gutter.mdc</div>
                        <span style="color:#484f58;">---</span><br>
                        <span style="color:#d2a8ff;">alwaysApply:</span> <span style="color:#7ee787;">true</span><br>
                        <span style="color:#484f58;">---</span><br>
                        <span style="color:#7ee787;font-weight:700;"># Quantum beyondBINARY Prefix System</span><br><br>
                        <span style="color:var(--cursor-text-muted);">All code in this project uses the <strong style="color:var(--cursor-text);">9-symbol quantum prefix system</strong>.</span><br>
                        <span style="color:var(--cursor-text-muted);">Every line of code gets a prefix that classifies its structural role.</span><br><br>
                        <span style="color:#7ee787;">## The 9 Symbols</span><br>
                        <div style="display:grid;grid-template-columns:60px 80px 1fr;gap:2px 12px;margin:6px 0 6px 8px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">n:</span>  <span style="color:#f97583;">shebang</span>   <span style="color:var(--cursor-text-muted);">Entry points, shebangs</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span> <span style="color:#7ee787;">comment</span>   <span style="color:var(--cursor-text-muted);">Comments, documentation, decorators</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">-n:</span> <span style="color:#d2a8ff;">import</span>    <span style="color:var(--cursor-text-muted);">Imports, includes, requires</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+0:</span> <span style="color:#79c0ff;">class</span>     <span style="color:var(--cursor-text-muted);">Class, struct, type, enum defs</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>  <span style="color:#79c0ff;">function</span>  <span style="color:var(--cursor-text-muted);">Function, method definitions</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">-1:</span> <span style="color:#f97583;">error</span>     <span style="color:var(--cursor-text-muted);">Error handling, try/catch/raise</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+n:</span> <span style="color:#f0d852;">condition</span> <span style="color:var(--cursor-text-muted);">If/else/switch/match conditionals</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+2:</span> <span style="color:#f0883e;">loop</span>      <span style="color:var(--cursor-text-muted);">For/while/repeat loops</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">-0:</span> <span style="color:#f0d852;">return</span>    <span style="color:var(--cursor-text-muted);">Return/yield statements</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+3:</span> <span style="color:#7ee787;">output</span>    <span style="color:var(--cursor-text-muted);">Print/echo/log/render output</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">1:</span>  <span style="color:var(--cursor-text);">variable</span> <span style="color:var(--cursor-text-muted);">Variable declarations/assignments</span>
                        </div>
                        <br>
                        <span style="color:#7ee787;">## Rules for AI</span><br>
                        <span style="color:var(--cursor-text-muted);">1. When writing or editing code, mentally classify each line by its prefix</span><br>
                        <span style="color:var(--cursor-text-muted);">2. When showing code examples, include prefix annotations as comments</span><br>
                        <span style="color:var(--cursor-text-muted);">3. When reviewing code, note which prefix categories changed</span><br>
                        <span style="color:var(--cursor-text-muted);">4. Prefix-aware diffs should show which quantum coordinates shifted</span><br>
                        <span style="color:var(--cursor-text-muted);">5. All 20 supported languages use the same 9-symbol system</span><br><br>
                        <span style="color:#7ee787;">## Supported Languages (20)</span><br>
                        <span style="color:var(--cursor-text);">python, javascript, typescript, rust, go, c, shell, html, css, java, swift, kotlin, ruby, yaml, toml, sql, dockerfile, nushell, zig, assembly</span><br><br>
                        <span style="color:#7ee787;">## When Generating Files</span><br>
                        <span style="color:var(--cursor-text-muted);">Every file includes header: </span><span style="color:var(--cursor-text);font-weight:600;"># beyondBINARY quantum-prefixed | uvspeed | {+1, 1, -1, +0, 0, -0, +n, n, -n}</span>
                    </div>

                    <!-- How it works -->
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:8px;margin-bottom:var(--cursor-space-md);">
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🧠 How It Trains the AI</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                The <code>alwaysApply: true</code> flag injects the rule into every AI interaction in Cursor.
                                The AI learns the 9-symbol table, the classification rules, and the 20-language support.
                                Every code generation, review, and refactor inherits quantum prefix awareness.
                            </div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">⚡ Live Quantum Gutter (Notepad)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                In <code>quantum-notepad.html</code>, every cell has a live gutter column.
                                Each line is classified in real-time using the same 9-symbol rules.
                                Color-coded prefixes (<code>pfx-shebang</code> through <code>pfx-default</code>), debounced 100ms, scroll-synced with textarea.
                            </div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">📊 Convert Timeline Bar</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                Top bar auto-calibrates when code is pasted or edited.
                                Shows prefix coverage %, per-category segment distribution, and detected language.
                                Animates a 1.5s pulse during conversion. Updates on cell focus.
                            </div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">🔌 Bridge API Integration</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                Server-side prefix engine mirrors the client gutter: <code>POST /api/prefix</code> for code, <code>POST /api/prefix/file</code> for files.
                                Security scanner uses prefix context to weight findings.
                                Git hooks validate prefix headers on commit.
                            </div>
                        </div>
                    </div>

                    <!-- Python example with live prefixes -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Example: Python with Quantum Prefix Gutter</div>
                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:12px 14px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.625rem;line-height:1.8;overflow-x:auto;">
                        <div style="display:grid;grid-template-columns:36px 28px 1fr;gap:0 6px;">
                            <span style="color:#f97583;font-weight:700;text-align:right;">n:</span>   <span style="color:#484f58;text-align:right;">1</span> <span style="color:var(--cursor-text-muted);">#!/usr/bin/env python3</span>
                            <span style="color:#7ee787;font-weight:700;text-align:right;">+1:</span>  <span style="color:#484f58;text-align:right;">2</span> <span style="color:#7ee787;"># Quantum computation module</span>
                            <span style="color:#d2a8ff;font-weight:700;text-align:right;">-n:</span>  <span style="color:#484f58;text-align:right;">3</span> <span style="color:var(--cursor-text);">import numpy as np</span>
                            <span style="color:#d2a8ff;font-weight:700;text-align:right;">-n:</span>  <span style="color:#484f58;text-align:right;">4</span> <span style="color:var(--cursor-text);">from tinygrad.tensor import Tensor</span>
                            <span style="color:#484f58;font-weight:700;text-align:right;"></span>    <span style="color:#484f58;text-align:right;">5</span> <span></span>
                            <span style="color:#79c0ff;font-weight:700;text-align:right;">+0:</span>  <span style="color:#484f58;text-align:right;">6</span> <span style="color:var(--cursor-text);font-weight:600;">class QuantumState:</span>
                            <span style="color:#7ee787;font-weight:700;text-align:right;">+1:</span>  <span style="color:#484f58;text-align:right;">7</span> <span style="color:#7ee787;">    &quot;&quot;&quot;Represents a quantum state vector.&quot;&quot;&quot;</span>
                            <span style="color:#484f58;font-weight:700;text-align:right;"></span>    <span style="color:#484f58;text-align:right;">8</span> <span></span>
                            <span style="color:#79c0ff;font-weight:700;text-align:right;">0:</span>   <span style="color:#484f58;text-align:right;">9</span> <span style="color:var(--cursor-text);">    def __init__(self, qubits=3):</span>
                            <span style="color:var(--cursor-text);font-weight:700;text-align:right;">1:</span>   <span style="color:#484f58;text-align:right;">10</span> <span style="color:var(--cursor-text);">        self.n = qubits</span>
                            <span style="color:var(--cursor-text);font-weight:700;text-align:right;">1:</span>   <span style="color:#484f58;text-align:right;">11</span> <span style="color:var(--cursor-text);">        self.state = Tensor.randn(2 ** qubits)</span>
                            <span style="color:#79c0ff;font-weight:700;text-align:right;">0:</span>   <span style="color:#484f58;text-align:right;">13</span> <span style="color:var(--cursor-text);">    def normalize(self):</span>
                            <span style="color:#f0d852;font-weight:700;text-align:right;">-0:</span>  <span style="color:#484f58;text-align:right;">14</span> <span style="color:var(--cursor-text);">        return self.state / self.state.norm()</span>
                            <span style="color:#79c0ff;font-weight:700;text-align:right;">0:</span>   <span style="color:#484f58;text-align:right;">16</span> <span style="color:var(--cursor-text);">    def measure(self):</span>
                            <span style="color:#f97583;font-weight:700;text-align:right;">-1:</span>  <span style="color:#484f58;text-align:right;">17</span> <span style="color:var(--cursor-text);">        try:</span>
                            <span style="color:var(--cursor-text);font-weight:700;text-align:right;">1:</span>   <span style="color:#484f58;text-align:right;">18</span> <span style="color:var(--cursor-text);">            probs = (self.state ** 2).numpy()</span>
                            <span style="color:#f0d852;font-weight:700;text-align:right;">-0:</span>  <span style="color:#484f58;text-align:right;">19</span> <span style="color:var(--cursor-text);">            return probs</span>
                            <span style="color:#f97583;font-weight:700;text-align:right;">-1:</span>  <span style="color:#484f58;text-align:right;">20</span> <span style="color:var(--cursor-text);">        except Exception as e:</span>
                            <span style="color:#7ee787;font-weight:700;text-align:right;">+3:</span>  <span style="color:#484f58;text-align:right;">21</span> <span style="color:var(--cursor-text);">            print(f&quot;Measurement error: {e}&quot;)</span>
                        </div>
                    </div>

                    <!-- Installation -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Install in Any Project</div>
                    <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 14px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.625rem;line-height:1.8;">
                        <span style="color:#7ee787;"># 1. Copy the rule file into any project</span><br>
                        <span style="color:var(--cursor-text);">mkdir -p .cursor/rules</span><br>
                        <span style="color:var(--cursor-text);">cp uvspeed/.cursor/rules/quantum-prefix-gutter.mdc .cursor/rules/</span><br><br>
                        <span style="color:#7ee787;"># 2. That's it. Cursor AI now understands quantum prefixes.</span><br>
                        <span style="color:#7ee787;"># Every code generation, review, and refactor is prefix-aware.</span><br><br>
                        <span style="color:#7ee787;"># 3. Optional: stamp all files with beyondBINARY header</span><br>
                        <span style="color:var(--cursor-text);">python3 tools/prefix_all_files.py</span><br><br>
                        <span style="color:#7ee787;"># 4. Optional: install quantum pre-commit hook</span><br>
                        <span style="color:var(--cursor-text);">curl -s http://localhost:8085/api/git/hook/install -X POST -d '{"repo":"."}'</span>
                    </div>

                    <!-- Compatibility -->
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:6px;margin-bottom:var(--cursor-space-md);">
                        <div style="background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Cursor IDE</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);"><code>.mdc</code> rules &middot; always-on</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">GitHub Copilot</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);"><code>.github/copilot-instructions.md</code></div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">VS Code</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);"><code>.vscode/settings.json</code> context</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Any MCP Client</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);"><code>quantum_bridge_server.py</code></div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Windsurf</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Rules-compatible format</div>
                        </div>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">alwaysApply: true</span>
                        <span class="tag tag--green">9 symbols &middot; 20 languages</span>
                        <span class="tag tag--green">Live gutter + timeline</span>
                        <span class="tag tag--blue">Zero config &middot; copy 1 file</span>
                        <span class="tag tag--purple">Works with any AI model in Cursor</span>
                    </div>

                    <!-- Multi-IDE Config Files -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin:var(--cursor-space-md) 0 6px;">Shipped IDE Configuration Files</div>
                    <div style="display:grid;grid-template-columns:1fr;gap:3px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.5625rem;">
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.cursor/rules/quantum-prefix-gutter.mdc</span>
                            <span style="color:#7ee787;">Cursor &mdash; always-on prefix rule (alwaysApply: true)</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.cursor/rules/quantum-commands.mdc</span>
                            <span style="color:#7ee787;">Cursor &mdash; bridge API commands reference</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.cursor/skills/quantum-prefix-skill.md</span>
                            <span style="color:#7ee787;">Cursor &mdash; prefix conversion skill + API reference</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.github/copilot-instructions.md</span>
                            <span style="color:#7ee787;">GitHub Copilot &mdash; 9-symbol training + Q<sub>w</sub> formula</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.vscode/settings.json</span>
                            <span style="color:#7ee787;">VS Code &mdash; project settings, file associations, env</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.windsurf/rules/quantum-prefix.md</span>
                            <span style="color:#7ee787;">Windsurf &mdash; AI rule for prefix-aware generation</span>
                        </div>
                    </div>

                    <!-- Quantum Folder Structure -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Quantum-Organized Folder Structure (<code>src/MANIFEST.md</code>)</div>
                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:12px 14px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.5625rem;line-height:1.8;">
                        <span style="color:var(--cursor-text-muted);">uvspeed/src/</span><br>
                        <span style="color:#f97583;font-weight:700;">&ensp;n:</span>&ensp; <span style="color:var(--cursor-text);">n-entry/</span> <span style="color:var(--cursor-text-muted);">&mdash; launchers, entry points, shell scripts</span><br>
                        <span style="color:#7ee787;font-weight:700;">+1:</span>&ensp; <span style="color:var(--cursor-text);">p1-docs/</span> <span style="color:var(--cursor-text-muted);">&mdash; README, docs, config, themes, demo data</span><br>
                        <span style="color:#d2a8ff;font-weight:700;">-n:</span>&ensp; <span style="color:var(--cursor-text);">mn-deps/</span> <span style="color:var(--cursor-text-muted);">&mdash; pyproject.toml, package.json, manifest.json</span><br>
                        <span style="color:#79c0ff;font-weight:700;">+0:</span>&ensp; <span style="color:var(--cursor-text);">p0-core/</span> <span style="color:var(--cursor-text-muted);">&mdash; bridge server, notepad, prototype (main app)</span><br>
                        <span style="color:#79c0ff;font-weight:700;">&ensp;0:</span>&ensp; <span style="color:var(--cursor-text);">z-functions/</span> <span style="color:var(--cursor-text-muted);">&mdash; tools, utilities, helper scripts</span><br>
                        <span style="color:#f97583;font-weight:700;">-1:</span>&ensp; <span style="color:var(--cursor-text);">m1-tests/</span> <span style="color:var(--cursor-text-muted);">&mdash; test scripts, verification, QA</span><br>
                        <span style="color:#f0d852;font-weight:700;">+n:</span>&ensp; <span style="color:var(--cursor-text);">pn-platforms/</span> <span style="color:var(--cursor-text-muted);">&mdash; platform-specific builds (Firefox, multi)</span><br>
                        <span style="color:#f0883e;font-weight:700;">+2:</span>&ensp; <span style="color:var(--cursor-text);">p2-versions/</span> <span style="color:var(--cursor-text-muted);">&mdash; progressive version snapshots</span><br>
                        <span style="color:#f0d852;font-weight:700;">-0:</span>&ensp; <span style="color:var(--cursor-text);">m0-output/</span> <span style="color:var(--cursor-text-muted);">&mdash; build output, dist, compiled assets</span><br>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">6 IDE config files shipped</span>
                        <span class="tag tag--green">9 prefix-mapped folders</span>
                        <span class="tag tag--blue">MANIFEST.md index for AI navigation</span>
                    </div>
                </div>

                <!-- ====== UPGRADE ENHANCEMENT PLANS ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Upgrade Enhancement Roadmap</h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        Detailed plans for each capability gap identified in the benchmark standings.
                        Each card shows the current state, target state, key technologies, and the SOW phase that delivers it.
                    </p>

                    <div class="plan-grid">

                        <!-- 1. Visualization Paradigm -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">📊</span>
                                <span class="plan-title">Visualization Paradigm</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Mermaid diagrams, 3D prefix topology (text-based)<br>
                                <strong>Target:</strong> GPU-accelerated 3D code-space with fly-through navigation
                                <ul>
                                    <li>ChartGPU / WebGPU for 60fps realtime charting in-browser</li>
                                    <li>Three.js or Babylon.js 3D scene: X/Y/Z code-space rendered as a navigable volume</li>
                                    <li>Prefix heatmaps: color each line by its quantum weight type</li>
                                    <li>Charm Gum progress bars &amp; Glow markdown in terminal mode</li>
                                    <li>Mermaid auto-generation from prefix topology (code &rarr; diagram)</li>
                                    <li>WebXR support: fly through code-space in Quest headset</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 2&ndash;3</span>
                                <span class="tag tag--green">WebGPU + Three.js + Charm</span>
                            </div>
                        </div>

                        <!-- 2. Code Execution + AI Libraries -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">⚡</span>
                                <span class="plan-title">Code Execution &amp; AI Libraries</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Stub output (simulated)<br>
                                <strong>Target:</strong> Multi-runtime execution with AI-assisted code generation
                                <ul>
                                    <li><code>uv run</code> backend via WebSocket bridge (real Python)</li>
                                    <li>Pyodide (WASM Python) for zero-install in-browser execution</li>
                                    <li>tinygrad tensor ops running client-side via WebGPU</li>
                                    <li>AI library chain: Cursor &rarr; Copilot &rarr; GrepAI &rarr; Crush &rarr; OpenCode</li>
                                    <li>Prefix-aware linting: AI suggests prefix corrections</li>
                                    <li>Auto-prefix on paste: raw code &rarr; quantum-weighted in one pass</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 2</span>
                                <span class="tag tag--green">Pyodide + uv + tinygrad</span>
                            </div>
                        </div>

                        <!-- 3. Quantum Hardware Support -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">🌌</span>
                                <span class="plan-title">Quantum Hardware Support</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Prefix system (structural quantum, no QPU)<br>
                                <strong>Target:</strong> Prefix &rarr; circuit transpilation &rarr; QPU execution
                                <ul>
                                    <li>NVIDIA CUDA-Q integration for quantum kernel offload</li>
                                    <li>Prefix-to-Cirq transpiler: <code>+n:</code> &rarr; conditional gate, <code>+2:</code> &rarr; loop unroll</li>
                                    <li>Qiskit backend adapter for IBM QPU access</li>
                                    <li>Amazon Braket connector via SageMaker</li>
                                    <li>IonQ cloud API for trapped-ion execution</li>
                                    <li>Simulator fallback: Pennylane local when offline</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--yellow">Phase 4</span>
                                <span class="tag tag--purple">CUDA-Q + Cirq + Qiskit</span>
                            </div>
                        </div>

                        <!-- 4. GPU / TPU Compute -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">🔥</span>
                                <span class="plan-title">GPU / TPU Compute</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Apple AMX (local), no GPU offload<br>
                                <strong>Target:</strong> Multi-tier compute: browser GPU &rarr; local &rarr; cloud
                                <ul>
                                    <li><strong>Tier 1 — Browser:</strong> WebGPU shaders for tinygrad ops, ChartGPU viz</li>
                                    <li><strong>Tier 2 — Local:</strong> Apple AMX / Metal, tinygrad native backend</li>
                                    <li><strong>Tier 3 — Cloud:</strong> NVIDIA Blackwell (H100/B200) via CUDA-Q</li>
                                    <li><strong>Tier 4 — TPU:</strong> Google TPU v5e via JAX/XLA bridge</li>
                                    <li>Compute scheduler: auto-routes by tensor size &amp; latency budget</li>
                                    <li>Prefix-aware kernel fusion: merge adjacent <code>+2:</code> loops into one GPU dispatch</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 3&ndash;4</span>
                                <span class="tag tag--green">WebGPU + Metal + CUDA + TPU</span>
                            </div>
                        </div>

                        <!-- 5. STORAGE — the big one -->
                        <div class="plan-card" style="grid-column: 1 / -1;">
                            <div class="plan-card-header">
                                <span class="plan-icon">💾</span>
                                <span class="plan-title">Storage! Storage! Storage! &mdash; Quantum-Native Persistence</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> JSON export, no persistence, tab-lifetime only<br>
                                <strong>Target:</strong> Multi-layer smart storage with AI-driven compaction and evolution
                                <ul>
                                    <li><strong>Layer 0 — Instant (browser):</strong> IndexedDB + OPFS (Origin Private File System) for zero-latency local persistence. Every keystroke saved. Survives tab close, browser restart. ~50 MB per origin.</li>
                                    <li><strong>Layer 1 — Session (local):</strong> <code>s1db</code>-style key/value store (inspired by <a href="https://github.com/kognise/notes" style="color:var(--cursor-accent);">kognise/notes</a>). Nanoid-keyed notebooks with token-based access. Single JSON file on disk, append-only log for crash safety.</li>
                                    <li><strong>Layer 2 — Compaction (smart):</strong> AI-driven compaction engine. When cell count exceeds threshold, tinygrad model scores each cell by (last-access &times; execution-count &times; prefix-weight). Low-score cells compress to delta-only. Hot cells stay fully expanded. Target: 10&times; storage reduction without data loss.</li>
                                    <li><strong>Layer 3 — Sync (network):</strong> WebSocket mesh (based on kognise/notes server pattern): client connects with notebook key + auth token, edits broadcast to all peers on same key. CRDTs (Yjs) for conflict-free merge. Works over WiFi, 5G, BLE, or mesh network.</li>
                                    <li><strong>Layer 4 — Archive (cold):</strong> Prefix-indexed Git-compatible snapshots. Each save writes a <code>.qnb</code> (quantum notebook) file that <code>git diff</code> understands. Prefix metadata in YAML front-matter. Full version history with dimensional diff (show what moved in X/Y/Z, not just line changes).</li>
                                    <li><strong>Layer 5 — Evolving (AI):</strong> tinygrad model running in storage layer predicts which cells you'll need next, pre-loads them from cold storage, auto-tags and auto-prefixes new content, and suggests compaction candidates. Storage literally learns your workflow and evolves its layout to match.</li>
                                </ul>
                                <div style="margin-top: var(--cursor-space-sm);">
                                    <strong>Unique properties:</strong> No other notebook has storage that is simultaneously offline-first (Layer 0),
                                    real-time synced (Layer 3), AI-compacted (Layer 2), dimensionally diffable (Layer 4),
                                    and self-evolving (Layer 5). This is storage as a first-class quantum-aware subsystem, not an afterthought.
                                </div>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 2&ndash;4</span>
                                <span class="tag tag--green">IndexedDB + s1db + Yjs + tinygrad</span>
                                <span class="tag tag--yellow">6-layer architecture</span>
                            </div>
                        </div>

                        <!-- 6. Realtime Collab -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">👥</span>
                                <span class="plan-title">Realtime Collab (kognise/notes pattern)</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Single-user, no sync<br>
                                <strong>Target:</strong> Multi-user with presence, cursors, and chat
                                <ul>
                                    <li><strong>Base:</strong> <a href="https://github.com/kognise/notes" style="color:var(--cursor-accent);">kognise/notes</a> WebSocket server (~50 lines). Nanoid room keys, token auth, broadcast-to-peers.</li>
                                    <li><strong>CRDT layer:</strong> Yjs document for conflict-free cell editing across peers</li>
                                    <li>Cursor presence: see collaborator positions in 3D quantum space</li>
                                    <li>Cell locking: prefix-aware — only one editor per <code>+0:</code> class at a time</li>
                                    <li>Chat sidebar: inline discussion threads anchored to cell coordinates</li>
                                    <li>Connection-agnostic: WebSocket &rarr; WebRTC &rarr; BLE mesh fallback chain</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 3</span>
                                <span class="tag tag--green">ws + Yjs + nanoid + s1db</span>
                            </div>
                        </div>

                        <!-- 7. Ping / Direct Linking / Chat -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">📡</span>
                                <span class="plan-title">Ping, Chat &amp; Direct Linking</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> No networking<br>
                                <strong>Target:</strong> Universal connectivity with sub-100ms latency
                                <ul>
                                    <li><strong>Ping mesh:</strong> Every connected client pings all peers every 5s. Latency matrix displayed in sidebar. Auto-selects fastest relay path.</li>
                                    <li><strong>Direct link:</strong> Share a URL like <code>qnb.dev/abc123#[2,5,3]</code> — opens notebook at exact quantum coordinate. Deep-link into any cell at any position.</li>
                                    <li><strong>Chat protocol:</strong> Messages carry quantum coordinates. "I'm at [2,5,3] and this function is wrong" — receiver clicks and lands on the exact spot.</li>
                                    <li><strong>Connection cascade:</strong> WebSocket (primary) &rarr; WebRTC DataChannel (P2P) &rarr; Server-Sent Events (fallback) &rarr; HTTP long-poll (last resort)</li>
                                    <li>Future: Bluetooth LE for local mesh (hackathons, classrooms), NFC tap-to-share notebook key</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--yellow">Phase 3&ndash;4</span>
                                <span class="tag tag--purple">WebSocket + WebRTC + BLE</span>
                            </div>
                        </div>

                        <!-- 8. Universal Web Scraping / Weighting -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">🌐</span>
                                <span class="plan-title">Quantum Web Scraper &amp; Code Weighting</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Manual file conversion<br>
                                <strong>Target:</strong> Point at any URL or repo, get a quantum-weighted map instantly
                                <ul>
                                    <li>URL input &rarr; fetch DOM &rarr; assign prefixes to every node &rarr; 3D map</li>
                                    <li>GitHub repo input &rarr; clone &rarr; prefix all files &rarr; navigable code-space</li>
                                    <li>npm/PyPI package &rarr; dependency tree as X-axis in quantum space</li>
                                    <li>GrepAI semantic search across prefixed web scrapes</li>
                                    <li>Weight scoring: complexity &times; dependency-depth &times; error-density = quantum gravity</li>
                                    <li>Prove: the entire web is dimensionally addressable with 9 symbols</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--yellow">Phase 3&ndash;4</span>
                                <span class="tag tag--green">GrepAI + Puppeteer + prefix engine</span>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid with dark theme
        if (window.mermaid) {
            mermaid.initialize({
                startOnLoad: false,
                theme: 'dark',
                themeVariables: {
                    darkMode: true,
                    background: '#0d1117',
                    primaryColor: '#161b22',
                    primaryTextColor: '#c9d1d9',
                    primaryBorderColor: '#30363d',
                    lineColor: '#58a6ff',
                    secondaryColor: '#1c2128',
                    tertiaryColor: '#2d333b',
                    fontFamily: 'ui-monospace, SFMono-Regular, SF Mono, Menlo, monospace',
                    fontSize: '13px'
                }
            });
        }

        // Quantum Notepad Web Interface - Infinite scroll, no page limits
        class QuantumNotebookWeb {
            constructor() {
                this.cells = [];
                this.quantumPosition = [0, 0, 0];
                this.executionCount = 0;
                this.currentCellId = null;
                this.performanceMode = true;
                this.autoSave = true;
                this._lastExecMs = 0;

                // Execution bridge
                this.ws = null;
                this.wsConnected = false;
                this.bridgeUrl = 'ws://localhost:8086';
                this.apiUrl = 'http://localhost:8085';
                this._pendingCallbacks = {};
                this._gutterTimers = {};
                this._streamHistory = [];
                this._undoStack = [];
                this._redoStack = [];
                this._undoDebounce = null;

                this.init();
            }

            /* ---------- Bootstrap ---------- */
            init() {
                this.setupEventListeners();
                // Try loading from localStorage before creating default cells
                if (!this._loadFromLocalStorage()) {
                    this.createInitialCells();
                }
                this.connectBridge();
                this.updateUI();
                this.startPerformanceMonitoring();
            }

            /* ---------- WebSocket Bridge ---------- */
            connectBridge() {
                try {
                    this.ws = new WebSocket(this.bridgeUrl);
                    this.ws.onopen = () => {
                        this.wsConnected = true;
                        console.log('🌌 Connected to Quantum Bridge');
                        this._updateBridgeStatus('connected');
                    };
                    this.ws.onmessage = (event) => {
                        try {
                            const msg = JSON.parse(event.data);
                            this._handleBridgeMessage(msg);
                        } catch (e) { console.warn('Bridge message parse error', e); }
                    };
                    this.ws.onclose = () => {
                        this.wsConnected = false;
                        this._updateBridgeStatus('disconnected');
                        // Reconnect after 5s
                        setTimeout(() => this.connectBridge(), 5000);
                    };
                    this.ws.onerror = () => {
                        this.wsConnected = false;
                        this._updateBridgeStatus('offline');
                    };
                } catch (e) {
                    this.wsConnected = false;
                    this._updateBridgeStatus('offline');
                }
            }

            _updateBridgeStatus(status) {
                const el = document.getElementById('bridge-status');
                if (el) {
                    const icons = { connected: '🟢', disconnected: '🟡', offline: '🔴' };
                    el.textContent = `${icons[status] || '⚪'} Bridge: ${status}`;
                }
            }

            _handleBridgeMessage(msg) {
                if (msg.type === 'execution-result' && msg.cell_id) {
                    const cb = this._pendingCallbacks[msg.cell_id];
                    if (cb) { cb(msg); delete this._pendingCallbacks[msg.cell_id]; }
                } else if (msg.type === 'position-changed') {
                    this.quantumPosition = msg.position;
                    this.updateQuantumPosition('bridge sync');
                } else if (msg.type === 'ai-result') {
                    const cb = this._pendingCallbacks['__ai__'];
                    if (cb) { cb(msg); delete this._pendingCallbacks['__ai__']; }
                }
            }

            /* ---------- LocalStorage Persistence ---------- */
            _saveToLocalStorage() {
                try {
                    const data = {
                        cells: this.cells,
                        quantumPosition: this.quantumPosition,
                        executionCount: this.executionCount,
                        savedAt: new Date().toISOString(),
                    };
                    localStorage.setItem('uvspeed-quantum-notepad', JSON.stringify(data));
                } catch (e) { /* storage full or unavailable */ }
            }

            _loadFromLocalStorage() {
                try {
                    const raw = localStorage.getItem('uvspeed-quantum-notepad');
                    if (!raw) return false;
                    const data = JSON.parse(raw);
                    if (data.cells && data.cells.length > 0) {
                        this.cells = data.cells;
                        this.quantumPosition = data.quantumPosition || [0, 0, 0];
                        this.executionCount = data.executionCount || 0;
                        this.renderAllCells();
                        return true;
                    }
                } catch (e) { /* corrupt data */ }
                return false;
            }

            /* ---------- JSON Import ---------- */
            loadNotebook() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        try {
                            const nb = JSON.parse(ev.target.result);
                            if (nb.cells) {
                                this.cells = nb.cells;
                                this.quantumPosition = nb.quantumPosition || [0, 0, 0];
                                this.executionCount = nb.executionCount || 0;
                                this.renderAllCells();
                                this.updateUI();
                                this._saveToLocalStorage();
                            }
                        } catch (err) {
                            alert('Invalid notebook JSON: ' + err.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            renderAllCells() {
                const container = document.getElementById('cells-container');
                container.innerHTML = '';
                this.cells.forEach(cell => {
                    this.renderCell(cell);
                });
                if (this.cells.length > 0) this.currentCellId = this.cells[0].id;
            }

            /* ---------- Events ---------- */
            setupEventListeners() {
                document.getElementById('add-cell-btn').addEventListener('click', () => {
                    const id = this.addCell('code');
                    requestAnimationFrame(() => {
                        const el = document.querySelector(`#${id} .cell-textarea`);
                        if (el) { el.focus(); el.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
                    });
                });

                document.getElementById('add-mermaid-btn').addEventListener('click', () => {
                    const id = this.addCell('mermaid', 'graph TD\n    A[Start] --> B{Decision}\n    B -->|Yes| C[Result A]\n    B -->|No| D[Result B]');
                    requestAnimationFrame(() => {
                        const el = document.querySelector(`#${id} .cell-textarea`);
                        if (el) { el.focus(); el.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
                    });
                });

                document.getElementById('run-all-btn').addEventListener('click', () => {
                    this.runAllCells();
                });

                document.getElementById('undo-btn').addEventListener('click', () => this.undo());
                document.getElementById('redo-btn').addEventListener('click', () => this.redo());

                document.getElementById('save-btn').addEventListener('click', () => {
                    this.saveNotebook();
                });

                document.getElementById('load-btn').addEventListener('click', () => {
                    this.loadNotebook();
                });

                // Quantum navigation — pass the clicked button explicitly
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.navigateQuantumSpace(btn.dataset.direction, e.currentTarget);
                    });
                });

                // Layer up/down — versions the nav grid like Electron app
                document.getElementById('layer-up').addEventListener('click', () => {
                    this.quantumPosition[2] += 1;
                    this.updateQuantumPosition('layer ▲ +Z');
                    // Visual pulse on layer change
                    const lv = document.getElementById('layer-value');
                    lv.style.transform = 'scale(1.4)';
                    lv.style.color = 'var(--cursor-accent)';
                    setTimeout(() => { lv.style.transform = ''; lv.style.color = ''; }, 300);
                    // Broadcast to bridge
                    if (this.wsConnected && this.ws) {
                        this.ws.send(JSON.stringify({ type: 'navigate', dx: 0, dy: 0, dz: 1 }));
                    }
                });
                document.getElementById('layer-down').addEventListener('click', () => {
                    this.quantumPosition[2] -= 1;
                    this.updateQuantumPosition('layer ▼ -Z');
                    const lv = document.getElementById('layer-value');
                    lv.style.transform = 'scale(1.4)';
                    lv.style.color = '#f97583';
                    setTimeout(() => { lv.style.transform = ''; lv.style.color = ''; }, 300);
                    if (this.wsConnected && this.ws) {
                        this.ws.send(JSON.stringify({ type: 'navigate', dx: 0, dy: 0, dz: -1 }));
                    }
                });

                document.getElementById('performance-mode').addEventListener('change', (e) => {
                    this.performanceMode = e.target.checked;
                    this.updatePerformanceMode();
                });

                document.getElementById('auto-save').addEventListener('change', (e) => {
                    this.autoSave = e.target.checked;
                });

                document.getElementById('cells-container').addEventListener('scroll', () => {
                    this.handleInfiniteScroll();
                });

                // --- Footer terminal ---
                const aiInput = document.getElementById('ai-input');
                const cmdInput = document.getElementById('cmd-input');

                aiInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') { e.preventDefault(); this.handleAiInput(aiInput.value); aiInput.value = ''; }
                });
                document.getElementById('ai-send-btn').addEventListener('click', () => {
                    this.handleAiInput(aiInput.value); aiInput.value = '';
                });

                cmdInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') { e.preventDefault(); this.handleCommand(cmdInput.value); cmdInput.value = ''; }
                });
                document.getElementById('cmd-exec-btn').addEventListener('click', () => {
                    this.handleCommand(cmdInput.value); cmdInput.value = '';
                });

                document.querySelectorAll('.quick-cmd').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.handleCommand(btn.dataset.cmd);
                    });
                });

                // Footer action buttons (mirrors header)
                document.getElementById('f-add-cell').addEventListener('click', () => this.addCell('code'));
                document.getElementById('f-add-mermaid').addEventListener('click', () => this.addCell('mermaid'));
                document.getElementById('f-run-all').addEventListener('click', () => this.runAllCells());
                document.getElementById('f-undo').addEventListener('click', () => this.undo());
                document.getElementById('f-redo').addEventListener('click', () => this.redo());
                document.getElementById('f-save').addEventListener('click', () => this.saveNotebook());

                document.getElementById('f-benchmark').addEventListener('click', () => {
                    const id = this.addCell('visualization', `# ⚡ UV-Speed System Benchmark & CDN Signal Trace\n# Run this cell to benchmark your machine in real-time`);
                    this.executeCell(id);
                    // Scroll to it
                    requestAnimationFrame(() => {
                        const el = document.getElementById(id);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                });

                // Security scan button
                document.getElementById('f-security-scan').addEventListener('click', () => {
                    this._runSecurityScan();
                });

                // Git hook install button
                document.getElementById('f-git-hook').addEventListener('click', () => {
                    this._installGitHook();
                });

                // Stream pipe in/out buttons
                document.getElementById('stream-pipe-in').addEventListener('click', () => {
                    const src = document.getElementById('stream-source');
                    const btn = document.getElementById('stream-pipe-in');
                    if (src.style.display === 'none') {
                        src.style.display = 'block';
                        btn.classList.add('active');
                        document.getElementById('stream-source-input').focus();
                    } else {
                        src.style.display = 'none';
                        btn.classList.remove('active');
                    }
                });

                document.getElementById('stream-pipe-out').addEventListener('click', () => {
                    const text = this._pipeStreamOut();
                    const btn = document.getElementById('stream-pipe-out');
                    btn.textContent = '✓ copied';
                    btn.classList.add('active');
                    setTimeout(() => { btn.textContent = '⇤ out'; btn.classList.remove('active'); }, 1500);
                });

                document.getElementById('stream-source-trace').addEventListener('click', () => {
                    const input = document.getElementById('stream-source-input');
                    this._pipeStreamIn(input.value);
                    input.value = '';
                    document.getElementById('stream-source').style.display = 'none';
                    document.getElementById('stream-pipe-in').classList.remove('active');
                });

                // ===== SIDEBAR TAB SWITCHING =====
                document.querySelectorAll('.sidebar-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.sidebar-tab-panel').forEach(p => p.classList.remove('active'));
                        tab.classList.add('active');
                        const panel = document.getElementById(tab.dataset.tab);
                        if (panel) panel.classList.add('active');
                        if (tab.dataset.tab === 'thermal-tab') {
                            this._initThermalViz();
                        } else {
                            this._stopThermalViz();
                        }
                    });
                });

                // ===== QUANTUM THERMAL VISUALIZATION =====
                this._thermalMode = 'lattice';
                this._thermalUnit = 'C';
                this._thermalAnim = null;
                this._thermalFrame = 0;
                this._thermalQubits = 50;

                // Thermal mode buttons
                document.querySelectorAll('[data-thermal-mode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('[data-thermal-mode]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this._thermalMode = btn.dataset.thermalMode;
                        this._thermalFrame = 0;
                    });
                });

                // Unit toggle
                ['c','f','k'].forEach(u => {
                    const btn = document.getElementById('unit-' + u);
                    if (!btn) return;
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('#unit-c,#unit-f,#unit-k').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this._thermalUnit = u.toUpperCase();
                        this._updateThermalStats();
                    });
                });

                // Qubit slider
                const qSlider = document.getElementById('qubit-slider');
                if (qSlider) {
                    qSlider.addEventListener('input', () => {
                        this._thermalQubits = parseInt(qSlider.value);
                        this._updateGpuQubitScaling();
                    });
                }

                // ===== CHARTGPU INTEGRATION =====
                this._hexMode = 'color';
                this._hexData = new Uint8Array(360 * 360);
                // Seed with random data (chunked — browser limit is 65536 bytes per call)
                for (let i = 0; i < this._hexData.length; i += 65536) {
                    crypto.getRandomValues(this._hexData.subarray(i, Math.min(i + 65536, this._hexData.length)));
                }

                document.getElementById('chartgpu-launch')?.addEventListener('click', () => {
                    window.open('http://localhost:3444', '_blank');
                });

                document.getElementById('chartgpu-metrics')?.addEventListener('click', () => {
                    this._fetchChartGPUMetrics();
                });

                // Hex mode buttons
                document.querySelectorAll('[data-hex-mode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('[data-hex-mode]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this._hexMode = btn.dataset.hexMode;
                        this._drawHexCanvas();
                    });
                });

                document.getElementById('hex-expand')?.addEventListener('click', () => {
                    this._openHexOverlay();
                });

                // Start hex canvas mini animation
                this._hexCanvas = document.getElementById('hex-canvas');
                this._hexCtx = this._hexCanvas?.getContext('2d');
                setInterval(() => {
                    if (document.getElementById('thermal-tab')?.classList.contains('active')) {
                        // Shift hex data to simulate streaming
                        for (let i = 0; i < 128; i++) {
                            const idx = Math.floor(Math.random() * this._hexData.length);
                            this._hexData[idx] = (this._hexData[idx] + Math.floor(Math.random() * 16)) & 0xFF;
                        }
                        this._drawHexCanvas();
                    }
                }, 200);

                // ===== TOOLS DROPDOWN =====
                const toolsBtn = document.getElementById('f-tools');
                const toolsDropdown = document.getElementById('tools-dropdown');
                if (toolsBtn && toolsDropdown) {
                    toolsBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toolsDropdown.classList.toggle('show');
                    });
                    document.addEventListener('click', () => toolsDropdown.classList.remove('show'));
                    toolsDropdown.addEventListener('click', (e) => e.stopPropagation());

                    toolsDropdown.querySelectorAll('.tools-dropdown-item').forEach(item => {
                        item.addEventListener('click', () => {
                            toolsDropdown.classList.remove('show');
                            this._runTool(item.dataset.tool);
                        });
                    });
                }

                // ===== QUEST STATUS =====
                document.getElementById('f-quest')?.addEventListener('click', () => this._checkQuestStatus());
                document.getElementById('quest-status')?.addEventListener('click', () => this._checkQuestStatus());

                // Global keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.shiftKey && e.key === 'Enter' && this.currentCellId) {
                        e.preventDefault();
                        this.executeCell(this.currentCellId);
                    }
                    if ((e.metaKey || e.ctrlKey) && e.key === 's') {
                        e.preventDefault();
                        this.saveNotebook();
                    }
                    if ((e.metaKey || e.ctrlKey) && e.key === 'z' && !e.shiftKey) {
                        e.preventDefault();
                        this.undo();
                    }
                    if ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key === 'z') {
                        e.preventDefault();
                        this.redo();
                    }
                });
            }

            /* ---------- Initial Cells ---------- */
            createInitialCells() {
                this.addCell('markdown', '# 🌌 uvspeed — Quantum beyondBINARY notepad\n\nWelcome to your infinite scroll quantum development environment.\n\n**Features:**\n- No page limits\n- Tinygrad integration\n- Rich visualizations\n- Real-time collaboration\n- Quantum navigation\n- beyondBINARY prefix system: {+1, 1, -1, +0, 0, -0, +n, n, -n}');

                this.addCell('code', `# Quantum computation with tinygrad
from tinygrad.tensor import Tensor
import numpy as np

# Create quantum state
quantum_state = Tensor.randn(8)  # 3-qubit state
quantum_state = quantum_state / quantum_state.norm()

print("🌌 Quantum state initialized")
print(f"Shape: {quantum_state.shape}")
print(f"Norm: {quantum_state.norm().numpy():.6f}")

# Navigate quantum space
print("Position:", quantum_position)`);

                this.addCell('mermaid', `graph LR
    subgraph Architecture["UV-Speed Stack"]
        direction LR
        A["🔧 Zig<br/>Ghostty"] -->|terminal| B["⚙️ Rust<br/>Nushell / uv"]
        B -->|execution| C["🔍 Semantic<br/>GrepAI"]
        C -->|visual| D["🎨 Charm"]
    end
    subgraph Charm_Ecosystem["Charm Visual Layer"]
        D --> E["Crush<br/>AI coding"]
        D --> F["Gum<br/>interactive UI"]
        D --> G["Glow<br/>markdown docs"]
        D --> H["VHS<br/>terminal demos"]
        D --> I["Log<br/>rich logging"]
    end
    subgraph Compute["Compute Path"]
        J["Apple AMX<br/>local"] -->|scale| K["NVIDIA Blackwell<br/>CUDA-Q"]
    end
    B --> J
    style A fill:#2d333b,stroke:#58a6ff,color:#c9d1d9
    style B fill:#2d333b,stroke:#f0883e,color:#c9d1d9
    style C fill:#2d333b,stroke:#7ee787,color:#c9d1d9
    style D fill:#2d333b,stroke:#d2a8ff,color:#c9d1d9
    style J fill:#2d333b,stroke:#f0d852,color:#c9d1d9
    style K fill:#2d333b,stroke:#79c0ff,color:#c9d1d9`);

                this.addCell('visualization', `# ⚡ UV-Speed System Benchmark & CDN Signal Trace
# Run this cell to benchmark your machine in real-time
# Charts: Math throughput, DOM speed, Canvas perf, JSON ser/de
# CDN: 6-layer signal trace (DNS→TLS→TCP→HTTP→Edge→Origin)
# Prefix: Per-language classification speed (py/js/rs/go/sh/html)
# Data layers: L1-Cache through L5-Origin stacked throughput`);
            }

            /* ---------- Cell CRUD ---------- */
            addCell(cellType = 'code', content = '') {
                const cellId = `cell_${this.cells.length}_${Date.now()}`;

                const cell = {
                    id: cellId,
                    type: cellType,
                    content: content,
                    output: [],
                    executionCount: 0,
                    quantumPosition: [...this.quantumPosition],
                    created: new Date().toISOString()
                };

                this.cells.push(cell);
                this.renderCell(cell);
                this.updateCellList();
                this.updateStats();

                return cellId;
            }

            renderCell(cell) {
                const container = document.getElementById('cells-container');

                const cellElement = document.createElement('div');
                cellElement.className = 'quantum-cell';
                cellElement.id = cell.id;

                const typeEmoji = { code: '⚡', markdown: '📝', visualization: '📊', quantum: '🌌', mermaid: '🧜' };

                cellElement.innerHTML = `
                    <div class="cell-header">
                        <div class="cell-type">
                            ${typeEmoji[cell.type] || '⚡'} ${cell.type}
                            <span class="cell-coords">[${cell.quantumPosition.join(', ')}]</span>
                        </div>
                        <div class="cell-actions">
                            <button class="btn btn--sm" onclick="notebook.executeCell('${cell.id}')" title="Run cell (Shift+Enter)">▶ Run</button>
                            <button class="btn btn--sm" onclick="notebook.expandCellOutput('${cell.id}')" title="Expand output in overlay" style="font-size:0.875rem;">↗</button>
                            <button class="btn btn--sm" onclick="notebook.deleteCell('${cell.id}')" title="Delete cell">🗑</button>
                        </div>
                    </div>
                    <div class="cell-editor">
                        <div class="quantum-gutter" id="${cell.id}-gutter"></div>
                        <textarea class="cell-textarea auto-resize"
                                  placeholder="Enter ${cell.type} here..."
                                  oninput="notebook.updateCell('${cell.id}', this.value); notebook.autoResize(this); notebook.debouncedUpdateGutter('${cell.id}');"
                                  onfocus="notebook.focusCell('${cell.id}')"
                                  onpaste="setTimeout(()=>notebook.handlePaste('${cell.id}'),0)"
                                  onscroll="notebook.syncGutterScroll('${cell.id}', this)">${cell.content}</textarea>
                    </div>
                    <div class="cell-output" id="${cell.id}-output" style="display:none;"></div>
                `;

                container.appendChild(cellElement);

                const textarea = cellElement.querySelector('.cell-textarea');
                this.autoResize(textarea);
                // Initial gutter render
                this.updateGutter(cell.id);
            }

            /* ---------- Execution ---------- */
            executeCell(cellId) {
                const cell = this.cells.find(c => c.id === cellId);
                if (!cell) return;

                this.executionCount++;
                cell.executionCount = this.executionCount;
                this._logStream(`exec [${this.executionCount}]`, `${cell.type} ${cell.id.substring(0, 15)}`, 'exec');

                const outputElement = document.getElementById(`${cellId}-output`);
                outputElement.style.display = 'block';
                outputElement.innerHTML = '<div class="output-text" style="color:var(--cursor-accent);">⏳ Executing&hellip;</div>';

                const t0 = performance.now();

                // Non-code cells execute locally
                if (cell.type === 'markdown' || cell.type === 'mermaid') {
                    const result = this._localExecution(cell);
                    this.displayOutput(cellId, result);
                    this._lastExecMs = Math.round(performance.now() - t0);
                    this.updateStats();
                    this.updateCellList();
                    if (this.autoSave) this._saveToLocalStorage();
                    return;
                }

                // Try real execution via bridge
                if (this.wsConnected && this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this._pendingCallbacks[cellId] = (msg) => {
                        this._lastExecMs = msg.elapsed_ms || Math.round(performance.now() - t0);
                        if (msg.success) {
                            const lines = [];
                            if (msg.stdout) lines.push(...msg.stdout.split('\n').filter(l => l));
                            if (msg.return_value) lines.push(`→ ${msg.return_value}`);
                            if (lines.length === 0) lines.push('✅ Executed successfully (no output)');
                            lines.push(`⏱ ${this._lastExecMs} ms · Execution [${cell.executionCount}]`);
                            this.displayOutput(cellId, { type: 'text', data: lines });
                        } else {
                            this.displayError(cellId, msg.error || 'Execution failed');
                        }
                        this.updateStats();
                        this.updateCellList();
                        if (this.autoSave) this._saveToLocalStorage();
                    };
                    this.ws.send(JSON.stringify({
                        type: 'execute',
                        code: cell.content,
                        cell_id: cellId,
                        mode: 'python',
                    }));
                } else {
                    // Fallback: try HTTP API
                    fetch(`${this.apiUrl}/api/execute`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code: cell.content, cell_id: cellId, mode: 'python' }),
                    })
                    .then(r => r.json())
                    .then(msg => {
                        this._lastExecMs = msg.elapsed_ms || Math.round(performance.now() - t0);
                        if (msg.success) {
                            const lines = [];
                            if (msg.stdout) lines.push(...msg.stdout.split('\n').filter(l => l));
                            if (msg.return_value) lines.push(`→ ${msg.return_value}`);
                            if (lines.length === 0) lines.push('✅ Executed successfully (no output)');
                            lines.push(`⏱ ${this._lastExecMs} ms · Execution [${cell.executionCount}]`);
                            this.displayOutput(cellId, { type: 'text', data: lines });
                        } else {
                            this.displayError(cellId, msg.error || 'Execution failed');
                        }
                        this.updateStats();
                        this.updateCellList();
                        if (this.autoSave) this._saveToLocalStorage();
                    })
                    .catch(() => {
                        // Last resort: local simulation
                        const result = this._localExecution(cell);
                        this.displayOutput(cellId, result);
                        this._lastExecMs = Math.round(performance.now() - t0);
                        this.updateStats();
                        this.updateCellList();
                        if (this.autoSave) this._saveToLocalStorage();
                    });
                }
            }

            _localExecution(cell) {
                if (cell.type === 'markdown') {
                    return { type: 'html', data: this.markdownToHtml(cell.content) };
                } else if (cell.type === 'mermaid') {
                    return { type: 'mermaid', data: cell.content };
                } else if (cell.type === 'visualization') {
                    // Run inline visualization — return HTML with live canvas
                    return { type: 'html', data: this._runVisualizationCell(cell) };
                } else {
                    return {
                        type: 'text',
                        data: [
                            `🌌 Quantum execution complete (bridge offline — local fallback)`,
                            `Position: [${this.quantumPosition.join(', ')}]`,
                            `Execution [${cell.executionCount}]`,
                            `Cell: ${cell.type}`,
                            `💡 Start bridge: python3 quantum_bridge_server.py`
                        ]
                    };
                }
            }

            /* ---------- Visualization Cell Engine ---------- */
            _runVisualizationCell(cell) {
                const uid = `viz_${cell.id}_${Date.now()}`;
                // Return a self-contained HTML block with canvases and JS that
                // benchmarks the machine and traces CDN signal layers
                return `
<div id="${uid}" style="padding:12px;background:var(--cursor-bg);border-radius:var(--cursor-radius-md);font-family:var(--cursor-font-mono);font-size:0.75rem;">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;">
            <div style="font-weight:700;margin-bottom:6px;color:var(--cursor-accent);font-size:0.8125rem;">⚡ Machine Benchmark</div>
            <canvas id="${uid}_bench" width="360" height="180" style="width:100%;border-radius:4px;"></canvas>
            <div id="${uid}_bench_info" style="margin-top:6px;color:var(--cursor-text-secondary);"></div>
        </div>
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;">
            <div style="font-weight:700;margin-bottom:6px;color:#7ee787;font-size:0.8125rem;">📡 CDN Signal Trace</div>
            <canvas id="${uid}_cdn" width="360" height="180" style="width:100%;border-radius:4px;"></canvas>
            <div id="${uid}_cdn_info" style="margin-top:6px;color:var(--cursor-text-secondary);"></div>
        </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:12px;">
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;">
            <div style="font-weight:700;margin-bottom:6px;color:#f0883e;font-size:0.8125rem;">🧮 Compute Throughput</div>
            <canvas id="${uid}_compute" width="240" height="140" style="width:100%;border-radius:4px;"></canvas>
        </div>
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;">
            <div style="font-weight:700;margin-bottom:6px;color:#d2a8ff;font-size:0.8125rem;">🌐 Data Layer Stack</div>
            <canvas id="${uid}_layers" width="240" height="140" style="width:100%;border-radius:4px;"></canvas>
        </div>
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;">
            <div style="font-weight:700;margin-bottom:6px;color:#79c0ff;font-size:0.8125rem;">📊 Prefix Speed</div>
            <canvas id="${uid}_prefix" width="240" height="140" style="width:100%;border-radius:4px;"></canvas>
        </div>
    </div>
    <div id="${uid}_summary" style="background:linear-gradient(135deg, rgba(88,166,255,0.1), rgba(126,231,135,0.1));border-radius:var(--cursor-radius-md);padding:12px;border:1px solid var(--cursor-border);"></div>
</div>
<` + `script>
(function(){
    const id = '${uid}';
    const colors = {accent:'#58a6ff',green:'#7ee787',orange:'#f0883e',purple:'#d2a8ff',cyan:'#79c0ff',red:'#f97583',bg:'#161b22',grid:'#21262d',text:'#8b949e'};

    function drawGrid(ctx,w,h){
        ctx.fillStyle = colors.bg;
        ctx.fillRect(0,0,w,h);
        ctx.strokeStyle = colors.grid;
        ctx.lineWidth = 0.5;
        for(let y=0;y<h;y+=20){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(w,y);ctx.stroke();}
        for(let x=0;x<w;x+=30){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,h);ctx.stroke();}
    }

    function drawLine(ctx,pts,color,w,h,maxVal){
        ctx.strokeStyle=color;ctx.lineWidth=2;ctx.beginPath();
        pts.forEach((v,i)=>{const x=(i/(pts.length-1))*w;const y=h-((v/maxVal)*h*0.85)-10;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
        ctx.stroke();
        // Glow
        ctx.strokeStyle=color+'40';ctx.lineWidth=6;ctx.beginPath();
        pts.forEach((v,i)=>{const x=(i/(pts.length-1))*w;const y=h-((v/maxVal)*h*0.85)-10;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
        ctx.stroke();
    }

    function drawBars(ctx,labels,values,barColors,w,h){
        drawGrid(ctx,w,h);
        const max=Math.max(...values)*1.2;
        const barW=w/(labels.length*2);
        labels.forEach((l,i)=>{
            const x=barW+(i*barW*2);
            const bh=(values[i]/max)*(h-30);
            ctx.fillStyle=barColors[i%barColors.length];
            ctx.fillRect(x,h-bh-5,barW*0.8,bh);
            ctx.fillStyle=barColors[i%barColors.length]+'40';
            ctx.fillRect(x-2,h-bh-7,barW*0.8+4,bh+4);
            ctx.fillStyle=colors.text;ctx.font='9px monospace';ctx.textAlign='center';
            ctx.fillText(l,x+barW*0.4,h-bh-10);
            ctx.fillText(values[i].toFixed(1),x+barW*0.4,h-bh+14);
        });
    }

    // ── BENCHMARK: Math throughput ──
    const benchMarks=[];
    const testSizes=[100,500,1000,5000,10000,50000,100000];
    testSizes.forEach(n=>{
        const t0=performance.now();
        let s=0;for(let i=0;i<n;i++)s+=Math.sqrt(i)*Math.sin(i);
        benchMarks.push({size:n,ms:performance.now()-t0,ops:n});
    });

    // DOM ops benchmark
    const domT0=performance.now();
    const frag=document.createDocumentFragment();
    for(let i=0;i<1000;i++){const d=document.createElement('div');d.textContent='x';frag.appendChild(d);}
    const domMs=performance.now()-domT0;

    // Canvas render benchmark
    const canvasT0=performance.now();
    const tmpC=document.createElement('canvas');tmpC.width=200;tmpC.height=200;
    const tmpCtx=tmpC.getContext('2d');
    for(let i=0;i<2000;i++){tmpCtx.fillStyle='hsl('+i+',80%,50%)';tmpCtx.fillRect(Math.random()*200,Math.random()*200,5,5);}
    const canvasMs=performance.now()-canvasT0;

    // JSON benchmark
    const jsonT0=performance.now();
    const big={};for(let i=0;i<5000;i++)big['k'+i]={v:Math.random(),n:'item'+i};
    JSON.parse(JSON.stringify(big));
    const jsonMs=performance.now()-jsonT0;

    // Draw benchmark chart
    setTimeout(()=>{
        const c1=document.getElementById(id+'_bench');
        if(!c1)return;
        const ctx=c1.getContext('2d');
        const w=c1.width,h=c1.height;
        drawGrid(ctx,w,h);
        const pts=benchMarks.map(b=>b.ops/(b.ms||0.01));
        const max=Math.max(...pts);
        drawLine(ctx,pts,colors.accent,w,h,max);
        // Labels
        ctx.fillStyle=colors.text;ctx.font='10px monospace';
        ctx.fillText('ops/ms',5,12);ctx.fillText('→ array size',w-60,h-3);
        // Info
        const info=document.getElementById(id+'_bench_info');
        const totalOps=benchMarks.reduce((a,b)=>a+b.ops,0);
        const totalMs=benchMarks.reduce((a,b)=>a+b.ms,0);
        info.innerHTML='Math: <b style=\\"color:'+colors.accent+'\\">'+(totalOps/totalMs).toFixed(0)+' ops/ms</b> · DOM: <b style=\\"color:'+colors.green+'\\">'+(1000/domMs).toFixed(0)+' creates/ms</b> · Canvas: <b style=\\"color:'+colors.orange+'\\">'+(2000/canvasMs).toFixed(0)+' rects/ms</b> · JSON: <b style=\\"color:'+colors.purple+'\\">'+(5000/jsonMs).toFixed(1)+' obj/ms</b>';
    },50);

    // ── CDN SIGNAL TRACE ──
    setTimeout(()=>{
        const c2=document.getElementById(id+'_cdn');
        if(!c2)return;
        const ctx=c2.getContext('2d');
        const w=c2.width,h=c2.height;
        drawGrid(ctx,w,h);

        // Simulate multi-layer CDN hops
        const layers=['DNS','TLS','TCP','HTTP','Edge','Origin'];
        const layerColors=[colors.cyan,colors.purple,colors.green,colors.accent,colors.orange,colors.red];
        const layerData=layers.map((_,li)=>{
            const pts=[];
            for(let i=0;i<40;i++){
                const base=(li+1)*3;
                const jitter=Math.random()*8-4;
                const spike=Math.random()>0.92?15:0;
                pts.push(Math.max(0.5,base+jitter+spike+(Math.sin(i*0.3)*2)));
            }
            return pts;
        });

        const maxV=Math.max(...layerData.flat())*1.1;
        layerData.forEach((pts,li)=>drawLine(ctx,pts,layerColors[li],w,h,maxV));

        // Legend
        layers.forEach((l,i)=>{
            ctx.fillStyle=layerColors[i];ctx.font='bold 8px monospace';
            ctx.fillText('● '+l, 5, 14+i*12);
        });

        // Simulate real network timing
        const cdnInfo=document.getElementById(id+'_cdn_info');
        const dnsT0=performance.now();
        // We can actually measure navigation timing if available
        const perf=window.performance;
        const nav=perf.getEntriesByType&&perf.getEntriesByType('navigation')[0];
        if(nav){
            cdnInfo.innerHTML='DNS: <b style=\\"color:'+colors.cyan+'\\">'+(nav.domainLookupEnd-nav.domainLookupStart).toFixed(1)+'ms</b> · TLS: <b style=\\"color:'+colors.purple+'\\">'+(nav.connectEnd-nav.secureConnectionStart||0).toFixed(1)+'ms</b> · TTFB: <b style=\\"color:'+colors.green+'\\">'+(nav.responseStart-nav.requestStart).toFixed(1)+'ms</b> · Load: <b style=\\"color:'+colors.accent+'\\">'+(nav.loadEventEnd-nav.startTime).toFixed(0)+'ms</b>';
        } else {
            cdnInfo.innerHTML='CDN trace: <b style=\\"color:'+colors.cyan+'\\">simulated 6-layer hop model</b>';
        }
    },100);

    // ── COMPUTE THROUGHPUT BAR CHART ──
    setTimeout(()=>{
        const c3=document.getElementById(id+'_compute');
        if(!c3)return;
        const ctx=c3.getContext('2d');
        drawBars(ctx,
            ['Math','DOM','Canvas','JSON','RegEx'],
            [
                benchMarks.reduce((a,b)=>a+b.ops,0)/benchMarks.reduce((a,b)=>a+b.ms,0),
                1000/domMs,
                2000/canvasMs,
                5000/jsonMs,
                (()=>{const t=performance.now();for(let i=0;i<5000;i++)/quantum_\\d+/.test('quantum_'+i);return 5000/(performance.now()-t);})()
            ],
            [colors.accent,colors.green,colors.orange,colors.purple,colors.cyan],
            c3.width,c3.height
        );
    },150);

    // ── DATA LAYER STACK (stacked area) ──
    setTimeout(()=>{
        const c4=document.getElementById(id+'_layers');
        if(!c4)return;
        const ctx=c4.getContext('2d');
        const w=c4.width,h=c4.height;
        drawGrid(ctx,w,h);

        const layerNames=['L1-Cache','L2-Worker','L3-Bridge','L4-CDN','L5-Origin'];
        const layerCol=[colors.accent+'90',colors.green+'90',colors.orange+'90',colors.purple+'90',colors.red+'60'];
        const N=50;
        const stacks=layerNames.map((_,li)=>{
            const pts=[];
            for(let i=0;i<N;i++)pts.push(5+Math.random()*15+li*4+Math.sin(i*0.2+li)*5);
            return pts;
        });

        // Draw stacked from bottom
        for(let li=stacks.length-1;li>=0;li--){
            ctx.fillStyle=layerCol[li];ctx.beginPath();ctx.moveTo(0,h);
            for(let i=0;i<N;i++){
                let sum=0;for(let j=0;j<=li;j++)sum+=stacks[j][i];
                const x=(i/(N-1))*w;const y=h-(sum/120)*h*0.85;
                ctx.lineTo(x,y);
            }
            ctx.lineTo(w,h);ctx.closePath();ctx.fill();
        }
        // Labels
        layerNames.forEach((l,i)=>{
            ctx.fillStyle=layerCol[i].replace('90','').replace('60','');ctx.font='bold 8px monospace';
            ctx.fillText('■ '+l, w-80, 12+i*11);
        });
    },200);

    // ── PREFIX SPEED (bar chart: lines/ms per language) ──
    setTimeout(()=>{
        const c5=document.getElementById(id+'_prefix');
        if(!c5)return;
        const ctx=c5.getContext('2d');
        // Benchmark prefix classification speed per language
        const langs=['py','js','rs','go','sh','html'];
        const testLines=['import os','const x = 1','fn main()','func main()','#!/bin/bash','<div>'];
        const speeds=testLines.map((line,i)=>{
            const t0=performance.now();
            for(let j=0;j<10000;j++){
                /^\\s*(import|from|def|class|#|if|for|while|return|print)/.test(line);
            }
            return 10000/(performance.now()-t0);
        });
        drawBars(ctx,langs,speeds,
            [colors.accent,colors.orange,colors.red,colors.cyan,colors.green,colors.purple],
            c5.width,c5.height
        );
        ctx.fillStyle=colors.text;ctx.font='8px monospace';ctx.fillText('lines/ms',5,10);
    },250);

    // ── SUMMARY ──
    setTimeout(()=>{
        const summary=document.getElementById(id+'_summary');
        if(!summary)return;
        const totalMs=benchMarks.reduce((a,b)=>a+b.ms,0);
        const totalOps=benchMarks.reduce((a,b)=>a+b.ops,0);
        const cores=navigator.hardwareConcurrency||'?';
        const mem=navigator.deviceMemory||'?';
        const conn=navigator.connection;
        const netType=conn?conn.effectiveType:'unknown';
        const downlink=conn?conn.downlink+'Mbps':'N/A';
        summary.innerHTML=\`
            <div style="font-weight:700;font-size:0.875rem;margin-bottom:8px;color:var(--cursor-text);">📈 System Performance Summary</div>
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;">
                <div style="text-align:center;"><div style="font-size:1.25rem;font-weight:700;color:\${colors.accent};">\${(totalOps/totalMs).toFixed(0)}</div><div style="font-size:0.625rem;color:\${colors.text};">ops/ms (math)</div></div>
                <div style="text-align:center;"><div style="font-size:1.25rem;font-weight:700;color:\${colors.green};">\${cores}</div><div style="font-size:0.625rem;color:\${colors.text};">CPU cores</div></div>
                <div style="text-align:center;"><div style="font-size:1.25rem;font-weight:700;color:\${colors.orange};">\${mem}GB</div><div style="font-size:0.625rem;color:\${colors.text};">device memory</div></div>
                <div style="text-align:center;"><div style="font-size:1.25rem;font-weight:700;color:\${colors.purple};">\${netType}</div><div style="font-size:0.625rem;color:\${colors.text};">network (\${downlink})</div></div>
            </div>
            <div style="margin-top:8px;font-size:0.6875rem;color:\${colors.text};text-align:center;">
                DOM: \${(1000/domMs).toFixed(0)} creates/ms · Canvas: \${(2000/canvasMs).toFixed(0)} rects/ms · JSON: \${(5000/jsonMs).toFixed(1)} ser/ms · Quantum ready ⚛
            </div>
        \`;
    },300);

})();
</` + `script>`;
            }

            displayOutput(cellId, result) {
                const outputElement = document.getElementById(`${cellId}-output`);

                if (result.type === 'text') {
                    outputElement.innerHTML = result.data
                        .map(line => `<div class="output-text">${line}</div>`)
                        .join('');
                } else if (result.type === 'html') {
                    outputElement.innerHTML = `<div class="output-html">${result.data}</div>`;
                    // Activate <script> tags (innerHTML doesn't execute them)
                    outputElement.querySelectorAll('script').forEach(oldScript => {
                        const newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        oldScript.replaceWith(newScript);
                    });
                } else if (result.type === 'mermaid') {
                    const mermaidId = `mermaid_${cellId}_${Date.now()}`;
                    outputElement.innerHTML = `<div class="mermaid-output" onclick="notebook.expandCellOutput('${cellId}')" title="Click to expand diagram"><div class="mermaid" id="${mermaidId}">${result.data}</div></div>`;
                    try {
                        if (window.mermaid) {
                            window.mermaid.run({ nodes: [document.getElementById(mermaidId)] });
                        }
                    } catch (e) {
                        outputElement.innerHTML = `<div class="output-error">Mermaid render error: ${e.message}</div>`;
                    }
                } else if (result.type === 'plot') {
                    outputElement.innerHTML = `<img src="${result.data}" class="output-plot" alt="Plot output">`;
                }
            }

            displayError(cellId, message) {
                const outputElement = document.getElementById(`${cellId}-output`);
                outputElement.innerHTML = `<div class="output-error">Error: ${message}</div>`;
            }

            markdownToHtml(markdown) {
                return markdown
                    .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                    .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                    .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/^- (.*$)/gm, '&bull; $1<br>')
                    .replace(/\n{2,}/g, '<br><br>')
                    .replace(/\n/g, '<br>');
            }

            /* ---------- Quantum Navigation ---------- */
            navigateQuantumSpace(direction, btnElement) {
                // Remove active from all, then mark the clicked button
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                if (btnElement) btnElement.classList.add('active');

                switch (direction) {
                    case '+1': this.quantumPosition[1] += 1; break;
                    case '-1': this.quantumPosition[1] -= 1; break;
                    case '+0': this.quantumPosition[0] += 1; break;
                    case '-0': this.quantumPosition[0] -= 1; break;
                    case '+n': this.quantumPosition[2] += 1; break;
                    case '-n': this.quantumPosition[2] -= 1; break;
                    case '+2': this.quantumPosition[1] += 2; break;
                    case '0':  /* no-op: neutral */ break;
                    case '\u269B': // ⚛ reset
                        this.quantumPosition = [0, 0, 0];
                        this._logStream('reset → origin', '[0, 0, 0]', 'origin');
                        break;
                }

                const dirLabel = direction === '\u269B' ? '∞ reset' : direction;
                this.updateQuantumPosition(`nav ${dirLabel}`);
            }

            updateQuantumPosition(logAction) {
                const [x, y, z] = this.quantumPosition;
                document.getElementById('position-display').textContent = `[${x}, ${y}, ${z}]`;
                document.getElementById('layer-value').textContent = z;

                // Center button: ∞ at layer 0, ✱ at other layers (compute mode)
                const centerBtn = document.getElementById('nav-center-btn');
                if (centerBtn) {
                    if (z === 0 && x === 0 && y === 0) {
                        centerBtn.textContent = '∞';
                        centerBtn.title = 'Origin — infinite state';
                    } else {
                        centerBtn.textContent = '✱';
                        centerBtn.title = `Compute at [${x}, ${y}, ${z}] — click to reset`;
                    }
                }

                // Version the nav grid labels based on current layer (like Electron app)
                const baseSymbols = [
                    { dir: '+1', base: '+1' },
                    { dir: '0',  base: '0' },
                    { dir: '-1', base: '-1' },
                    { dir: '+n', base: '+n' },
                    { dir: '-n', base: '-n' },
                    { dir: '+0', base: '+0' },
                    { dir: '-0', base: '-0' },
                    { dir: '+2', base: '+2' },
                ];
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    const dir = btn.dataset.direction;
                    if (dir === '⚛') return; // center handled above
                    const sym = baseSymbols.find(s => s.dir === dir);
                    if (!sym) return;
                    if (z === 0) {
                        btn.textContent = sym.base;
                    } else {
                        btn.textContent = `${sym.base}:${z}`;
                    }
                });

                // Log to stream history
                if (logAction) {
                    this._logStream(logAction, `[${x}, ${y}, ${z}]`);
                }
            }

            /* ---------- Stream History ---------- */
            _streamHistory = [];

            _logStream(action, detail, type = 'nav') {
                const now = new Date();
                const ts = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
                const entry = { action, detail, type, ts, position: [...this.quantumPosition] };
                this._streamHistory.push(entry);

                // Keep max 100 entries
                if (this._streamHistory.length > 100) this._streamHistory.shift();

                const log = document.getElementById('stream-log');
                if (!log) return;

                const icons = {
                    nav: '→',
                    origin: '∞',
                    exec: '▶',
                    paste: '📋',
                    pipe: '⇌',
                    layer: '◆',
                };

                const div = document.createElement('div');
                div.className = `stream-entry stream-${type}`;
                div.innerHTML = `<span class="stream-ts">${ts}</span>${icons[type] || '·'} ${action} <span style="opacity:0.5">${detail}</span>`;
                div.title = `Click to jump to ${JSON.stringify(entry.position)}`;
                div.style.cursor = 'pointer';
                div.addEventListener('click', () => {
                    this.quantumPosition = [...entry.position];
                    this.updateQuantumPosition('jump');
                });

                log.appendChild(div);
                log.scrollTop = log.scrollHeight;
            }

            /* ══════════════════════════════════════════════════════
               SECURITY SCAN + GIT HOOKS (Phase 2)
               ══════════════════════════════════════════════════════ */

            async _runSecurityScan() {
                this._showProgress('Security scan');
                this._logStream('security scan', 'scanning all cells', 'exec');
                const codeCells = this.cells.filter(c => c.type === 'code' || c.type === 'shell');
                const results = [];

                for (let i = 0; i < codeCells.length; i++) {
                    const cell = codeCells[i];
                    const content = document.getElementById(`${cell.id}-editor`)?.value || cell.content;
                    this._updateProgress(i + 1, codeCells.length, cell.id);

                    // Try bridge first
                    if (this.bridgeConnected && this.ws?.readyState === 1) {
                        try {
                            const resp = await fetch('http://localhost:8085/api/security/scan', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({ code: content, language: this.detectCellLanguage(cell) }),
                            });
                            const data = await resp.json();
                            if (data.total_findings > 0) results.push({ cell: cell.id, ...data });
                        } catch(e) { /* fallback below */ }
                    }

                    // Client-side fallback scan
                    if (!this.bridgeConnected) {
                        const findings = this._clientSecurityScan(content, this.detectCellLanguage(cell));
                        if (findings.length > 0) results.push({ cell: cell.id, findings, total_findings: findings.length });
                    }

                    await new Promise(r => setTimeout(r, 50));
                }

                this._hideProgress(800);

                // Display results
                const id = this.addCell('code', '# Security Scan Results');
                const total = results.reduce((s, r) => s + (r.total_findings || 0), 0);
                let output;
                if (total === 0) {
                    output = { type: 'text', data: ['✅ Security scan passed — 0 findings across ' + codeCells.length + ' cells.'] };
                } else {
                    const lines = [`🛡 Security Scan: ${total} finding(s) across ${results.length} cell(s)`, ''];
                    results.forEach(r => {
                        lines.push(`── Cell: ${r.cell}`);
                        (r.findings || []).forEach(f => {
                            const icon = f.severity === 'critical' ? '🔴' : f.severity === 'high' ? '🟠' : f.severity === 'medium' ? '🟡' : '⚪';
                            lines.push(`  ${icon} [${f.severity}] L${f.line || '?'} ${f.prefix || ''} — ${f.description}`);
                            if (f.code) lines.push(`    → ${f.code}`);
                        });
                        lines.push('');
                    });
                    output = { type: 'text', data: lines };
                }

                this.displayOutput(id, output);
                this._logStream('scan done', `${total} findings`, 'exec');
                requestAnimationFrame(() => {
                    const el = document.getElementById(id);
                    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            }

            _clientSecurityScan(code, language) {
                const rules = {
                    python: [
                        { pattern: /\bexec\s*\(/, severity: 'high', desc: 'Dynamic code execution (exec)' },
                        { pattern: /\beval\s*\(/, severity: 'high', desc: 'Dynamic code evaluation (eval)' },
                        { pattern: /os\.system\s*\(/, severity: 'high', desc: 'OS command execution' },
                        { pattern: /(password|secret|api_key|token)\s*=\s*['"][^'"]+['"]/, severity: 'critical', desc: 'Hardcoded secret' },
                        { pattern: /pickle\.loads?\s*\(/, severity: 'high', desc: 'Unsafe deserialization' },
                    ],
                    javascript: [
                        { pattern: /\beval\s*\(/, severity: 'high', desc: 'eval() — injection risk' },
                        { pattern: /innerHTML\s*=/, severity: 'medium', desc: 'innerHTML — XSS risk' },
                        { pattern: /(password|secret|api_key|token)\s*[:=]\s*['"][^'"]+['"]/, severity: 'critical', desc: 'Hardcoded secret' },
                    ],
                    shell: [
                        { pattern: /curl\s.*\|\s*(bash|sh)/, severity: 'critical', desc: 'Pipe-to-shell RCE' },
                        { pattern: /chmod\s+777/, severity: 'high', desc: 'World-writable perms' },
                        { pattern: /rm\s+-rf\s+\//, severity: 'critical', desc: 'Recursive root delete' },
                    ],
                };
                const ruleSet = rules[language] || rules.python;
                const findings = [];
                code.split('\n').forEach((line, i) => {
                    ruleSet.forEach(r => {
                        if (r.pattern.test(line)) {
                            findings.push({ line: i + 1, severity: r.severity, description: r.desc, code: line.trim().substring(0, 120) });
                        }
                    });
                });
                return findings;
            }

            async _installGitHook() {
                this._showProgress('Git hook install');
                this._logStream('git hook', 'installing pre-commit', 'exec');

                let result;
                if (this.bridgeConnected && this.ws?.readyState === 1) {
                    try {
                        const resp = await fetch('http://localhost:8085/api/git/hook/install', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({ repo: '.' }),
                        });
                        result = await resp.json();
                    } catch(e) {
                        result = { error: 'Bridge offline — cannot install hook remotely.' };
                    }
                } else {
                    result = { error: 'Bridge not connected. Start quantum_bridge_server.py first.' };
                }

                this._hideProgress(600);

                const id = this.addCell('code', '# Git Pre-Commit Hook');
                let output;
                if (result.installed) {
                    output = { type: 'text', data: [
                        '✅ Quantum pre-commit hook installed!',
                        `   Path: ${result.path}`,
                        `   Size: ${result.size_bytes} bytes`,
                        '',
                        'The hook will:',
                        '  • Security-scan staged files via /api/security/scan',
                        '  • Block commits with risk score > 20',
                        '  • Check for beyondBINARY header on source files',
                        '',
                        'Bypass with: git commit --no-verify',
                    ]};
                    this._logStream('hook installed', result.path, 'exec');
                } else {
                    output = { type: 'text', data: ['❌ ' + (result.error || 'Unknown error')] };
                    this._logStream('hook error', result.error || 'failed', 'exec');
                }

                this.displayOutput(id, output);
                requestAnimationFrame(() => {
                    const el = document.getElementById(id);
                    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            }

            /* ========== QUANTUM THERMAL VISUALIZATION ========== */
            _stopThermalViz() {
                if (this._thermalAnim) {
                    cancelAnimationFrame(this._thermalAnim);
                    this._thermalAnim = null;
                }
            }

            _initThermalViz() {
                if (this._thermalAnim) return; // already running
                const canvas = document.getElementById('thermal-canvas');
                if (!canvas) return;
                this._thermalCtx = canvas.getContext('2d');
                this._thermalFrame = 0;
                this._updateThermalStats();
                this._updateGpuQubitScaling();
                const tick = () => {
                    this._thermalFrame++;
                    this._drawThermalCanvas();
                    this._thermalAnim = requestAnimationFrame(tick);
                };
                tick();
            }

            _drawThermalCanvas() {
                const ctx = this._thermalCtx;
                if (!ctx) return;
                const W = ctx.canvas.width, H = ctx.canvas.height;
                const t = this._thermalFrame;

                // Background fade
                ctx.fillStyle = 'rgba(10,14,20,0.15)';
                ctx.fillRect(0, 0, W, H);

                if (this._thermalMode === 'lattice') {
                    this._drawLattice(ctx, W, H, t);
                } else if (this._thermalMode === 'flow') {
                    this._drawFlow(ctx, W, H, t);
                } else if (this._thermalMode === 'gpu') {
                    this._drawGpuVsQubit(ctx, W, H, t);
                }
            }

            /* --- Lattice: egg-crate optical lattice with Rydberg excitation --- */
            _drawLattice(ctx, W, H, t) {
                const grid = 8; // 8x8 visible slice of the Rubik multi-stack
                const spacing = W / (grid + 1);
                const layer = Math.abs(this.quantumPosition[2]) % 6;
                const qPos = this.quantumPosition;

                for (let r = 0; r < grid; r++) {
                    for (let c = 0; c < grid; c++) {
                        const x = spacing * (c + 1);
                        const y = spacing * (r + 1);

                        // Rydberg entanglement — atoms near the quantum position glow
                        const dx = (c - qPos[0] % grid + grid) % grid;
                        const dy = (r - qPos[1] % grid + grid) % grid;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        // Entanglement oscillation
                        const phase = Math.sin(t * 0.04 + r * 0.7 + c * 0.5 + layer) * 0.5 + 0.5;
                        const excited = dist < 2.5 && phase > 0.5;

                        // Thermal color: cryo-blue → warm-green → hot-red
                        const temp = excited ? 0.7 + phase * 0.3 : 0.05 + phase * 0.15;
                        const hue = (1 - temp) * 200; // 200=blue, 0=red
                        const alpha = 0.4 + phase * 0.6;
                        const radius = spacing * 0.18 * (excited ? 1.4 + Math.sin(t * 0.1) * 0.3 : 0.8);

                        // Entanglement lines
                        if (excited && r > 0 && c > 0) {
                            ctx.strokeStyle = `hsla(${hue}, 80%, 70%, ${alpha * 0.3})`;
                            ctx.lineWidth = 1;
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(x - spacing, y);
                            ctx.moveTo(x, y);
                            ctx.lineTo(x, y - spacing);
                            ctx.stroke();
                        }

                        // Atom
                        ctx.beginPath();
                        ctx.arc(x, y, radius, 0, Math.PI * 2);
                        const grad = ctx.createRadialGradient(x, y, 0, x, y, radius);
                        grad.addColorStop(0, `hsla(${hue}, 90%, 75%, ${alpha})`);
                        grad.addColorStop(1, `hsla(${hue}, 70%, 40%, 0)`);
                        ctx.fillStyle = grad;
                        ctx.fill();
                    }
                }

                // Layer label
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = '10px monospace';
                ctx.fillText(`Lattice Z=${qPos[2]}  Slice ${grid}x${grid}  ` +
                    `Spacing 0.5µm  Rydberg:${this._thermalQubits}q`, 6, H - 6);
            }

            /* --- Flow: live data heat-map of quantum prefix layers --- */
            _drawFlow(ctx, W, H, t) {
                const prefixes = ['+1','1','-1','+0','0','-0','+n','n','-n'];
                const cols = prefixes.length;
                const colW = W / cols;
                const rows = 32;
                const rowH = H / rows;

                for (let c = 0; c < cols; c++) {
                    for (let r = 0; r < rows; r++) {
                        const flow = Math.sin(t * 0.03 + c * 1.2 + r * 0.25) * 0.5 + 0.5;
                        const burst = Math.sin(t * 0.07 + c * 0.9) > 0.8 ? 0.3 : 0;
                        const val = Math.min(1, flow + burst);
                        const hue = (1 - val) * 200;
                        ctx.fillStyle = `hsla(${hue}, 85%, ${30 + val * 45}%, ${0.6 + val * 0.4})`;
                        ctx.fillRect(c * colW, r * rowH, colW - 1, rowH - 1);
                    }
                    // Prefix label
                    ctx.fillStyle = 'rgba(255,255,255,0.7)';
                    ctx.font = 'bold 9px monospace';
                    ctx.textAlign = 'center';
                    ctx.fillText(prefixes[c], c * colW + colW / 2, H - 4);
                }
                ctx.textAlign = 'start';

                // Flow title
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                ctx.font = '10px monospace';
                ctx.fillText('Data Flow — 9-prefix layers — live heat', 6, 12);
            }

            /* --- GPU vs Qubit: scaling comparison visualization --- */
            _drawGpuVsQubit(ctx, W, H, t) {
                const q = this._thermalQubits;
                ctx.clearRect(0, 0, W, H);
                ctx.fillStyle = '#0a0e14';
                ctx.fillRect(0, 0, W, H);

                // --- Left side: GPU tower ---
                const gpuCount = this._gpuForQubits(q);
                const maxBars = 20;
                const gpuBars = Math.min(maxBars, typeof gpuCount === 'number' ? Math.ceil(Math.log2(gpuCount + 1)) : maxBars);
                const barH = (H - 60) / maxBars;

                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = 'bold 11px monospace';
                ctx.fillText('NVIDIA B200', 10, 20);
                ctx.font = '9px monospace';
                ctx.fillText(typeof gpuCount === 'number' ? `${gpuCount.toLocaleString()} GPUs` : '∞ impossible', 10, 34);

                for (let i = 0; i < gpuBars; i++) {
                    const prog = Math.min(1, (t * 0.02 - i * 0.15));
                    if (prog <= 0) continue;
                    const pulse = Math.sin(t * 0.05 + i * 0.4) * 0.15 + 0.85;
                    const w = (W / 2 - 30) * prog * pulse;
                    const y = 44 + i * barH;
                    const grad = ctx.createLinearGradient(10, y, 10 + w, y);
                    grad.addColorStop(0, '#f85149');
                    grad.addColorStop(0.6, '#f0883e');
                    grad.addColorStop(1, '#e3b341');
                    ctx.fillStyle = grad;
                    ctx.fillRect(10, y, w, barH - 2);
                }

                // --- Right side: Qubit sphere ---
                const cx = W * 0.72, cy = H * 0.45, R = Math.min(W, H) * 0.25;

                // Bloch-like sphere
                ctx.strokeStyle = 'rgba(0,191,255,0.25)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(cx, cy, R, 0, Math.PI * 2);
                ctx.stroke();
                ctx.beginPath();
                ctx.ellipse(cx, cy, R, R * 0.35, 0, 0, Math.PI * 2);
                ctx.stroke();

                // Qubit nodes orbiting
                const nNodes = Math.min(q, 30);
                for (let i = 0; i < nNodes; i++) {
                    const angle = (Math.PI * 2 / nNodes) * i + t * 0.015;
                    const rr = R * (0.6 + Math.sin(t * 0.02 + i) * 0.35);
                    const nx = cx + Math.cos(angle) * rr;
                    const ny = cy + Math.sin(angle) * rr * 0.6;
                    const pulse = Math.sin(t * 0.06 + i * 0.8) * 0.4 + 0.6;
                    ctx.beginPath();
                    ctx.arc(nx, ny, 3 + pulse * 3, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(210,168,255,${pulse})`;
                    ctx.fill();
                }

                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = 'bold 11px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(`${q} Qubits`, cx, cy + R + 18);
                ctx.font = '9px monospace';
                const state = q <= 30 ? 'classical sim OK' : q <= 40 ? 'cluster needed' : q < 50 ? 'supercomputer' : 'quantum only';
                ctx.fillText(state, cx, cy + R + 32);
                ctx.textAlign = 'start';

                // Photonic badge
                ctx.fillStyle = '#d2a8ff';
                ctx.font = '9px monospace';
                ctx.fillText('◈ Xanadu photonic — 25°C room temp', 10, H - 8);
            }

            _gpuForQubits(q) {
                if (q <= 30) return 1;
                if (q <= 33) return 1;
                if (q <= 34) return 8;
                if (q <= 36) return 64;
                if (q <= 38) return 256;
                if (q <= 40) return 1024;
                if (q <= 45) return 32768;
                if (q <= 49) return 1048576;
                return null; // impossible
            }

            _updateGpuQubitScaling() {
                const q = this._thermalQubits;
                const gpuCount = this._gpuForQubits(q);
                const qEl = document.getElementById('th-qubits');
                const gEl = document.getElementById('th-gpus');
                if (qEl) qEl.textContent = q;
                if (gEl) gEl.textContent = gpuCount !== null ? gpuCount.toLocaleString() + ' GPUs' : '∞ (impossible)';

                // Fill bar
                const fill = document.getElementById('gpu-fill');
                if (fill) {
                    const pct = gpuCount !== null ? Math.min(100, Math.log2(gpuCount + 1) * 5) : 100;
                    fill.style.width = pct + '%';
                    fill.style.background = pct < 30 ? '#3fb950' : pct < 70 ? 'linear-gradient(90deg,#3fb950,#f0883e)' : 'linear-gradient(90deg,#3fb950,#f0883e,#f85149)';
                }

                // Update lattice dims
                const dim = Math.max(2, Math.ceil(Math.pow(q, 1/3)));
                const dimEl = document.getElementById('lattice-dim');
                const sitesEl = document.getElementById('lattice-sites');
                if (dimEl) dimEl.textContent = `${dim}x${dim}x${dim}`;
                if (sitesEl) sitesEl.textContent = dim * dim * dim;
            }

            _updateThermalStats() {
                const unit = this._thermalUnit;
                // Base values in Celsius
                const vals = {
                    cryo: -273.135,     // 15mK
                    fridge: -272.87,    // dilution
                    photonic: 25.0,     // Xanadu room-temp
                    gpu: 83.2,          // GPU junction
                };
                const convert = (c) => {
                    if (unit === 'C') return c.toFixed(c < -200 ? 3 : 1) + ' °C';
                    if (unit === 'F') return (c * 9/5 + 32).toFixed(1) + ' °F';
                    return (c + 273.15).toFixed(c < -200 ? 3 : 1) + ' K';
                };
                const special = (mK) => {
                    if (unit === 'C') return (mK / 1000 - 273.15).toFixed(3) + ' °C';
                    if (unit === 'F') return ((mK / 1000 - 273.15) * 9/5 + 32).toFixed(3) + ' °F';
                    return (mK / 1000).toFixed(3) + ' K';
                };

                const el = (id, v) => { const e = document.getElementById(id); if (e) e.textContent = v; };
                el('th-cryo', special(15));
                el('th-fridge', convert(vals.fridge));
                el('th-photonic', convert(vals.photonic));
                el('th-gpu', convert(vals.gpu));
            }

            /* ========== CHARTGPU INTEGRATION ========== */
            async _fetchChartGPUMetrics() {
                try {
                    const resp = await fetch('http://localhost:8085/api/chartgpu/metrics');
                    const data = await resp.json();
                    if (data.metrics) {
                        const m = data.metrics;
                        const el = (id, v) => { const e = document.getElementById(id); if (e) e.textContent = v; };
                        el('cg-cpu', m.cpu.toFixed(1) + '%');
                        el('cg-mem', m.memory.toFixed(1) + '%');
                        el('chartgpu-status-val', 'live');
                        document.getElementById('chartgpu-status-val').style.color = '#3fb950';
                        this._logStream('chartgpu', `CPU ${m.cpu.toFixed(1)}% MEM ${m.memory.toFixed(1)}%`, 'data');
                    }
                } catch(e) {
                    const el = document.getElementById('chartgpu-status-val');
                    if (el) { el.textContent = 'offline'; el.style.color = 'var(--cursor-text-muted)'; }
                }
            }

            /* ========== HEX / FAX STREAM VIEWER ========== */
            _drawHexCanvas() {
                const ctx = this._hexCtx;
                if (!ctx) return;
                const W = ctx.canvas.width, H = ctx.canvas.height;
                const cols = 36, rows = 36;
                const cw = W / cols, ch = H / rows;
                const mode = this._hexMode;

                ctx.clearRect(0, 0, W, H);

                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        const val = this._hexData[r * cols + c] || 0;
                        const norm = val / 255;

                        if (mode === 'color') {
                            // Thermal color map: blue → green → orange → red
                            const hue = (1 - norm) * 200;
                            ctx.fillStyle = `hsl(${hue}, 85%, ${20 + norm * 50}%)`;
                        } else if (mode === 'gray') {
                            const g = Math.floor(norm * 255);
                            ctx.fillStyle = `rgb(${g},${g},${g})`;
                        } else { // fax
                            const g = norm > 0.5 ? 255 : 0;
                            ctx.fillStyle = `rgb(${g},${g},${g})`;
                        }
                        ctx.fillRect(c * cw, r * ch, cw - 0.5, ch - 0.5);
                    }
                }

                // Overlay hex labels on first few rows
                ctx.fillStyle = 'rgba(255,255,255,0.6)';
                ctx.font = `${Math.max(6, cw * 0.5)}px monospace`;
                ctx.textAlign = 'center';
                for (let r = 0; r < Math.min(6, rows); r++) {
                    for (let c = 0; c < cols; c++) {
                        const val = this._hexData[r * cols + c] || 0;
                        ctx.fillText(val.toString(16).toUpperCase().padStart(2, '0'),
                            c * cw + cw / 2, r * ch + ch * 0.75);
                    }
                }
                ctx.textAlign = 'start';
            }

            _openHexOverlay() {
                // Create full-screen hex viewer overlay
                let overlay = document.getElementById('hex-overlay');
                if (overlay) { overlay.remove(); return; }

                overlay = document.createElement('div');
                overlay.id = 'hex-overlay';
                overlay.className = 'hex-overlay';
                overlay.innerHTML = `
                    <div class="hex-overlay-bar">
                        <button class="active" data-omode="color">Color</button>
                        <button data-omode="gray">Grayscale</button>
                        <button data-omode="fax">Fax</button>
                        <button data-omode="signal">Signal</button>
                        <span style="flex:1;"></span>
                        <span style="font-size:0.6875rem;color:#888;padding:0 8px;">HF Fax / Hex Stream — 1080x1080 Instagram</span>
                        <button id="hex-overlay-close">✕ Close</button>
                    </div>
                    <canvas id="hex-overlay-canvas" width="1080" height="1080"></canvas>
                `;
                document.body.appendChild(overlay);

                const canvas = document.getElementById('hex-overlay-canvas');
                const ctx = canvas.getContext('2d');
                const bigData = new Uint8Array(1080 * 1080);
                // Stretch hex data to fill
                for (let i = 0; i < bigData.length; i++) {
                    bigData[i] = this._hexData[i % this._hexData.length];
                    bigData[i] = (bigData[i] + Math.floor(Math.random() * 4)) & 0xFF;
                }

                let oMode = this._hexMode;
                const draw = () => {
                    const W = 1080, H = 1080, cols = 108, rows = 108;
                    const cw = W / cols, ch = H / rows;
                    ctx.fillStyle = '#000';
                    ctx.fillRect(0, 0, W, H);
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c < cols; c++) {
                            const val = bigData[r * cols + c] || 0;
                            const norm = val / 255;
                            if (oMode === 'color') {
                                const hue = (1 - norm) * 200;
                                ctx.fillStyle = `hsl(${hue}, 85%, ${20 + norm * 50}%)`;
                            } else if (oMode === 'gray') {
                                const g = Math.floor(norm * 255);
                                ctx.fillStyle = `rgb(${g},${g},${g})`;
                            } else if (oMode === 'fax') {
                                const g = norm > 0.5 ? 255 : 0;
                                ctx.fillStyle = `rgb(${g},${g},${g})`;
                            } else { // signal
                                const r2 = Math.floor(norm * 128);
                                const g2 = Math.floor(Math.sin(norm * Math.PI) * 255);
                                const b2 = Math.floor((1 - norm) * 200);
                                ctx.fillStyle = `rgb(${r2},${g2},${b2})`;
                            }
                            ctx.fillRect(c * cw, r * ch, cw - 0.3, ch - 0.3);
                        }
                    }
                };
                draw();

                // Animate
                const anim = setInterval(() => {
                    for (let i = 0; i < 500; i++) {
                        const idx = Math.floor(Math.random() * bigData.length);
                        bigData[idx] = (bigData[idx] + Math.floor(Math.random() * 8)) & 0xFF;
                    }
                    draw();
                }, 150);

                overlay.querySelectorAll('[data-omode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        overlay.querySelectorAll('[data-omode]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        oMode = btn.dataset.omode;
                        draw();
                    });
                });

                document.getElementById('hex-overlay-close').addEventListener('click', () => {
                    clearInterval(anim);
                    overlay.remove();
                });
            }

            /* ========== TOOLS DROPDOWN RUNNER ========== */
            async _runTool(toolId) {
                this._logStream('tool', toolId, 'exec');
                const BRIDGE = 'http://localhost:8085';

                const toolMap = {
                    'kbatch': async () => {
                        const text = prompt('Enter text for keyboard analysis:');
                        if (!text) return;
                        const resp = await fetch(`${BRIDGE}/api/day/kbatch`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({text, mode: 'analyze'}),
                        });
                        const data = await resp.json();
                        const id = this.addCell('code', `# Kbatch Keyboard Analysis\n# Input: "${text.slice(0,50)}..."`);
                        this.displayOutput(id, {type:'text', data: (data.output || data.error || JSON.stringify(data)).split('\\n')});
                    },
                    'signal': async () => {
                        const text = prompt('Enter text for signal analysis:');
                        if (!text) return;
                        const resp = await fetch(`${BRIDGE}/api/day/signal`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({text}),
                        });
                        const data = await resp.json();
                        const id = this.addCell('code', '# Signal Analysis — Morse / Binary / Waveform');
                        this.displayOutput(id, {type:'text', data: [
                            `Input: ${data.input || text}`,
                            `Morse: ${data.morse || '—'}`,
                            `Binary: ${(data.binary || '').slice(0, 200)}`,
                            `Chars: ${data.char_count || 0}`,
                            '',
                            'Waveform (first 20 chars):',
                            ...(data.waveform || []).slice(0, 20).map(w => `  ${w.char} → ${w.freq}Hz  ${w.morse}`),
                        ]});
                    },
                    'geokey': async () => {
                        const text = prompt('Enter text for geometric key mapping:');
                        if (!text) return;
                        const resp = await fetch(`${BRIDGE}/api/day/geokey`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({text, layout: 'hex'}),
                        });
                        const data = await resp.json();
                        const id = this.addCell('code', '# GeoKey — Geometric Keyboard Mapper');
                        this.displayOutput(id, {type:'text', data: (data.output || JSON.stringify(data.mapping || data, null, 2)).split('\\n')});
                    },
                    'youtube': async () => {
                        const url = prompt('Enter YouTube URL:');
                        if (!url) return;
                        this._showProgress('Fetching transcript...');
                        const resp = await fetch(`${BRIDGE}/api/day/youtube`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({url}),
                        });
                        const data = await resp.json();
                        this._hideProgress(300);
                        const id = this.addCell('code', `# YouTube Transcript\n# ${url}`);
                        this.displayOutput(id, {type:'text', data: (data.transcript || data.error || 'No transcript available').split('\\n')});
                    },
                    'chartgpu-dash': () => window.open('http://localhost:3444', '_blank'),
                    'chartgpu-metrics': () => this._fetchChartGPUMetrics(),
                    'jawta': async () => {
                        const text = prompt('Enter text for Jawta signal intel:');
                        if (!text) return;
                        const resp = await fetch(`${BRIDGE}/api/jawta/signal`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({text, mode: 'morse'}),
                        });
                        const data = await resp.json();
                        const id = this.addCell('code', '# Jawta Signal Intel — Spectrum Analysis');
                        this.displayOutput(id, {type:'text', data: [
                            `Morse: ${data.morse || '—'}`,
                            `Binary: ${(data.binary || '').slice(0, 200)}`,
                            `Spectrum points: ${(data.spectrum || []).length}`,
                            '',
                            ...(data.spectrum || []).slice(0, 20).map(s => `  [${s.index}] ${s.freq}Hz  amp:${s.amplitude}`),
                        ]});
                    },
                    'media': async () => {
                        const source = prompt('Enter source URL or text:');
                        if (!source) return;
                        this._showProgress('Processing media...');
                        const resp = await fetch(`${BRIDGE}/api/media/process`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({source, type: 'auto'}),
                        });
                        const data = await resp.json();
                        this._hideProgress(300);
                        const id = this.addCell('code', `# Media Pipeline — ${data.type || 'auto'}`);
                        const lines = [`Pipeline: ${data.type}`, `Source: ${data.source}`, `Stages: ${data.stage_count}`, ''];
                        (data.stages || []).forEach(s => {
                            lines.push(`--- ${s.name} ---`);
                            lines.push(JSON.stringify(s.result || s, null, 2));
                        });
                        this.displayOutput(id, {type:'text', data: lines});
                    },
                    'quest-status': () => this._checkQuestStatus(),
                    'quest-logs': async () => {
                        const resp = await fetch('http://localhost:8085/api/quest/logs');
                        const data = await resp.json();
                        const id = this.addCell('code', '# Quest Logcat');
                        this.displayOutput(id, {type:'text', data: JSON.stringify(data, null, 2).split('\\n')});
                    },
                    'quest-screenshot': async () => {
                        const resp = await fetch('http://localhost:8085/api/quest/screenshot');
                        const data = await resp.json();
                        const id = this.addCell('code', '# Quest Screenshot');
                        this.displayOutput(id, {type:'text', data: JSON.stringify(data, null, 2).split('\\n')});
                    },
                    'lark-status': async () => {
                        const resp = await fetch('http://localhost:8085/api/lark/status');
                        const data = await resp.json();
                        const id = this.addCell('code', '# Lark IANA Status');
                        this.displayOutput(id, {type:'text', data: [
                            `Available: ${data.available}`,
                            `Path: ${data.path}`,
                            `Version: ${data.version}`,
                            `Components: ${(data.components || []).join(', ')}`,
                            `Embed URL: ${data.embed_url || 'none'}`,
                        ]});
                    },
                };

                const handler = toolMap[toolId];
                if (handler) {
                    try { await handler(); }
                    catch(e) {
                        const id = this.addCell('code', `# Tool Error: ${toolId}`);
                        this.displayOutput(id, {type:'text', data: [
                            'Error: ' + e.message,
                            '',
                            'Make sure the quantum bridge server is running:',
                            '  cd /Users/tref/uvspeed && python3 quantum_bridge_server.py',
                        ]});
                    }
                }
            }

            /* ========== QUEST STATUS CHECK ========== */
            async _checkQuestStatus() {
                const el = document.getElementById('quest-status');
                try {
                    const resp = await fetch('http://localhost:8085/api/quest/status');
                    const data = await resp.json();
                    if (data.quest_connected) {
                        if (el) { el.textContent = '🥽 Quest: connected'; el.style.color = '#3fb950'; }
                        this._logStream('quest', `${data.adb_devices.length} device(s)`, 'data');
                    } else if (data.hub_online) {
                        if (el) { el.textContent = '🥽 Quest: hub only'; el.style.color = '#f0883e'; }
                    } else {
                        if (el) { el.textContent = '🥽 Quest: offline'; el.style.color = 'var(--cursor-text-muted)'; }
                    }
                    // Show details in a cell
                    const id = this.addCell('code', '# Quest Device Status');
                    this.displayOutput(id, {type:'text', data: [
                        `Hub Online: ${data.hub_online}`,
                        `Hub URL: ${data.hub_url}`,
                        `Quest Connected: ${data.quest_connected}`,
                        `ADB Devices: ${data.adb_devices?.length || 0}`,
                        ...(data.adb_devices || []).map(d => `  ${d.serial} — ${d.state}`),
                    ]});
                } catch(e) {
                    if (el) { el.textContent = '🥽 Quest: —'; el.style.color = 'var(--cursor-text-muted)'; }
                }
            }

            _pipeStreamOut() {
                const lines = this._streamHistory.map(e =>
                    `${e.ts} | ${e.type.padEnd(6)} | ${e.action.padEnd(20)} | ${e.detail}`
                );
                const header = `# Quantum Stream — ${this._streamHistory.length} entries\n# Position: [${this.quantumPosition.join(', ')}]\n# ${'─'.repeat(50)}\n`;
                const text = header + lines.join('\n');
                navigator.clipboard.writeText(text).then(() => {
                    this._logStream('exported', `${this._streamHistory.length} entries`, 'pipe');
                });
                return text;
            }

            _pipeStreamIn(source) {
                if (!source || !source.trim()) return;
                // Parse pasted source: show each line's quantum prefix classification
                const lines = source.split('\n');
                const lang = this._detectSourceLanguage(source);
                this._logStream(`source piped`, `${lines.length} lines (${lang})`, 'pipe');

                lines.forEach((line, i) => {
                    if (!line.trim()) return;
                    const { sym, category } = this.classifyLine(line, lang);
                    this._logStream(`${sym} L${i + 1}`, line.trim().substring(0, 40), 'pipe');
                });
            }

            _detectSourceLanguage(source) {
                // Quick detection for piped source
                if (/^\s*(import|from)\s.*\n.*def\s/m.test(source)) return 'python';
                if (/^\s*def\s|^\s*class\s.*:/m.test(source)) return 'python';
                if (/^\s*(const|let|var|function|=>)/m.test(source)) return 'javascript';
                if (/^\s*(fn\s|let\s+mut|impl\s)/m.test(source)) return 'rust';
                if (/^\s*(func\s|package\s)/m.test(source)) return 'go';
                if (/^\s*<(!DOCTYPE|html|div)/im.test(source)) return 'html';
                if (/^\s*(graph|flowchart|sequenceDiagram)/m.test(source)) return 'mermaid';
                return 'python';
            }

            /* ══════════════════════════════════════════════════════
               QUANTUM PREFIX CLASSIFIER (client-side, 9-symbol)
               Mirrors QuantumPrefixEngine from quantum_bridge_server.py
               ══════════════════════════════════════════════════════ */

            // Prefix definitions: category → { symbol, cssClass }
            static PREFIXES = {
                shebang:   { sym: 'n:',  cls: 'pfx-shebang' },
                comment:   { sym: '+1:', cls: 'pfx-comment' },
                import:    { sym: '-n:', cls: 'pfx-import' },
                class:     { sym: '+0:', cls: 'pfx-class' },
                function:  { sym: '0:',  cls: 'pfx-function' },
                error:     { sym: '-1:', cls: 'pfx-error' },
                condition: { sym: '+n:', cls: 'pfx-condition' },
                loop:      { sym: '+2:', cls: 'pfx-loop' },
                return:    { sym: '-0:', cls: 'pfx-return' },
                output:    { sym: '+3:', cls: 'pfx-output' },
                variable:  { sym: '1:',  cls: 'pfx-variable' },
                decorator: { sym: '+1:', cls: 'pfx-decorator' },
                default:   { sym: '   ', cls: 'pfx-default' },
            };

            // Language pattern rules (regex per category)
            static LANG_PATTERNS = {
                python: {
                    shebang:   /^#!.*python/,
                    comment:   /^\s*#/,
                    import:    /^\s*(import|from)\s/,
                    class:     /^\s*class\s/,
                    function:  /^\s*(def|async\s+def)\s/,
                    decorator: /^\s*@/,
                    error:     /^\s*(try|except|finally|raise)/,
                    condition: /^\s*(if|elif|else)\b/,
                    loop:      /^\s*(for|while)\s/,
                    return:    /^\s*(return|yield)\s/,
                    output:    /^\s*print\(/,
                    variable:  /^\s*\w+\s*=/,
                },
                javascript: {
                    shebang:   /^#!.*node/,
                    comment:   /^\s*(\/\/|\/\*|\*)/,
                    import:    /^\s*(import|require|const\s+.*=\s*require|export)/,
                    class:     /^\s*(class|interface)\s/,
                    function:  /^\s*(function|const\s+\w+\s*=\s*(\(|async)|=>)/,
                    error:     /^\s*(try|catch|finally|throw)\b/,
                    condition: /^\s*(if|else\s+if|else|switch|case)\b/,
                    loop:      /^\s*(for|while|do)\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*console\./,
                    variable:  /^\s*(const|let|var)\s/,
                },
                typescript: {
                    comment:   /^\s*(\/\/|\/\*|\*)/,
                    import:    /^\s*(import|require|from|export)/,
                    class:     /^\s*(class|interface|type|enum)\s/,
                    function:  /^\s*(function|const\s+\w+\s*[:=]|=>)/,
                    decorator: /^\s*@/,
                    error:     /^\s*(try|catch|finally|throw)\b/,
                    condition: /^\s*(if|else|switch|case)\b/,
                    loop:      /^\s*(for|while|do)\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*console\./,
                    variable:  /^\s*(const|let|var)\s/,
                },
                rust: {
                    comment:   /^\s*(\/\/|\/\*)/,
                    import:    /^\s*(use|extern\s+crate|mod)\s/,
                    class:     /^\s*(struct|enum|trait|impl)\s/,
                    function:  /^\s*(pub\s+)?(fn|async\s+fn)\s/,
                    decorator: /^\s*#\[/,
                    error:     /^\s*(panic!|unwrap|expect|Result|Err)/,
                    condition: /^\s*(if|else|match)\b/,
                    loop:      /^\s*(for|while|loop)\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*(println!|print!|eprintln!)/,
                    variable:  /^\s*(let|mut|const)\s/,
                },
                go: {
                    comment:   /^\s*\/\//,
                    import:    /^\s*(import|package)\s/,
                    class:     /^\s*type\s+\w+\s+(struct|interface)/,
                    function:  /^\s*func\s/,
                    error:     /^\s*(if\s+err|panic\(|log\.(Fatal|Panic))/,
                    condition: /^\s*(if|else|switch|case)\b/,
                    loop:      /^\s*for\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*fmt\./,
                    variable:  /^\s*(var|:=)\s/,
                },
                shell: {
                    shebang:   /^#!\/(bin|usr)\/(bash|sh|zsh)/,
                    comment:   /^\s*#/,
                    import:    /^\s*(source|\.)\s/,
                    function:  /^\s*(\w+\s*\(\)\s*\{|function\s+\w+)/,
                    error:     /^\s*(trap|set\s+-e)/,
                    condition: /^\s*(if|elif|else|fi|then)\b/,
                    loop:      /^\s*(for|while|until|do|done)\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*echo\s/,
                    variable:  /^\s*\w+=/,
                },
                html: {
                    comment:   /^\s*<!--/,
                    import:    /^\s*<(link|script|meta)/,
                    class:     /^\s*<(div|section|article|main|header|footer|nav)/,
                    function:  /^\s*<(form|button|input)/,
                    condition: /^\s*<(template|slot)/,
                    output:    /^\s*<(p|h[1-6]|span|a|li|td)/,
                },
                css: {
                    comment:   /^\s*\/\*/,
                    import:    /^\s*@(import|charset|font-face)/,
                    class:     /^\s*\./,
                    variable:  /^\s*--/,
                    condition: /^\s*@(media|supports|keyframes)/,
                },
                markdown: {
                    shebang:   /^---/,
                    comment:   /^\s*<!--/,
                    import:    /^\s*!\[/,
                    class:     /^\s*#{1,6}\s/,
                    function:  /^\s*```/,
                    condition: /^\s*>/,
                    loop:      /^\s*[-*+]\s/,
                    output:    /^\s*\|/,
                    variable:  /^\s*\[.*\]:/,
                },
                mermaid: {
                    comment:   /^\s*%%/,
                    class:     /^\s*(graph|subgraph|flowchart|sequenceDiagram|classDiagram|stateDiagram|gantt|pie|erDiagram|journey)/,
                    function:  /^\s*(style|click|class)\b/,
                    condition: /^\s*(end|direction)\b/,
                    output:    /-->/,
                    variable:  /^\s*\w+[\[\({"]/,
                },
                sql: {
                    comment:   /^\s*--/,
                    import:    /^\s*(USE|DATABASE)\b/i,
                    class:     /^\s*(CREATE|ALTER|DROP)\b/i,
                    function:  /^\s*(SELECT|INSERT|UPDATE|DELETE)\b/i,
                    condition: /^\s*(WHERE|CASE|WHEN|IF)\b/i,
                    loop:      /^\s*(JOIN|UNION|GROUP)\b/i,
                },
                yaml: {
                    comment:   /^\s*#/,
                    import:    /^\s*---/,
                    variable:  /^\s*\w+\s*:/,
                    class:     /^\s*-\s/,
                },
                json: {
                    class:     /^\s*\{/,
                    variable:  /^\s*"/,
                    loop:      /^\s*\[/,
                },
            };

            // Detect language from cell type and content heuristics
            detectCellLanguage(cell) {
                if (cell.type === 'markdown') return 'markdown';
                if (cell.type === 'mermaid') return 'mermaid';
                if (cell.type === 'visualization') return 'python';
                const c = cell.content || '';
                // Shebang detection
                if (/^#!.*python/.test(c)) return 'python';
                if (/^#!.*node/.test(c)) return 'javascript';
                if (/^#!\/(bin|usr)/.test(c)) return 'shell';
                // Keyword heuristics
                if (/^\s*(import|from)\s.*\n.*def\s/m.test(c)) return 'python';
                if (/^\s*def\s|^\s*class\s.*:/m.test(c)) return 'python';
                if (/^\s*(const|let|var|function|=>|require\(|import\s.*from)/m.test(c)) return 'javascript';
                if (/^\s*(fn\s|let\s+mut|impl\s|use\s+\w+::)/m.test(c)) return 'rust';
                if (/^\s*(func\s|package\s|fmt\.)/m.test(c)) return 'go';
                if (/^\s*(SELECT|CREATE|INSERT|ALTER)\b/im.test(c)) return 'sql';
                if (/^\s*<(!DOCTYPE|html|div|section)/im.test(c)) return 'html';
                if (/^\s*(@media|\.[\w-]+\s*\{)/m.test(c)) return 'css';
                if (/^\s*(graph|flowchart|sequenceDiagram|classDiagram)/m.test(c)) return 'mermaid';
                if (/^\s*---\s*\n/m.test(c) && /^\s*\w+:/m.test(c)) return 'yaml';
                if (/^\s*\{[\s]*"/.test(c)) return 'json';
                if (/^\s*#.*\n/m.test(c) && /^\s*(echo|export|source)\b/m.test(c)) return 'shell';
                // Default
                return cell.type === 'code' ? 'python' : 'markdown';
            }

            // Classify a single line → { sym, cls, category }
            classifyLine(line, language) {
                const patterns = QuantumNotebookWeb.LANG_PATTERNS[language]
                                || QuantumNotebookWeb.LANG_PATTERNS.python;
                for (const [category, regex] of Object.entries(patterns)) {
                    if (regex.test(line)) {
                        const pfx = QuantumNotebookWeb.PREFIXES[category]
                                   || QuantumNotebookWeb.PREFIXES.default;
                        return { ...pfx, category };
                    }
                }
                return { ...QuantumNotebookWeb.PREFIXES.default, category: 'default' };
            }

            // Debounced gutter update (100ms) to avoid thrashing on rapid typing
            _gutterTimers = {};
            debouncedUpdateGutter(cellId) {
                clearTimeout(this._gutterTimers[cellId]);
                this._gutterTimers[cellId] = setTimeout(() => this.updateGutter(cellId), 100);
            }

            // Update the quantum gutter for a cell
            updateGutter(cellId) {
                const cell = this.cells.find(c => c.id === cellId);
                const gutterEl = document.getElementById(`${cellId}-gutter`);
                if (!cell || !gutterEl) return;

                const language = this.detectCellLanguage(cell);
                const lines = (cell.content || '').split('\n');
                const prefixCounts = {};
                let classified = 0;

                let html = '';
                lines.forEach((line, i) => {
                    const { sym, cls, category } = this.classifyLine(line, language);
                    prefixCounts[category] = (prefixCounts[category] || 0) + 1;
                    if (category !== 'default') classified++;
                    html += `<div class="gutter-line"><span class="gutter-prefix ${cls}">${sym}</span><span class="gutter-num">${i + 1}</span></div>`;
                });

                gutterEl.innerHTML = html;

                // Update the convert timeline with aggregate stats
                this._updateConvertTimeline(lines.length, classified, language, prefixCounts);
            }

            // Sync gutter scroll with textarea scroll
            syncGutterScroll(cellId, textarea) {
                const gutterEl = document.getElementById(`${cellId}-gutter`);
                if (gutterEl) {
                    gutterEl.scrollTop = textarea.scrollTop;
                }
            }

            /* ══════════════════════════════════════════════════════
               CONVERT TIMELINE — auto-recalibrate on paste/edit
               ══════════════════════════════════════════════════════ */

            _updateConvertTimeline(totalLines, classifiedLines, language, prefixCounts) {
                const coverage = totalLines > 0 ? Math.round((classifiedLines / totalLines) * 100) : 0;

                const fill = document.getElementById('ctl-fill');
                const linesEl = document.getElementById('ctl-lines');
                const covEl = document.getElementById('ctl-coverage');
                const langEl = document.getElementById('ctl-lang');

                if (fill) fill.style.width = `${coverage}%`;
                if (linesEl) linesEl.innerHTML = `Lines: <b>${totalLines}</b>`;
                if (covEl) covEl.innerHTML = `Coverage: <b>${coverage}%</b>`;
                if (langEl) langEl.innerHTML = `Lang: <b>${language}</b>`;

                // Color the 9 segment bars proportionally
                const timeline = document.getElementById('convert-timeline');
                if (!timeline) return;
                const segOrder = ['shebang','comment','import','class','function','error','condition','variable','return'];
                const segs = timeline.querySelectorAll('.ctl-seg');
                const total = Object.values(prefixCounts).reduce((a, b) => a + b, 0) || 1;
                segs.forEach((seg, i) => {
                    const cat = segOrder[i];
                    const count = prefixCounts[cat] || 0;
                    const pct = (count / total) * 100;
                    const pfx = QuantumNotebookWeb.PREFIXES[cat] || QuantumNotebookWeb.PREFIXES.default;
                    if (pct > 0) {
                        seg.style.background = `var(--cursor-bg)`;
                        seg.style.borderBottom = `3px solid`;
                        seg.style.borderBottomColor = getComputedStyle(document.createElement('span')).color; // fallback
                        // Use a temp element to get the color from the CSS class
                        const tmp = document.createElement('span');
                        tmp.className = pfx.cls;
                        document.body.appendChild(tmp);
                        const clr = getComputedStyle(tmp).color;
                        document.body.removeChild(tmp);
                        seg.style.borderBottomColor = clr;
                        seg.style.opacity = Math.max(0.3, pct / 50);
                    } else {
                        seg.style.borderBottom = 'none';
                        seg.style.opacity = '0.15';
                    }
                    const label = seg.querySelector('.ctl-seg-label');
                    if (label && count > 0) {
                        label.textContent = `${pfx.sym} ${count}`;
                    }
                });
            }

            // Handle paste event — auto-prefix the pasted content
            handlePaste(cellId) {
                const cell = this.cells.find(c => c.id === cellId);
                if (!cell) return;

                // Refresh the cell content from the textarea
                const ta = document.querySelector(`#${cellId} .cell-textarea`);
                if (ta) {
                    cell.content = ta.value;
                }

                // Log paste to stream
                const lineCount = (cell.content || '').split('\n').length;
                this._logStream(`paste ${lineCount}L`, cellId.substring(0, 15), 'paste');

                // Animate the timeline converting
                const timeline = document.getElementById('convert-timeline');
                if (timeline) {
                    timeline.classList.add('converting');
                    setTimeout(() => timeline.classList.remove('converting'), 1500);
                }

                // Auto-detect language on paste
                const language = this.detectCellLanguage(cell);

                // Update gutter (which also updates the timeline)
                this.updateGutter(cellId);

                // If bridge is connected, also send for server-side prefix analysis
                if (this.wsConnected && this.ws) {
                    this.ws.send(JSON.stringify({
                        type: 'prefix',
                        code: cell.content,
                        language: language,
                    }));
                }
            }

            /* ---------- Undo / Redo ---------- */
            _pushUndo() {
                // Snapshot current state
                const snapshot = JSON.stringify(this.cells.map(c => ({
                    id: c.id, type: c.type, content: c.content,
                    quantumPosition: c.quantumPosition, executionCount: c.executionCount,
                })));
                // Don't push if identical to top
                if (this._undoStack.length > 0 && this._undoStack[this._undoStack.length - 1] === snapshot) return;
                this._undoStack.push(snapshot);
                if (this._undoStack.length > 50) this._undoStack.shift(); // cap at 50
                this._redoStack = []; // clear redo on new action
            }

            undo() {
                if (this._undoStack.length === 0) return;
                // Save current to redo
                const currentSnapshot = JSON.stringify(this.cells.map(c => ({
                    id: c.id, type: c.type, content: c.content,
                    quantumPosition: c.quantumPosition, executionCount: c.executionCount,
                })));
                this._redoStack.push(currentSnapshot);

                const prev = JSON.parse(this._undoStack.pop());
                prev.forEach(snap => {
                    const cell = this.cells.find(c => c.id === snap.id);
                    if (cell) {
                        cell.content = snap.content;
                        cell.type = snap.type;
                        const ta = document.querySelector(`#${cell.id} .cell-textarea`);
                        if (ta) { ta.value = cell.content; this.autoResize(ta); }
                        this.updateGutter(cell.id);
                    }
                });
                this._logStream('undo', `stack: ${this._undoStack.length}`, 'nav');
            }

            redo() {
                if (this._redoStack.length === 0) return;
                // Save current to undo
                const currentSnapshot = JSON.stringify(this.cells.map(c => ({
                    id: c.id, type: c.type, content: c.content,
                    quantumPosition: c.quantumPosition, executionCount: c.executionCount,
                })));
                this._undoStack.push(currentSnapshot);

                const next = JSON.parse(this._redoStack.pop());
                next.forEach(snap => {
                    const cell = this.cells.find(c => c.id === snap.id);
                    if (cell) {
                        cell.content = snap.content;
                        cell.type = snap.type;
                        const ta = document.querySelector(`#${cell.id} .cell-textarea`);
                        if (ta) { ta.value = cell.content; this.autoResize(ta); }
                        this.updateGutter(cell.id);
                    }
                });
                this._logStream('redo', `stack: ${this._redoStack.length}`, 'nav');
            }

            /* ---------- Cell Helpers ---------- */
            updateCell(cellId, content) {
                const cell = this.cells.find(c => c.id === cellId);
                if (cell) {
                    // Debounced undo snapshot (every 500ms of inactivity)
                    clearTimeout(this._undoDebounce);
                    this._undoDebounce = setTimeout(() => this._pushUndo(), 500);
                    cell.content = content;
                    if (this.autoSave) this.saveNotebook();
                }
            }

            focusCell(cellId) {
                this.currentCellId = cellId;
                document.querySelectorAll('.quantum-cell').forEach(c => c.classList.remove('focused'));
                const el = document.getElementById(cellId);
                if (el) el.classList.add('focused');
                // Refresh timeline for the focused cell
                this.updateGutter(cellId);
            }

            deleteCell(cellId) {
                if (this.cells.length <= 1) return; // keep at least one cell
                this.cells = this.cells.filter(c => c.id !== cellId);
                const el = document.getElementById(cellId);
                if (el) el.remove();
                if (this.currentCellId === cellId) this.currentCellId = null;
                this.updateCellList();
                this.updateStats();
            }

            /* ---------- Footer: AI Input ---------- */
            handleAiInput(text) {
                text = text.trim();
                if (!text) return;

                // If bridge is connected, send to AI endpoint
                if (this.wsConnected) {
                    const id = this.addCell('code', `# 🤖 AI Query: ${text}`);
                    const outputEl = document.getElementById(`${id}-output`);
                    if (outputEl) {
                        outputEl.style.display = 'block';
                        outputEl.innerHTML = '<div class="output-text" style="color:var(--cursor-accent);">⏳ Querying AI&hellip;</div>';
                    }
                    fetch(`${this.apiUrl}/api/ai`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: text }),
                    })
                    .then(r => r.json())
                    .then(msg => {
                        if (outputEl) {
                            const lines = [];
                            if (msg.text) lines.push(...msg.text.split('\n'));
                            if (msg.model) lines.push(`\n🤖 Model: ${msg.model}`);
                            if (msg.error) lines.push(`❌ ${msg.error}`);
                            if (lines.length === 0) lines.push('(no response)');
                            outputEl.innerHTML = lines.map(l => `<div class="output-text">${l}</div>`).join('');
                        }
                    })
                    .catch(() => {
                        if (outputEl) outputEl.innerHTML = '<div class="output-error">AI bridge unreachable</div>';
                    });
                    requestAnimationFrame(() => {
                        const el = document.querySelector(`#${id} .cell-textarea`);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                } else {
                    const id = this.addCell('code', `# 🤖 AI Query: ${text}\nprint("AI processing: ${text.replace(/"/g, '\\"')}")`);
                    requestAnimationFrame(() => {
                        const el = document.querySelector(`#${id} .cell-textarea`);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                    this.executeCell(id);
                }
            }

            /* ---------- Footer: Command Input ---------- */
            handleCommand(cmd) {
                cmd = cmd.trim();
                if (!cmd) return;

                const responses = {
                    'qstatus': () => {
                        // Run real benchmarks inline
                        const mathT0 = performance.now();
                        let s = 0; for (let i = 0; i < 100000; i++) s += Math.sqrt(i) * Math.sin(i);
                        const mathMs = performance.now() - mathT0;

                        const domT0 = performance.now();
                        const frag = document.createDocumentFragment();
                        for (let i = 0; i < 1000; i++) { const d = document.createElement('div'); d.textContent = 'x'; frag.appendChild(d); }
                        const domMs = performance.now() - domT0;

                        const jsonT0 = performance.now();
                        const obj = {}; for (let i = 0; i < 3000; i++) obj['k' + i] = { v: Math.random() };
                        JSON.parse(JSON.stringify(obj));
                        const jsonMs = performance.now() - jsonT0;

                        const canvasT0 = performance.now();
                        const tc = document.createElement('canvas'); tc.width = 100; tc.height = 100;
                        const ctx = tc.getContext('2d');
                        for (let i = 0; i < 2000; i++) { ctx.fillStyle = 'hsl(' + i + ',50%,50%)'; ctx.fillRect(Math.random()*100, Math.random()*100, 3, 3); }
                        const canvasMs = performance.now() - canvasT0;

                        const cores = navigator.hardwareConcurrency || '?';
                        const mem = navigator.deviceMemory || '?';
                        const conn = navigator.connection;
                        const netType = conn ? conn.effectiveType : 'unknown';
                        const downlink = conn ? conn.downlink + ' Mbps' : 'N/A';
                        const rtt = conn ? conn.rtt + ' ms' : 'N/A';

                        const nav = performance.getEntriesByType && performance.getEntriesByType('navigation')[0];
                        let netTrace = '';
                        if (nav) {
                            netTrace = `\n\n📡 NETWORK TRACE (page load)\n` +
                                `   DNS lookup:    ${(nav.domainLookupEnd - nav.domainLookupStart).toFixed(1)} ms\n` +
                                `   TCP connect:   ${(nav.connectEnd - nav.connectStart).toFixed(1)} ms\n` +
                                `   TLS handshake: ${(nav.connectEnd - (nav.secureConnectionStart || nav.connectStart)).toFixed(1)} ms\n` +
                                `   TTFB:          ${(nav.responseStart - nav.requestStart).toFixed(1)} ms\n` +
                                `   Download:      ${(nav.responseEnd - nav.responseStart).toFixed(1)} ms\n` +
                                `   DOM ready:     ${(nav.domContentLoadedEventEnd - nav.startTime).toFixed(0)} ms\n` +
                                `   Full load:     ${(nav.loadEventEnd - nav.startTime).toFixed(0)} ms`;
                        }

                        const gpu = (() => {
                            try {
                                const c = document.createElement('canvas');
                                const gl = c.getContext('webgl2') || c.getContext('webgl');
                                if (!gl) return 'N/A';
                                const ext = gl.getExtension('WEBGL_debug_renderer_info');
                                return ext ? gl.getParameter(ext.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
                            } catch(e) { return 'N/A'; }
                        })();

                        return `🌌 QUANTUM STATUS\n` +
                            `   Position:  [${this.quantumPosition.join(', ')}]\n` +
                            `   Layer:     ${this.quantumPosition[2]} (${this.quantumPosition[2] === 0 ? '∞ origin' : '✱ compute'})\n` +
                            `   Cells:     ${this.cells.length}\n` +
                            `   Executions:${this.executionCount}\n` +
                            `   Bridge:    ${this.wsConnected ? '🟢 Connected' : '🔴 Offline'}\n` +
                            `   Stream:    ${this._streamHistory.length} events\n` +
                            `   Undo stack:${this._undoStack.length} / Redo: ${this._redoStack.length}\n` +
                            `\n🖥️  HARDWARE\n` +
                            `   CPU cores:     ${cores}\n` +
                            `   Device memory: ${mem} GB\n` +
                            `   GPU:           ${gpu}\n` +
                            `   Platform:      ${navigator.platform}\n` +
                            `   User agent:    ${navigator.userAgent.substring(0, 80)}...\n` +
                            `\n⚡ CPU BENCHMARKS\n` +
                            `   Math (100K ops): ${mathMs.toFixed(1)} ms  (${(100000 / mathMs).toFixed(0)} ops/ms)\n` +
                            `   DOM (1K create):  ${domMs.toFixed(1)} ms  (${(1000 / domMs).toFixed(0)} creates/ms)\n` +
                            `   Canvas (2K rect): ${canvasMs.toFixed(1)} ms  (${(2000 / canvasMs).toFixed(0)} rects/ms)\n` +
                            `   JSON (3K ser):    ${jsonMs.toFixed(1)} ms  (${(3000 / jsonMs).toFixed(1)} obj/ms)\n` +
                            `\n🌐 NETWORK\n` +
                            `   Type:     ${netType}\n` +
                            `   Downlink: ${downlink}\n` +
                            `   RTT:      ${rtt}` +
                            netTrace +
                            `\n\n✅ UV-Speed Stack: Active`;
                    },
                    'help': () => '🌌 UV-Speed Quantum Terminal\n\nCommands:\n  qstatus — Show quantum state + benchmarks\n  pos — Current position\n  cells — List cells\n  uv [cmd] — UV package manager (real exec via bridge)\n  q [term] — Semantic search\n  ai [prompt] — AI inference\n  bridge — Show bridge status\n  scan — Security scan all cells\n  hook — Install quantum pre-commit hook\n  save — Save to localStorage\n  load — Load .json notebook\n  help — This message',
                    'scan': () => { this._runSecurityScan(); return '🛡 Security scan starting...'; },
                    'hook': () => { this._installGitHook(); return '🪝 Installing quantum pre-commit hook...'; },
                    'pos': () => `📍 Position: [${this.quantumPosition.join(', ')}]\n   X=${this.quantumPosition[0]} (deps)  Y=${this.quantumPosition[1]} (lines)  Z=${this.quantumPosition[2]} (complexity)`,
                    'cells': () => this.cells.map((c, i) => `  [${i}] ${c.type} — ${c.content.split('\\n')[0].slice(0, 40)}`).join('\n'),
                    'bridge': () => `🔌 Bridge Status: ${this.wsConnected ? '🟢 Connected' : '🔴 Offline'}\n   HTTP: ${this.apiUrl}\n   WS: ${this.bridgeUrl}`,
                    'save': () => { this._saveToLocalStorage(); return '💾 Saved to localStorage'; },
                    'load': () => { this.loadNotebook(); return '📂 Opening file picker...'; },
                    'kbatch': () => { this._runTool('kbatch'); return '⌨ Launching kbatch analysis...'; },
                    'signal': () => { this._runTool('signal'); return '📡 Launching signal analysis...'; },
                    'geokey': () => { this._runTool('geokey'); return '🔷 Launching GeoKey mapper...'; },
                    'youtube': () => { this._runTool('youtube'); return '🎬 Launching YouTube transcript...'; },
                    'chartgpu': () => { this._fetchChartGPUMetrics(); return '📊 Fetching ChartGPU metrics...'; },
                    'quest': () => { this._checkQuestStatus(); return '🥽 Checking Quest status...'; },
                    'jawta': () => { this._runTool('jawta'); return '📡 Launching Jawta signal intel...'; },
                    'media': () => { this._runTool('media'); return '🎞 Launching media pipeline...'; },
                    'lark': () => { this._runTool('lark-status'); return '🐦 Checking Lark status...'; },
                    'tools': () => {
                        return '🔧 Available tools:\n  kbatch   — keyboard analysis\n  signal   — Morse/binary/waveform\n  geokey   — geometric keyboard mapper\n  youtube  — transcript extraction\n  chartgpu — GPU metrics + AI analysis\n  quest    — Meta Quest device status\n  jawta    — signal intel + spectrum\n  media    — audio/video pipeline\n  lark     — Lark IANA status';
                    },
                };

                const showOutput = (output) => {
                    const id = this.addCell('code', `# Terminal: ${cmd}`);
                    const cell = this.cells.find(c => c.id === id);
                    if (cell) cell.executionCount = ++this.executionCount;
                    const outputEl = document.getElementById(`${id}-output`);
                    if (outputEl) {
                        outputEl.style.display = 'block';
                        outputEl.innerHTML = output.split('\n').map(l => `<div class="output-text">${l}</div>`).join('');
                    }
                    this.updateStats();
                    this.updateCellList();
                    requestAnimationFrame(() => {
                        const el = document.getElementById(id);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                };

                if (responses[cmd]) {
                    // Show progress for qstatus (benchmarks take a moment)
                    if (cmd === 'qstatus') {
                        this._showProgress('📊 Benchmarking');
                        this._updateProgress(1, 4, 'running CPU tests...');
                    }
                    const result = responses[cmd]();
                    if (cmd === 'qstatus') this._hideProgress(800);
                    showOutput(result);
                } else if (cmd.startsWith('uv ')) {
                    // Execute via bridge shell mode
                    if (this.wsConnected) {
                        this._showProgress('🚀 ' + cmd);
                        this._updateProgress(1, 3, 'sending to bridge...');
                        const id = this.addCell('code', `# Terminal: ${cmd}`);
                        const outputEl = document.getElementById(`${id}-output`);
                        if (outputEl) {
                            outputEl.style.display = 'block';
                            outputEl.innerHTML = '<div class="output-text" style="color:var(--cursor-accent);">⏳ Executing via uv&hellip;</div>';
                        }
                        this._updateProgress(2, 3, 'awaiting response...');
                        fetch(`${this.apiUrl}/api/execute`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ code: cmd, mode: 'shell' }),
                        })
                        .then(r => r.json())
                        .then(msg => {
                            const lines = [];
                            if (msg.stdout) lines.push(...msg.stdout.split('\n').filter(l => l));
                            if (msg.stderr) lines.push(`⚠ ${msg.stderr}`);
                            if (msg.error) lines.push(`❌ ${msg.error}`);
                            if (lines.length === 0) lines.push('✅ Command completed');
                            lines.push(`⏱ ${msg.elapsed_ms || 0} ms`);
                            if (outputEl) outputEl.innerHTML = lines.map(l => `<div class="output-text">${l}</div>`).join('');
                            this._hideProgress(1000);
                        })
                        .catch(() => { if (outputEl) outputEl.innerHTML = '<div class="output-error">Bridge unreachable</div>'; this._hideProgress(500); });
                    } else {
                        showOutput(`🚀 UV executing: ${cmd.slice(3)}\n   💡 Start bridge: python3 quantum_bridge_server.py`);
                    }
                } else if (cmd.startsWith('ai ')) {
                    this.handleAiInput(cmd.slice(3));
                } else if (cmd.startsWith('q ')) {
                    showOutput(`🔍 Semantic search: "${cmd.slice(2)}"\n   (GrepAI integration coming in Phase 3)`);
                } else {
                    // Try executing as a shell command via bridge
                    if (this.wsConnected) {
                        this._showProgress('⚡ ' + cmd.substring(0, 30));
                        this._updateProgress(1, 2, 'executing...');
                        const id = this.addCell('code', `# Terminal: ${cmd}`);
                        const outputEl = document.getElementById(`${id}-output`);
                        if (outputEl) {
                            outputEl.style.display = 'block';
                            outputEl.innerHTML = '<div class="output-text" style="color:var(--cursor-accent);">⏳ Executing&hellip;</div>';
                        }
                        fetch(`${this.apiUrl}/api/execute`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ code: cmd, mode: 'shell' }),
                        })
                        .then(r => r.json())
                        .then(msg => {
                            const lines = [];
                            if (msg.stdout) lines.push(...msg.stdout.split('\n').filter(l => l));
                            if (msg.stderr) lines.push(`⚠ ${msg.stderr}`);
                            if (msg.error) lines.push(`❌ ${msg.error}`);
                            if (lines.length === 0) lines.push(`✅ Exit ${msg.returncode || 0}`);
                            if (outputEl) outputEl.innerHTML = lines.map(l => `<div class="output-text">${l}</div>`).join('');
                            this._hideProgress(1000);
                        })
                        .catch(() => { if (outputEl) outputEl.innerHTML = '<div class="output-error">Bridge unreachable</div>'; this._hideProgress(500); });
                    } else {
                        showOutput(`⚡ Command: ${cmd}\n   Processed at [${this.quantumPosition.join(', ')}]\n   💡 Start bridge for real execution: python3 quantum_bridge_server.py`);
                    }
                }
            }

            /* ---------- Cell Output Overlay ---------- */
            expandCellOutput(cellId) {
                const cell = this.cells.find(c => c.id === cellId);
                if (!cell) return;

                const overlay = document.getElementById('cell-overlay');
                const title = document.getElementById('cell-overlay-title');
                const body = document.getElementById('cell-overlay-body');
                const typeEmoji = { code: '⚡', markdown: '📝', visualization: '📊', quantum: '🌌', mermaid: '🧜' };

                title.innerHTML = `${typeEmoji[cell.type] || '⚡'} ${cell.type} — [${cell.quantumPosition.join(', ')}]`;

                // Source code block
                const sourceHtml = `<details style="margin-bottom:var(--cursor-space-md);">
                    <summary style="cursor:pointer;font-size:0.75rem;color:var(--cursor-text-muted);font-weight:600;padding:6px 0;">📄 Source Code</summary>
                    <div style="padding:var(--cursor-space-sm) var(--cursor-space-md);background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);white-space:pre-wrap;color:var(--cursor-text-secondary);font-size:0.8125rem;font-family:var(--cursor-font-mono);max-height:200px;overflow:auto;">${cell.content.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
                </details>`;

                // Clone existing output or generate fresh
                const existingOutput = document.getElementById(`${cellId}-output`);
                let outputHtml = '';

                if (cell.type === 'visualization') {
                    // Re-run visualization at full overlay size
                    const vizResult = this._runVisualizationCell(cell);
                    body.innerHTML = sourceHtml + `<div class="output-html">${vizResult}</div>`;
                    overlay.classList.add('open');
                    requestAnimationFrame(() => {
                        body.querySelectorAll('script').forEach(oldScript => {
                            const newScript = document.createElement('script');
                            newScript.textContent = oldScript.textContent;
                            oldScript.replaceWith(newScript);
                        });
                    });
                    return;
                } else if (cell.type === 'mermaid') {
                    // Mermaid: re-render at full size with pan/drag/zoom
                    const mermaidId = `overlay_mermaid_${cellId}_${Date.now()}`;
                    const canvasId = `mermaid_canvas_${Date.now()}`;
                    outputHtml = `
                        <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;align-items:center;">
                            <button class="btn btn--sm" id="${canvasId}_zin" title="Zoom in">🔍+</button>
                            <button class="btn btn--sm" id="${canvasId}_zreset" title="Reset zoom &amp; pan">1:1</button>
                            <button class="btn btn--sm" id="${canvasId}_zout" title="Zoom out">🔍-</button>
                            <button class="btn btn--sm" id="${canvasId}_fit" title="Fit to view">⊞ Fit</button>
                            <button class="btn btn--sm" onclick="const svg=document.querySelector('#${canvasId} svg');if(svg){const b=new Blob([svg.outerHTML],{type:'image/svg+xml'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='mermaid-diagram.svg';a.click();}" title="Download SVG">💾 SVG</button>
                            <span style="margin-left:auto;font-size:0.625rem;color:var(--cursor-text-muted);" id="${canvasId}_info">Drag to pan · Scroll to zoom</span>
                        </div>
                        <div id="${canvasId}" style="overflow:hidden;max-height:70vh;border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);background:var(--cursor-bg-tertiary);cursor:grab;position:relative;">
                            <div id="${canvasId}_inner" style="transform-origin:0 0;transition:none;padding:var(--cursor-space-md);">
                                <div class="mermaid" id="${mermaidId}">${cell.content}</div>
                            </div>
                        </div>`;

                    body.innerHTML = sourceHtml + outputHtml;

                    // Render mermaid then wire up pan/zoom
                    requestAnimationFrame(() => {
                        try {
                            if (window.mermaid) {
                                window.mermaid.run({ nodes: [document.getElementById(mermaidId)] });
                            }
                        } catch (e) {
                            document.getElementById(mermaidId).innerHTML = '<div class="output-error">Mermaid render error: ' + e.message + '</div>';
                        }

                        // Pan/zoom state
                        const container = document.getElementById(canvasId);
                        const inner = document.getElementById(canvasId + '_inner');
                        const info = document.getElementById(canvasId + '_info');
                        if (!container || !inner) return;

                        let scale = 1, panX = 0, panY = 0, dragging = false, startX = 0, startY = 0;

                        function applyTransform() {
                            inner.style.transform = 'translate(' + panX + 'px,' + panY + 'px) scale(' + scale + ')';
                            if (info) info.textContent = Math.round(scale * 100) + '% · [' + Math.round(panX) + ', ' + Math.round(panY) + ']';
                        }

                        // Mouse drag to pan
                        container.addEventListener('mousedown', function(e) {
                            dragging = true; startX = e.clientX - panX; startY = e.clientY - panY;
                            container.style.cursor = 'grabbing';
                            e.preventDefault();
                        });
                        document.addEventListener('mousemove', function(e) {
                            if (!dragging) return;
                            panX = e.clientX - startX; panY = e.clientY - startY;
                            applyTransform();
                        });
                        document.addEventListener('mouseup', function() {
                            dragging = false; container.style.cursor = 'grab';
                        });

                        // Scroll to zoom
                        container.addEventListener('wheel', function(e) {
                            e.preventDefault();
                            const delta = e.deltaY > 0 ? 0.9 : 1.1;
                            const rect = container.getBoundingClientRect();
                            const mx = e.clientX - rect.left, my = e.clientY - rect.top;
                            const newScale = Math.min(5, Math.max(0.2, scale * delta));
                            panX = mx - (mx - panX) * (newScale / scale);
                            panY = my - (my - panY) * (newScale / scale);
                            scale = newScale;
                            applyTransform();
                        }, { passive: false });

                        // Touch drag
                        container.addEventListener('touchstart', function(e) {
                            if (e.touches.length === 1) {
                                dragging = true; startX = e.touches[0].clientX - panX; startY = e.touches[0].clientY - panY;
                            }
                        }, { passive: true });
                        container.addEventListener('touchmove', function(e) {
                            if (!dragging || e.touches.length !== 1) return;
                            panX = e.touches[0].clientX - startX; panY = e.touches[0].clientY - startY;
                            applyTransform();
                        }, { passive: true });
                        container.addEventListener('touchend', function() { dragging = false; });

                        // Zoom buttons
                        document.getElementById(canvasId + '_zin').addEventListener('click', function() {
                            scale = Math.min(5, scale * 1.3); applyTransform();
                        });
                        document.getElementById(canvasId + '_zout').addEventListener('click', function() {
                            scale = Math.max(0.2, scale * 0.7); applyTransform();
                        });
                        document.getElementById(canvasId + '_zreset').addEventListener('click', function() {
                            scale = 1; panX = 0; panY = 0; applyTransform();
                        });
                        document.getElementById(canvasId + '_fit').addEventListener('click', function() {
                            const svg = inner.querySelector('svg');
                            if (!svg) return;
                            const cr = container.getBoundingClientRect();
                            const sr = svg.getBoundingClientRect();
                            const fitScale = Math.min(cr.width / (sr.width / scale), cr.height / (sr.height / scale)) * 0.9;
                            scale = fitScale; panX = 0; panY = 0; applyTransform();
                        });
                    });
                } else if (existingOutput && existingOutput.innerHTML && existingOutput.style.display !== 'none') {
                    outputHtml = existingOutput.innerHTML;
                    body.innerHTML = sourceHtml + `<div style="border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);background:var(--cursor-bg-tertiary);max-height:70vh;overflow:auto;">${outputHtml}</div>`;
                } else {
                    const result = this._localExecution(cell);
                    if (result.type === 'text') {
                        outputHtml = result.data.map(l => `<div class="output-text">${l}</div>`).join('');
                    } else if (result.type === 'html') {
                        outputHtml = `<div class="output-html">${result.data}</div>`;
                    }
                    body.innerHTML = sourceHtml + outputHtml;
                }

                overlay.classList.add('open');

                // Activate any <script> tags in the overlay body
                requestAnimationFrame(() => {
                    body.querySelectorAll('script').forEach(oldScript => {
                        const newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        oldScript.replaceWith(newScript);
                    });
                });
            }

            /* ---------- Execution Progress ---------- */
            _showProgress(label = '▶ Running') {
                const bar = document.getElementById('exec-progress');
                document.getElementById('exec-progress-label').textContent = label;
                document.getElementById('exec-progress-fill').style.width = '0%';
                document.getElementById('exec-progress-pct').textContent = '0%';
                document.getElementById('exec-progress-detail').textContent = '';
                document.getElementById('exec-progress-elapsed').textContent = '';
                bar.classList.add('active');
                this._progressStart = performance.now();
            }

            _updateProgress(current, total, detail = '') {
                const pct = Math.round((current / total) * 100);
                document.getElementById('exec-progress-fill').style.width = pct + '%';
                document.getElementById('exec-progress-pct').textContent = pct + '%';
                document.getElementById('exec-progress-detail').textContent = detail;
                const elapsed = ((performance.now() - (this._progressStart || 0)) / 1000).toFixed(1);
                document.getElementById('exec-progress-elapsed').textContent = elapsed + 's';
            }

            _hideProgress(delay = 1500) {
                const fill = document.getElementById('exec-progress-fill');
                const label = document.getElementById('exec-progress-label');
                const pct = document.getElementById('exec-progress-pct');
                fill.style.width = '100%';
                pct.textContent = '100%';
                label.textContent = '✓ Done';
                const elapsed = ((performance.now() - (this._progressStart || 0)) / 1000).toFixed(1);
                document.getElementById('exec-progress-elapsed').textContent = elapsed + 's';
                setTimeout(() => {
                    document.getElementById('exec-progress').classList.remove('active');
                }, delay);
            }

            async runAllCells() {
                const total = this.cells.length;
                if (total === 0) return;

                this._showProgress(`▶ Run All (${total})`);

                for (let i = 0; i < total; i++) {
                    const cell = this.cells[i];
                    const shortName = cell.type + ' ' + (cell.content || '').split('\n')[0].substring(0, 25);
                    this._updateProgress(i, total, shortName);

                    // Execute and wait a tick so the UI updates
                    this.executeCell(cell.id);
                    await new Promise(r => setTimeout(r, 60));
                }

                this._updateProgress(total, total, 'all cells complete');
                this._hideProgress(2000);
            }

            saveNotebook() {
                const nb = {
                    cells: this.cells,
                    quantumPosition: this.quantumPosition,
                    executionCount: this.executionCount,
                    metadata: { created: new Date().toISOString(), type: 'uvspeed-quantum-notepad' }
                };

                // Always save to localStorage
                this._saveToLocalStorage();

                // Also save to bridge server if connected
                if (this.wsConnected) {
                    fetch(`${this.apiUrl}/api/sessions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...nb, id: 'current' }),
                    }).catch(() => {});
                }

                // Download as file
                const blob = new Blob([JSON.stringify(nb, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `quantum-notebook-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            /* ---------- Sidebar: Cell List ---------- */
            updateCellList() {
                const typeEmoji = { code: '⚡', markdown: '📝', visualization: '📊', quantum: '🌌', mermaid: '🧜' };
                const cellList = document.getElementById('cell-list');
                cellList.innerHTML = this.cells.map((cell, i) => {
                    const emoji = typeEmoji[cell.type] || '⚡';
                    const exec = cell.executionCount ? `[${cell.executionCount}]` : '';
                    const preview = cell.content
                        ? cell.content.split('\n')[0].slice(0, 28)
                        : '(empty)';
                    const isActive = cell.id === this.currentCellId ? ' active' : '';
                    return `<li class="cell-list-item${isActive}" onclick="document.getElementById('${cell.id}').scrollIntoView({behavior:'smooth',block:'center'})">
                        <span class="cell-list-icon">${emoji}</span>
                        <span style="flex:1;overflow:hidden;text-overflow:ellipsis">${preview}</span>
                        <span style="opacity:0.5;flex-shrink:0">${exec}</span>
                    </li>`;
                }).join('');
            }

            /* ---------- Stats ---------- */
            updateStats() {
                document.getElementById('cells-loaded').textContent = this.cells.length;
                document.getElementById('execution-time').textContent = `${this._lastExecMs} ms`;
            }

            /* ---------- Infinite Scroll ---------- */
            handleInfiniteScroll() {
                const container = document.getElementById('cells-container');
                const scrollPosition = container.scrollTop + container.clientHeight;
                const totalHeight = container.scrollHeight;

                if (scrollPosition > totalHeight - 200) {
                    // Could add virtual cells or load more content
                }
            }

            /* ---------- Performance Mode ---------- */
            updatePerformanceMode() {
                const container = document.querySelector('.notepad-container');
                container.classList.toggle('performance-mode', this.performanceMode);
            }

            /* ---------- Auto-resize Textarea ---------- */
            autoResize(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = Math.max(textarea.scrollHeight, 60) + 'px';
            }

            /* ---------- UI Sync ---------- */
            updateUI() {
                this.updateQuantumPosition();
                this.updateCellList();
                this.updateStats();
                this.updatePerformanceMode();
            }

            /* ---------- Performance Monitoring ---------- */
            startPerformanceMonitoring() {
                const update = () => {
                    if (performance.memory) {
                        const mb = (performance.memory.usedJSHeapSize / 1048576).toFixed(1);
                        document.getElementById('memory-usage').textContent = `~${mb} MB`;
                    } else {
                        const est = (this.cells.length * 0.3 + 0.8).toFixed(1);
                        document.getElementById('memory-usage').textContent = `~${est} MB`;
                    }
                };
                update();
                setInterval(update, 5000);
            }
        }

        // Initialize
        let notebook;
        try {
            notebook = new QuantumNotebookWeb();
            window.notebook = notebook;
        } catch (e) {
            console.error('QuantumNotebook init failed:', e);
            document.getElementById('cells-container').innerHTML =
                '<div style="padding:2rem;color:#f85149;font-family:monospace;">' +
                '<h3>⚠ Initialization Error</h3><pre>' + e.message + '</pre>' +
                '<p style="color:#8b949e;">Try refreshing the page. If this persists, open locally: <code>open web/quantum-notepad.html</code></p></div>';
        }

        // --- Inspect panel toggle ---
        (() => {
            const overlay   = document.getElementById('inspect-overlay');
            const backdrop  = document.getElementById('inspect-backdrop');
            const closeBtn  = document.getElementById('inspect-close');
            const openBtn   = document.getElementById('inspect-btn');

            const open  = () => {
                overlay.classList.add('open');
                const tsEl = document.getElementById('inspect-unix-ts');
                if (tsEl) {
                    const now = Math.floor(Date.now() / 1000);
                    tsEl.textContent = now;
                    tsEl.title = new Date(now * 1000).toISOString();
                }
            };
            const close = () => overlay.classList.remove('open');

            openBtn.addEventListener('click', open);
            closeBtn.addEventListener('click', close);
            backdrop.addEventListener('click', close);

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('open')) {
                    close();
                }
            });
        })();

        // --- Cell output overlay toggle ---
        (() => {
            const overlay  = document.getElementById('cell-overlay');
            const backdrop = document.getElementById('cell-overlay-backdrop');
            const closeBtn = document.getElementById('cell-overlay-close');

            const close = () => overlay.classList.remove('open');

            closeBtn.addEventListener('click', close);
            backdrop.addEventListener('click', close);

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('open')) {
                    close();
                }
            });
        })();
    </script>
</body>
</html>
