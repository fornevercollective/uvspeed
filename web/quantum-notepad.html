<!-- beyondBINARY quantum-prefixed | uvspeed | {+1, 1, -1, +0, 0, -0, +n, n, -n} -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uvspeed - Quantum beyondBINARY notepad</title>
    <link rel="icon" type="image/png" sizes="32x32" href="../icons/favicon.png">
    <link rel="icon" type="image/x-icon" href="../icons/favicon.ico">
    <link rel="apple-touch-icon" sizes="192x192" href="../icons/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&display=swap">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d1117">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
    <script src="quantum-prefixes.js"></script>
    <style>
        /* ===== Inlined Design System (cursor-theme.css) ===== */
        :root {
            --cursor-bg: var(--qp-bg, #0d1117);
            --cursor-bg-secondary: var(--qp-bg-secondary, #161b22);
            --cursor-bg-tertiary: var(--qp-bg-tertiary, #21262d);
            --cursor-bg-hover: var(--qp-bg-hover, #292e36);
            --cursor-text: var(--qp-text, #e6edf3);
            --cursor-text-secondary: var(--qp-text-secondary, #c9d1d9);
            --cursor-text-muted: var(--qp-text-muted, #8b949e);
            --cursor-accent: var(--qp-accent, #58a6ff);
            --cursor-accent-hover: #79c0ff;
            --cursor-accent-subtle: var(--qp-accent-subtle, rgba(56,139,253,0.15));
            --cursor-border: var(--qp-border, #30363d);
            --cursor-border-muted: var(--qp-border-muted, #21262d);
            --cursor-success: #3fb950;
            --cursor-warning: #d29922;
            --cursor-danger: #f85149;
            --cursor-font-sans: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --cursor-font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            --cursor-space-xs: 0.25rem;
            --cursor-space-sm: 0.5rem;
            --cursor-space-md: 1rem;
            --cursor-space-lg: 1.5rem;
            --cursor-space-xl: 2rem;
            --cursor-space-2xl: 3rem;
            --cursor-radius-sm: 4px;
            --cursor-radius-md: 6px;
            --cursor-radius-lg: 8px;
            --cursor-radius-xl: 12px;
            --cursor-shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --cursor-shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4);
            --cursor-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4);
            --cursor-shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.5);
            color-scheme: dark;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--cursor-font-sans);
            background: var(--cursor-bg);
            color: var(--cursor-text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .btn {
            display: inline-flex; align-items: center; gap: var(--cursor-space-sm);
            padding: var(--cursor-space-sm) var(--cursor-space-md);
            border: 1px solid var(--cursor-border); border-radius: var(--cursor-radius-md);
            background: var(--cursor-bg-secondary); color: var(--cursor-text);
            font-size: 0.875rem; font-weight: 500; cursor: pointer;
            transition: all 0.15s ease; white-space: nowrap; text-decoration: none;
        }
        .btn:hover { background: var(--cursor-bg-hover); border-color: var(--cursor-border); color: var(--cursor-text); }
        .btn:focus { outline: 2px solid var(--cursor-accent); outline-offset: 2px; }
        .btn--primary { background: var(--cursor-accent); border-color: var(--cursor-accent); color: #fff; }
        .btn--primary:hover { background: var(--cursor-accent-hover); border-color: var(--cursor-accent-hover); color: #fff; }
        .btn--sm { padding: calc(var(--cursor-space-sm) * 0.75) var(--cursor-space-sm); font-size: 0.8125rem; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--cursor-bg); }
        ::-webkit-scrollbar-thumb { background: var(--cursor-border); border-radius: var(--cursor-radius-sm); }
        ::-webkit-scrollbar-thumb:hover { background: var(--cursor-bg-hover); }

        /* ===== Layout Shell ===== */
        .notepad-container {
            height: 100vh;
            background: var(--cursor-bg);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ===== Header ===== */
        .notepad-header {
            background: var(--cursor-bg-secondary);
            border-bottom: 1px solid var(--cursor-border);
            padding: var(--cursor-space-sm) var(--cursor-space-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--cursor-space-md);
            flex-shrink: 0;
            min-height: 52px;
            flex-wrap: wrap;
        }

        .notepad-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--cursor-text);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
            white-space: nowrap;
            min-width: 0;
        }

        .notepad-logo {
            height: 28px;
            width: auto;
            border-radius: 4px;
            display: none; /* replaced by live Numsy */
        }
        /* ---- Numsy inline logo (header companion) ---- */
        #numsy-logo {
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
            margin-right: 6px;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
        }
        .numsy-logo-body{position:relative;width:40px;height:28px;display:inline-block}
        .numsy-logo-cat{width:40px;height:28px;position:relative;display:block}
        .numsy-logo-rainbow{position:absolute;left:-18px;top:3px;width:18px;height:22px;display:flex;flex-direction:column;overflow:hidden;border-radius:2px 0 0 2px}
        .nls{flex:1;transition:width .3s}
        .numsy-logo-torso{position:absolute;left:0;top:3px;width:24px;height:20px;background:#f97583;border-radius:3px;border:1.5px solid #484f58}
        .numsy-logo-torso::before{content:'';position:absolute;inset:2px;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.1) 2px,rgba(0,0,0,.1) 4px)}
        .numsy-logo-head{position:absolute;left:18px;top:0;width:20px;height:20px;background:#8b949e;border-radius:3px;border:1.5px solid #484f58;z-index:2}
        .nle-l,.nle-r{position:absolute;width:0;height:0;top:-4px;border-left:3px solid transparent;border-right:3px solid transparent;border-bottom:5px solid #8b949e}
        .nle-l{left:1px}.nle-r{right:1px}
        .nle-l::after,.nle-r::after{content:'';position:absolute;top:2px;left:-2px;width:0;height:0;border-left:2px solid transparent;border-right:2px solid transparent;border-bottom:3px solid #f97583}
        .numsy-logo-eyes{position:absolute;top:5px;left:3px;display:flex;gap:4px}
        .numsy-logo-eye{width:4px;height:4px;background:#e6edf3;border-radius:50%;position:relative}
        .numsy-logo-eye::after{content:'';position:absolute;width:2px;height:2px;background:#0d1117;border-radius:50%;top:1px;left:1px;transition:all .2s}
        .numsy-logo-mouth{position:absolute;bottom:2px;left:50%;transform:translateX(-50%);font-size:5px;line-height:1;color:#f97583}
        .numsy-logo-feet{position:absolute;bottom:-3px;left:3px;display:flex;gap:5px}
        .nlf{width:5px;height:4px;background:#8b949e;border-radius:0 0 2px 2px;border:1px solid #484f58;border-top:none}
        .numsy-logo-tail{position:absolute;left:-5px;top:6px;width:7px;height:3px;background:#8b949e;border-radius:2px 0 0 2px;transform-origin:right center}
        .numsy-logo-bubble{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#161b22;border:1px solid #30363d;border-radius:6px;padding:2px 6px;font-size:.5rem;color:#e6edf3;white-space:nowrap;opacity:0;transition:opacity .3s;pointer-events:none;font-family:'SF Mono',monospace;box-shadow:0 2px 6px rgba(0,0,0,.3);margin-bottom:4px;z-index:99999}
        .numsy-logo-bubble::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:3px solid transparent;border-top-color:#30363d}
        .numsy-logo-bubble.show{opacity:1}
        /* Logo numsy states */
        .numsy-logo-body.idle .numsy-logo-torso{animation:nl-float 3s ease-in-out infinite}
        .numsy-logo-body.thinking .numsy-logo-torso{animation:nl-wobble 0.4s ease-in-out infinite}
        .numsy-logo-body.happy .nls{animation:nl-rainbow .5s ease infinite}
        .numsy-logo-body.dance .numsy-logo-cat{animation:nl-dance 0.3s ease infinite}
        .numsy-logo-body.wiggle .numsy-logo-cat{animation:nl-wiggle 0.5s ease infinite}
        .numsy-logo-body.fly .numsy-logo-cat{animation:nl-fly 1s ease infinite}
        .numsy-logo-body.fly .nls{animation:nl-rainbow .3s ease infinite}
        .numsy-logo-body.sleepy{filter:brightness(.6) saturate(.5)}
        @keyframes nl-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}
        @keyframes nl-wobble{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}
        @keyframes nl-rainbow{0%,100%{opacity:1}50%{opacity:.6}}
        @keyframes nl-dance{0%{transform:rotate(0) scale(1)}25%{transform:rotate(-3deg) scale(1.05)}50%{transform:rotate(0) scale(1)}75%{transform:rotate(3deg) scale(1.05)}}
        @keyframes nl-wiggle{0%{transform:translateX(0)}25%{transform:translateX(-2px)}50%{transform:translateX(2px)}75%{transform:translateX(-1px)}100%{transform:translateX(0)}}
        @keyframes nl-fly{0%{transform:translateY(0) rotate(0)}25%{transform:translateY(-4px) rotate(-2deg)}50%{transform:translateY(-1px) rotate(0)}75%{transform:translateY(-5px) rotate(2deg)}100%{transform:translateY(0) rotate(0)}}
            flex-shrink: 0;
            image-rendering: auto;
            filter: drop-shadow(0 0 6px rgba(139, 92, 246, 0.4));
        }

        .notepad-title .subtitle {
            font-size: 0.8125rem;
            font-weight: 400;
            color: var(--cursor-text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .quantum-status {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
            font-size: 0.875rem;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .quantum-status .status-badges {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
        }

        .quantum-status .header-actions {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
        }

        /* ===== Main Content Split ===== */
        .notepad-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            min-height: 0;
        }

        /* ===== Cells Area ===== */
        .cells-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--cursor-space-lg);
            scroll-behavior: smooth;
            min-width: 0;
        }

        /* ===== Cell Card ===== */
        .quantum-cell {
            margin-bottom: var(--cursor-space-lg);
            background: var(--cursor-bg-secondary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-lg);
            overflow: hidden;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .quantum-cell:hover {
            border-color: var(--cursor-accent-subtle);
            box-shadow: 0 0 0 1px rgba(88, 166, 255, 0.15);
        }

        .quantum-cell.focused {
            border-color: var(--cursor-accent);
            box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.25);
        }

        .cell-header {
            padding: var(--cursor-space-xs) var(--cursor-space-md);
            background: var(--cursor-bg-tertiary);
            border-bottom: 1px solid var(--cursor-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--cursor-space-sm);
            min-height: 36px;
        }

        .cell-type {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--cursor-text-muted);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            letter-spacing: 0.3px;
            white-space: nowrap;
            min-width: 0;
        }

        .cell-type .cell-coords {
            font-size: 0.625rem;
            color: var(--cursor-text-muted);
            opacity: 0.7;
            margin-left: var(--cursor-space-xs);
        }

        .cell-actions {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }

        /* ===== In-Cell Utility Tools Bar ===== */
        .cell-tools-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            padding: 4px 8px;
            border-top: 1px solid var(--cursor-border-muted);
            background: var(--cursor-bg-tertiary);
        }
        .cell-tool-btn {
            padding: 2px 6px;
            font-size: 0.5625rem;
            font-weight: 600;
            border: 1px solid var(--cursor-border);
            border-radius: 3px;
            background: var(--cursor-bg);
            color: var(--cursor-text-muted);
            cursor: pointer;
            transition: all 0.12s ease;
            white-space: nowrap;
        }
        .cell-tool-btn:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }
        .cell-tool-btn:active { transform: scale(0.96); }
        .cell-tool-result {
            padding: 6px 10px;
            font-size: 0.6875rem;
            font-family: var(--cursor-font-mono);
            background: var(--cursor-bg-secondary);
            border-top: 1px solid var(--cursor-border-muted);
            color: var(--cursor-text-secondary);
            max-height: 200px;
            overflow-y: auto;
        }

        .cell-actions .btn--sm {
            padding: 3px 8px;
            font-size: 0.75rem;
            line-height: 1.4;
        }

        /* ===== Quantum Prefix Gutter ===== */
        .cell-editor {
            position: relative;
            display: flex;
        }

        .quantum-gutter {
            flex-shrink: 0;
            width: 54px;
            min-height: 80px;
            padding: var(--cursor-space-md) 0 var(--cursor-space-md) 6px;
            background: var(--cursor-bg);
            border-right: 1px solid var(--cursor-border-muted);
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
            line-height: 1.65;
            color: var(--cursor-text-muted);
            overflow: hidden;
            user-select: none;
            white-space: pre;
            /* Match textarea font metrics exactly for line alignment */
            box-sizing: border-box;
        }

        .quantum-gutter .gutter-line {
            display: flex;
            align-items: baseline;
            /* Must match textarea: font-size 0.8125rem * line-height 1.65 */
            height: calc(0.8125rem * 1.65);
            line-height: calc(0.8125rem * 1.65);
            overflow: hidden;
        }

        .quantum-gutter .gutter-prefix {
            width: 26px;
            text-align: right;
            font-weight: 700;
            flex-shrink: 0;
        }

        .quantum-gutter .gutter-num {
            width: 22px;
            text-align: right;
            opacity: 0.5;
            flex-shrink: 0;
            margin-left: 2px;
        }

        /* Prefix color coding */
        .pfx-shebang  { color: #f0d852; }
        .pfx-comment  { color: #7ee787; }
        .pfx-import   { color: #d2a8ff; }
        .pfx-class    { color: #79c0ff; }
        .pfx-function { color: #58a6ff; }
        .pfx-error    { color: #f97583; }
        .pfx-condition{ color: #f0883e; }
        .pfx-loop     { color: #ff9bce; }
        .pfx-return   { color: #b392f0; }
        .pfx-output   { color: #56d364; }
        .pfx-variable { color: #79c0ff; }
        .pfx-decorator{ color: #7ee787; }
        .pfx-default  { color: var(--cursor-text-muted); }

        /* ===== Execution Progress Bar ===== */
        .exec-progress {
            height: 0;
            overflow: hidden;
            background: var(--cursor-bg-tertiary);
            border-bottom: none;
            transition: height 0.3s ease;
            position: relative;
        }

        .exec-progress.active {
            height: 32px;
            border-bottom: 1px solid var(--cursor-border);
        }

        .exec-progress-inner {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 12px;
            height: 32px;
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
        }

        .exec-progress-label {
            color: var(--cursor-text-muted);
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 65px;
        }

        .exec-progress-track {
            flex: 1;
            height: 10px;
            background: var(--cursor-bg);
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid var(--cursor-border-muted);
            position: relative;
        }

        .exec-progress-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, var(--cursor-accent), #7ee787);
            width: 0%;
            transition: width 0.35s ease;
            position: relative;
        }

        .exec-progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 20px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3));
            border-radius: 0 5px 5px 0;
        }

        .exec-progress.active .exec-progress-fill {
            animation: exec-shimmer 1.5s ease infinite;
        }

        @keyframes exec-shimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .exec-progress-pct {
            color: var(--cursor-accent);
            font-weight: 700;
            min-width: 36px;
            text-align: right;
            flex-shrink: 0;
        }

        .exec-progress-detail {
            color: var(--cursor-text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            flex-shrink: 0;
        }

        .exec-progress-elapsed {
            color: var(--cursor-text-muted);
            opacity: 0.6;
            flex-shrink: 0;
            min-width: 48px;
            text-align: right;
        }

        /* ===== Convert Timeline Bar ===== */
        .convert-timeline {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            background: var(--cursor-bg-tertiary);
            border-bottom: 1px solid var(--cursor-border);
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
            min-height: 28px;
            overflow: hidden;
        }

        .convert-timeline .ctl-label {
            color: var(--cursor-text-muted);
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .convert-timeline .ctl-track {
            flex: 1;
            height: 14px;
            background: var(--cursor-bg);
            border-radius: 7px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--cursor-border-muted);
        }

        .convert-timeline .ctl-fill {
            height: 100%;
            border-radius: 7px;
            background: linear-gradient(90deg, #58a6ff 0%, #7ee787 40%, #f0883e 70%, #d2a8ff 100%);
            width: 0%;
            transition: width 0.6s ease;
        }

        .convert-timeline .ctl-segments {
            position: absolute;
            inset: 0;
            display: flex;
        }

        .convert-timeline .ctl-seg {
            flex: 1;
            border-right: 1px solid var(--cursor-border-muted);
            position: relative;
        }

        .convert-timeline .ctl-seg:last-child { border-right: none; }

        .convert-timeline .ctl-seg-label {
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.5rem;
            color: var(--cursor-text-muted);
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .convert-timeline:hover .ctl-seg-label { opacity: 1; }

        .convert-timeline .ctl-stats {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .convert-timeline .ctl-stat {
            color: var(--cursor-text-secondary);
        }

        .convert-timeline .ctl-stat b {
            color: var(--cursor-accent);
        }

        .convert-timeline.converting .ctl-fill {
            animation: ctl-pulse 1s ease infinite;
        }

        @keyframes ctl-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ===== Quantum Heatmap Fullscreen (COIN360-style) ===== */
        .ctl-expand {
            background: none; border: none; color: var(--cursor-text-muted);
            cursor: pointer; font-size: 0.75rem; padding: 2px 6px;
            border-radius: 3px; transition: all 0.12s ease; flex-shrink: 0;
        }
        .ctl-expand:hover { color: var(--cursor-accent); background: var(--cursor-accent-subtle); }

        .qheat-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: var(--cursor-bg); display: none;
            flex-direction: column; overflow: hidden;
        }
        .qheat-overlay.open { display: flex; }

        .qheat-header {
            display: flex; align-items: center; gap: 12px;
            padding: 10px 16px; background: var(--cursor-bg-secondary);
            border-bottom: 1px solid var(--cursor-border); flex-shrink: 0;
        }
        .qheat-title { font-size: 0.875rem; font-weight: 700; color: var(--cursor-text); }
        .qheat-subtitle { font-size: 0.6875rem; color: var(--cursor-text-muted); }
        .qheat-close {
            margin-left: auto; background: none; border: 1px solid var(--cursor-border);
            color: var(--cursor-text-muted); width: 28px; height: 28px; border-radius: 50%;
            font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .qheat-close:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }

        .qheat-toolbar {
            display: flex; align-items: center; gap: 8px; padding: 6px 16px;
            background: var(--cursor-bg-tertiary); border-bottom: 1px solid var(--cursor-border-muted);
            flex-shrink: 0; flex-wrap: wrap;
        }
        .qheat-mode-btn {
            padding: 3px 10px; font-size: 0.625rem; font-weight: 600;
            border: 1px solid var(--cursor-border); border-radius: 4px;
            background: var(--cursor-bg); color: var(--cursor-text-muted);
            cursor: pointer; transition: all 0.12s;
        }
        .qheat-mode-btn:hover { color: var(--cursor-text); border-color: var(--cursor-text-muted); }
        .qheat-mode-btn.active { background: var(--cursor-accent-subtle); color: var(--cursor-accent); border-color: var(--cursor-accent); }

        .qheat-legend {
            display: flex; gap: 8px; margin-left: auto; align-items: center; flex-wrap: wrap;
        }
        .qheat-legend-item {
            display: flex; align-items: center; gap: 3px; font-size: 0.5625rem;
            color: var(--cursor-text-secondary);
        }
        .qheat-legend-swatch {
            width: 10px; height: 10px; border-radius: 2px; flex-shrink: 0;
        }

        .qheat-stats {
            display: flex; gap: 16px; padding: 6px 16px; background: var(--cursor-bg-secondary);
            border-bottom: 1px solid var(--cursor-border-muted); flex-shrink: 0;
            font-size: 0.6875rem; font-family: var(--cursor-font-mono);
        }
        .qheat-stat { color: var(--cursor-text-secondary); }
        .qheat-stat b { color: var(--cursor-accent); }

        .qheat-body { flex: 1; position: relative; overflow: hidden; }
        .qheat-canvas {
            position: absolute; inset: 0; width: 100%; height: 100%;
        }

        .qheat-tooltip {
            position: fixed; z-index: 10001; pointer-events: none;
            background: var(--cursor-bg-secondary); border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md); padding: 8px 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.5); font-size: 0.6875rem;
            color: var(--cursor-text); max-width: 280px; display: none;
        }
        .qheat-tooltip.visible { display: block; }
        .qheat-tooltip-title { font-weight: 700; margin-bottom: 4px; }
        .qheat-tooltip-row { display: flex; justify-content: space-between; gap: 12px; }
        .qheat-tooltip-label { color: var(--cursor-text-muted); }
        .qheat-tooltip-val { color: var(--cursor-accent); font-family: var(--cursor-font-mono); }

        .cell-textarea {
            display: block;
            flex: 1;
            min-width: 0;
            min-height: 80px;
            padding: var(--cursor-space-md);
            background: transparent;
            border: none;
            color: var(--cursor-text);
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            line-height: 1.65;
            resize: none;
            outline: none;
            box-sizing: border-box;
            tab-size: 4;
            -moz-tab-size: 4;
        }

        .cell-textarea:focus {
            background: rgba(88, 166, 255, 0.02);
        }

        .cell-textarea::placeholder {
            color: var(--cursor-text-muted);
            opacity: 0.5;
        }

        /* ===== Cell Output ===== */
        .cell-output {
            padding: var(--cursor-space-sm) var(--cursor-space-md);
            background: var(--cursor-bg);
            border-top: 1px solid var(--cursor-border);
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            line-height: 1.5;
            overflow-x: auto;
            word-break: break-word;
        }

        .output-text {
            color: var(--cursor-text-secondary);
            padding: 2px 0;
        }

        .output-text:last-child {
            margin-bottom: 0;
        }

        .output-error {
            color: var(--cursor-danger);
            background: rgba(248, 81, 73, 0.08);
            padding: var(--cursor-space-sm) var(--cursor-space-md);
            border-radius: var(--cursor-radius-md);
            border: 1px solid rgba(248, 81, 73, 0.2);
            margin: var(--cursor-space-xs) 0;
        }

        .output-plot {
            max-width: 100%;
            height: auto;
            border-radius: var(--cursor-radius-md);
            box-shadow: var(--cursor-shadow-md);
            display: block;
        }

        .output-html h1 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--cursor-space-sm);
            color: var(--cursor-text);
        }

        .output-html h2 {
            font-size: 1.0625rem;
            font-weight: 600;
            margin-bottom: var(--cursor-space-xs);
            color: var(--cursor-text);
        }

        .output-html strong {
            color: var(--cursor-text);
        }

        /* ===== Sidebar ===== */
        .quantum-sidebar {
            width: 260px;
            flex-shrink: 0;
            background: var(--cursor-bg-secondary);
            border-left: 1px solid var(--cursor-border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            box-sizing: border-box;
        }

        .sidebar-section {
            padding: var(--cursor-space-md);
            border-bottom: 1px solid var(--cursor-border-muted);
        }

        .sidebar-title {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--cursor-text-muted);
            margin-bottom: var(--cursor-space-sm);
            letter-spacing: 0.5px;
        }

        /* ===== Sidebar Tabs ===== */
        .sidebar-tabs-ext {
            display: flex; gap: 0; border-bottom: 1px solid var(--cursor-border-muted);
            background: var(--cursor-bg-tertiary);
        }
        .sidebar-tabs-ext .sidebar-tab-ext {
            flex: 1; padding: 5px 4px; font-size: 0.5625rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.4px; text-align: center;
            color: var(--cursor-text-muted); background: none; border: none;
            cursor: pointer; transition: all 0.15s ease; border-bottom: 2px solid transparent;
        }
        .sidebar-tabs-ext .sidebar-tab-ext:hover { color: var(--cursor-text-secondary); background: var(--cursor-bg-hover); }
        .sidebar-tabs-ext .sidebar-tab-ext.active { color: var(--cursor-accent); border-bottom-color: var(--cursor-accent); }
        .sidebar-tab-ext-panel { display: none; overflow-y: auto; overflow-x: hidden; max-width: 100%; box-sizing: border-box; }
        .sidebar-tab-ext-panel.active { display: block; }

        /* --- AI/LLM Panel --- */
        .llm-panel { padding: var(--cursor-space-sm); }
        .llm-model-card {
            background: var(--cursor-bg-tertiary); border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm); padding: 8px 10px; margin-bottom: 6px;
            cursor: pointer; transition: all 0.15s ease;
        }
        .llm-model-card:hover { border-color: var(--cursor-text-muted); }
        .llm-model-card.selected { border-color: var(--cursor-accent); background: var(--cursor-accent-subtle); }
        .llm-model-name { font-size: 0.6875rem; font-weight: 600; color: var(--cursor-text); }
        .llm-model-meta { font-size: 0.5625rem; color: var(--cursor-text-muted); margin-top: 2px; }
        .llm-prompt-row {
            display: flex; gap: 4px; margin-top: 6px;
        }
        .llm-prompt-row input {
            flex: 1; padding: 4px 8px; font-size: 0.625rem; border-radius: 4px;
            border: 1px solid var(--cursor-border); background: var(--cursor-bg);
            color: var(--cursor-text); font-family: var(--cursor-font-mono);
        }
        .llm-prompt-row button {
            padding: 4px 10px; font-size: 0.625rem; font-weight: 600;
            border: 1px solid var(--cursor-accent); border-radius: 4px;
            background: var(--cursor-accent-subtle); color: var(--cursor-accent); cursor: pointer;
        }

        /* --- Language Panel --- */
        .lang-panel { padding: var(--cursor-space-sm); overflow-x: hidden; }
        .lang-subtabs {
            display: flex; gap: 2px; margin-bottom: 8px;
        }
        .lang-subtab {
            padding: 3px 8px; font-size: 0.5625rem; font-weight: 600;
            border: 1px solid var(--cursor-border); border-radius: 4px;
            background: var(--cursor-bg-tertiary); color: var(--cursor-text-muted);
            cursor: pointer; transition: all 0.12s; white-space: nowrap;
        }
        .lang-subtab:hover { color: var(--cursor-text-secondary); border-color: var(--cursor-text-muted); }
        .lang-subtab.active { background: var(--cursor-accent-subtle); color: var(--cursor-accent); border-color: var(--cursor-accent); }
        .lang-subpanel { display: none; }
        .lang-subpanel.active { display: block; }
        .lang-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin-bottom: 8px;
        }
        .lang-chip {
            padding: 4px 2px; font-size: 0.5625rem; font-weight: 600; text-align: center;
            border: 1px solid var(--cursor-border); border-radius: 4px;
            background: var(--cursor-bg-tertiary); color: var(--cursor-text-muted);
            cursor: pointer; transition: all 0.12s ease; white-space: nowrap; overflow: hidden;
        }
        .lang-chip:hover { color: var(--cursor-text); border-color: var(--cursor-text-muted); }
        .lang-chip.active { background: var(--cursor-accent-subtle); color: var(--cursor-accent); border-color: var(--cursor-accent); }
        .lang-info-box {
            background: var(--cursor-bg-tertiary); border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm); padding: 8px 10px;
            font-size: 0.625rem; color: var(--cursor-text-secondary); line-height: 1.6;
        }
        .lang-info-box strong { color: var(--cursor-text); }

        /* --- kbatch sub-tab in language panel --- */
        .lkb-stats {
            display: flex; flex-wrap: wrap; gap: 4px 10px; margin-bottom: 6px;
            font-size: 0.5625rem; font-family: var(--cursor-font-mono);
        }
        .lkb-stats b { font-weight: 700; }
        .lkb-canvas-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1px;
            background: #21262d; border-radius: var(--cursor-radius-sm);
            overflow: hidden; margin-bottom: 6px;
        }
        .lkb-canvas-cell {
            background: #0d1117; position: relative; height: 90px;
        }
        .lkb-canvas-cell canvas { width: 100%; height: calc(100% - 14px); display: block; }
        .lkb-canvas-label {
            padding: 1px 5px; font-size: 0.4375rem; font-weight: 600;
            background: #161b22;
        }
        .lkb-input {
            width: 100%; padding: 6px 8px; background: #0d1117;
            border: 1px solid #30363d; border-radius: 4px; color: #c9d1d9;
            font-family: var(--cursor-font-mono); font-size: 0.75rem; outline: none;
            box-sizing: border-box;
        }
        .lkb-input:focus { border-color: #f0883e; }
        .lkb-output {
            margin-top: 6px; padding: 6px 8px; background: var(--cursor-bg-tertiary);
            border: 1px solid var(--cursor-border); border-radius: var(--cursor-radius-sm);
            font-family: var(--cursor-font-mono); font-size: 0.5rem;
            color: var(--cursor-text-muted); max-height: 100px; overflow-y: auto;
            line-height: 1.5;
        }

        /* --- Blocks Panel (mini Pybricks builder) --- */
        /* ===== Blocks Builder â€” IBM Quantum-inspired flow ===== */
        .blocks-panel {
            padding: var(--cursor-space-sm);
            overflow-x: hidden;
            max-width: 100%;
            box-sizing: border-box;
        }

        /* Pipeline flow indicator */
        .nb-pipeline {
            display: flex; align-items: center; gap: 3px; margin-bottom: 8px;
            font-size: 0.5rem; font-weight: 600; color: var(--cursor-text-muted);
            letter-spacing: 0.3px; text-transform: uppercase; opacity: 0.7;
        }
        .nb-pipeline-stage {
            padding: 2px 6px; border-radius: 10px; font-size: 0.5rem;
            border: 1px dashed; white-space: nowrap;
        }
        .nb-pipeline-stage.s-init   { border-color: rgba(88,166,255,0.4); color: #58a6ff; }
        .nb-pipeline-stage.s-proc   { border-color: rgba(210,168,255,0.4); color: #d2a8ff; }
        .nb-pipeline-stage.s-output { border-color: rgba(63,185,80,0.4);  color: #3fb950; }
        .nb-pipeline-arrow { font-size: 0.625rem; opacity: 0.4; }

        /* Category groups with dashed borders */
        .nb-palette {
            display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px;
            max-width: 100%; overflow: hidden;
        }
        .nb-cat-group {
            border: 1px dashed var(--cursor-border-muted);
            border-radius: 8px; padding: 5px 6px 4px;
            background: rgba(255,255,255,0.015);
            overflow: hidden;
        }
        .nb-cat-label {
            font-size: 0.5rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.5px; margin-bottom: 3px; padding-left: 2px;
            display: flex; align-items: center; gap: 4px;
        }
        .nb-cat-label::before {
            content: ''; display: inline-block; width: 6px; height: 6px;
            border-radius: 50%;
        }
        .nb-cat-label.lbl-hub    { color: #58a6ff; }
        .nb-cat-label.lbl-hub::before    { background: #58a6ff; }
        .nb-cat-label.lbl-motion { color: #f0883e; }
        .nb-cat-label.lbl-motion::before { background: #f0883e; }
        .nb-cat-label.lbl-sensor { color: #3fb950; }
        .nb-cat-label.lbl-sensor::before { background: #3fb950; }
        .nb-cat-label.lbl-logic  { color: #d2a8ff; }
        .nb-cat-label.lbl-logic::before  { background: #d2a8ff; }
        .nb-cat-label.lbl-loop   { color: #ffe138; }
        .nb-cat-label.lbl-loop::before   { background: #ffe138; }
        .nb-cat-label.lbl-var    { color: #f97583; }
        .nb-cat-label.lbl-var::before    { background: #f97583; }
        .nb-cat-label.lbl-stream { color: #c084fc; }
        .nb-cat-label.lbl-stream::before { background: #c084fc; }

        .nb-cat-chips { display: flex; flex-wrap: wrap; gap: 3px; }

        /* Pill-shaped chips (IBM Quantum style) */
        .nb-chip {
            padding: 3px 10px; font-size: 0.5625rem; font-weight: 600;
            border-radius: 12px; cursor: pointer; border: 1px solid transparent;
            transition: all 0.15s ease; white-space: nowrap;
            flex-shrink: 0; max-width: calc(50% - 4px); box-sizing: border-box;
            overflow: hidden; text-overflow: ellipsis;
            position: relative;
        }
        .nb-chip:hover { filter: brightness(1.25); transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
        .nb-chip:active { transform: scale(0.96) translateY(0); }
        .nb-chip.cat-hub    { background: rgba(88,166,255,0.12); color: #58a6ff; border-color: rgba(88,166,255,0.25); }
        .nb-chip.cat-motion { background: rgba(255,136,56,0.12); color: #f0883e; border-color: rgba(255,136,56,0.25); }
        .nb-chip.cat-sensor { background: rgba(63,185,80,0.12); color: #3fb950; border-color: rgba(63,185,80,0.25); }
        .nb-chip.cat-logic  { background: rgba(210,168,255,0.12); color: #d2a8ff; border-color: rgba(210,168,255,0.25); }
        .nb-chip.cat-loop   { background: rgba(255,225,56,0.12); color: #ffe138; border-color: rgba(255,225,56,0.25); }
        .nb-chip.cat-var    { background: rgba(218,54,51,0.12); color: #f97583; border-color: rgba(218,54,51,0.25); }
        .nb-chip.cat-stream { background: rgba(192,132,252,0.12); color: #c084fc; border-color: rgba(192,132,252,0.25); }

        .nb-canvas {
            position: relative;
            min-height: 140px;
            background: #0a0e14;
            border: 1px solid var(--cursor-border-muted);
            border-radius: var(--cursor-radius-sm);
            overflow: hidden;
            max-width: 100%;
            box-sizing: border-box;
        }
        .nb-canvas .nb-grid {
            position: absolute; inset: 0;
            background-image:
                linear-gradient(rgba(255,255,255,.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,.03) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none;
        }
        .nb-block {
            position: absolute; min-width: 90px; border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4); cursor: grab;
            font-family: var(--cursor-font-mono); font-size: 0.5625rem; z-index: 2;
            user-select: none;
        }
        .nb-block:active { cursor: grabbing; z-index: 10; }
        .nb-block-head {
            padding: 3px 8px; font-weight: 700; font-size: 0.5625rem;
            border-radius: 5px 5px 0 0; color: rgba(0,0,0,0.7);
        }
        .nb-block-body {
            padding: 3px 6px; background: rgba(0,0,0,0.15); border-radius: 0 0 5px 5px;
        }
        .nb-block-body input, .nb-block-body select {
            width: 100%; padding: 1px 4px; font-size: 0.5rem;
            background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 2px; color: #fff; font-family: var(--cursor-font-mono);
        }
        .nb-conn-dot {
            position: absolute; right: -5px; top: 50%; width: 8px; height: 8px;
            border-radius: 50%; background: #ffe138; border: 1px solid rgba(0,0,0,0.3);
            cursor: crosshair; transform: translateY(-50%); z-index: 5;
        }
        .nb-connections-svg {
            position: absolute; inset: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1;
        }

        .sidebar-tabs {
            display: flex; gap: 0; border-bottom: 1px solid var(--cursor-border-muted);
        }
        .sidebar-tab {
            flex: 1; padding: 6px 4px; font-size: 0.625rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.5px; text-align: center;
            color: var(--cursor-text-muted); background: transparent; border: none;
            cursor: pointer; transition: all 0.15s ease; border-bottom: 2px solid transparent;
        }
        .sidebar-tab:hover { color: var(--cursor-text-secondary); background: var(--cursor-bg-hover); }
        .sidebar-tab.active { color: var(--cursor-accent); border-bottom-color: var(--cursor-accent); }
        .sidebar-tab-panel { display: none; }
        .sidebar-tab-panel.active { display: block; }

        /* ===== Quantum Thermal Viz ===== */
        .thermal-viz { padding: var(--cursor-space-sm); }
        .thermal-canvas-wrap {
            position: relative; width: 100%; aspect-ratio: 1;
            background: #0a0e14; border-radius: var(--cursor-radius-md);
            border: 1px solid var(--cursor-border); overflow: hidden; margin-bottom: 8px;
        }
        .thermal-canvas-wrap canvas { width: 100%; height: 100%; display: block; }
        .thermal-controls {
            display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 8px;
        }
        .thermal-btn {
            flex: 1; min-width: 48px; padding: 4px 6px; font-size: 0.625rem; font-weight: 600;
            border: 1px solid var(--cursor-border); border-radius: var(--cursor-radius-sm);
            background: var(--cursor-bg-tertiary); color: var(--cursor-text-secondary);
            cursor: pointer; transition: all 0.15s ease; text-align: center;
        }
        .thermal-btn:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }
        .thermal-btn.active { background: var(--cursor-accent-subtle); color: #fff; border-color: var(--cursor-accent); }
        .thermal-legend {
            display: flex; align-items: center; gap: 4px; margin-bottom: 6px;
        }
        .thermal-gradient {
            flex: 1; height: 10px; border-radius: 5px;
            background: linear-gradient(90deg, #00bfff 0%, #3fb950 30%, #f0883e 60%, #f85149 85%, #ff4500 100%);
        }
        .thermal-legend-label { font-size: 0.5625rem; color: var(--cursor-text-muted); white-space: nowrap; }
        .thermal-stat-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 3px 0; font-size: 0.625rem; color: var(--cursor-text-secondary);
            border-bottom: 1px solid var(--cursor-border-muted);
        }
        .thermal-stat-row:last-child { border-bottom: none; }
        .thermal-stat-val {
            font-family: var(--cursor-font-mono); font-weight: 600; font-size: 0.6875rem;
        }
        .thermal-stat-val.cryo { color: #00bfff; }
        .thermal-stat-val.warm { color: #f0883e; }
        .thermal-stat-val.hot { color: #f85149; }
        .thermal-stat-val.qbit { color: #d2a8ff; }
        .gpu-qubit-bar {
            height: 6px; border-radius: 3px; background: var(--cursor-bg);
            overflow: hidden; margin: 3px 0;
        }
        .gpu-qubit-fill {
            height: 100%; border-radius: 3px;
            transition: width 0.6s ease;
        }
        .thermal-section-label {
            font-size: 0.5625rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.6px; color: var(--cursor-text-muted); margin: 8px 0 4px;
        }
        .lattice-info {
            font-size: 0.5625rem; color: var(--cursor-text-muted); line-height: 1.5;
            padding: 4px 6px; background: var(--cursor-bg); border-radius: var(--cursor-radius-sm);
        }
        .lattice-info strong { color: var(--cursor-text-secondary); }

        /* ===== Visual Slice / 3D Cube ===== */
        .visual-viz { padding: var(--cursor-space-sm); }
        .visual-mode-bar { display: flex; gap: 4px; margin-bottom: 8px; }
        .visual-btn {
            flex: 1; min-width: 48px; padding: 4px 6px; font-size: 0.625rem; font-weight: 600;
            text-transform: uppercase; border: 1px solid var(--cursor-border); border-radius: 4px;
            background: var(--cursor-bg-tertiary); color: var(--cursor-text-muted); cursor: pointer;
            transition: all 0.15s ease;
        }
        .visual-btn:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }
        .visual-btn.active { background: var(--cursor-accent-subtle); color: #fff; border-color: var(--cursor-accent); }
        .visual-canvas-wrap {
            position: relative; width: 100%; aspect-ratio: 1;
            border-radius: var(--cursor-radius-md); overflow: hidden;
            background: #0a0e14; border: 1px solid var(--cursor-border-muted);
        }
        .visual-canvas-wrap canvas { width: 100%; height: 100%; display: block; }

        /* 3D Rubik cube container */
        .cube-scene {
            width: 100%; aspect-ratio: 1; perspective: 600px;
            display: flex; align-items: center; justify-content: center;
            background: #0a0e14; border-radius: var(--cursor-radius-md);
            border: 1px solid var(--cursor-border-muted); overflow: hidden;
            cursor: grab; user-select: none;
        }
        .cube-scene:active { cursor: grabbing; }
        .cube-wrap {
            width: 120px; height: 120px; position: relative;
            transform-style: preserve-3d;
            transition: transform 0.08s linear;
        }
        .cube-cell {
            position: absolute; width: 30%; height: 30%;
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 3px; display: flex; align-items: center; justify-content: center;
            font-family: var(--cursor-font-mono); font-size: 0.5rem; font-weight: 700;
            color: rgba(255,255,255,0.85); backface-visibility: visible;
            transition: opacity 0.25s ease, box-shadow 0.25s ease;
        }
        .cube-cell.active-cell { box-shadow: 0 0 12px rgba(139,92,246,0.7); border-color: rgba(139,92,246,0.6); }

        .cube-controls {
            display: flex; gap: 4px; margin-top: 6px; flex-wrap: wrap;
        }
        .cube-ctrl-btn {
            flex: 1; min-width: 36px; padding: 3px 4px; font-size: 0.5625rem; font-weight: 600;
            border: 1px solid var(--cursor-border); border-radius: 3px;
            background: var(--cursor-bg-tertiary); color: var(--cursor-text-muted); cursor: pointer;
        }
        .cube-ctrl-btn:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }
        .cube-ctrl-btn.active { background: var(--cursor-accent-subtle); color: #fff; border-color: var(--cursor-accent); }

        .visual-stat-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 3px 0; border-bottom: 1px solid var(--cursor-border-muted);
            font-size: 0.5625rem; color: var(--cursor-text-muted);
        }
        .visual-stat-val {
            font-family: var(--cursor-font-mono); font-weight: 600; font-size: 0.6875rem;
        }
        .visual-section-label {
            font-size: 0.5625rem; font-weight: 700; text-transform: uppercase;
            color: var(--cursor-text-muted); margin: 8px 0 4px; letter-spacing: 0.5px;
        }

        /* ===== Hex/Fax Overlay ===== */
        .hex-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.92); z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .hex-overlay canvas {
            width: min(100vw, 100vh); height: min(100vw, 100vh);
            image-rendering: pixelated; border: 1px solid var(--cursor-border);
        }
        .hex-overlay-bar {
            display: flex; gap: 8px; padding: 8px; background: var(--cursor-bg-secondary);
            border-radius: var(--cursor-radius-md); margin-bottom: 8px;
        }
        .hex-overlay-bar button {
            padding: 4px 12px; font-size: 0.75rem; border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm); background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-secondary); cursor: pointer;
        }
        .hex-overlay-bar button:hover { background: var(--cursor-bg-hover); }
        .hex-overlay-bar button.active { background: var(--cursor-accent-subtle); color: #fff; border-color: var(--cursor-accent); }

        /* ===== Tools Dropdown ===== */
        .tools-dropdown {
            position: absolute; bottom: 100%; left: 0; min-width: 220px;
            background: var(--cursor-bg-secondary); border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md); box-shadow: 0 -4px 16px rgba(0,0,0,0.4);
            padding: 4px 0; display: none; z-index: 900; max-height: 320px; overflow-y: auto;
        }
        .tools-dropdown.show { display: block; }
        .tools-dropdown-header {
            padding: 4px 10px; font-size: 0.5625rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.6px; color: var(--cursor-text-muted);
        }
        .tools-dropdown-item {
            padding: 6px 10px; font-size: 0.6875rem; color: var(--cursor-text-secondary);
            cursor: pointer; display: flex; align-items: center; gap: 6px;
        }
        .tools-dropdown-item:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }

        /* ===== Quantum Nav Cube ===== */
        .nav-cube-container {
            margin-bottom: var(--cursor-space-md);
            background: var(--cursor-bg);
            border-radius: var(--cursor-radius-md);
            position: relative;
            overflow: hidden;
        }

        /* 2D / 3D tab switcher */
        .ncv-tabs {
            display: flex; border-bottom: 1px solid var(--cursor-border-muted);
        }
        .ncv-tab {
            flex: 1; padding: 5px 0; text-align: center;
            font-size: 0.625rem; font-weight: 700; font-family: var(--cursor-font-mono);
            color: var(--cursor-text-muted); cursor: pointer;
            background: transparent; border: none; border-bottom: 2px solid transparent;
            transition: all 0.15s;
        }
        .ncv-tab:hover { color: var(--cursor-text-secondary); }
        .ncv-tab.active { color: var(--cursor-accent); border-bottom-color: var(--cursor-accent); background: rgba(88,166,255,0.04); }

        /* Viewport: clips 3D faces so they can't escape */
        .ncv-viewport {
            width: 100%; height: 160px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; position: relative;
        }
        .ncv-viewport.ncv-hidden { display: none; }

        /* 2D slice canvas */
        #ncv-2d-canvas { width: 100%; height: 100%; display: block; cursor: crosshair; }

        .nav-cube-scene {
            position: relative;
            perspective: 400px;
            width: 118px;
            height: 118px;
            cursor: grab;
            user-select: none;
        }
        .nav-cube-scene:active { cursor: grabbing; }

        /* Arrow controls â€” separate row below the viewport */
        .ncv-controls {
            display: flex; align-items: center; justify-content: center;
            gap: 6px; padding: 6px 8px;
            border-top: 1px solid var(--cursor-border-muted);
        }

        .nav-cube-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.25s ease;
            transform: rotateX(-20deg) rotateY(30deg);
        }

        .nav-cube-face {
            position: absolute;
            width: 118px;
            height: 118px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            padding: 3px;
            background: rgba(13, 17, 23, 0.55);
            border: 1px solid var(--cursor-border-muted);
            border-radius: 4px;
        }
        .nav-cube-face.ncf-front  { transform: translateZ(59px); }
        .nav-cube-face.ncf-back   { transform: rotateY(180deg) translateZ(59px); }
        .nav-cube-face.ncf-right  { transform: rotateY(90deg) translateZ(59px); }
        .nav-cube-face.ncf-left   { transform: rotateY(-90deg) translateZ(59px); }
        .nav-cube-face.ncf-top    { transform: rotateX(90deg) translateZ(59px); }
        .nav-cube-face.ncf-bottom { transform: rotateX(-90deg) translateZ(59px); }

        /* Cells: neutral by default, prefix color only on hover/active */
        .nav-cube-face span {
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--cursor-font-mono);
            font-size: 11px;
            font-weight: 800;
            letter-spacing: 0.02em;
            color: var(--cursor-text-muted);
            background: rgba(48, 54, 61, 0.7);
            cursor: pointer;
            transition: background 0.2s ease, box-shadow 0.15s ease, transform 0.1s ease, color 0.2s ease;
        }
        .nav-cube-face span:hover {
            background: var(--ncf-color, rgba(88, 100, 112, 0.6));
            box-shadow: 0 0 8px var(--ncf-glow, rgba(255,255,255,0.15));
            transform: scale(1.08);
            color: #fff;
        }
        .nav-cube-face span.ncf-active {
            background: var(--ncf-color, rgba(139, 92, 246, 0.5));
            box-shadow: 0 0 12px var(--ncf-glow, rgba(139, 92, 246, 0.7));
            border: 1px solid var(--ncf-glow, rgba(139, 92, 246, 0.6));
            color: #fff;
        }

        /* Flat-face snap: when cube faces camera directly, enlarge text for readability */
        .nav-cube-inner.ncf-flat .nav-cube-face span {
            font-size: 15px;
        }

        /* Rotation arrow buttons â€” positioned outside the cube */
        .nav-cube-arrow {
            width: 26px;
            height: 26px;
            border: 1px solid var(--cursor-border);
            border-radius: 50%;
            background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-muted);
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.12s ease;
            padding: 0;
        }
        .nav-cube-arrow:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
            border-color: var(--cursor-text-muted);
        }
        .nav-cube-arrow:active {
            transform: scale(0.9);
            background: var(--cursor-accent-subtle);
            color: var(--cursor-accent);
        }

        /* Flat grid â€” shown in 2D Slice mode, hidden in 3D Cube mode */
        .quantum-nav-mini {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            padding: 8px;
        }
        .quantum-nav-mini.ncv-hidden {
            display: none;
        }

        .nav-btn {
            aspect-ratio: 1;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-secondary);
            font-family: var(--cursor-font-mono);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
            border-color: var(--cursor-text-muted);
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .nav-btn.active {
            background: var(--cursor-accent);
            color: #ffffff;
            border-color: var(--cursor-accent);
            font-weight: 600;
        }

        .position-display {
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: var(--cursor-space-sm) var(--cursor-space-md);
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            color: var(--cursor-accent);
            text-align: center;
            letter-spacing: 0.5px;
        }

        /* ===== Quantum Stream History ===== */
        .quantum-stream {
            margin-top: var(--cursor-space-sm);
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            overflow: hidden;
        }

        .stream-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 8px;
            background: var(--cursor-bg-tertiary);
            border-bottom: 1px solid var(--cursor-border-muted);
        }

        .stream-title {
            font-size: 0.5625rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--cursor-text-muted);
            letter-spacing: 0.5px;
        }

        .stream-pipe-btns {
            display: flex;
            gap: 3px;
        }

        .stream-pipe-btn {
            font-size: 0.5625rem;
            font-family: var(--cursor-font-mono);
            padding: 1px 5px;
            border: 1px solid var(--cursor-border);
            border-radius: 3px;
            background: var(--cursor-bg-secondary);
            color: var(--cursor-text-muted);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .stream-pipe-btn:hover {
            background: var(--cursor-accent);
            color: #fff;
            border-color: var(--cursor-accent);
        }

        .stream-pipe-btn.active {
            background: var(--cursor-accent);
            color: #fff;
            border-color: var(--cursor-accent);
        }

        .stream-log {
            max-height: 120px;
            overflow-y: auto;
            padding: 4px 0;
            font-family: var(--cursor-font-mono);
            font-size: 0.625rem;
            line-height: 1.6;
        }

        .stream-log::-webkit-scrollbar { width: 3px; }
        .stream-log::-webkit-scrollbar-thumb { background: var(--cursor-border); border-radius: 3px; }

        .stream-entry {
            padding: 1px 8px;
            color: var(--cursor-text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
            transition: background 0.1s ease;
        }

        .stream-entry:hover {
            background: var(--cursor-bg-hover);
        }

        .stream-entry.stream-origin {
            color: var(--cursor-accent);
            font-weight: 600;
        }

        .stream-entry.stream-nav {
            color: var(--cursor-text-secondary);
        }

        .stream-entry.stream-exec {
            color: #7ee787;
        }

        .stream-entry.stream-paste {
            color: #d2a8ff;
        }

        .stream-entry.stream-pipe {
            color: #f0883e;
        }

        .stream-entry .stream-ts {
            opacity: 0.4;
            font-size: 0.5rem;
            min-width: 32px;
        }

        .stream-source {
            padding: 6px 8px;
            border-top: 1px solid var(--cursor-border-muted);
        }

        .stream-source-input {
            width: 100%;
            background: var(--cursor-bg-secondary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm);
            color: var(--cursor-text);
            font-family: var(--cursor-font-mono);
            font-size: 0.625rem;
            padding: 4px 6px;
            resize: none;
            outline: none;
            box-sizing: border-box;
        }

        .stream-source-input:focus {
            border-color: var(--cursor-accent);
        }

        /* ===== Cell Overview Nav Bar ===== */
        .cell-nav-bar {
            display: flex; align-items: center; gap: 3px; margin-bottom: 6px;
        }
        .cell-nav-btn {
            padding: 2px 7px; font-size: 0.6875rem; font-weight: 600;
            border: 1px solid var(--cursor-border); border-radius: 4px;
            background: var(--cursor-bg); color: var(--cursor-text-muted);
            cursor: pointer; transition: all 0.12s ease; line-height: 1.3;
        }
        .cell-nav-btn:hover { background: var(--cursor-bg-hover); color: var(--cursor-text); }
        .cell-nav-btn:active { transform: scale(0.94); }
        .cell-nav-btn:disabled { opacity: 0.3; pointer-events: none; }
        .cell-nav-jump {
            flex: 1; padding: 2px 6px; font-size: 0.625rem;
            border: 1px solid var(--cursor-border); border-radius: 4px;
            background: var(--cursor-bg); color: var(--cursor-text);
            font-family: var(--cursor-font-mono); outline: none;
            min-width: 0;
        }
        .cell-nav-jump:focus { border-color: var(--cursor-accent); }
        .cell-nav-jump::placeholder { color: var(--cursor-text-muted); opacity: 0.5; }
        .cell-nav-counter {
            font-size: 0.5625rem; color: var(--cursor-text-muted); white-space: nowrap;
            font-family: var(--cursor-font-mono);
        }

        /* ===== Cell Overview List ===== */
        .cell-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 260px;
            overflow-y: auto;
        }

        .cell-list-item {
            padding: var(--cursor-space-xs) var(--cursor-space-sm);
            border-radius: var(--cursor-radius-sm);
            margin-bottom: 2px;
            cursor: pointer;
            transition: background 0.1s ease;
            font-size: 0.75rem;
            color: var(--cursor-text-secondary);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .cell-list-item:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
        }

        .cell-list-item.active {
            background: var(--cursor-accent-subtle);
            color: var(--cursor-accent);
        }

        .cell-list-item .cell-list-icon {
            flex-shrink: 0;
        }

        .cell-list-item .cli-move {
            opacity: 0; font-size: 0.5625rem; cursor: pointer;
            padding: 0 2px; border-radius: 2px; transition: opacity 0.12s;
            color: var(--cursor-text-muted); flex-shrink: 0;
        }
        .cell-list-item:hover .cli-move { opacity: 0.6; }
        .cell-list-item .cli-move:hover { opacity: 1; color: var(--cursor-accent); }

        /* ===== Performance Stats ===== */
        .perf-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2px 0;
            font-size: 0.75rem;
            color: var(--cursor-text-secondary);
        }

        .perf-row span:last-child {
            font-family: var(--cursor-font-mono);
            color: var(--cursor-text-muted);
            font-size: 0.6875rem;
        }

        .perf-toggles {
            margin-top: var(--cursor-space-sm);
            display: flex;
            flex-direction: column;
            gap: var(--cursor-space-xs);
        }

        .perf-toggles label {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            font-size: 0.75rem;
            color: var(--cursor-text-secondary);
            cursor: pointer;
        }

        .perf-toggles input[type="checkbox"] {
            accent-color: var(--cursor-accent);
        }

        /* ===== Virtual / Infinite Scroll ===== */
        .virtual-cell {
            height: 200px;
            background: var(--cursor-bg-tertiary);
            border: 1px dashed var(--cursor-border);
            border-radius: var(--cursor-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--cursor-text-muted);
            font-style: italic;
            margin-bottom: var(--cursor-space-lg);
        }

        /* ===== Performance Mode ===== */
        .performance-mode .quantum-cell {
            contain: layout style paint;
            will-change: transform;
        }

        /* ===== Auto-growing Textarea ===== */
        .auto-resize {
            overflow: hidden;
            resize: none;
        }

        /* ===== Keyboard Hint ===== */
        .kbd-hint {
            font-size: 0.625rem;
            color: var(--cursor-text-muted);
            opacity: 0.6;
            margin-left: 4px;
            font-family: var(--cursor-font-mono);
        }

        /* ===== Empty State ===== */
        .empty-state {
            text-align: center;
            padding: var(--cursor-space-2xl) var(--cursor-space-lg);
            color: var(--cursor-text-muted);
        }

        .empty-state p {
            margin-top: var(--cursor-space-sm);
            font-size: 0.875rem;
        }

        /* ===== Inspect Panel Overlay ===== */
        .inspect-overlay {
            position: fixed;
            inset: 0;
            z-index: 900;
            display: none;
        }

        .inspect-overlay.open {
            display: flex;
        }

        .inspect-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(4px);
        }

        .inspect-panel {
            position: relative;
            margin: 24px auto;
            width: min(960px, calc(100vw - 48px));
            max-height: calc(100vh - 48px);
            background: var(--cursor-bg-secondary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-xl);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--cursor-shadow-xl), 0 0 80px rgba(88, 166, 255, 0.06);
            z-index: 1;
        }

        .inspect-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--cursor-space-md) var(--cursor-space-lg);
            border-bottom: 1px solid var(--cursor-border);
            flex-shrink: 0;
        }

        .inspect-header h2 {
            font-size: 1.0625rem;
            font-weight: 600;
            color: var(--cursor-text);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
        }

        .inspect-close {
            background: none;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            color: var(--cursor-text-muted);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.125rem;
            transition: all 0.15s ease;
        }

        .inspect-close:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
        }

        .inspect-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--cursor-space-lg);
        }

        /* --- Inspect sections --- */
        .inspect-section {
            margin-bottom: var(--cursor-space-xl);
        }

        .inspect-section:last-child {
            margin-bottom: 0;
        }

        .inspect-section h3 {
            font-size: 0.8125rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--cursor-accent);
            margin-bottom: var(--cursor-space-md);
            padding-bottom: var(--cursor-space-xs);
            border-bottom: 1px solid var(--cursor-border-muted);
        }

        .inspect-section p,
        .inspect-section li {
            font-size: 0.8125rem;
            line-height: 1.65;
            color: var(--cursor-text-secondary);
        }

        .inspect-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .inspect-section li {
            padding: 3px 0;
            padding-left: 1.1em;
            position: relative;
        }

        .inspect-section li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.65em;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--cursor-accent);
            opacity: 0.6;
        }

        /* --- Limits grid --- */
        .limits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--cursor-space-md);
        }

        .limit-card {
            background: var(--cursor-bg-tertiary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: var(--cursor-space-md);
        }

        .limit-card .limit-label {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            color: var(--cursor-text-muted);
            margin-bottom: 4px;
        }

        .limit-card .limit-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--cursor-text);
            font-family: var(--cursor-font-mono);
        }

        .limit-card .limit-note {
            font-size: 0.6875rem;
            color: var(--cursor-text-muted);
            margin-top: 4px;
            line-height: 1.4;
        }

        /* --- Comparison table --- */
        .compare-table-wrap {
            overflow-x: auto;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
        }

        .compare-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .compare-table th,
        .compare-table td {
            padding: 7px 10px;
            border-bottom: 1px solid var(--cursor-border-muted);
            text-align: left;
        }

        .compare-table thead th {
            background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-muted);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.625rem;
            letter-spacing: 0.4px;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .compare-table thead th:first-child {
            position: sticky;
            left: 0;
            z-index: 2;
        }

        .compare-table tbody td:first-child {
            position: sticky;
            left: 0;
            background: var(--cursor-bg-secondary);
            font-weight: 600;
            color: var(--cursor-text);
            border-right: 1px solid var(--cursor-border);
            z-index: 1;
        }

        .compare-table tbody tr:hover td {
            background: var(--cursor-bg-tertiary);
        }

        .compare-table tbody tr:hover td:first-child {
            background: var(--cursor-bg-hover);
        }

        .compare-table .self-col {
            background: rgba(88, 166, 255, 0.06);
            color: var(--cursor-accent);
            font-weight: 500;
        }

        .compare-table thead .self-col {
            background: rgba(88, 166, 255, 0.12);
            color: var(--cursor-accent);
        }

        .cmp-yes  { color: var(--cursor-success); }
        .cmp-no   { color: var(--cursor-text-muted); opacity: 0.6; }
        .cmp-part { color: var(--cursor-warning); }
        .cmp-mid  { color: #8b9cf7; font-style: italic; }
        .cmp-best { color: var(--cursor-accent); font-weight: 600; }

        /* --- Tag pills --- */
        .tag-row {
            display: flex;
            flex-wrap: wrap;
            gap: var(--cursor-space-xs);
            margin-top: var(--cursor-space-sm);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 0.6875rem;
            font-weight: 500;
        }

        .tag--green  { background: rgba(63,185,80,0.15); color: #7ee787; border: 1px solid rgba(63,185,80,0.25); }
        .tag--blue   { background: rgba(88,166,255,0.12); color: #79c0ff; border: 1px solid rgba(88,166,255,0.2); }
        .tag--yellow { background: rgba(210,153,34,0.15); color: #f0d852; border: 1px solid rgba(210,153,34,0.25); }
        .tag--red    { background: rgba(248,81,73,0.12); color: #f97583; border: 1px solid rgba(248,81,73,0.2); }
        .tag--purple { background: rgba(210,168,255,0.12); color: #d2a8ff; border: 1px solid rgba(210,168,255,0.22); }

        /* ===== SOW Phase Timeline ===== */
        .sow-timeline {
            display: flex;
            flex-direction: column;
            gap: 0;
            position: relative;
            padding-left: 28px;
        }

        .sow-timeline::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            background: var(--cursor-border);
        }

        .sow-phase {
            position: relative;
            padding: var(--cursor-space-md);
            padding-left: var(--cursor-space-md);
            background: var(--cursor-bg-tertiary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            margin-bottom: var(--cursor-space-md);
        }

        .sow-phase::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 18px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--cursor-border);
            background: var(--cursor-bg);
        }

        .sow-phase.phase-done::before {
            background: var(--cursor-success);
            border-color: var(--cursor-success);
        }

        .sow-phase.phase-active::before {
            background: var(--cursor-accent);
            border-color: var(--cursor-accent);
            box-shadow: 0 0 8px rgba(88,166,255,0.4);
        }

        .sow-phase.phase-next::before {
            background: var(--cursor-bg);
            border-color: var(--cursor-text-muted);
        }

        .sow-phase-title {
            font-size: 0.8125rem;
            font-weight: 700;
            color: var(--cursor-text);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
        }

        .sow-phase-title .phase-tag {
            font-size: 0.625rem;
            font-weight: 600;
            padding: 1px 7px;
            border-radius: 10px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .phase-tag--done { background: rgba(63,185,80,0.2); color: #7ee787; }
        .phase-tag--active { background: rgba(88,166,255,0.2); color: #79c0ff; }
        .phase-tag--next { background: rgba(139,156,247,0.15); color: #8b9cf7; }
        .phase-tag--future { background: rgba(210,153,34,0.15); color: #f0d852; }

        .sow-phase-body {
            font-size: 0.75rem;
            color: var(--cursor-text-secondary);
            line-height: 1.6;
        }

        .sow-phase-body ul {
            list-style: none;
            padding: 0;
            margin: var(--cursor-space-xs) 0 0 0;
        }

        .sow-phase-body li {
            padding: 2px 0 2px 1em;
            position: relative;
            font-size: 0.75rem;
        }

        .sow-phase-body li::before {
            content: 'â€º';
            position: absolute;
            left: 0;
            color: var(--cursor-accent);
            font-weight: 700;
        }

        /* --- Benchmark grid --- */
        .bench-grid {
            display: grid;
            grid-template-columns: 2.4fr repeat(10, 1fr);
            gap: 0;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            overflow: hidden;
            font-size: 0.6875rem;
        }

        .bench-grid .bg-hd {
            background: var(--cursor-bg-tertiary);
            padding: 6px 8px;
            font-weight: 600;
            color: var(--cursor-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border-bottom: 1px solid var(--cursor-border);
            display: flex;
            align-items: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bench-grid .bg-hd.self-hd {
            background: rgba(88,166,255,0.12);
            color: var(--cursor-accent);
            font-weight: 700;
        }

        .bench-grid .bg-cell {
            padding: 5px 8px;
            border-bottom: 1px solid var(--cursor-border-muted);
            color: var(--cursor-text-secondary);
            display: flex;
            align-items: center;
            overflow: hidden;
        }

        .bench-grid .bg-cell.bg-cap {
            font-weight: 600;
            color: var(--cursor-text);
            background: var(--cursor-bg-secondary);
            border-right: 1px solid var(--cursor-border);
            white-space: nowrap;
        }

        .bench-grid .bg-cell.bg-self {
            background: rgba(88,166,255,0.05);
            color: var(--cursor-accent);
            font-weight: 600;
        }

        .bench-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .bench-dot--yes { background: #7ee787; }
        .bench-dot--part { background: #f0d852; }
        .bench-dot--no { background: #484f58; }
        .bench-dot--best { background: #58a6ff; box-shadow: 0 0 6px rgba(88,166,255,0.5); }

        /* ===== Enhancement Plan Cards ===== */
        .plan-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--cursor-space-md);
        }

        .plan-card {
            background: var(--cursor-bg-tertiary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: var(--cursor-space-md);
            display: flex;
            flex-direction: column;
        }

        .plan-card-header {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            margin-bottom: var(--cursor-space-sm);
        }

        .plan-card-header .plan-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .plan-card-header .plan-title {
            font-size: 0.8125rem;
            font-weight: 700;
            color: var(--cursor-text);
        }

        .plan-card-body {
            font-size: 0.6875rem;
            color: var(--cursor-text-secondary);
            line-height: 1.55;
            flex: 1;
        }

        .plan-card-body code {
            font-size: 0.625rem;
            background: var(--cursor-bg);
            padding: 1px 4px;
            border-radius: 3px;
            color: var(--cursor-accent);
        }

        .plan-card-body ul {
            list-style: none;
            padding: 0;
            margin: 4px 0 0 0;
        }

        .plan-card-body li {
            padding: 1px 0 1px 0.9em;
            position: relative;
            font-size: 0.6875rem;
        }

        .plan-card-body li::before {
            content: 'â€º';
            position: absolute;
            left: 0;
            color: var(--cursor-accent);
            font-weight: 700;
        }

        .plan-card-footer {
            margin-top: var(--cursor-space-sm);
            padding-top: var(--cursor-space-xs);
            border-top: 1px solid var(--cursor-border-muted);
        }

        .plan-card-footer .tag {
            font-size: 0.5625rem;
        }

        .prefix-demo {
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: var(--cursor-space-md);
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
            line-height: 1.7;
            overflow-x: auto;
            margin: var(--cursor-space-md) 0;
        }

        .prefix-demo .pf { color: var(--cursor-accent); font-weight: 600; }
        .prefix-demo .tg { color: #f97583; }
        .prefix-demo .at { color: #d2a8ff; }
        .prefix-demo .tx { color: var(--cursor-text-secondary); }
        .prefix-demo .cm { color: #8b949e; font-style: italic; }

        /* ===== Language Benchmark Chart ===== */
        .lang-chart {
            margin: var(--cursor-space-md) 0;
        }

        .lang-chart-row {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
            padding: 4px 0;
        }

        .lang-chart-label {
            width: 90px;
            flex-shrink: 0;
            font-size: 0.6875rem;
            font-weight: 600;
            color: var(--cursor-text);
            text-align: right;
            font-family: var(--cursor-font-mono);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
        }

        .lang-chart-bar-wrap {
            flex: 1;
            height: 20px;
            background: var(--cursor-bg);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--cursor-border-muted);
        }

        .lang-chart-bar {
            height: 100%;
            border-radius: 3px;
            display: flex;
            align-items: center;
            padding-left: 8px;
            font-size: 0.5625rem;
            font-weight: 600;
            color: #fff;
            white-space: nowrap;
            transition: width 0.6s ease;
        }

        .lang-chart-value {
            width: 48px;
            flex-shrink: 0;
            font-size: 0.625rem;
            font-family: var(--cursor-font-mono);
            color: var(--cursor-text-muted);
            text-align: right;
        }

        .lang-chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: var(--cursor-space-sm);
            margin-top: var(--cursor-space-sm);
            padding-top: var(--cursor-space-xs);
            border-top: 1px solid var(--cursor-border-muted);
        }

        .lang-chart-legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.625rem;
            color: var(--cursor-text-muted);
        }

        .lang-chart-legend-item .ldot {
            width: 8px;
            height: 8px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        /* ===== Mermaid Diagrams ===== */
        .mermaid-output {
            padding: var(--cursor-space-md);
            background: var(--cursor-bg);
            border-top: 1px solid var(--cursor-border);
            overflow-x: auto;
            display: flex;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: background 0.2s ease;
        }

        .mermaid-output:hover {
            background: var(--cursor-bg-tertiary);
        }

        .mermaid-output::after {
            content: 'â†— Click to expand';
            position: absolute;
            top: 6px;
            right: 8px;
            font-size: 0.5625rem;
            color: var(--cursor-text-muted);
            background: var(--cursor-bg-secondary);
            padding: 2px 6px;
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }

        .mermaid-output:hover::after {
            opacity: 1;
        }

        .mermaid-output svg {
            max-width: 100%;
            height: auto;
        }

        /* ===== Layer Navigator ===== */
        .layer-nav {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            margin-top: var(--cursor-space-sm);
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-md);
            padding: 4px 8px;
        }

        .layer-nav .layer-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm);
            background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-secondary);
            font-size: 0.8125rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            flex-shrink: 0;
        }

        .layer-nav .layer-btn:hover {
            background: var(--cursor-bg-hover);
            color: var(--cursor-text);
            border-color: var(--cursor-text-muted);
        }

        .layer-nav .layer-btn:active { transform: scale(0.92); }

        .layer-label {
            flex: 1;
            text-align: center;
            font-family: var(--cursor-font-mono);
            font-size: 0.6875rem;
            color: var(--cursor-text-muted);
            letter-spacing: 0.3px;
            white-space: nowrap;
        }

        .layer-label strong {
            color: var(--cursor-accent);
            font-size: 0.8125rem;
            transition: transform 0.3s ease, color 0.3s ease;
            display: inline-block;
        }

        /* ===== Footer Terminal ===== */
        .notepad-footer {
            flex-shrink: 0;
            background: var(--cursor-bg-secondary);
            border-top: 1px solid var(--cursor-border);
            padding: var(--cursor-space-sm) var(--cursor-space-lg);
            display: flex;
            flex-direction: column;
            gap: var(--cursor-space-xs);
        }

        .footer-ai-row {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
        }

        .footer-ai-row input {
            flex: 1;
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-accent);
            border-radius: var(--cursor-radius-sm);
            padding: 6px 10px;
            color: var(--cursor-text);
            font-size: 0.8125rem;
            font-family: inherit;
            outline: none;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .footer-ai-row input:focus {
            border-color: var(--cursor-accent);
            box-shadow: 0 0 0 2px rgba(88, 166, 255, 0.15);
        }

        .footer-ai-row input::placeholder {
            color: var(--cursor-text-muted);
            opacity: 0.6;
        }

        .footer-cmd-row {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
        }

        .footer-prompt-symbol {
            color: var(--cursor-accent);
            font-weight: 700;
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            flex-shrink: 0;
        }

        .footer-cmd-row input {
            flex: 1;
            background: var(--cursor-bg);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-sm);
            padding: 6px 10px;
            color: var(--cursor-text);
            font-size: 0.8125rem;
            font-family: var(--cursor-font-mono);
            outline: none;
            transition: border-color 0.15s ease;
        }

        .footer-cmd-row input:focus {
            border-color: var(--cursor-accent);
        }

        .footer-cmd-row input::placeholder {
            color: var(--cursor-text-muted);
            opacity: 0.5;
        }

        .top-quick-cmds {
            display: flex;
            flex-direction: column;
            gap: 3px;
            padding: 4px 12px;
            background: var(--cursor-bg-tertiary);
            border-bottom: 1px solid var(--cursor-border-muted);
        }
        .top-quick-cmds .fqc-tabbar { justify-content: flex-start; }
        .top-quick-cmds .fqc-panel { justify-content: flex-start; }
        .top-quick-cmds .btn--xs {
            padding: 2px 8px;
            font-size: 0.625rem;
            border-radius: 4px;
            font-weight: 500;
        }
        .top-quick-cmds .tools-dropdown {
            bottom: auto;
            top: 100%;
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
        }

        .footer-quick-cmds {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        .fqc-tabbar {
            display: flex;
            gap: 2px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        .fqc-tab {
            padding: 2px 7px;
            font-size: 0.5625rem;
            font-weight: 600;
            border: 1px solid var(--cursor-border);
            border-radius: 4px;
            background: var(--cursor-bg-tertiary);
            color: var(--cursor-text-muted);
            cursor: pointer;
            transition: all 0.12s;
            white-space: nowrap;
        }
        .fqc-tab:hover { color: var(--cursor-text-secondary); border-color: var(--cursor-text-muted); }
        .fqc-tab.active { background: var(--cursor-accent-subtle); color: var(--cursor-accent); border-color: var(--cursor-accent); }
        .fqc-panel {
            display: none;
            gap: 3px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-start;
        }
        .fqc-panel.active { display: flex; }

        .footer-quick-cmds .btn--xs {
            padding: 2px 8px;
            font-size: 0.625rem;
            border-radius: 4px;
            font-weight: 500;
        }

        /* ===== Cell Output Overlay ===== */
        .cell-overlay {
            position: fixed;
            inset: 0;
            z-index: 800;
            display: none;
        }

        .cell-overlay.open { display: flex; }

        .cell-overlay .cell-overlay-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(4px);
        }

        .cell-overlay-panel {
            position: relative;
            margin: 32px auto;
            width: min(960px, calc(100vw - 48px));
            max-height: calc(100vh - 64px);
            background: var(--cursor-bg-secondary);
            border: 1px solid var(--cursor-border);
            border-radius: var(--cursor-radius-xl);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--cursor-shadow-xl), 0 0 60px rgba(88, 166, 255, 0.08);
            z-index: 1;
        }

        .cell-overlay-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--cursor-space-sm) var(--cursor-space-lg);
            border-bottom: 1px solid var(--cursor-border);
            flex-shrink: 0;
        }

        .cell-overlay-header h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--cursor-text);
            display: flex;
            align-items: center;
            gap: var(--cursor-space-sm);
            margin: 0;
            text-transform: none;
            border: none;
            padding: 0;
        }

        .cell-overlay-body {
            flex: 1;
            overflow-y: auto;
            padding: var(--cursor-space-lg);
            font-family: var(--cursor-font-mono);
            font-size: 0.8125rem;
            line-height: 1.65;
            color: var(--cursor-text-secondary);
        }

        /* ===== Comparison Scorecard ===== */
        .scorecard {
            display: flex;
            gap: var(--cursor-space-md);
            margin-bottom: var(--cursor-space-lg);
            flex-wrap: wrap;
        }

        .score-pill {
            display: flex;
            align-items: center;
            gap: var(--cursor-space-xs);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .score-pill--wins {
            background: rgba(63, 185, 80, 0.15);
            color: #7ee787;
            border: 1px solid rgba(63, 185, 80, 0.3);
        }

        .score-pill--roadmap {
            background: rgba(139, 156, 247, 0.12);
            color: #8b9cf7;
            border: 1px solid rgba(139, 156, 247, 0.25);
        }

        .score-pill--gap {
            background: rgba(248, 81, 73, 0.08);
            color: var(--cursor-text-muted);
            border: 1px solid rgba(248, 81, 73, 0.15);
        }

        .score-pill .score-num {
            font-size: 1.0625rem;
            font-weight: 700;
        }

        /* Enhanced self-col glow */
        .compare-table .self-col {
            background: rgba(88, 166, 255, 0.08);
            color: var(--cursor-accent);
            font-weight: 600;
        }

        .compare-table thead .self-col {
            background: rgba(88, 166, 255, 0.15);
            color: var(--cursor-accent);
            font-weight: 700;
            text-shadow: 0 0 12px rgba(88, 166, 255, 0.3);
        }

        .compare-table tbody tr:hover .self-col {
            background: rgba(88, 166, 255, 0.14);
        }

        /* ===== Responsive ===== */
        @media (max-width: 1100px) {
            .notepad-header {
                padding: var(--cursor-space-sm) var(--cursor-space-md);
            }

            .notepad-header .status-badges {
                display: none;
            }

            .quantum-sidebar {
                width: 220px;
            }

            .notepad-footer {
                padding: var(--cursor-space-sm) var(--cursor-space-md);
            }
        }

        @media (max-width: 860px) {
            .notepad-content {
                flex-direction: column;
            }

            .quantum-sidebar {
                width: 100%;
                max-height: 220px;
                border-left: none;
                border-top: 1px solid var(--cursor-border);
                flex-direction: row;
                overflow-x: auto;
                overflow-y: hidden;
            }

            .quantum-sidebar .sidebar-section {
                min-width: 200px;
                border-bottom: none;
                border-right: 1px solid var(--cursor-border-muted);
            }

            .notepad-title .subtitle {
                display: none;
            }

            .footer-quick-cmds { display: none; }
            .top-quick-cmds { display: none; }
        }

        /* ===== Hex Stream Chat Widget (top-right) ===== */
        .hxs-toggle {
            position: fixed; top: 8px; right: 90px; z-index: 99998;
            background: var(--cursor-bg-secondary); border: 1px solid var(--cursor-border);
            border-radius: 6px; padding: 3px 10px; cursor: pointer;
            font-size: 0.625rem; font-weight: 700; color: var(--cursor-text-muted);
            font-family: var(--cursor-font-mono); display: flex; align-items: center; gap: 5px;
            transition: all 0.15s; box-shadow: 0 1px 4px var(--cursor-shadow, rgba(0,0,0,0.2));
            user-select: none; line-height: 1;
        }
        .hxs-toggle:hover { color: var(--cursor-text); border-color: var(--cursor-text-muted); }
        .hxs-toggle .hxs-dot { width: 5px; height: 5px; border-radius: 50%; background: #484f58; flex-shrink: 0; }
        .hxs-toggle .hxs-dot.live { background: #da3633; box-shadow: 0 0 6px rgba(218,54,51,0.5); animation: hxs-pulse 1.5s ease infinite; }
        @keyframes hxs-pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }

        .hxs-panel {
            position: fixed; top: 36px; right: 12px; z-index: 99997;
            width: 280px; max-height: 420px;
            background: var(--cursor-bg-secondary); border: 1px solid var(--cursor-border);
            border-radius: 8px; display: none; flex-direction: column;
            box-shadow: 0 4px 20px var(--cursor-shadow, rgba(0,0,0,0.3));
            overflow: hidden; font-size: 0.6875rem;
        }
        .hxs-panel.open { display: flex; }

        .hxs-video-area {
            position: relative; width: 100%; height: 0; background: #000;
            overflow: hidden; transition: height 0.2s ease;
        }
        .hxs-video-area.active { height: 140px; }
        .hxs-video-area video, .hxs-video-area canvas {
            width: 100%; height: 100%; object-fit: cover; display: block;
        }
        .hxs-video-bar {
            position: absolute; bottom: 0; left: 0; right: 0; display: flex; gap: 3px;
            padding: 3px 4px; background: rgba(0,0,0,0.6);
        }
        .hxs-video-btn {
            padding: 2px 6px; font-size: 0.5rem; font-weight: 600;
            border: 1px solid rgba(255,255,255,0.15); border-radius: 3px;
            background: rgba(255,255,255,0.08); color: #e6edf3;
            cursor: pointer; transition: all 0.12s;
        }
        .hxs-video-btn:hover { background: rgba(255,255,255,0.15); }
        .hxs-video-btn.active { background: rgba(218,54,51,0.3); border-color: #da3633; color: #f85149; }

        .hxs-msgs {
            flex: 1; overflow-y: auto; padding: 6px 8px;
            max-height: 200px; min-height: 80px;
        }
        .hxs-msg {
            margin-bottom: 4px; padding: 3px 6px; border-radius: 5px;
            background: var(--cursor-bg-tertiary); font-size: 0.625rem;
            line-height: 1.4; word-break: break-word;
        }
        .hxs-msg .hxs-msg-user {
            font-weight: 700; color: var(--cursor-accent); margin-right: 4px;
        }
        .hxs-msg .hxs-msg-time {
            font-size: 0.5rem; color: var(--cursor-text-muted); float: right;
        }
        .hxs-msg.system { color: var(--cursor-text-muted); font-style: italic; background: none; padding: 1px 6px; }

        .hxs-input-bar {
            display: flex; gap: 4px; padding: 5px 6px;
            border-top: 1px solid var(--cursor-border-muted);
            background: var(--cursor-bg);
        }
        .hxs-input {
            flex: 1; padding: 4px 8px; font-size: 0.625rem;
            border: 1px solid var(--cursor-border); border-radius: 4px;
            background: var(--cursor-bg-tertiary); color: var(--cursor-text);
            font-family: var(--cursor-font-mono); outline: none;
        }
        .hxs-input:focus { border-color: var(--cursor-accent); }
        .hxs-send-btn {
            padding: 4px 10px; font-size: 0.5625rem; font-weight: 700;
            border: 1px solid var(--cursor-accent); border-radius: 4px;
            background: var(--cursor-accent-subtle); color: var(--cursor-accent);
            cursor: pointer; transition: all 0.12s; white-space: nowrap;
        }
        .hxs-send-btn:hover { background: var(--cursor-accent); color: #fff; }

        /* ===== Chalk / Handwritten Mode ===== */
        .chalk-toggle-btn {
            position: fixed; bottom: 48px; right: 16px; z-index: 9999;
            width: 32px; height: 32px; border-radius: 50%;
            border: 1px solid var(--cursor-border);
            background: var(--cursor-bg-secondary);
            color: var(--cursor-text-muted);
            font-size: 0.875rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .chalk-toggle-btn:hover { color: var(--cursor-text); transform: scale(1.1); }
        .chalk-toggle-btn.active { background: rgba(255,225,56,0.15); color: #ffe138;
            border-color: rgba(255,225,56,0.4); }

        /* When chalk mode is active on body */
        body[data-chalk="on"] {
            --chalk-font: 'Caveat', 'Marker Felt', 'Comic Sans MS', cursive;
        }

        body[data-chalk="on"] .sidebar-title,
        body[data-chalk="on"] .sidebar-tab,
        body[data-chalk="on"] .cell-type,
        body[data-chalk="on"] .cell-nav-btn,
        body[data-chalk="on"] .nb-cat-label,
        body[data-chalk="on"] .nb-pipeline-stage,
        body[data-chalk="on"] .nb-chip,
        body[data-chalk="on"] .cell-list-item,
        body[data-chalk="on"] .perf-row,
        body[data-chalk="on"] .tag,
        body[data-chalk="on"] .btn--xs,
        body[data-chalk="on"] .status-badge,
        body[data-chalk="on"] .notepad-title,
        body[data-chalk="on"] .cell-nav-counter,
        body[data-chalk="on"] .nb-block-head {
            font-family: var(--chalk-font) !important;
            letter-spacing: 0.3px;
        }

        body[data-chalk="on"] .sidebar-title {
            font-size: 1rem; font-weight: 700;
        }
        body[data-chalk="on"] .sidebar-tab {
            font-size: 0.875rem;
        }
        body[data-chalk="on"] .cell-list-item {
            font-size: 0.875rem;
        }
        body[data-chalk="on"] .nb-chip {
            font-size: 0.75rem;
        }
        body[data-chalk="on"] .nb-cat-label {
            font-size: 0.6875rem;
        }
        body[data-chalk="on"] .nb-pipeline-stage {
            font-size: 0.625rem;
        }

        /* Sketchy borders â€” slightly irregular radius */
        body[data-chalk="on"] .quantum-cell {
            border-radius: 6px 12px 8px 14px;
            border-style: dashed;
            border-width: 1.5px;
        }
        body[data-chalk="on"] .cell-header {
            border-radius: 5px 11px 0 0;
        }
        body[data-chalk="on"] .sidebar-section {
            border-bottom-style: dashed;
        }
        body[data-chalk="on"] .nb-cat-group {
            border-radius: 10px 6px 12px 8px;
            border-width: 1.5px;
        }
        body[data-chalk="on"] .nb-chip {
            border-radius: 14px 10px 16px 12px;
            border-style: dashed;
        }
        body[data-chalk="on"] .cell-nav-btn {
            border-radius: 6px 4px 8px 5px;
            border-style: dashed;
        }

        /* Chalkboard texture overlay on cells container */
        body[data-chalk="on"] .cells-container::before {
            content: '';
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 28px,
                rgba(255,255,255,0.012) 28px,
                rgba(255,255,255,0.012) 29px
            );
            pointer-events: none; z-index: 0;
        }

        /* Slight tilt on blocks builder canvas blocks */
        body[data-chalk="on"] .nb-block {
            border-radius: 6px 10px 8px 12px;
            border: 1.5px dashed;
        }
        body[data-chalk="on"] .nb-block:nth-child(odd) { transform: rotate(-0.3deg); }
        body[data-chalk="on"] .nb-block:nth-child(even) { transform: rotate(0.4deg); }

        /* Softer shadows for organic feel */
        body[data-chalk="on"] .quantum-cell {
            box-shadow: 2px 3px 0 rgba(255,255,255,0.04), -1px -1px 0 rgba(255,255,255,0.02);
        }

        /* Wavy underlines on titles */
        body[data-chalk="on"] .sidebar-title {
            text-decoration: underline wavy;
            text-decoration-color: rgba(255,225,56,0.3);
            text-underline-offset: 3px;
        }

        /* Hand-drawn feel for performance rows */
        body[data-chalk="on"] .perf-row {
            font-family: var(--chalk-font);
            font-size: 0.875rem;
            border-bottom-style: dotted;
        }
    </style>
</head>
<body>
    <div style="display:flex;height:2px;width:100%;flex-shrink:0"><span style="flex:1;background:#ff3838"></span><span style="flex:1;background:#ff8c38"></span><span style="flex:1;background:#ffe138"></span><span style="flex:1;background:#3fb950"></span><span style="flex:1;background:#38a5ff"></span><span style="flex:1;background:#bc8cff"></span></div>

    <!-- ===== Hex Stream Chat Widget ===== -->
    <button class="hxs-toggle" id="hxs-toggle" title="Hex Stream â€” chat & share screen">
        <span class="hxs-dot" id="hxs-dot"></span>
        HexStream
    </button>
    <div class="hxs-panel" id="hxs-panel">
        <div class="hxs-video-area" id="hxs-video-area">
            <video id="hxs-vid" autoplay playsinline muted style="display:none;"></video>
            <canvas id="hxs-canvas" width="280" height="140" style="display:none;"></canvas>
            <div id="hxs-vid-ph" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#484f58;font-size:0.5rem;font-family:var(--cursor-font-mono);">No stream active</div>
            <div class="hxs-video-bar">
                <button class="hxs-video-btn" id="hxs-cam-btn" title="Camera">ðŸ“·</button>
                <button class="hxs-video-btn" id="hxs-scr-btn" title="Share screen">ðŸ–µ</button>
                <button class="hxs-video-btn" id="hxs-stop-btn" title="Stop stream">â¹</button>
            </div>
        </div>
        <div class="hxs-msgs" id="hxs-msgs">
            <div class="hxs-msg system">HexStream ready â€” chat or share screen</div>
        </div>
        <div class="hxs-input-bar">
            <input class="hxs-input" id="hxs-input" type="text" placeholder="Type a messageâ€¦" autocomplete="off" maxlength="500">
            <button class="hxs-send-btn" id="hxs-send-btn">Send</button>
        </div>
    </div>

    <div class="notepad-container">
        <!-- Header -->
        <div class="notepad-header">
            <div class="notepad-title">
                <span id="numsy-logo" title="Numsy â€” click to interact">
                    <span class="numsy-logo-bubble" id="numsy-bubble"></span>
                    <span class="numsy-logo-body idle" id="numsy-body">
                        <span class="numsy-logo-cat" id="numsy-cat">
                            <span class="numsy-logo-rainbow">
                                <span class="nls" style="background:#f85149"></span>
                                <span class="nls" style="background:#f0883e"></span>
                                <span class="nls" style="background:#e3b341"></span>
                                <span class="nls" style="background:#3fb950"></span>
                                <span class="nls" style="background:#58a6ff"></span>
                                <span class="nls" style="background:#a78bfa"></span>
                            </span>
                            <span class="numsy-logo-tail" id="numsy-tail"></span>
                            <span class="numsy-logo-torso"></span>
                            <span class="numsy-logo-head">
                                <span class="nle-l"></span><span class="nle-r"></span>
                                <span class="numsy-logo-eyes">
                                    <span class="numsy-logo-eye" id="numsy-eye-l"></span>
                                    <span class="numsy-logo-eye" id="numsy-eye-r"></span>
                                </span>
                                <span class="numsy-logo-mouth" id="numsy-mouth">w</span>
                            </span>
                            <span class="numsy-logo-feet">
                                <span class="nlf"></span><span class="nlf"></span>
                            </span>
                        </span>
                    </span>
                </span>
                uvspeed â€” Quantum beyond<span style="font-weight:900;letter-spacing:0.5px;">BINARY</span> notepad
                <span class="subtitle">Dimensional code addressing &middot; {+1, 1, -1, +0, 0, -0, +n, n, -n} &middot; Charm visual layer</span>
            </div>

            <div class="quantum-status">
                <div class="status-badges">
                    <div class="status-indicator status-indicator--success">Charm Visual</div>
                    <div class="status-indicator status-indicator--success">Mermaid</div>
                    <div class="status-indicator status-indicator--success">Infinite Scroll</div>
                </div>

                <div class="header-actions">
                    <button class="btn btn--sm" id="add-cell-btn">+ Code</button>
                    <button class="btn btn--sm" id="add-mermaid-btn" title="Add Mermaid diagram cell">+ Diagram</button>
                    <button class="btn btn--primary btn--sm" id="run-all-btn">â–¶ Run All</button>
                    <button class="btn btn--sm" id="undo-btn" title="Undo (Ctrl+Z)">â†© Undo</button>
                    <button class="btn btn--sm" id="redo-btn" title="Redo (Ctrl+Shift+Z)">â†ª Redo</button>
                    <button class="btn btn--sm" id="save-btn">ðŸ’¾ Save</button>
                    <button class="btn btn--sm" id="load-btn" title="Load .json notebook">ðŸ“‚ Load</button>
                    <button class="btn btn--sm" id="inspect-btn" title="Inspect: limits, comparisons, trade-offs">ðŸ” Inspect</button>
                    <button class="btn btn--sm" id="terminal-btn" title="Toggle xterm.js terminal panel" style="font-size:0.75rem;">ðŸ’» Term</button>
                    <span id="bridge-status" style="font-size:0.625rem;color:var(--cursor-text-muted);padding:4px 8px;">ðŸ”´ Bridge: offline</span>
                    <span id="quest-status" style="font-size:0.625rem;color:var(--cursor-text-muted);padding:4px 8px;cursor:pointer;" title="Click to check Quest device">ðŸ¥½ Quest: â€”</span>
                </div>
            </div>
        </div>

        <!-- Execution Progress Bar -->
        <div class="exec-progress" id="exec-progress">
            <div class="exec-progress-inner">
                <span class="exec-progress-label" id="exec-progress-label">â–¶ Running</span>
                <div class="exec-progress-track">
                    <div class="exec-progress-fill" id="exec-progress-fill"></div>
                </div>
                <span class="exec-progress-pct" id="exec-progress-pct">0%</span>
                <span class="exec-progress-detail" id="exec-progress-detail"></span>
                <span class="exec-progress-elapsed" id="exec-progress-elapsed"></span>
            </div>
        </div>

        <!-- Top Quick Commands (mirrors footer tabs) -->
        <div class="top-quick-cmds" id="top-quick-cmds">
            <div class="fqc-tabbar" id="tqc-tabbar">
                <span class="fqc-tab active" data-tqc="cells">ðŸ“ Cells</span>
                <span class="fqc-tab" data-tqc="tools">ðŸ”§ Tools</span>
                <span class="fqc-tab" data-tqc="apps">ðŸš€ Apps</span>
                <span class="fqc-tab" data-tqc="addins">âž• Add-ins</span>
                <span class="fqc-tab" data-tqc="infra">âš™ Infra</span>
            </div>

            <!-- Panel: Cells (default) -->
            <div class="fqc-panel active" data-tqc-panel="cells">
                <button class="btn btn--xs" id="t-add-cell" title="Add code cell">+ Code</button>
                <button class="btn btn--xs" id="t-add-mermaid" title="Add diagram cell">+ Diagram</button>
                <button class="btn btn--xs" id="t-run-all" style="background:var(--cursor-accent);color:#fff;">â–¶ Run All</button>
                <button class="btn btn--xs" id="t-undo" title="Undo">â†©</button>
                <button class="btn btn--xs" id="t-redo" title="Redo">â†ª</button>
                <button class="btn btn--xs" id="t-save" title="Save">ðŸ’¾</button>
                <button class="btn btn--xs quick-cmd" data-cmd="qstatus">ðŸ“Š Status</button>
                <button class="btn btn--xs quick-cmd" data-cmd="help">â“ Help</button>
                <button class="btn btn--xs quick-cmd" data-cmd="pos">ðŸ“ Pos</button>
                <button class="btn btn--xs quick-cmd" data-cmd="cells">ðŸ“‹ Cells</button>
            </div>

            <!-- Panel: Tools -->
            <div class="fqc-panel" data-tqc-panel="tools">
                <button class="btn btn--xs" id="t-benchmark" title="Benchmark cell" style="background:#f0883e22;border-color:#f0883e55;color:#f0883e;">âš¡ Benchmark</button>
                <button class="btn btn--xs" id="t-security-scan" title="Security scan" style="background:#da363422;border-color:#da363455;color:#da3634;">ðŸ›¡ Scan</button>
                <button class="btn btn--xs" id="t-git-hook" title="Git hook" style="background:#8b5cf622;border-color:#8b5cf655;color:#8b5cf6;">ðŸª Hook</button>
                <button class="btn btn--xs quick-cmd" data-cmd="uv sync">ðŸ”„ Sync</button>
                <button class="btn btn--xs quick-cmd" data-cmd="q tinygrad">ðŸ” Search</button>
                <button class="btn btn--xs" id="t-quest" title="Quest status" style="background:#1877f222;border-color:#1877f255;color:#1877f2;">ðŸ¥½ Quest</button>
                <div style="position:relative;display:inline-block;">
                    <button class="btn btn--xs" id="t-tools" title="All tools" style="background:#7c3aed22;border-color:#7c3aed55;color:#7c3aed;">ðŸ”§ All Tools â–¾</button>
                    <div class="tools-dropdown" id="top-tools-dropdown">
                        <div class="tools-dropdown-header">Day Terminal</div>
                        <div class="tools-dropdown-item" data-tool="kbatch">âŒ¨ Kbatch â€” Keyboard Analysis</div>
                        <div class="tools-dropdown-item" data-tool="signal">ðŸ“¡ Signal â€” Morse/Binary/Waveform</div>
                        <div class="tools-dropdown-item" data-tool="geokey">ðŸ”· GeoKey â€” Geometric Mapper</div>
                        <div class="tools-dropdown-item" data-tool="youtube">ðŸŽ¬ YouTube â€” Transcript</div>
                        <div class="tools-dropdown-header">Electronics</div>
                        <div class="tools-dropdown-item" data-tool="hexbench">âš¡ hexbench â€” Voltage Lab</div>
                        <div class="tools-dropdown-header">ChartGPU</div>
                        <div class="tools-dropdown-item" data-tool="chartgpu-dash">ðŸ“Š ChartGPU Dashboard</div>
                        <div class="tools-dropdown-item" data-tool="chartgpu-metrics">âš¡ Live Metrics + AI</div>
                        <div class="tools-dropdown-header">Media Pipeline</div>
                        <div class="tools-dropdown-item" data-tool="jawta">ðŸ“¡ Jawta Signal Intel</div>
                        <div class="tools-dropdown-item" data-tool="media">ðŸŽž Media Process</div>
                        <div class="tools-dropdown-header">Meta Quest</div>
                        <div class="tools-dropdown-item" data-tool="quest-status">ðŸ¥½ Quest Status</div>
                        <div class="tools-dropdown-item" data-tool="quest-logs">ðŸ“œ Quest Logs</div>
                        <div class="tools-dropdown-item" data-tool="quest-screenshot">ðŸ“¸ Quest Screenshot</div>
                        <div class="tools-dropdown-header">Lark / Jawta</div>
                        <div class="tools-dropdown-item" data-tool="lark-status">ðŸ¦ Lark IANA Status</div>
                    </div>
                </div>
            </div>

            <!-- Panel: Apps -->
            <div class="fqc-panel" data-tqc-panel="apps">
                <button class="btn btn--xs" id="t-play-numsy" title="brotherNumsy" style="background:#e6b42222;border-color:#e6b42255;color:#e6b422;">ðŸŽ® brotherNumsy</button>
                <button class="btn btn--xs" id="t-open-kbatch" title="kbatch" style="background:#f0883e22;border-color:#f0883e55;color:#f0883e;">âŒ¨ kbatch</button>
                <button class="btn btn--xs" id="t-open-hexcast" title="hexcast" style="background:#da363322;border-color:#da363355;color:#f97583;">ðŸ“¡ hexcast</button>
                <button class="btn btn--xs" id="t-open-hexbench" title="hexbench" style="background:#ffe13822;border-color:#ffe13855;color:#ffe138;" onclick="openOverlay('hexbench.html','hexbench')">âš¡ hexbench</button>
                <button class="btn btn--xs" id="t-open-blackwell" title="Blackwell" style="background:#76b90022;border-color:#76b90055;color:#76b900;" onclick="openOverlay('blackwell.html','Blackwell')">ðŸŸ¢ Blackwell</button>
                <button class="btn btn--xs" id="t-open-questcast" title="questcast" style="background:#1877f222;border-color:#1877f255;color:#1877f2;" onclick="openOverlay('questcast.html','questcast')">ðŸ¥½ questcast</button>
                <button class="btn btn--xs" id="t-open-archflow" title="archflow" style="background:#ff6d5a22;border-color:#ff6d5a55;color:#ff6d5a;" onclick="openOverlay('archflow.html','archflow')">ðŸ”€ archflow</button>
                <button class="btn btn--xs" id="t-open-researchlab" title="Research Lab" style="background:#da368822;border-color:#da368855;color:#da3688;" onclick="openOverlay('research-lab.html','Research Lab')">ðŸ”¬ Research Lab</button>
                <button class="btn btn--xs" id="t-open-jawta" title="jawta audio" style="background:#c084fc22;border-color:#c084fc55;color:#c084fc;" onclick="openOverlay('jawta-audio.html','jawta audio')">ðŸŽµ jawta</button>
                <button class="btn btn--xs" id="t-open-dashboard" title="Dashboard" style="background:#23863622;border-color:#23863655;color:#238636;" onclick="openOverlay('github-dashboard.html','Dashboard')">ðŸ“Š Dashboard</button>
            </div>

            <!-- Panel: Add-ins (cell types) -->
            <div class="fqc-panel" data-tqc-panel="addins">
                <button class="btn btn--xs" id="t-freya-units" title="FreyaUnits cell" style="background:#7c3aed22;border-color:#7c3aed55;color:#a78bfa;">ðŸ”¬ FreyaUnits</button>
                <button class="btn btn--xs" id="t-add-quantum" title="quantum visual cell" style="background:#8b5cf622;border-color:#8b5cf655;color:#c4b5fd;">ðŸŒŒ + quantum</button>
                <button class="btn btn--xs" id="t-add-kbatch" title="kbatch cell" style="background:#f0883e22;border-color:#f0883e55;color:#f0883e;">âŒ¨ + kbatch</button>
                <button class="btn btn--xs" id="t-add-hexcast" title="hexcast cell" style="background:#da363322;border-color:#da363355;color:#f97583;">ðŸ“¡ + hexcast</button>
                <button class="btn btn--xs" id="t-add-hexbench" title="hexbench cell" style="background:#ffe13822;border-color:#ffe13855;color:#ffe138;">âš¡ + hexbench</button>
            </div>

            <!-- Panel: Infra -->
            <div class="fqc-panel" data-tqc-panel="infra">
                <button class="btn btn--xs quick-cmd" data-cmd="bridge">ðŸ”Œ Bridge</button>
                <button class="btn btn--xs quick-cmd" data-cmd="save">ðŸ’¾ Save</button>
                <button class="btn btn--xs quick-cmd" data-cmd="load">ðŸ“‚ Load</button>
                <button class="btn btn--xs quick-cmd" data-cmd="scan">ðŸ›¡ Scan All</button>
                <button class="btn btn--xs quick-cmd" data-cmd="hook">ðŸª Git Hook</button>
                <button class="btn btn--xs quick-cmd" data-cmd="tools">ðŸ“‹ List Tools</button>
            </div>
        </div>

        <!-- Convert Timeline Bar -->
        <div class="convert-timeline" id="convert-timeline">
            <span class="ctl-label">âš› CONVERT</span>
            <div class="ctl-track">
                <div class="ctl-fill" id="ctl-fill"></div>
                <div class="ctl-segments">
                    <div class="ctl-seg"><span class="ctl-seg-label">n:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">+1:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">-n:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">+0:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">0:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">-1:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">+n:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">1:</span></div>
                    <div class="ctl-seg"><span class="ctl-seg-label">-0:</span></div>
                </div>
            </div>
            <div class="ctl-stats">
                <span class="ctl-stat" id="ctl-lines">Lines: <b>0</b></span>
                <span class="ctl-stat" id="ctl-coverage">Coverage: <b>0%</b></span>
                <span class="ctl-stat" id="ctl-lang">Lang: <b>auto</b></span>
            </div>
            <button class="ctl-expand" id="ctl-expand" title="Quantum Heatmap â€” fullscreen COIN360-style visualization">â›¶</button>
        </div>

        <!-- Main Content -->
        <div class="notepad-content">
            <!-- Cells Container (Infinite Scroll) -->
            <div class="cells-container" id="cells-container">
                <!-- Dynamic cells will be inserted here -->
            </div>

            <!-- Quantum Sidebar -->
            <div class="quantum-sidebar">
                <!-- Extended Tab Row (AI / Language / Blocks) -->
                <div class="sidebar-tabs-ext" id="sidebar-tabs-ext">
                    <button class="sidebar-tab-ext" data-ext-tab="ai-tab" id="tab-ai">ðŸ¤– AI/LLM</button>
                    <button class="sidebar-tab-ext" data-ext-tab="lang-tab" id="tab-lang">ðŸŒ Language</button>
                    <button class="sidebar-tab-ext" data-ext-tab="blocks-tab" id="tab-blocks">ðŸ§± Blocks</button>
                </div>

                <!-- Sidebar Tab Bar -->
                <div class="sidebar-tabs" id="sidebar-tabs-main">
                    <button class="sidebar-tab active" data-tab="nav-tab" id="tab-nav">âš› Nav</button>
                    <button class="sidebar-tab" data-tab="visual-tab" id="tab-visual">ðŸ§Š Visual</button>
                    <button class="sidebar-tab" data-tab="thermal-tab" id="tab-thermal">ðŸŒ¡ Thermal</button>
                </div>

                <!-- ===== TAB 1: Navigation ===== -->
                <div class="sidebar-tab-panel active" id="nav-tab">
                <div class="sidebar-section">
                    <div class="sidebar-title">Quantum Navigation</div>

                    <!-- Quantum Nav â€” 2D slice / 3D cube -->
                    <div class="nav-cube-container" id="nav-cube-container">
                        <!-- Tab bar: 2D flat slice vs 3D Rubik's cube -->
                        <div class="ncv-tabs">
                            <button class="ncv-tab" id="ncv-tab-2d" data-ncv="2d">â¬¡ 2D Slice</button>
                            <button class="ncv-tab active" id="ncv-tab-3d" data-ncv="3d">ðŸŽ² 3D Cube</button>
                        </div>

                        <!-- 2D Slice â€” original flat grid (shown when 2D tab active) -->
                        <div id="ncv-2d-view" class="ncv-hidden" style="padding:0;">
                            <div class="quantum-nav-mini" id="ncv-2d-grid">
                                <button class="nav-btn" data-direction="+1" title="Lines up (+Y)">+1</button>
                                <button class="nav-btn" data-direction="0" title="Neutral">0</button>
                                <button class="nav-btn" data-direction="-1" title="Lines down (-Y)">-1</button>
                                <button class="nav-btn" data-direction="+n" title="Complexity up (+Z)">+n</button>
                                <button class="nav-btn active" data-direction="âš›" id="nav-center-btn" title="Reset to origin">âˆž</button>
                                <button class="nav-btn" data-direction="-n" title="Complexity down (-Z)">-n</button>
                                <button class="nav-btn" data-direction="+0" title="Dependencies right (+X)">+0</button>
                                <button class="nav-btn" data-direction="-0" title="Dependencies left (-X)">-0</button>
                                <button class="nav-btn" data-direction="+2" title="Jump +2 lines">+2</button>
                            </div>
                        </div>

                        <!-- 3D Cube viewport (clipped so faces can't escape) -->
                        <div class="ncv-viewport" id="ncv-3d-view">
                            <div class="nav-cube-scene" id="nav-cube-scene">
                                <div class="nav-cube-inner" id="nav-cube-inner">
                                    <!-- Front face â€” primary 9-symbol pad -->
                                    <div class="nav-cube-face ncf-front">
                                        <span data-nav="+1" style="--ncf-color:#ff383866;--ncf-glow:#ff383888">+1</span>
                                        <span data-nav="0"  style="--ncf-color:#58a6ff66;--ncf-glow:#58a6ff88">0</span>
                                        <span data-nav="-1" style="--ncf-color:#ff8c3866;--ncf-glow:#ff8c3888">-1</span>
                                        <span data-nav="+0" style="--ncf-color:#ffe13866;--ncf-glow:#ffe13888">+0</span>
                                        <span data-nav="âš›"  style="--ncf-color:#8b5cf666;--ncf-glow:#8b5cf688" class="ncf-active">âˆž</span>
                                        <span data-nav="-0" style="--ncf-color:#484f5866;--ncf-glow:#484f5888">-0</span>
                                        <span data-nav="+n" style="--ncf-color:#bc8cff66;--ncf-glow:#bc8cff88">+n</span>
                                        <span data-nav="-n" style="--ncf-color:#3fb95066;--ncf-glow:#3fb95088">-n</span>
                                        <span data-nav="+2" style="--ncf-color:#da363366;--ncf-glow:#da363388">+2</span>
                                    </div>
                                    <!-- Back -->
                                    <div class="nav-cube-face ncf-back">
                                        <span style="--ncf-color:#3fb95066;--ncf-glow:#3fb95088">n</span><span style="--ncf-color:#da363366;--ncf-glow:#da363388">-n</span><span style="--ncf-color:#bc8cff66;--ncf-glow:#bc8cff88">+n</span>
                                        <span style="--ncf-color:#484f5866;--ncf-glow:#484f5888">-0</span><span style="--ncf-color:#8b949e66;--ncf-glow:#8b949e88">0</span><span style="--ncf-color:#ffe13866;--ncf-glow:#ffe13888">+0</span>
                                        <span style="--ncf-color:#ff8c3866;--ncf-glow:#ff8c3888">-1</span><span style="--ncf-color:#58a6ff66;--ncf-glow:#58a6ff88">1</span><span style="--ncf-color:#ff383866;--ncf-glow:#ff383888">+1</span>
                                    </div>
                                    <!-- Right -->
                                    <div class="nav-cube-face ncf-right">
                                        <span style="--ncf-color:#ff8c3866;--ncf-glow:#ff8c3888">-1</span><span style="--ncf-color:#ffe13866;--ncf-glow:#ffe13888">+0</span><span style="--ncf-color:#3fb95066;--ncf-glow:#3fb95088">n</span>
                                        <span style="--ncf-color:#ff383866;--ncf-glow:#ff383888">+1</span><span style="--ncf-color:#8b949e66;--ncf-glow:#8b949e88">0</span><span style="--ncf-color:#da363366;--ncf-glow:#da363388">-n</span>
                                        <span style="--ncf-color:#58a6ff66;--ncf-glow:#58a6ff88">1</span><span style="--ncf-color:#484f5866;--ncf-glow:#484f5888">-0</span><span style="--ncf-color:#bc8cff66;--ncf-glow:#bc8cff88">+n</span>
                                    </div>
                                    <!-- Left -->
                                    <div class="nav-cube-face ncf-left">
                                        <span style="--ncf-color:#bc8cff66;--ncf-glow:#bc8cff88">+n</span><span style="--ncf-color:#484f5866;--ncf-glow:#484f5888">-0</span><span style="--ncf-color:#58a6ff66;--ncf-glow:#58a6ff88">1</span>
                                        <span style="--ncf-color:#da363366;--ncf-glow:#da363388">-n</span><span style="--ncf-color:#8b949e66;--ncf-glow:#8b949e88">0</span><span style="--ncf-color:#ff383866;--ncf-glow:#ff383888">+1</span>
                                        <span style="--ncf-color:#3fb95066;--ncf-glow:#3fb95088">n</span><span style="--ncf-color:#ffe13866;--ncf-glow:#ffe13888">+0</span><span style="--ncf-color:#ff8c3866;--ncf-glow:#ff8c3888">-1</span>
                                    </div>
                                    <!-- Top -->
                                    <div class="nav-cube-face ncf-top">
                                        <span style="--ncf-color:#bc8cff66;--ncf-glow:#bc8cff88">+n</span><span style="--ncf-color:#bc8cff66;--ncf-glow:#bc8cff88">+n</span><span style="--ncf-color:#bc8cff66;--ncf-glow:#bc8cff88">+n</span>
                                        <span style="--ncf-color:#ff383866;--ncf-glow:#ff383888">+1</span><span style="--ncf-color:#ff383866;--ncf-glow:#ff383888">+1</span><span style="--ncf-color:#ff383866;--ncf-glow:#ff383888">+1</span>
                                        <span style="--ncf-color:#ffe13866;--ncf-glow:#ffe13888">+0</span><span style="--ncf-color:#ffe13866;--ncf-glow:#ffe13888">+0</span><span style="--ncf-color:#ffe13866;--ncf-glow:#ffe13888">+0</span>
                                    </div>
                                    <!-- Bottom -->
                                    <div class="nav-cube-face ncf-bottom">
                                        <span style="--ncf-color:#da363366;--ncf-glow:#da363388">-n</span><span style="--ncf-color:#da363366;--ncf-glow:#da363388">-n</span><span style="--ncf-color:#da363366;--ncf-glow:#da363388">-n</span>
                                        <span style="--ncf-color:#ff8c3866;--ncf-glow:#ff8c3888">-1</span><span style="--ncf-color:#ff8c3866;--ncf-glow:#ff8c3888">-1</span><span style="--ncf-color:#ff8c3866;--ncf-glow:#ff8c3888">-1</span>
                                        <span style="--ncf-color:#484f5866;--ncf-glow:#484f5888">-0</span><span style="--ncf-color:#484f5866;--ncf-glow:#484f5888">-0</span><span style="--ncf-color:#484f5866;--ncf-glow:#484f5888">-0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Controls â€” always below the viewport, never obscured -->
                        <div class="ncv-controls" id="ncv-3d-controls">
                            <button class="nav-cube-arrow" id="nca-up" title="Rotate up">â–²</button>
                            <button class="nav-cube-arrow" id="nca-left" title="Rotate left">â—€</button>
                            <button class="nav-cube-arrow" id="nca-right" title="Rotate right">â–¶</button>
                            <button class="nav-cube-arrow" id="nca-down" title="Rotate down">â–¼</button>
                        </div>
                    </div>

                    <!-- (flat grid moved into ncv-2d-view above) -->

                    <!-- Layer Up/Down Navigator -->
                    <div class="layer-nav">
                        <button class="layer-btn" id="layer-down" title="Layer down (-Z complexity)">â–¼</button>
                        <div class="layer-label">Layer <strong id="layer-value">0</strong> <span style="opacity:0.5">Z</span></div>
                        <button class="layer-btn" id="layer-up" title="Layer up (+Z complexity)">â–²</button>
                    </div>

                    <div class="position-display" id="position-display">[0, 0, 0]</div>

                    <!-- Quantum Stream History -->
                    <div class="quantum-stream" id="quantum-stream">
                        <div class="stream-header">
                            <span class="stream-title">Stream History</span>
                            <div class="stream-pipe-btns">
                                <button class="stream-pipe-btn" id="stream-pipe-in" title="Pipe source in â€” paste or select source to trace">â‡¥ in</button>
                                <button class="stream-pipe-btn" id="stream-pipe-out" title="Pipe stream out â€” copy trace to clipboard">â‡¤ out</button>
                            </div>
                        </div>
                        <div class="stream-log" id="stream-log">
                            <div class="stream-entry stream-origin">âˆž origin [0, 0, 0]</div>
                        </div>
                        <div class="stream-source" id="stream-source" style="display:none;">
                            <textarea class="stream-source-input" id="stream-source-input" placeholder="Pipe source here to trace quantum coordinates..." rows="3"></textarea>
                            <button class="btn btn--sm" id="stream-source-trace" style="width:100%;margin-top:4px;">âš› Trace Source</button>
                        </div>
                    </div>
                </div>
                </div><!-- /nav-tab -->

                <!-- ===== TAB 2: Visual Slice / 3D Cube ===== -->
                <div class="sidebar-tab-panel" id="visual-tab">
                <div class="sidebar-section visual-viz">
                    <div class="sidebar-title">Visual Slice</div>

                    <!-- Mode toggle -->
                    <div class="visual-mode-bar">
                        <button class="visual-btn active" data-visual-mode="slice" title="2D cross-section of 3D code space at current Z layer">Slice</button>
                        <button class="visual-btn" data-visual-mode="cube" title="Interactive 3D Rubik's cube â€” code layers as stacked slices">Cube</button>
                        <button class="visual-btn" data-visual-mode="orb" title="Quantum orbital â€” spherical probability density">Orb</button>
                    </div>

                    <!-- 2D Slice canvas -->
                    <div class="visual-canvas-wrap" id="visual-slice-wrap">
                        <canvas id="visual-slice-canvas" width="480" height="480"></canvas>
                    </div>

                    <!-- 3D Rubik cube -->
                    <div class="cube-scene" id="visual-cube-wrap" style="display:none;">
                        <div class="cube-wrap" id="cube-wrap">
                            <!-- 27 cells generated by JS (3Ã—3Ã—3) -->
                        </div>
                    </div>

                    <!-- Orb canvas -->
                    <div class="visual-canvas-wrap" id="visual-orb-wrap" style="display:none;">
                        <canvas id="visual-orb-canvas" width="480" height="480"></canvas>
                    </div>

                    <!-- Cube controls -->
                    <div class="cube-controls" id="cube-controls">
                        <button class="cube-ctrl-btn" id="cube-auto" title="Auto-rotate">âŸ³ Auto</button>
                        <button class="cube-ctrl-btn" id="cube-explode" title="Explode view">ðŸ’¥ Explode</button>
                        <button class="cube-ctrl-btn" id="cube-reset" title="Reset rotation">âŠ™ Reset</button>
                        <button class="cube-ctrl-btn" id="cube-layer-mode" title="Toggle layer isolation">â—« Layer</button>
                    </div>

                    <!-- Stats -->
                    <div class="visual-section-label">Position State</div>
                    <div class="visual-stat-row"><span>X (dependency)</span><span class="visual-stat-val" id="vs-x" style="color:#3fb950;">0</span></div>
                    <div class="visual-stat-row"><span>Y (line)</span><span class="visual-stat-val" id="vs-y" style="color:#58a6ff;">0</span></div>
                    <div class="visual-stat-row"><span>Z (complexity)</span><span class="visual-stat-val" id="vs-z" style="color:#d2a8ff;">0</span></div>
                    <div class="visual-stat-row"><span>Current prefix</span><span class="visual-stat-val" id="vs-prefix" style="color:var(--cursor-accent);">âˆž</span></div>
                    <div class="visual-stat-row"><span>Active layer</span><span class="visual-stat-val" id="vs-layer" style="color:#f0883e;">0</span></div>
                    <div class="visual-stat-row"><span>Slice cells</span><span class="visual-stat-val" id="vs-cells" style="color:var(--cursor-text-secondary);">81</span></div>

                    <div class="visual-section-label">3D Addressing</div>
                    <div class="lattice-info">
                        <strong>9-symbol prefix</strong> â†’ 3D cube mapping<br>
                        +1/1/-1 = Y-axis (line navigation)<br>
                        +0/0/-0 = X-axis (dependency depth)<br>
                        +n/n/-n = Z-axis (complexity layers)<br>
                        Rubik stack: <strong id="cube-dim">3Ã—3Ã—3</strong> = <strong id="cube-sites">27</strong> cells
                    </div>
                </div>
                </div><!-- /visual-tab -->

                <!-- ===== TAB 3: Thermal Visualization ===== -->
                <div class="sidebar-tab-panel" id="thermal-tab">
                <div class="sidebar-section thermal-viz">
                    <div class="sidebar-title">Quantum Thermal State</div>

                    <!-- Temperature legend -->
                    <div class="thermal-legend">
                        <span class="thermal-legend-label">15 mK</span>
                        <div class="thermal-gradient"></div>
                        <span class="thermal-legend-label">300 K</span>
                    </div>

                    <!-- Mode buttons -->
                    <div class="thermal-controls">
                        <button class="thermal-btn active" data-thermal-mode="lattice" title="Optical lattice â€” egg-crate cold-atom simulator">Lattice</button>
                        <button class="thermal-btn" data-thermal-mode="flow" title="Live layer data-flow heat map">Flow</button>
                        <button class="thermal-btn" data-thermal-mode="gpu" title="GPU â†” Qubit scaling comparison">GPUâ†”Q</button>
                    </div>

                    <!-- Animated canvas -->
                    <div class="thermal-canvas-wrap">
                        <canvas id="thermal-canvas" width="480" height="480"></canvas>
                    </div>

                    <!-- Unit toggle -->
                    <div style="display:flex;gap:4px;margin-bottom:6px;">
                        <button class="thermal-btn active" id="unit-c" style="flex:0 0 36px;">Â°C</button>
                        <button class="thermal-btn" id="unit-f" style="flex:0 0 36px;">Â°F</button>
                        <button class="thermal-btn" id="unit-k" style="flex:0 0 36px;">K</button>
                    </div>

                    <!-- Stats: current thermal reading -->
                    <div class="thermal-section-label">Layer Thermal Map</div>
                    <div class="thermal-stat-row"><span>Cryo core (qubit)</span><span class="thermal-stat-val cryo" id="th-cryo">15 mK</span></div>
                    <div class="thermal-stat-row"><span>Dilution fridge</span><span class="thermal-stat-val cryo" id="th-fridge">âˆ’272.87 Â°C</span></div>
                    <div class="thermal-stat-row"><span>Photonic (Xanadu)</span><span class="thermal-stat-val warm" id="th-photonic">25.0 Â°C</span></div>
                    <div class="thermal-stat-row"><span>GPU junction</span><span class="thermal-stat-val hot" id="th-gpu">83.2 Â°C</span></div>

                    <!-- GPU â†” Qubit comparison -->
                    <div class="thermal-section-label">GPU â†” Qubit Scaling</div>
                    <div class="thermal-stat-row"><span>Qubit count</span><span class="thermal-stat-val qbit" id="th-qubits">50</span></div>
                    <div class="thermal-stat-row"><span>B200 GPUs needed</span><span class="thermal-stat-val hot" id="th-gpus">âˆž (impossible)</span></div>
                    <div class="gpu-qubit-bar"><div class="gpu-qubit-fill" id="gpu-fill" style="width:100%;background:linear-gradient(90deg,#3fb950,#f0883e,#f85149);"></div></div>

                    <!-- Qubit slider -->
                    <div style="display:flex;align-items:center;gap:6px;margin-top:4px;">
                        <span style="font-size:0.5625rem;color:var(--cursor-text-muted);">1</span>
                        <input type="range" id="qubit-slider" min="1" max="60" value="50" style="flex:1;accent-color:var(--cursor-accent);">
                        <span style="font-size:0.5625rem;color:var(--cursor-text-muted);">60</span>
                    </div>

                    <!-- Lattice info -->
                    <div class="thermal-section-label">Quantum Lattice</div>
                    <div class="lattice-info">
                        <strong>Optical egg-crate</strong> â€” 0.5 Âµm spacing<br>
                        Rydberg excitation â†’ atom entanglement<br>
                        Rubik's-cube multi-stack: <strong id="lattice-dim">5Ã—5Ã—5</strong> = <strong id="lattice-sites">125</strong> sites<br>
                        <span style="color:#d2a8ff;">Photonic (Xanadu)</span> â€” room-temp âœ“
                    </div>

                    <!-- ChartGPU Integration -->
                    <div class="thermal-section-label">ChartGPU</div>
                    <div style="display:flex;gap:4px;margin-bottom:4px;">
                        <button class="thermal-btn" id="chartgpu-launch" title="Open ChartGPU dashboard">ðŸ“Š Dashboard</button>
                        <button class="thermal-btn" id="chartgpu-metrics" title="Fetch live metrics">âš¡ Metrics</button>
                    </div>
                    <div class="thermal-stat-row"><span>ChartGPU</span><span class="thermal-stat-val" id="chartgpu-status-val" style="color:var(--cursor-text-muted);">offline</span></div>
                    <div class="thermal-stat-row"><span>CPU</span><span class="thermal-stat-val warm" id="cg-cpu">â€”</span></div>
                    <div class="thermal-stat-row"><span>Memory</span><span class="thermal-stat-val warm" id="cg-mem">â€”</span></div>

                    <!-- Hex / Fax Stream Viewer -->
                    <div class="thermal-section-label">HF Fax / Hex Stream</div>
                    <div style="display:flex;gap:4px;margin-bottom:4px;">
                        <button class="thermal-btn active" id="hex-mode-color" data-hex-mode="color">Color</button>
                        <button class="thermal-btn" id="hex-mode-gray" data-hex-mode="gray">Gray</button>
                        <button class="thermal-btn" id="hex-mode-fax" data-hex-mode="fax">Fax</button>
                        <button class="thermal-btn" id="hex-expand" title="Expand hex viewer overlay">â†—</button>
                    </div>
                    <div class="thermal-canvas-wrap" style="aspect-ratio:1;max-height:180px;">
                        <canvas id="hex-canvas" width="360" height="360"></canvas>
                    </div>
                </div>
                </div><!-- /thermal-tab -->

                <!-- ===== EXT TAB 1: AI / LLM ===== -->
                <div class="sidebar-tab-ext-panel" id="ai-tab">
                <div class="llm-panel">
                    <div class="sidebar-title">AI / LLM Models</div>

                    <div class="llm-model-card selected" data-llm="local" id="llm-local">
                        <div class="llm-model-name">ðŸŸ¢ Local (Ollama)</div>
                        <div class="llm-model-meta">llama3 Â· 8B Â· offline Â· 0 cost</div>
                    </div>
                    <div class="llm-model-card" data-llm="openai" id="llm-openai">
                        <div class="llm-model-name">ðŸ”µ OpenAI / GPT-4o</div>
                        <div class="llm-model-meta">Cloud API Â· 128K ctx Â· bridge required</div>
                    </div>
                    <div class="llm-model-card" data-llm="claude" id="llm-claude">
                        <div class="llm-model-name">ðŸŸ£ Anthropic / Claude</div>
                        <div class="llm-model-meta">Cloud API Â· 200K ctx Â· bridge required</div>
                    </div>
                    <div class="llm-model-card" data-llm="gemini" id="llm-gemini">
                        <div class="llm-model-name">ðŸŸ¡ Google / Gemini</div>
                        <div class="llm-model-meta">Cloud API Â· 1M ctx Â· bridge required</div>
                    </div>
                    <div class="llm-model-card" data-llm="hf" id="llm-hf">
                        <div class="llm-model-name">ðŸ¤— Hugging Face</div>
                        <div class="llm-model-meta">Transformers Â· local or API Â· custom models</div>
                    </div>

                    <div style="font-size:0.5625rem;color:var(--cursor-text-muted);margin:8px 0 4px;font-weight:600;">QUICK PROMPT</div>
                    <div class="llm-prompt-row">
                        <input type="text" id="llm-prompt-input" placeholder="Ask the selected model...">
                        <button id="llm-send-btn">â–¶</button>
                    </div>

                    <div style="font-size:0.5625rem;color:var(--cursor-text-muted);margin:10px 0 4px;font-weight:600;">SETTINGS</div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.5625rem;">
                        <div style="color:var(--cursor-text-secondary)">Temperature</div>
                        <input type="range" min="0" max="100" value="70" id="llm-temp" style="width:100%;">
                        <div style="color:var(--cursor-text-secondary)">Max tokens</div>
                        <input type="number" value="2048" min="64" max="8192" id="llm-max-tokens" style="width:100%;padding:2px 4px;font-size:0.5625rem;background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:3px;color:var(--cursor-text);font-family:var(--cursor-font-mono);">
                        <div style="color:var(--cursor-text-secondary)">System prompt</div>
                        <select id="llm-system" style="width:100%;padding:2px 4px;font-size:0.5rem;background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:3px;color:var(--cursor-text);">
                            <option value="code">Code assistant</option>
                            <option value="quantum">Quantum prefix</option>
                            <option value="explain">Explainer</option>
                            <option value="review">Code review</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div id="llm-status" style="margin-top:8px;font-size:0.5625rem;color:var(--cursor-text-muted);font-family:var(--cursor-font-mono);">Model: local (ollama) Â· idle</div>
                </div>
                </div><!-- /ai-tab -->

                <!-- ===== EXT TAB 2: Language ===== -->
                <div class="sidebar-tab-ext-panel" id="lang-tab">
                <div class="lang-panel">
                    <div class="sidebar-title">Language Packs</div>

                    <!-- Sub-tab bar -->
                    <div class="lang-subtabs" id="lang-subtabs">
                        <span class="lang-subtab active" data-lang-sub="lang-packs-sub">ðŸŒ Packs</span>
                        <span class="lang-subtab" data-lang-sub="lang-kbatch-sub">âŒ¨ kbatch</span>
                    </div>

                    <!-- Sub-panel: Language Packs -->
                    <div class="lang-subpanel active" id="lang-packs-sub">
                        <div style="font-size:0.5625rem;color:var(--cursor-text-muted);margin-bottom:6px;">20 quantum-prefix language packs â€” select to view coverage &amp; AST rules</div>

                        <div class="lang-grid" id="lang-grid">
                            <span class="lang-chip active" data-lang="python">Python</span>
                            <span class="lang-chip" data-lang="javascript">JS</span>
                            <span class="lang-chip" data-lang="typescript">TS</span>
                            <span class="lang-chip" data-lang="rust">Rust</span>
                            <span class="lang-chip" data-lang="go">Go</span>
                            <span class="lang-chip" data-lang="c">C</span>
                            <span class="lang-chip" data-lang="cpp">C++</span>
                            <span class="lang-chip" data-lang="java">Java</span>
                            <span class="lang-chip" data-lang="shell">Shell</span>
                            <span class="lang-chip" data-lang="ruby">Ruby</span>
                            <span class="lang-chip" data-lang="swift">Swift</span>
                            <span class="lang-chip" data-lang="kotlin">Kotlin</span>
                            <span class="lang-chip" data-lang="php">PHP</span>
                            <span class="lang-chip" data-lang="lua">Lua</span>
                            <span class="lang-chip" data-lang="r">R</span>
                            <span class="lang-chip" data-lang="sql">SQL</span>
                            <span class="lang-chip" data-lang="html">HTML</span>
                            <span class="lang-chip" data-lang="css">CSS</span>
                            <span class="lang-chip" data-lang="yaml">YAML</span>
                            <span class="lang-chip" data-lang="toml">TOML</span>
                        </div>

                        <div class="lang-info-box" id="lang-info-box">
                            <strong>Python</strong> â€” Coverage: <span style="color:#7ee787;">98%</span><br>
                            AST rules: <span style="color:var(--cursor-accent);">47</span> patterns<br>
                            Prefixes: all 9 symbols mapped<br>
                            <span style="color:var(--cursor-text-muted);">+1: class/def Â· +0: assign Â· n: import Â· -n: return Â· 0: pass/comment Â· -0: del Â· +n: raise Â· -1: except Â· +2: yield</span>
                        </div>

                        <div style="margin-top:8px;font-size:0.5625rem;color:var(--cursor-text-muted);font-weight:600;">DETECTION</div>
                        <div style="display:flex;gap:4px;margin-top:4px;">
                            <button class="btn btn--xs" id="lang-detect-btn" style="background:var(--cursor-accent-subtle);color:var(--cursor-accent);border-color:var(--cursor-accent);">ðŸ” Auto-detect</button>
                            <button class="btn btn--xs" id="lang-apply-btn">Apply to cell</button>
                        </div>
                        <div id="lang-detect-result" style="margin-top:6px;font-size:0.5625rem;color:var(--cursor-text-muted);font-family:var(--cursor-font-mono);display:none;"></div>
                    </div>

                    <!-- Sub-panel: kbatch Keyboard Analyzer -->
                    <div class="lang-subpanel" id="lang-kbatch-sub">
                        <div style="font-size:0.5625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Live keyboard analysis â€” thermal heatmap, contrails, data output</div>

                        <!-- Stats row -->
                        <div class="lkb-stats">
                            <span>WPM: <b style="color:#58a6ff;" id="lkb-wpm">0</b></span>
                            <span>Eff: <b style="color:#7ee787;" id="lkb-eff">0%</b></span>
                            <span>Keys: <b style="color:#d2a8ff;" id="lkb-keys">0</b></span>
                            <span>Words: <b style="color:#c9d1d9;" id="lkb-words">0</b></span>
                        </div>

                        <!-- 2x2 canvas grid -->
                        <div class="lkb-canvas-grid">
                            <div class="lkb-canvas-cell">
                                <div class="lkb-canvas-label" style="color:#f0883e;">ðŸ”¥ Thermal</div>
                                <canvas id="lkb-cv-thermal"></canvas>
                            </div>
                            <div class="lkb-canvas-cell">
                                <div class="lkb-canvas-label" style="color:#58a6ff;">âœˆ Contrails</div>
                                <canvas id="lkb-cv-contrails"></canvas>
                            </div>
                            <div class="lkb-canvas-cell">
                                <div class="lkb-canvas-label" style="color:#d2a8ff;">â¬¡ Geometric</div>
                                <canvas id="lkb-cv-geo"></canvas>
                            </div>
                            <div class="lkb-canvas-cell">
                                <div class="lkb-canvas-label" style="color:#7ee787;">ðŸŽ¹ Language</div>
                                <canvas id="lkb-cv-lang"></canvas>
                            </div>
                        </div>

                        <!-- Input -->
                        <input id="lkb-input" class="lkb-input" type="text" placeholder="Type here to analyze..." autocomplete="off" spellcheck="false">

                        <!-- Data output log -->
                        <div class="lkb-output" id="lkb-output">
                            <div style="color:#484f58;">Keystroke data will appear here...</div>
                        </div>

                        <!-- Actions -->
                        <div style="display:flex;flex-wrap:wrap;gap:4px;margin-top:6px;">
                            <button class="btn btn--xs" id="lkb-reset" style="background:rgba(240,136,62,.1);color:#f0883e;border-color:rgba(240,136,62,.3);">â†º Reset</button>
                            <button class="btn btn--xs" id="lkb-export" style="background:rgba(88,166,255,.1);color:#58a6ff;border-color:rgba(88,166,255,.3);">ðŸ“‹ Export</button>
                            <button class="btn btn--xs" id="lkb-fullpage" onclick="window.open('kbatch.html','_blank')" style="background:rgba(63,185,80,.1);color:#3fb950;border-color:rgba(63,185,80,.3);">â†— Full Page</button>
                        </div>
                    </div>
                </div>
                </div><!-- /lang-tab -->

                <!-- ===== EXT TAB 3: Blocks (Pybricks-style) ===== -->
                <div class="sidebar-tab-ext-panel" id="blocks-tab">
                <div class="blocks-panel">
                    <div class="sidebar-title">Block Builder</div>
                    <div style="font-size:0.5625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Pybricks-style visual code blocks â€” drag, connect, export</div>

                    <!-- Pipeline flow indicator -->
                    <div class="nb-pipeline">
                        <span class="nb-pipeline-stage s-init">Initialize</span>
                        <span class="nb-pipeline-arrow">â†’</span>
                        <span class="nb-pipeline-stage s-proc">Process</span>
                        <span class="nb-pipeline-arrow">â†’</span>
                        <span class="nb-pipeline-stage s-output">Output</span>
                    </div>

                    <div class="nb-palette" id="nb-palette">
                        <!-- Hub / Initialize -->
                        <div class="nb-cat-group">
                            <div class="nb-cat-label lbl-hub">Hub</div>
                            <div class="nb-cat-chips">
                                <span class="nb-chip cat-hub" data-nb="hub_init">Hub Init</span>
                                <span class="nb-chip cat-hub" data-nb="hub_light">Light</span>
                                <span class="nb-chip cat-hub" data-nb="hub_beep">Beep</span>
                            </div>
                        </div>
                        <!-- Motion -->
                        <div class="nb-cat-group">
                            <div class="nb-cat-label lbl-motion">Motion</div>
                            <div class="nb-cat-chips">
                                <span class="nb-chip cat-motion" data-nb="motor_run">Motor</span>
                                <span class="nb-chip cat-motion" data-nb="motor_stop">Stop</span>
                            </div>
                        </div>
                        <!-- Sensors -->
                        <div class="nb-cat-group">
                            <div class="nb-cat-label lbl-sensor">Sensors</div>
                            <div class="nb-cat-chips">
                                <span class="nb-chip cat-sensor" data-nb="color_read">Color</span>
                                <span class="nb-chip cat-sensor" data-nb="dist_read">Dist</span>
                            </div>
                        </div>
                        <!-- Logic + Flow -->
                        <div class="nb-cat-group">
                            <div class="nb-cat-label lbl-logic">Logic</div>
                            <div class="nb-cat-chips">
                                <span class="nb-chip cat-logic" data-nb="if_then">If</span>
                                <span class="nb-chip cat-logic" data-nb="wait_ms">Wait</span>
                                <span class="nb-chip cat-loop" data-nb="loop_forever">Loop</span>
                                <span class="nb-chip cat-loop" data-nb="loop_n">Loop N</span>
                            </div>
                        </div>
                        <!-- Variables & Output -->
                        <div class="nb-cat-group">
                            <div class="nb-cat-label lbl-var">Data</div>
                            <div class="nb-cat-chips">
                                <span class="nb-chip cat-var" data-nb="set_var">Set</span>
                                <span class="nb-chip cat-var" data-nb="print_val">Print</span>
                                <span class="nb-chip cat-stream" data-nb="stream_in">Stream</span>
                            </div>
                        </div>
                    </div>

                    <div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px;max-width:100%;">
                        <button class="btn btn--xs" id="nb-preset-drive" style="background:rgba(255,225,56,.1);color:#ffe138;border-color:rgba(255,225,56,.3);">Drive Bot</button>
                        <button class="btn btn--xs" id="nb-preset-sorter" style="background:rgba(63,185,80,.1);color:#3fb950;border-color:rgba(63,185,80,.3);">Color Sorter</button>
                        <button class="btn btn--xs" id="nb-export" style="background:rgba(88,166,255,.1);color:#58a6ff;border-color:rgba(88,166,255,.3);">Export .py</button>
                        <button class="btn btn--xs" id="nb-clear">Clear</button>
                    </div>

                    <div class="nb-canvas" id="nb-canvas">
                        <div class="nb-grid"></div>
                        <svg class="nb-connections-svg" id="nb-connections-svg"></svg>
                        <!-- blocks inserted by JS -->
                    </div>
                </div>
                </div><!-- /blocks-tab -->

                <!-- ===== ALWAYS-VISIBLE SECTIONS ===== -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Cell Overview</div>
                    <div class="cell-nav-bar">
                        <button class="cell-nav-btn" id="cnav-first" title="Jump to first cell">â‡¤</button>
                        <button class="cell-nav-btn" id="cnav-up" title="Previous cell (â†‘)">â–²</button>
                        <button class="cell-nav-btn" id="cnav-down" title="Next cell (â†“)">â–¼</button>
                        <button class="cell-nav-btn" id="cnav-last" title="Jump to last cell">â‡¥</button>
                        <input class="cell-nav-jump" id="cnav-jump" type="number" min="1" placeholder="#" title="Jump to cell number">
                        <span class="cell-nav-counter" id="cnav-counter">0/0</span>
                    </div>
                    <ul class="cell-list" id="cell-list">
                        <!-- Dynamic cell list -->
                    </ul>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">Performance</div>
                    <div class="perf-row">
                        <span>Cells loaded</span>
                        <span id="cells-loaded">0</span>
                    </div>
                    <div class="perf-row">
                        <span>Memory usage</span>
                        <span id="memory-usage">~0 MB</span>
                    </div>
                    <div class="perf-row">
                        <span>Execution time</span>
                        <span id="execution-time">0 ms</span>
                    </div>

                    <div class="perf-toggles">
                        <label>
                            <input type="checkbox" id="performance-mode" checked>
                            Performance mode
                        </label>
                        <label>
                            <input type="checkbox" id="auto-save">
                            Auto-save
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Terminal / AI Search -->
        <div class="notepad-footer">
            <div class="footer-ai-row">
                <input type="text" id="ai-input" placeholder="ðŸ¤– Ask AI â€” responses appear as new cells..." autocomplete="off">
                <button class="btn btn--primary btn--sm" id="ai-send-btn">ðŸ¤– AI Cell</button>
            </div>
            <div class="footer-cmd-row">
                <span class="footer-prompt-symbol">âš› +\-</span>
                <input type="text" id="cmd-input" placeholder="uv run, q search, qstatus, help..." autocomplete="off">
                <button class="btn btn--sm" id="cmd-exec-btn">Execute</button>
            </div>
            <div class="footer-quick-cmds">
                <!-- Tab bar â€” hexbench-style compact tabs -->
                <div class="fqc-tabbar" id="fqc-tabbar">
                    <span class="fqc-tab active" data-fqc="cells">ðŸ“ Cells</span>
                    <span class="fqc-tab" data-fqc="tools">ðŸ”§ Tools</span>
                    <span class="fqc-tab" data-fqc="apps">ðŸš€ Apps</span>
                    <span class="fqc-tab" data-fqc="addins">âž• Add-ins</span>
                    <span class="fqc-tab" data-fqc="infra">âš™ Infra</span>
                </div>

                <!-- Panel: Cells (default) -->
                <div class="fqc-panel active" data-fqc-panel="cells">
                    <button class="btn btn--xs" id="f-add-cell" title="Add code cell">+ Code</button>
                    <button class="btn btn--xs" id="f-add-mermaid" title="Add diagram cell">+ Diagram</button>
                    <button class="btn btn--xs" id="f-run-all" style="background:var(--cursor-accent);color:#fff;">â–¶ Run All</button>
                    <button class="btn btn--xs" id="f-undo" title="Undo">â†©</button>
                    <button class="btn btn--xs" id="f-redo" title="Redo">â†ª</button>
                    <button class="btn btn--xs" id="f-save" title="Save">ðŸ’¾</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="qstatus">ðŸ“Š Status</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="help">â“ Help</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="pos">ðŸ“ Pos</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="cells">ðŸ“‹ Cells</button>
                </div>

                <!-- Panel: Tools -->
                <div class="fqc-panel" data-fqc-panel="tools">
                    <button class="btn btn--xs" id="f-benchmark" title="Benchmark cell" style="background:#f0883e22;border-color:#f0883e55;color:#f0883e;">âš¡ Benchmark</button>
                    <button class="btn btn--xs" id="f-security-scan" title="Security scan" style="background:#da363422;border-color:#da363455;color:#da3634;">ðŸ›¡ Scan</button>
                    <button class="btn btn--xs" id="f-git-hook" title="Git hook" style="background:#8b5cf622;border-color:#8b5cf655;color:#8b5cf6;">ðŸª Hook</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="uv sync">ðŸ”„ Sync</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="q tinygrad">ðŸ” Search</button>
                    <button class="btn btn--xs" id="f-quest" title="Quest status" style="background:#1877f222;border-color:#1877f255;color:#1877f2;">ðŸ¥½ Quest</button>
                    <div style="position:relative;display:inline-block;">
                        <button class="btn btn--xs" id="f-tools" title="All tools" style="background:#7c3aed22;border-color:#7c3aed55;color:#7c3aed;">ðŸ”§ All Tools â–¾</button>
                        <div class="tools-dropdown" id="tools-dropdown">
                            <div class="tools-dropdown-header">Day Terminal</div>
                            <div class="tools-dropdown-item" data-tool="kbatch">âŒ¨ Kbatch â€” Keyboard Analysis</div>
                            <div class="tools-dropdown-item" data-tool="signal">ðŸ“¡ Signal â€” Morse/Binary/Waveform</div>
                            <div class="tools-dropdown-item" data-tool="geokey">ðŸ”· GeoKey â€” Geometric Mapper</div>
                            <div class="tools-dropdown-item" data-tool="youtube">ðŸŽ¬ YouTube â€” Transcript</div>
                            <div class="tools-dropdown-header">Electronics</div>
                            <div class="tools-dropdown-item" data-tool="hexbench">âš¡ hexbench â€” Voltage Lab</div>
                            <div class="tools-dropdown-header">ChartGPU</div>
                            <div class="tools-dropdown-item" data-tool="chartgpu-dash">ðŸ“Š ChartGPU Dashboard</div>
                            <div class="tools-dropdown-item" data-tool="chartgpu-metrics">âš¡ Live Metrics + AI</div>
                            <div class="tools-dropdown-header">Media Pipeline</div>
                            <div class="tools-dropdown-item" data-tool="jawta">ðŸ“¡ Jawta Signal Intel</div>
                            <div class="tools-dropdown-item" data-tool="media">ðŸŽž Media Process</div>
                            <div class="tools-dropdown-header">Meta Quest</div>
                            <div class="tools-dropdown-item" data-tool="quest-status">ðŸ¥½ Quest Status</div>
                            <div class="tools-dropdown-item" data-tool="quest-logs">ðŸ“œ Quest Logs</div>
                            <div class="tools-dropdown-item" data-tool="quest-screenshot">ðŸ“¸ Quest Screenshot</div>
                            <div class="tools-dropdown-header">Lark / Jawta</div>
                            <div class="tools-dropdown-item" data-tool="lark-status">ðŸ¦ Lark IANA Status</div>
                        </div>
                    </div>
                </div>

                <!-- Panel: Apps -->
                <div class="fqc-panel" data-fqc-panel="apps">
                    <button class="btn btn--xs" id="f-play-numsy" title="brotherNumsy" style="background:#e6b42222;border-color:#e6b42255;color:#e6b422;">ðŸŽ® brotherNumsy</button>
                    <button class="btn btn--xs" id="f-open-kbatch" title="kbatch" style="background:#f0883e22;border-color:#f0883e55;color:#f0883e;">âŒ¨ kbatch</button>
                    <button class="btn btn--xs" id="f-open-hexcast" title="hexcast" style="background:#da363322;border-color:#da363355;color:#f97583;">ðŸ“¡ hexcast</button>
                    <button class="btn btn--xs" id="f-open-hexbench" title="hexbench" style="background:#ffe13822;border-color:#ffe13855;color:#ffe138;" onclick="openOverlay('hexbench.html','hexbench')">âš¡ hexbench</button>
                    <button class="btn btn--xs" id="f-open-blackwell" title="Blackwell" style="background:#76b90022;border-color:#76b90055;color:#76b900;" onclick="openOverlay('blackwell.html','Blackwell')">ðŸŸ¢ Blackwell</button>
                    <button class="btn btn--xs" id="f-open-questcast" title="questcast" style="background:#1877f222;border-color:#1877f255;color:#1877f2;" onclick="openOverlay('questcast.html','questcast')">ðŸ¥½ questcast</button>
                    <button class="btn btn--xs" id="f-open-archflow" title="archflow" style="background:#ff6d5a22;border-color:#ff6d5a55;color:#ff6d5a;" onclick="openOverlay('archflow.html','archflow')">ðŸ”€ archflow</button>
                    <button class="btn btn--xs" id="f-open-researchlab" title="Research Lab" style="background:#da368822;border-color:#da368855;color:#da3688;" onclick="openOverlay('research-lab.html','Research Lab')">ðŸ”¬ Research Lab</button>
                    <button class="btn btn--xs" id="f-open-jawta" title="jawta audio" style="background:#c084fc22;border-color:#c084fc55;color:#c084fc;" onclick="openOverlay('jawta-audio.html','jawta audio')">ðŸŽµ jawta</button>
                    <button class="btn btn--xs" id="f-open-dashboard" title="Dashboard" style="background:#23863622;border-color:#23863655;color:#238636;" onclick="openOverlay('github-dashboard.html','Dashboard')">ðŸ“Š Dashboard</button>
                </div>

                <!-- Panel: Add-ins (cell types) -->
                <div class="fqc-panel" data-fqc-panel="addins">
                    <button class="btn btn--xs" id="f-freya-units" title="FreyaUnits cell" style="background:#7c3aed22;border-color:#7c3aed55;color:#a78bfa;">ðŸ”¬ FreyaUnits</button>
                    <button class="btn btn--xs" id="f-add-quantum" title="quantum visual cell" style="background:#8b5cf622;border-color:#8b5cf655;color:#c4b5fd;">ðŸŒŒ + quantum</button>
                    <button class="btn btn--xs" id="f-add-kbatch" title="kbatch cell" style="background:#f0883e22;border-color:#f0883e55;color:#f0883e;">âŒ¨ + kbatch</button>
                    <button class="btn btn--xs" id="f-add-hexcast" title="hexcast cell" style="background:#da363322;border-color:#da363355;color:#f97583;">ðŸ“¡ + hexcast</button>
                    <button class="btn btn--xs" id="f-add-hexbench" title="hexbench cell" style="background:#ffe13822;border-color:#ffe13855;color:#ffe138;">âš¡ + hexbench</button>
                </div>

                <!-- Panel: Infra -->
                <div class="fqc-panel" data-fqc-panel="infra">
                    <button class="btn btn--xs quick-cmd" data-cmd="bridge">ðŸ”Œ Bridge</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="save">ðŸ’¾ Save</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="load">ðŸ“‚ Load</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="scan">ðŸ›¡ Scan All</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="hook">ðŸª Git Hook</button>
                    <button class="btn btn--xs quick-cmd" data-cmd="tools">ðŸ“‹ List Tools</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== CELL OUTPUT OVERLAY ===== -->
    <div class="cell-overlay" id="cell-overlay">
        <div class="cell-overlay-backdrop" id="cell-overlay-backdrop"></div>
        <div class="cell-overlay-panel">
            <div class="cell-overlay-header">
                <h3 id="cell-overlay-title">âš¡ Cell Output</h3>
                <button class="inspect-close" id="cell-overlay-close">&times;</button>
            </div>
            <div class="cell-overlay-body" id="cell-overlay-body">
                <!-- dynamic -->
            </div>
        </div>
    </div>

    <!-- ===== QUANTUM HEATMAP FULLSCREEN (COIN360-style) ===== -->
    <div class="qheat-overlay" id="qheat-overlay">
        <div class="qheat-header">
            <span class="qheat-title">âš› Quantum Heatmap</span>
            <span class="qheat-subtitle">Treemap visualization of code prefix weight â€” sized by lines, colored by category</span>
            <button class="qheat-close" id="qheat-close" title="Close">&times;</button>
        </div>
        <div class="qheat-toolbar">
            <button class="qheat-mode-btn active" data-qheat-mode="treemap" title="Treemap â€” rectangles sized by weight">Treemap</button>
            <button class="qheat-mode-btn" data-qheat-mode="bubble" title="Bubble â€” circles sized by weight">Bubble</button>
            <button class="qheat-mode-btn" data-qheat-mode="bar" title="Bar chart">Bars</button>
            <button class="qheat-mode-btn" data-qheat-mode="sunburst" title="Sunburst â€” radial hierarchy">Sunburst</button>
            <span style="width:1px;height:16px;background:var(--cursor-border);margin:0 4px;flex-shrink:0;"></span>
            <button class="qheat-mode-btn" data-qheat-mode="slice" title="2D Slice â€” flat prefix grid heatmap">Slice</button>
            <button class="qheat-mode-btn" data-qheat-mode="orb" title="Orb â€” 3D probability sphere">Orb</button>
            <button class="qheat-mode-btn" data-qheat-mode="lattice" title="Lattice â€” quantum lattice network">Lattice</button>
            <button class="qheat-mode-btn" data-qheat-mode="cube3d" title="3D Cube â€” rotating prefix cube">3D Cube</button>
            <div class="qheat-legend" id="qheat-legend">
                <!-- filled by JS -->
            </div>
        </div>
        <div class="qheat-stats" id="qheat-stats">
            <span class="qheat-stat">Cells: <b id="qh-cells">0</b></span>
            <span class="qheat-stat">Lines: <b id="qh-lines">0</b></span>
            <span class="qheat-stat">Coverage: <b id="qh-coverage">0%</b></span>
            <span class="qheat-stat">Language: <b id="qh-lang">auto</b></span>
            <span class="qheat-stat">Prefixes: <b id="qh-prefixes">0/9</b></span>
        </div>
        <div class="qheat-body" id="qheat-body">
            <canvas class="qheat-canvas" id="qheat-canvas"></canvas>
        </div>
    </div>
    <div class="qheat-tooltip" id="qheat-tooltip">
        <div class="qheat-tooltip-title" id="qheat-tt-title"></div>
        <div class="qheat-tooltip-row"><span class="qheat-tooltip-label">Lines</span><span class="qheat-tooltip-val" id="qheat-tt-lines"></span></div>
        <div class="qheat-tooltip-row"><span class="qheat-tooltip-label">Weight</span><span class="qheat-tooltip-val" id="qheat-tt-weight"></span></div>
        <div class="qheat-tooltip-row"><span class="qheat-tooltip-label">Symbol</span><span class="qheat-tooltip-val" id="qheat-tt-sym"></span></div>
        <div class="qheat-tooltip-row"><span class="qheat-tooltip-label">Category</span><span class="qheat-tooltip-val" id="qheat-tt-cat"></span></div>
        <div class="qheat-tooltip-row"><span class="qheat-tooltip-label">Cell</span><span class="qheat-tooltip-val" id="qheat-tt-cell"></span></div>
    </div>

    <!-- ===== INSPECT PANEL ===== -->
    <div class="inspect-overlay" id="inspect-overlay">
        <div class="inspect-backdrop" id="inspect-backdrop"></div>
        <div class="inspect-panel">
            <div class="inspect-header" style="position:relative;">
                <h2>ðŸ” Inspect &mdash; uvspeed &middot; Quantum beyond<span style="font-weight:900;">BINARY</span> notepad</h2>
                <div style="position:absolute;right:48px;top:50%;transform:translateY(-50%);font-family:var(--cursor-font-mono);font-size:0.5625rem;color:var(--cursor-text-muted);text-align:right;line-height:1.3;">
                    <span style="color:var(--cursor-accent);font-weight:700;">last updated</span><br>
                    <span style="color:#8b949e;font-size:0.5rem;">unix</span> <span id="inspect-unix-ts" style="color:#7ee787;font-weight:600;font-size:0.625rem;"></span><br>
                    <span id="inspect-version-stamp" style="color:#d2a8ff;font-weight:600;font-size:0.5625rem;">v4.0 Â· Phase 4.0</span>
                </div>
                <button class="inspect-close" id="inspect-close">&times;</button>
            </div>
            <div class="inspect-body">

                <!-- ====== DEV TIMELINE ====== -->
                <div class="inspect-section" style="border-bottom:2px solid var(--cursor-accent);">
                    <h3>uvspeed &mdash; Development Timeline</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        Git commit history + file signatures. <strong style="color:#7ee787;">Phase 4.0 shipped &amp; pushed to GitHub.</strong>
                    </p>

                    <!-- Commit history -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Git Commits</div>
                    <div style="display:grid;grid-template-columns:1fr;gap:4px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.625rem;">
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(139,92,246,0.08);border:1px solid rgba(139,92,246,0.3);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">HEAD</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#d2a8ff;">v4.0 &mdash; Tauri desktop app, hexterm terminal, multi-stream, funding &amp; sponsor page</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">33669e4</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#7ee787;">Add screenshots back to README with collapsible gallery</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">259a2d7</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#7ee787;">v4.0.0 &mdash; Tauri desktop app, hexterm, multi-stream, funding &amp; sponsor page</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">83a3094</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#7ee787;">v3.4.0 &mdash; In-cell tools, touch events, PWA offline mode</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">0003c6e</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#7ee787;">GitHub community standards, Dependabot, project health dashboard</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">b72da21</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#7ee787;">v3.3.0 &mdash; Multi-instance, MCP server, dynamic Ollama, tinygrad classifier</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">d239a34</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#7ee787;">v3.0.0 &mdash; Project restructure: numbered src/, clean root, Electron 40.4</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">e3c8745</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#7ee787;">Screenshots, notepad cells for kbatch/hexcast, Phase 3 cross-check</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">77f612f</span>
                            <span style="color:var(--cursor-text-muted);">Feb 12</span>
                            <span style="color:#7ee787;">kbatch keyboard analyzer + hexcast video broadcast + inspect update</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">409df5c</span>
                            <span style="color:var(--cursor-text-muted);">Feb 11</span>
                            <span style="color:#7ee787;">Nyan Cat ambience, FreyaUnits cell, live code editor &amp; terminal</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">d25345c</span>
                            <span style="color:var(--cursor-text-muted);">Feb 11</span>
                            <span style="color:#7ee787;">brotherNumsy &amp; Freya beyondBINARY runner game with FreyaUnits</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">abb4a61</span>
                            <span style="color:var(--cursor-text-muted);">Feb 11</span>
                            <span style="color:var(--cursor-text);">Phase 2: security scanner + git hooks + 25 API endpoints</span>
                        </div>
                        <div style="display:grid;grid-template-columns:64px 60px 1fr;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:var(--cursor-accent);">77f24ac</span>
                            <span style="color:var(--cursor-text-muted);">Feb 10</span>
                            <span style="color:var(--cursor-text);">Initial UV-Speed Quantum Terminal package</span>
                        </div>
                    </div>

                    <!-- File signatures -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Core File Signatures</div>
                    <div style="display:grid;grid-template-columns:1fr;gap:2px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.5625rem;">
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(139,92,246,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+0:</span>
                            <span style="color:#d2a8ff;">~450 KB</span>
                            <span style="color:var(--cursor-text);">web/quantum-notepad.html</span>
                            <span style="color:var(--cursor-text-muted);">Main UI &mdash; 3-tab sidebar (Nav/Visual/Thermal), 3D cube, inspect, 9K+ lines</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(139,92,246,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+0:</span>
                            <span style="color:#d2a8ff;">~120 KB</span>
                            <span style="color:var(--cursor-text);">web/terminal.html</span>
                            <span style="color:var(--cursor-text-muted);">hexterm &mdash; full terminal emulator, virtual FS, device presets, quantum gutter</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(139,92,246,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+0:</span>
                            <span style="color:#d2a8ff;">~60 KB</span>
                            <span style="color:var(--cursor-text);">web/sponsor.html</span>
                            <span style="color:var(--cursor-text-muted);">Promo &amp; funding page &mdash; animated chars, Rubik&rsquo;s cube, tool showcase</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>
                            <span style="color:#f0883e;">~8 KB</span>
                            <span style="color:var(--cursor-text);">src-tauri/src/main.rs</span>
                            <span style="color:var(--cursor-text-muted);">Tauri v2 &mdash; window mgr, native menus, device presets, 50+ devices</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>
                            <span style="color:#f0883e;">96 KB</span>
                            <span style="color:var(--cursor-text);">src/01-core/quantum_bridge_server.py</span>
                            <span style="color:var(--cursor-text-muted);">Backend &mdash; 55+ endpoints, instance mgr, Ollama, tinygrad classifier</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+n:</span>
                            <span style="color:#f0883e;">85 KB</span>
                            <span style="color:var(--cursor-text);">web/brothernumsy.html</span>
                            <span style="color:var(--cursor-text-muted);">Side-scroller game &mdash; brotherNumsy &amp; Freya runner</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#f0883e;">~40 KB</span>
                            <span style="color:var(--cursor-text);">web/grid.html</span>
                            <span style="color:var(--cursor-text-muted);">Multi-stream canvas grid &mdash; 2x2/3x3/4x4, device mgmt, dev console</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#f0883e;">~35 KB</span>
                            <span style="color:var(--cursor-text);">web/feed.html</span>
                            <span style="color:var(--cursor-text-muted);">Video/audio feed &mdash; waveform, speech transcript, BroadcastChannel</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#f0883e;">36 KB</span>
                            <span style="color:var(--cursor-text);">web/hexcast.html</span>
                            <span style="color:var(--cursor-text-muted);">Live video hex broadcast &mdash; 4 modes, latency benchmarks</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#f0883e;">34 KB</span>
                            <span style="color:var(--cursor-text);">web/kbatch.html</span>
                            <span style="color:var(--cursor-text-muted);">Keyboard contrail/pattern analyzer &mdash; thermal heatmaps</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#76b900;">35 KB</span>
                            <span style="color:var(--cursor-text);">web/blackwell.html</span>
                            <span style="color:var(--cursor-text-muted);">NVIDIA Blackwell &mdash; SM heatmap, data streams, deploy targets</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#1877f2;">18 KB</span>
                            <span style="color:var(--cursor-text);">web/questcast.html</span>
                            <span style="color:var(--cursor-text-muted);">Meta Quest broadcast &mdash; Detectron2, BabyTrack, SAM, depth</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#ff6d5a;">18 KB</span>
                            <span style="color:var(--cursor-text);">web/archflow.html</span>
                            <span style="color:var(--cursor-text-muted);">n8n-style architecture visualizer &mdash; nodes, connections, Mermaid</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#c084fc;">20 KB</span>
                            <span style="color:var(--cursor-text);">web/jawta-audio.html</span>
                            <span style="color:var(--cursor-text-muted);">Spatial audio &mdash; Dolby Atmos 7.1.4, binaural, Strudel live code</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#238636;">36 KB</span>
                            <span style="color:var(--cursor-text);">web/github-dashboard.html</span>
                            <span style="color:var(--cursor-text-muted);">GitHub health dashboard &mdash; traffic, code freq, funding, releases</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+0:</span>
                            <span style="color:#ffe138;">~95 KB</span>
                            <span style="color:var(--cursor-text);">web/hexbench.html</span>
                            <span style="color:var(--cursor-text-muted);">Voltage lab &mdash; PSU monitor, Arduino editor, node workbench, Pybricks builder</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#da3688;">~35 KB</span>
                            <span style="color:var(--cursor-text);">web/research-lab.html</span>
                            <span style="color:var(--cursor-text-muted);">Research editor &mdash; markdown + mermaid, node canvas, console</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#58a6ff;">~30 KB</span>
                            <span style="color:var(--cursor-text);">web/hexcast-send.html</span>
                            <span style="color:var(--cursor-text-muted);">Mobile PWA &mdash; phone camera streaming to hexcast receiver</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:#d2a8ff;">~12 KB</span>
                            <span style="color:var(--cursor-text);">web/numsy.html</span>
                            <span style="color:var(--cursor-text-muted);">1080&times;1080 Instagram visual generator</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;background:rgba(88,166,255,0.04);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">-n:</span>
                            <span style="color:#58a6ff;">~13 KB</span>
                            <span style="color:var(--cursor-text);">web/quantum-prefixes.js</span>
                            <span style="color:var(--cursor-text-muted);">Shared module &mdash; prefix API, cross-app BroadcastChannel sync, IoT bridge</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text-muted);">~15 KB</span>
                            <span style="color:var(--cursor-text);">web/launcher.html</span>
                            <span style="color:var(--cursor-text-muted);">Mode picker &mdash; instance/grid/web + command console</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">1:</span>
                            <span style="color:var(--cursor-text-muted);">~12 KB</span>
                            <span style="color:var(--cursor-text);">README.md</span>
                            <span style="color:var(--cursor-text-muted);">v4.0 &mdash; screenshots, architecture, 30 images, sponsor section</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 60px 260px 1fr;gap:6px;padding:4px 10px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text-muted);">3 KB</span>
                            <span style="color:var(--cursor-text);">.cursor/rules/quantum-prefix-gutter.mdc</span>
                            <span style="color:var(--cursor-text-muted);">IDE rule &mdash; always-on prefix AI training</span>
                        </div>
                    </div>

                    <!-- Phase milestones -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Phase Milestones</div>
                    <div style="display:flex;gap:6px;align-items:stretch;margin-bottom:var(--cursor-space-sm);flex-wrap:wrap;">
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">Phase 1 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Structural Bootstrap</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 10</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">Phase 2 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Bridge + Security</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 11</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">2.2 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Game + FreyaUnits</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 11</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">2.3 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">kbatch + hexcast</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 12</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">3.0 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Restructure</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 12</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">3.1 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Blackwell Live</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 12</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">3.2 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Dev Pages</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 12</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">3.3 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Multi-Instance</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 12</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(126,231,135,0.08);border:1px solid rgba(126,231,135,0.3);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#7ee787;font-weight:700;">3.4 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Cell Tools + PWA</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 12</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:rgba(139,92,246,0.1);border:1px solid rgba(139,92,246,0.4);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:#d2a8ff;font-weight:700;">4.0 âœ“</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Tauri + hexterm</div>
                            <div style="font-size:0.5rem;color:#484f58;">Feb 12</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:var(--cursor-text);font-weight:700;">4.1</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Agent Orchestration</div>
                            <div style="font-size:0.5rem;color:#484f58;">Next</div>
                        </div>
                        <div style="flex:1;min-width:80px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.625rem;color:var(--cursor-text);font-weight:700;">Phase 5</div>
                            <div style="font-size:0.5rem;color:var(--cursor-text-muted);">Native Terminal</div>
                            <div style="font-size:0.5rem;color:#484f58;">Future</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">20+ commits &middot; 4 days &middot; 12 phases complete</span>
                        <span class="tag tag--green">Phase 4.0 &mdash; Tauri Desktop App SHIPPED</span>
                        <span class="tag tag--blue">v4.0.0 &middot; Tauri v2 (Rust) &middot; 55+ endpoints</span>
                        <span class="tag tag--purple">github.com/fornevercollective/uvspeed</span>
                        <span class="tag tag--yellow">18 web apps + hexterm + multi-stream + funding LIVE</span>
                    </div>
                </div>

                <!-- ====== AGENT-READY STATUS DASHBOARD ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Agent-Ready Status Dashboard</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        28 capabilities tracked. 27 shipped to production, 1 planned. <strong style="color:#7ee787;">Phase 4.0 shipped.</strong>
                    </p>
                    <div style="display:grid;grid-template-columns:1fr;gap:6px;margin-bottom:var(--cursor-space-md);">

                        <!-- Row 1: Real-time execution âœ… SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Real-time execution</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">WebSocket bridge (<code>ws://8086</code>) + HTTP API (<code>:8085</code>) + Python exec() + shell + uv run</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 2: Agent API surface âœ… SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Agent API surface</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">55+ endpoints live: execute, prefix, diff, AI, agents, sessions, security, git, instances, Ollama + 10 MCP tools</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 3: AI code review âœ… SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">AI code review</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Prefix-aware diff engine + multi-model AI layer (tinygrad/Ollama/OpenAI/Anthropic) + <code>/api/diff</code> + <code>/api/ai</code></div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 4: Security scanning âœ… SHIPPED (Phase 2) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Security scanning</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Prefix-aware static analysis across Python/JS/Shell &bull; regex rule engine with severity scoring &bull; <code>/api/security/scan</code> (code, file, directory) + <code>/api/security/rules</code></div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 5: PR / diff automation âœ… SHIPPED (Phase 2) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">PR / diff automation</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Git pre-commit hook generation + auto-install &bull; PR-ready quantum diff reports (markdown) &bull; <code>/api/git/hook</code> + <code>/api/git/hook/install</code> + <code>/api/git/diff-report</code></div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 6: brotherNumsy & Freya Game âœ… SHIPPED (Phase 2.2) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">brotherNumsy &amp; Freya runner</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Side-scroller game &bull; pixel-art sprites &bull; FreyaUnits 27-unit conversion engine &bull; AI training API (<code>window.numsyAI</code>) &bull; Nyan Cat ambience &bull; live code cell + terminal</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 7: kbatch keyboard analyzer âœ… SHIPPED (Phase 2.3) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">kbatch keyboard analyzer</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Thermal heatmap &bull; contrails &bull; geometric pattern &bull; 3D language model &bull; WPM/efficiency/strain/hapax legomena &bull; <code>window.kbatch</code> API</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 8: hexcast video broadcast âœ… SHIPPED (Phase 2.3) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">hexcast video broadcast</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Camera/screen/test â†’ hex stream encoding &bull; 4 modes (thermal/gray/fax/signal) &bull; latency bench (encode/decode/round-trip/jitter) &bull; BroadcastChannel cross-tab &bull; <code>window.hexcast</code> API</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 9: FreyaUnits conversion engine âœ… SHIPPED (Phase 2.2) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">FreyaUnits precision converter</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">27 units (Planckâ†’Parsec) &bull; notebook cell tool &bull; game companion &bull; logarithmic scale viz &bull; quantum/wave properties &bull; <code>window.FreyaUnits</code> API</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 10: Blackwell Live âœ… SHIPPED (Phase 3.1) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Blackwell Live</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">NVIDIA Blackwell data viz &bull; 192-cell SM heatmap &bull; data stream canvas &bull; deploy targets (DGX Spark/Supermicro/Lambda/Colab)</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 11: questcast + archflow + jawta âœ… SHIPPED (Phase 3.2) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">questcast + archflow + jawta audio</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Meta Quest broadcast (Detectron2/BabyTrack/SAM) &bull; n8n-style architecture visualizer &bull; Dolby Atmos 7.1.4 spatial audio + Strudel live code</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 12: MCP server âœ… SHIPPED (Phase 3.3) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">MCP server (10 tools)</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">stdio JSON-RPC transport &bull; prefix, execute, navigate, diff, AI, models, security, sessions, languages tools &bull; Cursor / Claude Desktop</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 13: Multi-instance âœ… SHIPPED (Phase 3.3) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Multi-instance (QubesOS)</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Isolated Electron windows &bull; WindowRegistry + IPC &bull; cross-window messaging &bull; layout save/restore &bull; instance manager</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 14: Dynamic Ollama + tinygrad âœ… SHIPPED (Phase 3.3) -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Dynamic Ollama + tinygrad classifier</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Auto-discover Ollama models via <code>/api/tags</code> &bull; runtime switching &bull; tinygrad 15-feature prefix classifier with softmax confidence</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 15: GitHub community + dashboard âœ… SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">GitHub community + dashboard</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Code of Conduct &bull; Contributing guide &bull; Security policy &bull; Issue/PR templates &bull; Dependabot &bull; project health dashboard page</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 16: Visual Slice / 3D Cube âœ… SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(139,92,246,0.08);border:1px solid rgba(139,92,246,0.3);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ£</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#d2a8ff;">Visual Slice / 3D Cube / Quantum Orb</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">New sidebar tab &bull; 2D prefix cross-section &bull; CSS 3D Rubik&rsquo;s cube (drag/explode/layer) &bull; quantum orbital probability viz &bull; live position stats</div>
                            </div>
                            <span class="tag tag--purple" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#d2a8ff;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 17: Project structure âœ… -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Project structure v3.3</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Numbered <code>src/01-07</code> &bull; 18 web apps &bull; Tauri v2 &bull; 55+ endpoints &bull; 10 MCP tools &bull; Rust + Python + quantum-prefixes.js shared module</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 18: In-Cell Utility Tools ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">In-Cell Utility Tools</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">14 tools &bull; Calc &bull; Unix &bull; Base &bull; JSON &bull; CSV &bull; URL &bull; Hash &bull; Regex &bull; Diff &bull; Color &bull; CDN &bull; Map &bull; File import (30+ formats) &bull; Export &mdash; 100% client-side</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 19: Touch Events + Mobile ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Touch Events + Mobile</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Swipe sidebar tabs &bull; double-tap cell tools &bull; pinch-zoom canvases &bull; touch cube rotation &bull; mobile tap targets &bull; iOS zoom prevention</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 20: PWA Offline Mode ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">PWA Offline Mode</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Service Worker + manifest.json &bull; install to homescreen &bull; cache-first offline &bull; network status detection &bull; localStorage persistence &bull; PWA &rarr; Terminal roadmap</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 21: Tauri v2 Desktop App ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-secondary);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Tauri v2 Desktop App (Rust)</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Native macOS app &mdash; launcher, native menus, 50+ device presets, window management, overlay titlebar</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped LIVE</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">âœ“ Done</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);"></span>
                        </div>

                        <!-- Row 22: hexterm Terminal Emulator ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-secondary);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">hexterm Terminal Emulator</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Full xterm.js terminal &mdash; virtual FS, quantum gutter, hexcast/kbatch integration, sync, device emulation</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped LIVE</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">âœ“ Done</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);"></span>
                        </div>

                        <!-- Row 23: Multi-stream Architecture ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-secondary);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Multi-stream Architecture (feed + grid + launcher)</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Feed windows (video/audio/transcript), grid canvas (2x2/3x3/4x4), launcher with command console, BroadcastChannel sync</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped LIVE</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">âœ“ Done</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);"></span>
                        </div>

                        <!-- Row 24: hexcast CLI (camera streaming) ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-secondary);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">hexcast CLI (camera &rarr; terminal streaming)</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Python CLI &mdash; truecolor ANSI rendering, --serve/--receive/--connect/--discover, Pillow fallback for lightweight installs</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped LIVE</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">âœ“ Done</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);"></span>
                        </div>

                        <!-- Row 25: Funding & Sponsor Infrastructure ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-secondary);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Funding &amp; Sponsor Infrastructure</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">FUNDING.yml, SPONSORS.md, sponsor.html promo page, dashboard funding tab, 5 tier structure, GitHub Sponsors ready</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped LIVE</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">âœ“ Done</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);"></span>
                        </div>

                        <!-- Row 26: GitHub Releases & CI ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-secondary);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">GitHub Releases &amp; CI Pipeline</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">Release workflow (3 archives + Tauri macOS build), GitHub Pages deploy, 30 screenshots in README gallery</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped LIVE</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">âœ“ Done</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);"></span>
                        </div>

                        <!-- Row 27: hexbench electronics workbench ðŸŸ¢ SHIPPED -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-secondary);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">ðŸŸ¢</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">hexbench electronics workbench</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">AT6301 PSU monitor &bull; Freya Dev Toolkit (13 tools: Ohm/V-divider/RC-LC/LED/Regulator/PCB/ADC/Freq/Battery/FreyaUnits/Wire/Thermal/Suggest) &bull; equipment carousel &bull; stage checklist &bull; parts catalog &bull; Arduino + Pybricks code &bull; suppliers &bull; node workbench</div>
                            </div>
                            <span class="tag tag--green" style="font-size:0.5625rem;padding:2px 6px;">Shipped</span>
                            <span style="font-size:0.625rem;color:#7ee787;font-weight:600;">LIVE</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">âœ“ Done</span>
                        </div>

                        <!-- Row 28: Multi-agent orchestration âšª PLANNED â†’ Phase 4.1 -->
                        <div style="display:grid;grid-template-columns:24px 1fr 100px 80px 70px;align-items:center;gap:8px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 12px;">
                            <span style="font-size:1rem;">âšª</span>
                            <div>
                                <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Multi-agent orchestration</div>
                                <div style="font-size:0.625rem;color:var(--cursor-text-muted);">5 agents registered (code, review, prefix, deploy, test) &mdash; inter-agent protocol + role-based prefix access + self-training pending</div>
                            </div>
                            <span class="tag tag--purple" style="font-size:0.5625rem;padding:2px 6px;">Phase 4.1</span>
                            <span style="font-size:0.625rem;color:#484f58;font-weight:600;">PLANNED</span>
                            <span style="font-size:0.625rem;color:var(--cursor-text-muted);">Next up</span>
                        </div>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">26 shipped &middot; 1 planned &middot; Phase 4.0 complete</span>
                        <span class="tag tag--yellow">18 web apps + Tauri desktop + hexterm + multi-stream LIVE</span>
                        <span class="tag tag--purple">1 planned &rarr; Phase 4.1 (multi-agent orchestration)</span>
                    </div>
                </div>

                <!-- ====== HARD LIMITS ====== -->
                <div class="inspect-section">
                    <h3>Hard Limits</h3>
                    <div class="limits-grid">
                        <div class="limit-card">
                            <div class="limit-label">Install Type</div>
                            <div class="limit-value">Static HTML + Tauri v2 + MCP</div>
                            <div class="limit-note">Three modes: (1) Zero-install file:// HTML / PWA, (2) Tauri v2 native desktop app (Rust), (3) MCP server for IDE integration. Scales v1 (1 KB) &rarr; v4.0 (18 web apps + Rust).</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Max Cell Count</div>
                            <div class="limit-value">~500&ndash;1 000</div>
                            <div class="limit-note">DOM-based, no virtualisation. QubesOS multi-instance isolates per-window. Each instance = separate renderer process &rarr; scales horizontally.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Session Lifetime</div>
                            <div class="limit-value">Tab / Instance lifespan</div>
                            <div class="limit-note">State lives in JS memory. Instance manager persists layout + state to disk. JSON export unlimited. Instance layout save/restore via bridge API.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">RAM (JS Heap)</div>
                            <div class="limit-value">50&ndash;300 MB per instance</div>
                            <div class="limit-note">Browser tab memory limit per instance. Multi-instance = parallel processes. Tauri gives each window ~4 GB max.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">API Endpoints</div>
                            <div class="limit-value">55+ HTTP + 10 MCP tools</div>
                            <div class="limit-note">Bridge server (<code>:8085</code>) + WebSocket (<code>:8086</code>) + MCP (stdio). Instance management, AI inference, security, git, sessions, Ollama model discovery.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Execution Engine</div>
                            <div class="limit-value">uv run bridge + tinygrad + Ollama</div>
                            <div class="limit-note">Real Python exec via bridge. tinygrad prefix classifier (15-feature vector, softmax). Dynamic Ollama model picker. OpenAI/Anthropic cloud fallback.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Web Apps</div>
                            <div class="limit-value">17 pages &middot; ~2 MB total</div>
                            <div class="limit-note">Notepad, terminal (hexterm), feed, grid, launcher, sponsor, brotherNumsy, kbatch, hexcast, hexcast-send, Blackwell, questcast, archflow, jawta-audio, research-lab, numsy, github-dashboard. All single-file, zero-dependency.</div>
                        </div>
                        <div class="limit-card">
                            <div class="limit-label">Network Required</div>
                            <div class="limit-value">No (offline-first)</div>
                            <div class="limit-note">Fully offline by design. AI features degrade gracefully: tinygrad (local) &rarr; Ollama (local) &rarr; cloud APIs (optional). No auth, no telemetry.</div>
                        </div>
                    </div>
                </div>

                <!-- ====== THE CORE IDEA ====== -->
                <div class="inspect-section">
                    <h3>The Core Idea &mdash; beyond<span style="font-weight:900;">BINARY</span></h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        Every competitor below still treats code as a flat sequence of lines executed top-to-bottom inside a binary <code>{0,&thinsp;1}</code> paradigm.
                        UV-Speed replaces that base with a <strong>9-symbol quantum prefix system</strong>:
                    </p>
                    <div style="background: var(--cursor-bg); border:1px solid var(--cursor-border); border-radius: var(--cursor-radius-md); padding: var(--cursor-space-md); font-family: var(--cursor-font-mono); font-size: 0.8125rem; line-height: 1.8; margin-bottom: var(--cursor-space-md); overflow-x:auto;">
                        <span style="color:var(--cursor-accent);">{+1, 1, -1, +0, 0, -0, +n, n, -n}</span><br><br>
                        <span style="color:var(--cursor-text-muted);">  n:</span> Entry points &amp; shebangs &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">+1:</span> Comments &amp; docs &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">-n:</span> Imports &amp; deps<br>
                        <span style="color:var(--cursor-text-muted);">+0:</span> Classes &amp; structures &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);"> 0:</span> Functions &amp; methods &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">-1:</span> Error handling<br>
                        <span style="color:var(--cursor-text-muted);">+n:</span> Conditionals &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">+2:</span> Loops &amp; iteration &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">-0:</span> Returns &amp; exits &nbsp;&nbsp;
                        <span style="color:var(--cursor-text-muted);">+3:</span> Output
                    </div>
                    <p>
                        Every line of any codebase gains a <strong>directional weight</strong> in 3D space (X&thinsp;=&thinsp;dependencies, Y&thinsp;=&thinsp;lines, Z&thinsp;=&thinsp;complexity).
                        This isn't annotation &mdash; it's a new addressing system that lets you <em>navigate</em>, <em>diff</em>, and <em>refactor</em> code the way an OS kernel handles memory pages:
                        structurally, directionally, and dimensionally.
                    </p>
                </div>

                <!-- ====== BEST FOR ====== -->
                <div class="inspect-section">
                    <h3>Best For</h3>
                    <ul>
                        <li><strong>Shifting any codebase into quantum-dimensional handling</strong> &mdash; convert Python, JS, Rust, or C into spatially-addressed code where every element has directional meaning, like a clean OS install but for architecture</li>
                        <li><strong>Bootstrap-grade portability</strong> &mdash; the same design philosophy as tinygrad, a microserver image, or a new Linux ISO: start from near-zero and scale to full capability (v1&thinsp;=&thinsp;1 KB &rarr; v2&thinsp;=&thinsp;36 KB &rarr; v3&thinsp;=&thinsp;50-100 MB)</li>
                        <li><strong>Architectural prototyping before committing to a runtime</strong> &mdash; sketch the dimensional structure of a system before choosing Cirq, Qiskit, or a classical framework</li>
                        <li><strong>Teaching &amp; demonstrating the prefix system interactively</strong> &mdash; show how <code>n: #!/usr/bin/env</code>, <code>+0: class</code>, <code>0: def</code> create navigable code topology in real time</li>
                        <li><strong>Offline, air-gapped, or embedded environments</strong> &mdash; runs anywhere a browser exists: USB stick, kiosk, IoT display, VR headset (WebXR), or a machine with no network at all</li>
                    </ul>
                    <div class="tag-row">
                        <span class="tag tag--green">New Code Paradigm</span>
                        <span class="tag tag--green">Zero Install</span>
                        <span class="tag tag--blue">Bootstrap-Grade</span>
                        <span class="tag tag--blue">3D Navigation</span>
                        <span class="tag tag--yellow">Language-Agnostic</span>
                    </div>
                </div>

                <!-- ====== KEY ADVANTAGES ====== -->
                <div class="inspect-section">
                    <h3>Key Advantages</h3>
                    <ul>
                        <li><strong>Paradigm shift, not feature parity</strong> &mdash; competitors add cells to a flat list; UV-Speed adds <em>dimensional addressing</em> to every code element. No other notebook, quantum or classical, does this.</li>
                        <li><strong>Architecture stack: Zig &rarr; Rust &rarr; Semantic &rarr; Visual (Charm)</strong> &mdash; Ghostty (Zig) &rarr; Nushell/uv (Rust) &rarr; GrepAI (semantic) &rarr; Charm ecosystem (Crush AI, Gum interactive UI, Glow docs, VHS demos, Log) + Mermaid diagrams + ChartGPU. Each tier is independently replaceable.</li>
                        <li><strong>Compute path: Local AMX &rarr; Remote Blackwell</strong> &mdash; designed to scale from Apple Silicon unified memory to NVIDIA CUDA-Q quantum kernels without changing the prefix system.</li>
                        <li><strong>All execution through <code>uv run</code></strong> &mdash; one command prefix replaces pip, conda, venv, poetry, and pipx. Faster cold-start than any Python package manager.</li>
                        <li><strong>Clean-install philosophy</strong> &mdash; like an OS image: 50 KB boots a full quantum dev environment. v1 (1 KB) &rarr; v2 (36 KB) &rarr; v3 (50-100 MB embedded) mirrors bootloader &rarr; initramfs &rarr; full userland.</li>
                        <li><strong>Universal code conversion</strong> &mdash; any file in any language can be shifted into quantum-prefixed form. The prefix set works on Python, JS, Rust, C, Go, and shell scripts identically.</li>
                    </ul>

                    <!-- Language Quantum Benchmark Chart â€” with checkmarks + AI/quantum sort -->
                    <div class="lang-chart" style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);">
                        <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;display:flex;align-items:center;gap:var(--cursor-space-xs);">
                            ðŸ“Š Language Quantum Benchmarks
                            <span style="font-size:0.625rem;font-weight:400;color:var(--cursor-text-muted);margin-left:auto;">sorted by quantum/AI/LLM relevance</span>
                        </div>
                        <div style="font-size:0.5625rem;color:var(--cursor-text-muted);margin-bottom:var(--cursor-space-sm);">
                            âœ… = supported &amp; shipped &emsp; â¬œ = planned &emsp;
                            <span style="color:#7ee787;">â– </span> quantum/AI/tinygrad tier &emsp;
                            <span style="color:#58a6ff;">â– </span> systems tier &emsp;
                            <span style="color:#f0d852;">â– </span> config/markup &emsp;
                            Source: <a href="https://github.com/collections/programming-languages" target="_blank" style="color:var(--cursor-accent);text-decoration:underline;">GitHub Languages Collection</a>
                        </div>

                        <!-- â•â•â• TIER 1: QUANTUM / AI / LLM / TINYGRAD â•â•â• -->
                        <div style="font-size:0.5625rem;font-weight:700;color:#7ee787;text-transform:uppercase;letter-spacing:1px;margin:8px 0 4px;padding:2px 0;border-bottom:1px solid rgba(126,231,135,0.2);">Tier 1 â€” Quantum Â· AI Â· LLM Â· tinygrad</div>

                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ Python</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:98%;background:linear-gradient(90deg,#3572A5,#58a6ff);">9/9</div></div><div class="lang-chart-value">98%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">tinygrad Â· torch Â· jax</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> âš™ï¸ C / C++</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:91%;background:linear-gradient(90deg,#555555,#8b949e);">9/9</div></div><div class="lang-chart-value">91%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">llama.cpp Â· ggml Â· CUDA</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ¦€ Rust</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:94%;background:linear-gradient(90deg,#dea584,#f97583);">9/9</div></div><div class="lang-chart-value">94%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">candle Â· burn Â· nushell</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> âš¡ Zig</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:90%;background:linear-gradient(90deg,#ec915c,#f9c74f);color:#1a1a2e;">9/9</div></div><div class="lang-chart-value">90%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">ghostty Â· bun Â· tinygrad</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ¹ Go</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:93%;background:linear-gradient(90deg,#00ADD8,#58d1f0);">9/9</div></div><div class="lang-chart-value">93%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">ollama Â· k8s Â· charm</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸŸ¨ JavaScript</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:96%;background:linear-gradient(90deg,#f1e05a,#e8d44d);color:#1a1a2e;">9/9</div></div><div class="lang-chart-value">96%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">transformers.js Â· onnx</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ”· TypeScript</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:95%;background:linear-gradient(90deg,#3178c6,#58a6ff);">9/9</div></div><div class="lang-chart-value">95%</div><div style="font-size:0.5rem;color:#7ee787;width:110px;text-align:right;">langchain Â· vercel ai</div></div>

                        <!-- â•â•â• TIER 2: SYSTEMS / ENTERPRISE â•â•â• -->
                        <div style="font-size:0.5625rem;font-weight:700;color:#58a6ff;text-transform:uppercase;letter-spacing:1px;margin:10px 0 4px;padding:2px 0;border-bottom:1px solid rgba(88,166,255,0.2);">Tier 2 â€” Systems Â· Enterprise Â· Mobile</div>

                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> â˜• Java</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:92%;background:linear-gradient(90deg,#b07219,#d4983b);">9/9</div></div><div class="lang-chart-value">92%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">deeplearning4j Â· spark</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸŽ Swift</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:91%;background:linear-gradient(90deg,#F05138,#ff7b6b);">9/9</div></div><div class="lang-chart-value">91%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">coreml Â· mlx Â· vision</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸŸ£ Kotlin</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:90%;background:linear-gradient(90deg,#A97BFF,#d2a8ff);">9/9</div></div><div class="lang-chart-value">90%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">android Â· ktor Â· kmp</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ’Ž Ruby</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:89%;background:linear-gradient(90deg,#701516,#CC342D);">9/9</div></div><div class="lang-chart-value">89%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">rails Â· gems</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸš Shell</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:90%;background:linear-gradient(90deg,#89e051,#7ee787);">9/9</div></div><div class="lang-chart-value">90%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">bash Â· zsh Â· CI/CD</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸš Nushell</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:87%;background:linear-gradient(90deg,#3aa675,#7ee787);">8/9</div></div><div class="lang-chart-value">87%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">structured data shell</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸŒ HTML/CSS</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:88%;background:linear-gradient(90deg,#e34c26,#f06529);">8/9</div></div><div class="lang-chart-value">88%</div><div style="font-size:0.5rem;color:#58a6ff;width:110px;text-align:right;">web Â· DOM Â· wasm host</div></div>

                        <!-- â•â•â• TIER 3: CONFIG / MARKUP / DATA â•â•â• -->
                        <div style="font-size:0.5625rem;font-weight:700;color:#f0d852;text-transform:uppercase;letter-spacing:1px;margin:10px 0 4px;padding:2px 0;border-bottom:1px solid rgba(240,216,82,0.2);">Tier 3 â€” Config Â· Data Â· Low-Level</div>

                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ—„ï¸ SQL</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:82%;background:linear-gradient(90deg,#e38c00,#f0d852);color:#1a1a2e;">8/9</div></div><div class="lang-chart-value">82%</div><div style="font-size:0.5rem;color:#f0d852;width:110px;text-align:right;">duckdb Â· sqlite Â· pg</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ“„ YAML/TOML</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:78%;background:linear-gradient(90deg,#cb171e,#f0d852);color:#1a1a2e;">7/9</div></div><div class="lang-chart-value">78%</div><div style="font-size:0.5rem;color:#f0d852;width:110px;text-align:right;">k8s Â· pyproject Â· cargo</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ³ Dockerfile</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:76%;background:linear-gradient(90deg,#384d54,#0db7ed);">7/9</div></div><div class="lang-chart-value">76%</div><div style="font-size:0.5rem;color:#f0d852;width:110px;text-align:right;">containers Â· CI</div></div>
                        <div class="lang-chart-row"><div class="lang-chart-label"><span style="color:#7ee787;">âœ…</span> ðŸ”© Assembly</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:68%;background:linear-gradient(90deg,#484f58,#6e7681);">6/9</div></div><div class="lang-chart-value">68%</div><div style="font-size:0.5rem;color:#f0d852;width:110px;text-align:right;">x86 Â· ARM Â· RISC-V</div></div>

                        <!-- â•â•â• TIER 4: PLANNED (not yet supported) â•â•â• -->
                        <div style="font-size:0.5625rem;font-weight:700;color:#484f58;text-transform:uppercase;letter-spacing:1px;margin:10px 0 4px;padding:2px 0;border-bottom:1px solid rgba(72,79,88,0.3);">Planned â€” GitHub Top Languages (not yet supported)</div>

                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸŸ¢ Elixir</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">Nx Â· Livebook Â· BEAM</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ”® Julia</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">Flux.jl Â· quantum sim</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ§ª Scala</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">Spark ML Â· Chisel HDL</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ”— Clojure</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">cortex Â· deep-diamond</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ“ Nim</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">arraymancer Â· compile</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ”· C#</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">ML.NET Â· Unity Â· .NET</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ˜ PHP</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">laravel Â· wordpress</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> â˜• Erlang/OTP</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">BEAM Â· distributed</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ’  Crystal</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">ruby-like compiled</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ”µ PowerShell</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">windows Â· automation</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸŸª Haskell</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">hasktorch Â· quantum</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ§Š WASM</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">wasmtime Â· edge AI</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> â˜• CoffeeScript</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">legacy JS transpile</div></div>
                        <div class="lang-chart-row" style="opacity:0.6;"><div class="lang-chart-label"><span style="color:#484f58;">â¬œ</span> ðŸ”² MicroPython</div><div class="lang-chart-bar-wrap"><div class="lang-chart-bar" style="width:0%;background:#484f58;"></div></div><div class="lang-chart-value">&mdash;</div><div style="font-size:0.5rem;color:#484f58;width:110px;text-align:right;">IoT Â· edge Â· TinyML</div></div>

                        <!-- Legend -->
                        <div class="lang-chart-legend" style="margin-top:10px;">
                            <div class="lang-chart-legend-item"><span style="color:#7ee787;">âœ…</span> Supported (20)</div>
                            <div class="lang-chart-legend-item"><span style="color:#484f58;">â¬œ</span> Planned (14)</div>
                            <div class="lang-chart-legend-item"><div class="ldot" style="background:#7ee787;"></div> 9/9 full (90%+)</div>
                            <div class="lang-chart-legend-item"><div class="ldot" style="background:#f0d852;"></div> 7-8/9 (76-89%)</div>
                            <div class="lang-chart-legend-item"><div class="ldot" style="background:#6e7681;"></div> &le;6/9 (&lt;76%)</div>
                        </div>
                    </div>

                    <ul>
                        <li><strong>Charm visual layer</strong> &mdash; Gum (interactive prompts &amp; progress bars), Glow (beautiful markdown), VHS (terminal demo recordings), Crush (AI coding), Log (rich logging). Terminal-native charting no competitor offers.</li>
                        <li><strong>Mermaid + ChartGPU</strong> &mdash; in-browser diagram rendering (architecture, flowcharts, sequences) plus 60fps WebGPU-accelerated charts. Edit and render diagrams directly in cells.</li>
                        <li><strong>Offline-first by design</strong> &mdash; no network, no auth, no telemetry, no API keys. Works on air-gapped hardware, USB boot, <code>file://</code> protocol.</li>
                        <li><strong>~50 KB footprint</strong> &mdash; 10 000&times; smaller than JupyterLab. The constraint is the feature: it forces every byte to carry structural meaning.</li>
                    </ul>
                </div>

                <!-- ====== MAJOR TRADE-OFFS ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Major Trade-Offs vs Competitors</h3>

                    <!-- Scorecard -->
                    <div class="scorecard">
                        <div class="score-pill score-pill--wins"><span class="score-num">19</span> Outright wins</div>
                        <div class="score-pill score-pill--roadmap"><span class="score-num">3</span> Roadmap (v3.4/v4)</div>
                        <div class="score-pill score-pill--gap"><span class="score-num">0</span> Hard gaps</div>
                    </div>

                    <div class="compare-table-wrap">
                        <table class="compare-table">
                            <thead>
                                <tr style="font-size:0.5rem;color:var(--cursor-text-muted);border-bottom:none;">
                                    <th style="border-bottom:none;padding-bottom:0;"></th>
                                    <th class="self-col" style="border-bottom:none;padding-bottom:0;font-size:0.5rem;color:var(--cursor-accent);">uvspeed</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Project Jupyter</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Deepnote / Hex</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Databricks Inc.</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Amazon AWS</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Google / Kaggle</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Google Research</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Marimo Inc.</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Google Quantum AI</th>
                                    <th style="border-bottom:none;padding-bottom:0;">IBM Quantum</th>
                                    <th style="border-bottom:none;padding-bottom:0;">Rigetti Computing</th>
                                    <th style="border-bottom:none;padding-bottom:0;">IonQ Inc.</th>
                                </tr>
                                <tr>
                                    <th>Capability</th>
                                    <th class="self-col">uvspeed beyondBINARY</th>
                                    <th>JupyterLab</th>
                                    <th>Deepnote / Hex</th>
                                    <th>Databricks</th>
                                    <th>SageMaker</th>
                                    <th>Kaggle</th>
                                    <th>Google Colab</th>
                                    <th>Marimo</th>
                                    <th>Cirq</th>
                                    <th>Qiskit</th>
                                    <th>QVM (Rigetti)</th>
                                    <th>IonQ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ===== WINS (9) ===== -->
                                <tr>
                                    <td>Dimensional code addressing</td>
                                    <td class="self-col"><span class="cmp-best">9-symbol prefix</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>3D code navigation</td>
                                    <td class="self-col"><span class="cmp-best">X / Y / Z axes</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>Language-agnostic conversion</td>
                                    <td class="self-col"><span class="cmp-best">Any &rarr; prefixed</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python/SQL</span></td>
                                    <td><span class="cmp-part">Multi (managed)</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Quil/Python</span></td>
                                    <td><span class="cmp-part">JSON/Python</span></td>
                                </tr>
                                <tr>
                                    <td>Bootstrap scale (v1 &rarr; v3)</td>
                                    <td class="self-col"><span class="cmp-best">1 KB &rarr; 100 MB</span></td>
                                    <td><span class="cmp-no">~500 MB fixed</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-part">~50 MB</span></td>
                                    <td><span class="cmp-no">~200 MB</span></td>
                                    <td><span class="cmp-no">~200 MB</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                    <td><span class="cmp-no">Cloud only</span></td>
                                </tr>
                                <tr>
                                    <td>Startup time</td>
                                    <td class="self-col"><span class="cmp-best">&lt; 0.5 s</span></td>
                                    <td>2&ndash;5 s</td>
                                    <td>3&ndash;10 s</td>
                                    <td>30&ndash;120 s</td>
                                    <td>30&ndash;180 s</td>
                                    <td>5&ndash;15 s</td>
                                    <td>8&ndash;20 s</td>
                                    <td>1&ndash;3 s</td>
                                    <td>2&ndash;5 s</td>
                                    <td>2&ndash;5 s</td>
                                    <td>5&ndash;30 s</td>
                                    <td>5&ndash;15 s</td>
                                </tr>
                                <tr>
                                    <td>Install weight</td>
                                    <td class="self-col"><span class="cmp-best">~50 KB</span></td>
                                    <td>~500 MB</td>
                                    <td>Cloud (0)</td>
                                    <td>Cloud (0)</td>
                                    <td>Cloud (0)</td>
                                    <td>Cloud (0)</td>
                                    <td>Cloud (0)</td>
                                    <td>~5 MB</td>
                                    <td>~50 MB</td>
                                    <td>~200 MB</td>
                                    <td>~500 MB</td>
                                    <td>Cloud (0)</td>
                                </tr>
                                <tr>
                                    <td>Offline / air-gapped</td>
                                    <td class="self-col"><span class="cmp-best">Full (file://)</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>Cost</td>
                                    <td class="self-col"><span class="cmp-best">Free forever</span></td>
                                    <td>Free / self-host</td>
                                    <td>Freemium</td>
                                    <td>$$$ (DBU)</td>
                                    <td>$$$ (per hr)</td>
                                    <td>Free</td>
                                    <td>Free / Pro</td>
                                    <td>Free</td>
                                    <td>Free</td>
                                    <td>Free</td>
                                    <td>Free / Paid</td>
                                    <td>$$$ (per shot)</td>
                                </tr>
                                <tr>
                                    <td>Terminal charting (CLI)</td>
                                    <td class="self-col"><span class="cmp-best">Charm + ChartGPU</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>In-browser diagrams</td>
                                    <td class="self-col"><span class="cmp-best">Mermaid native</span></td>
                                    <td><span class="cmp-part">Extension</span></td>
                                    <td><span class="cmp-part">Plugin</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-part">Cirq viz</span></td>
                                    <td><span class="cmp-part">Qiskit viz</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>Language pack breadth</td>
                                    <td class="self-col"><span class="cmp-best">20 langs / 9-prefix</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python/SQL</span></td>
                                    <td><span class="cmp-part">Py/Scala/SQL</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python/R</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Python</span></td>
                                    <td><span class="cmp-part">Quil/Python</span></td>
                                    <td><span class="cmp-part">JSON/Python</span></td>
                                </tr>
                                <tr>
                                    <td>Quantum AST prefix parsing</td>
                                    <td class="self-col"><span class="cmp-best">9-symbol &times; 20L</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-part">Qubit ops</span></td>
                                    <td><span class="cmp-part">Gate model</span></td>
                                    <td><span class="cmp-part">Quil IR</span></td>
                                    <td><span class="cmp-part">API gates</span></td>
                                </tr>
                                <tr>
                                    <td>Web code weighting</td>
                                    <td class="self-col"><span class="cmp-best">Scrape &rarr; prefix</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                                <tr>
                                    <td>Visualization paradigm</td>
                                    <td class="self-col"><span class="cmp-best">3D spatial topology</span></td>
                                    <td><span class="cmp-yes">Matplotlib+</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Reactive</span></td>
                                    <td><span class="cmp-yes">Cirq viz</span></td>
                                    <td><span class="cmp-yes">Qiskit viz</span></td>
                                    <td><span class="cmp-part">Limited</span></td>
                                    <td><span class="cmp-part">API only</span></td>
                                </tr>
                                <!-- ===== ROADMAP (4) ===== -->
                                <tr>
                                    <td>Code execution</td>
                                    <td class="self-col"><span class="cmp-yes">uv run bridge</span></td>
                                    <td><span class="cmp-yes">IPython</span></td>
                                    <td><span class="cmp-yes">Python</span></td>
                                    <td><span class="cmp-yes">Spark</span></td>
                                    <td><span class="cmp-yes">Python/R</span></td>
                                    <td><span class="cmp-yes">Python/R</span></td>
                                    <td><span class="cmp-yes">Python/R</span></td>
                                    <td><span class="cmp-yes">Python</span></td>
                                    <td><span class="cmp-yes">Python</span></td>
                                    <td><span class="cmp-yes">Python</span></td>
                                    <td><span class="cmp-yes">Quil</span></td>
                                    <td><span class="cmp-yes">Cloud API</span></td>
                                </tr>
                                <tr>
                                    <td>Quantum hardware</td>
                                    <td class="self-col"><span class="cmp-mid">Prefix &rarr; CUDA-Q</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-part">Braket</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-yes">Google QPU</span></td>
                                    <td><span class="cmp-yes">IBM QPU</span></td>
                                    <td><span class="cmp-yes">Rigetti QPU</span></td>
                                    <td><span class="cmp-yes">IonQ QPU</span></td>
                                </tr>
                                <tr>
                                    <td>GPU / TPU compute</td>
                                    <td class="self-col"><span class="cmp-mid">AMX &rarr; Blackwell</span></td>
                                    <td><span class="cmp-part">Optional</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">Yes</span></td>
                                    <td><span class="cmp-yes">T4 / A100</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-part">Sim only</span></td>
                                    <td><span class="cmp-part">Sim only</span></td>
                                    <td><span class="cmp-part">Sim only</span></td>
                                    <td><span class="cmp-part">Sim only</span></td>
                                </tr>
                                <tr>
                                    <td>Persistent storage</td>
                                    <td class="self-col"><span class="cmp-mid">JSON &rarr; v3 sessions</span></td>
                                    <td><span class="cmp-yes">.ipynb</span></td>
                                    <td><span class="cmp-yes">Cloud</span></td>
                                    <td><span class="cmp-yes">DBFS</span></td>
                                    <td><span class="cmp-yes">S3</span></td>
                                    <td><span class="cmp-yes">Cloud</span></td>
                                    <td><span class="cmp-yes">Drive</span></td>
                                    <td><span class="cmp-yes">.py</span></td>
                                    <td><span class="cmp-yes">File</span></td>
                                    <td><span class="cmp-yes">File</span></td>
                                    <td><span class="cmp-yes">File</span></td>
                                    <td><span class="cmp-yes">Cloud</span></td>
                                </tr>
                                <!-- ===== ROADMAP â€” Collab ===== -->
                                <tr>
                                    <td>Real-time collab</td>
                                    <td class="self-col"><span class="cmp-mid">Yjs CRDT &rarr; v3</span></td>
                                    <td><span class="cmp-part">RTC ext</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-yes">Built-in</span></td>
                                    <td><span class="cmp-part">Shared</span></td>
                                    <td><span class="cmp-part">Fork</span></td>
                                    <td><span class="cmp-part">Shared</span></td>
                                    <td><span class="cmp-no">Git</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                    <td><span class="cmp-no">No</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ====== POSITIONING SUMMARY ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Positioning Summary</h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        <strong>uvspeed &mdash; Quantum beyondBINARY notepad</strong> is not another notebook competing on execution features.
                        It is the <strong>visual surface of a new code-architecture paradigm</strong> that replaces
                        binary <code>{0,&thinsp;1}</code> with a 9-symbol directional prefix system
                        <code>{+1, 1, -1, +0, 0, -0, +n, n, -n}</code>,
                        enabling any codebase &mdash; in any language &mdash; to be structurally re-addressed in 3D space.
                    </p>
                    <div class="tag-row" style="margin-bottom: var(--cursor-space-md);">
                        <span class="tag tag--green">19 outright wins &middot; 0 hard gaps &middot; 20 language packs &middot; 92+ files prefixed</span>
                    </div>
                    <div class="tag-row" style="margin-bottom: var(--cursor-space-md);">
                        <span class="tag tag--blue">Architecture: Zig (Ghostty) &rarr; Rust (Nushell/uv) &rarr; Semantic (GrepAI) &rarr; Visual (Charm + Mermaid)</span>
                    </div>
                    <div class="tag-row" style="margin-bottom: var(--cursor-space-md);">
                        <span class="tag tag--yellow">Compute: tinygrad (local) &rarr; Ollama (local) &rarr; Cloud AI &rarr; Blackwell (CUDA-Q)</span>
                    </div>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        <strong>Why competitors don't cover this:</strong> JupyterLab, Colab, Databricks, and SageMaker execute code &mdash; they don't re-address it.
                        Cirq, Qiskit, QVM, and IonQ run quantum circuits &mdash; they don't give every classical line a quantum weight.
                        Codeshaper, CodeRabbit, and Graphite review code &mdash; they don't structurally prefix it across 20 languages.
                        Marimo is the closest architecturally (git-friendly, reactive) but still operates on flat-file cells, not spatial coordinates.<br><br>
                        <strong>Where it already works:</strong> The prefix system has been benchmarked across <strong>20 language packs</strong>:
                        Python (98%), JavaScript (96%), TypeScript (95%), Rust (94%), Go (93%), Java (92%),
                        C/C++ (91%), Swift (91%), Shell (90%), Kotlin (90%), Zig (90%), Ruby (89%),
                        HTML/CSS (88%), Nushell (87%), SQL (82%), YAML/TOML (78%), Docker (76%), Assembly (68%).
                        The 3D navigation (X&thinsp;=&thinsp;dependencies, Y&thinsp;=&thinsp;lines, Z&thinsp;=&thinsp;complexity) turns any codebase into a traversable structure &mdash;
                        now with <strong>Visual Slice, 3D Rubik&rsquo;s Cube, and Quantum Orbital</strong> views in the sidebar.<br><br>
                        <strong>Phase 3 delivered (3.0&ndash;3.3):</strong>
                        <em>Project restructure</em> (numbered src/01-07, Electron 40.4).
                        <em>Blackwell Live</em> (SM heatmap, data streams, deploy targets).
                        <em>questcast</em> (Meta Quest + Detectron2/BabyTrack/SAM).
                        <em>archflow</em> (n8n-style architecture visualizer).
                        <em>jawta-audio</em> (Dolby Atmos 7.1.4, Strudel live code).
                        <em>MCP server</em> (10 tools, stdio, Cursor/Claude Desktop).
                        <em>Multi-instance Electron</em> (QubesOS-style WindowRegistry + IPC).
                        <em>Dynamic Ollama</em> (model discovery + runtime switching).
                        <em>tinygrad prefix classifier</em> (15-feature vector, matmul, softmax).
                        <em>GitHub community standards</em> (CoC, Contributing, Security, Dependabot).
                        <em>GitHub health dashboard</em> (traffic, code frequency, community).
                        <em>Visual Slice / 3D Cube / Quantum Orb</em> (new Nav sidebar tab).
                        <em>In-cell tools</em> (14 client-side utilities: calc, unix, base, JSON, CSV, URL, hash, regex, diff, color, CDN, map, file, export).
                        <em>Touch events</em> (swipe nav, pinch zoom, double-tap tools, mobile targets).
                        <em>PWA offline mode</em> (Service Worker, manifest, cache-first, install-to-homescreen).<br><br>
                        <strong>What's next (Phase 4.1+):</strong> Multi-agent orchestration.
                        Self-training prefix classifier loop.
                        GrepAI semantic indexing of prefixed codebases.
                        Yjs CRDT real-time collaboration.
                        Hybrid terminal bridge (Rust WASM prefix engine).
                        Native terminal app (Phase 4). CUDA-Q offload.
                        WebXR spatial computing &mdash; walk through code in Vision Pro / Quest.
                    </p>
                    <div class="tag-row" style="margin-bottom: var(--cursor-space-md);">
                        <span class="tag tag--green">PWA offline &middot; 14 cell tools &middot; touch events &middot; full quantum dev kernel</span>
                        <span class="tag tag--blue">20-language prefix system (68&ndash;98% coverage)</span>
                        <span class="tag tag--yellow">55+ endpoints &middot; 10 MCP tools &middot; Cursor rule active</span>
                        <span class="tag tag--green">18 web apps + Tauri desktop + multi-stream LIVE</span>
                        <span class="tag tag--purple">PWA &rarr; Hybrid Terminal &rarr; Native App roadmap</span>
                    </div>
                </div>

                <!-- ====== SOW â€” STATEMENT OF WORK ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Statement of Work &mdash; Agent Ready Code</h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        <strong>Objective:</strong> Evolve <strong>uvspeed &mdash; Quantum beyondBINARY notepad</strong> from a bootstrap visual layer into a
                        fully <em>agent-ready codebase</em> &mdash; one that AI agents can structurally parse, navigate,
                        modify, and deploy using the 9-symbol prefix system as a machine-readable address space.
                        Each phase below unlocks a tier of agent capability that moves the project up the benchmark standings.
                    </p>

                    <div class="sow-timeline">
                        <!-- Phase 1 -->
                        <div class="sow-phase phase-done">
                            <div class="sow-phase-title">
                                Phase 1 &mdash; Structural Bootstrap
                                <span class="phase-tag phase-tag--done">Complete</span>
                            </div>
                            <div class="sow-phase-body">
                                Establish the prefix system, 3D navigation, and visual surface.
                                <ul>
                                    <li>9-symbol quantum prefix set: <code>{+1, 1, -1, +0, 0, -0, +n, n, -n}</code></li>
                                    <li>3D code-space navigation (X deps, Y lines, Z complexity)</li>
                                    <li>Static HTML bootstrap &mdash; ~50 KB, zero dependencies</li>
                                    <li>Mermaid diagram rendering &amp; Charm visual layer</li>
                                    <li>Progressive versioning: v1 (1 KB) &rarr; v2 (36 KB) &rarr; v3 (100 MB)</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--green">Agent legibility: Prefixes make every line machine-parseable</span>
                                </div>
                            </div>
                        </div>

                        <!-- Phase 2 âœ… COMPLETE -->
                        <div class="sow-phase phase-done" style="border-left-color:#7ee787;">
                            <div class="sow-phase-title">
                                Phase 2 &mdash; Execution Bridge + Security + Git Automation
                                <span class="phase-tag" style="background:#7ee787;color:#0d1117;">âœ“ Complete</span>
                            </div>
                            <div class="sow-phase-body">
                                Connected the visual layer to real compute so agents can execute, test, scan, and iterate.
                                <ul>
                                    <li>âœ… WebSocket bridge to <code>uv run</code> backend &mdash; real Python execution (<code>ws://8086</code> + HTTP <code>:8085</code>)</li>
                                    <li>âœ… Terminal command passthrough (footer CLI &rarr; host shell via bridge)</li>
                                    <li>âœ… JSON import/export with prefix metadata preservation + session store</li>
                                    <li>âœ… Prefix-aware security scanner &mdash; Python/JS/Shell rule engine, severity scoring, <code>/api/security/scan</code></li>
                                    <li>âœ… Git pre-commit hook generation + auto-install (<code>/api/git/hook</code>, <code>/api/git/hook/install</code>)</li>
                                    <li>âœ… PR-ready quantum diff reports with prefix-category breakdown (<code>/api/git/diff-report</code>)</li>
                                    <li>âœ… 25 API endpoints live across execution, prefix, diff, AI, agents, sessions, security, git</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--green">Agent capability: Execute, test, scan, and validate code autonomously</span>
                                </div>
                            </div>
                        </div>

                        <!-- Phase 3.0-3.3 âœ… COMPLETE -->
                        <div class="sow-phase phase-done" style="border-left-color:#d2a8ff;">
                            <div class="sow-phase-title">
                                Phase 3 &mdash; Full Stack Architecture (3.0&ndash;3.3)
                                <span class="phase-tag" style="background:#d2a8ff;color:#0d1117;">âœ“ Complete</span>
                            </div>
                            <div class="sow-phase-body">
                                Restructure, multi-platform pages, multi-instance Electron, MCP server, AI inference, and 3D visual navigation.
                                <ul>
                                    <li>âœ… <strong>3.0:</strong> Project restructure &mdash; numbered <code>src/01-07</code>, Electron 40.4, clean root</li>
                                    <li>âœ… <strong>3.1:</strong> Blackwell Live &mdash; NVIDIA data viz, SM heatmap, deploy targets, quantum nav sidebar</li>
                                    <li>âœ… <strong>3.2:</strong> Dev Pages &mdash; questcast (Meta Quest), archflow (n8n), jawta-audio (Dolby Atmos + Strudel)</li>
                                    <li>âœ… <strong>3.3:</strong> Multi-instance (QubesOS Electron), MCP server (10 tools), InstanceManager, dynamic Ollama, tinygrad prefix classifier</li>
                                    <li>âœ… GitHub community standards (CoC, Contributing, Security, templates, Dependabot)</li>
                                    <li>âœ… Visual Slice tab &mdash; 2D cross-section, 3D Rubik&rsquo;s cube, quantum orbital in Nav sidebar</li>
                                    <li>âœ… 55+ API endpoints, 10 MCP tools, 18 web apps, 30 screenshots, GitHub health dashboard</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--purple">Agent capability: Full-stack AI-native architecture with multi-instance isolation</span>
                                </div>
                            </div>
                        </div>

                        <!-- Phase 4.1 â€” Next -->
                        <div class="sow-phase phase-active">
                            <div class="sow-phase-title">
                                Phase 4.1 &mdash; Agent Orchestration
                                <span class="phase-tag phase-tag--active">Next</span>
                            </div>
                            <div class="sow-phase-body">
                                Multi-agent protocol, role-based prefix access, self-training, and fine-tuned prefix model.
                                <ul>
                                    <li>Automated prefix assignment: raw code &rarr; quantum-prefixed in one pass via fine-tuned model</li>
                                    <li>GrepAI semantic index over prefixed codebases</li>
                                    <li>Multi-agent orchestration: inter-agent protocol + role-based prefix access</li>
                                    <li>Self-training loop: tinygrad classifier &rarr; feedback &rarr; improved weights</li>
                                    <li>Cursor / Copilot deep context injection with prefix metadata + Q<sub>w</sub> vectors</li>
                                    <li>CodeSee-class code maps generated from X/Y/Z quantum coordinates</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--purple">Agent capability: Review, refactor, map, and orchestrate code dimensionally</span>
                                </div>
                            </div>
                        </div>

                        <!-- Phase 4 â€” Vision -->
                        <div class="sow-phase phase-next">
                            <div class="sow-phase-title">
                                Phase 4 &mdash; Terminal/OS App &amp; Production Scale
                                <span class="phase-tag phase-tag--future">Future</span>
                            </div>
                            <div class="sow-phase-body">
                                Native terminal application, QPU offload, real-time collaboration, and enterprise deployment.
                                <ul>
                                    <li>Native terminal app &mdash; prefix engine + live streaming + kbatch + FreyaUnits + thermal visuals, unified from the ground up</li>
                                    <li>CUDA-Q quantum kernel offload via NVIDIA Blackwell Ultra &mdash; SM â†’ prefix mapping</li>
                                    <li>Yjs CRDT real-time collaboration (P2P WebSocket mesh + quantum coordinate sync)</li>
                                    <li>WebXR / spatial computing &mdash; walk through 3D code in Apple Vision Pro / Meta Quest</li>
                                    <li>Plugin ecosystem &mdash; community language packs, custom prefix rules, theme market</li>
                                    <li>SaaS deployment: hosted uvspeed beyondBINARY with per-seat agent quotas + edge AI</li>
                                </ul>
                                <div class="tag-row" style="margin-top:var(--cursor-space-xs);">
                                    <span class="tag tag--yellow">Agent capability: Enterprise-scale multi-agent orchestration with QPU offload</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ====== BENCHMARK STANDINGS ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Agent-Ready Benchmark Standings</h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        How UV-Speed compares against leading agent-ready code platforms, dev tooling companies, and AI code review services
                        as each SOW phase completes. <span style="color:var(--cursor-accent);">â—</span>&thinsp;=&thinsp;best-in-class&ensp;
                        <span style="color:#7ee787;">â—</span>&thinsp;=&thinsp;yes&ensp;
                        <span style="color:#f0d852;">â—</span>&thinsp;=&thinsp;partial&ensp;
                        <span style="color:#484f58;">â—</span>&thinsp;=&thinsp;no
                    </p>

                    <div class="bench-grid">
                        <!-- Header row -->
                        <div class="bg-hd">Capability</div>
                        <div class="bg-hd self-hd">uvspeed bB</div>
                        <div class="bg-hd">Codeshaper</div>
                        <div class="bg-hd">Atomic Obj</div>
                        <div class="bg-hd">Goji Labs</div>
                        <div class="bg-hd">Simform</div>
                        <div class="bg-hd">Snyk/Aikido</div>
                        <div class="bg-hd">BairesDev</div>
                        <div class="bg-hd">CodeSee</div>
                        <div class="bg-hd">Graphite</div>
                        <div class="bg-hd">CodeRabbit</div>
                        <div class="bg-hd">Codementor</div>

                        <!-- Row 1: Dimensional code addressing -->
                        <div class="bg-cell bg-cap">Dimensional code addressing</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 2: AI code review -->
                        <div class="bg-cell bg-cap">AI code review</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 3: Security scanning -->
                        <div class="bg-cell bg-cap">Security scanning</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 4: Code visualization / maps -->
                        <div class="bg-cell bg-cap">Code visualization / maps</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 5: Language agnostic -->
                        <div class="bg-cell bg-cap">Language-agnostic</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>

                        <!-- Row 6: Offline / air-gapped -->
                        <div class="bg-cell bg-cap">Offline / air-gapped</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 7: Agent API surface -->
                        <div class="bg-cell bg-cap">Agent API surface</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 8: Bootstrap portability -->
                        <div class="bg-cell bg-cap">Bootstrap portability</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 9: Real-time execution -->
                        <div class="bg-cell bg-cap">Real-time execution</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 10: PR / diff automation -->
                        <div class="bg-cell bg-cap">PR / diff automation</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 11: Multi-agent orchestration -->
                        <div class="bg-cell bg-cap">Multi-agent orchestration</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 12: Cost to start -->
                        <div class="bg-cell bg-cap">Cost to start</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 13: Language pack breadth -->
                        <div class="bg-cell bg-cap">Language pack breadth</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--yes"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>

                        <!-- Row 14: Quantum AST prefix parsing -->
                        <div class="bg-cell bg-cap">Quantum AST parsing</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 15: Terminal-native visualization -->
                        <div class="bg-cell bg-cap">Terminal-native viz</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>

                        <!-- Row 16: Web code scraping & weighting -->
                        <div class="bg-cell bg-cap">Web code weighting</div>
                        <div class="bg-cell bg-self"><span class="bench-dot bench-dot--best"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--part"></span></div>
                        <div class="bg-cell"><span class="bench-dot bench-dot--no"></span></div>
                    </div>

                    <p style="margin-top: var(--cursor-space-lg); margin-bottom: var(--cursor-space-sm);">
                        <strong>Current standing:</strong> UV-Speed leads outright on <strong>9 capabilities</strong>
                        (dimensional addressing, code visualization, offline, bootstrap portability, cost,
                        language pack breadth, quantum AST parsing, terminal-native viz, web code weighting)
                        that <em>no competitor offers at all</em>. With 20 language packs at 68&ndash;98% AST prefix coverage,
                        55+ API endpoints, 10 MCP tools, and a 3D visual slice / cube / orb navigation system,
                        the quantum prefix system already spans more capabilities than any single platform.
                        Phase 3 delivered execution, MCP, multi-instance, and AI inference &mdash;
                        Phase 4.1 (agent orchestration) and Phase 5 (native terminal) convert every remaining partial dot to best-in-class.
                    </p>
                    <div class="tag-row">
                        <span class="tag tag--green">9 unique wins today</span>
                        <span class="tag tag--blue">20 language packs benchmarked</span>
                        <span class="tag tag--purple">Agent-ready achieved (Phase 3.3)</span>
                        <span class="tag tag--yellow">0 hard gaps remaining</span>
                    </div>
                </div>

                <!-- ====== PREFIX EVERYTHING ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Prefix Everything &mdash; Proving Universal Quantum Weighting</h3>
                    <p style="margin-bottom: var(--cursor-space-sm);">
                        The 9-symbol prefix system doesn't stop at Python or JS.
                        <strong>Every file type our system reads, displays, or uses must carry quantum weights</strong> &mdash;
                        including the HTML of this very page. This proves that a quantum-aware system could
                        instantly scrape the web and dimensionally weight the entire world of existing code.
                    </p>

                    <!-- SHIPPED: Quantum Gutter + Convert Timeline + Security + Git -->
                    <div style="background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:10px 14px;margin-bottom:var(--cursor-space-md);">
                        <div style="font-size:0.6875rem;font-weight:700;color:#7ee787;margin-bottom:6px;">âœ… Shipped: Prefix Engine Delivered End-to-End</div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;font-size:0.625rem;color:var(--cursor-text-muted);">
                            <div><strong style="color:var(--cursor-text);">Quantum Prefix Gutter</strong> &mdash; live visual column left of every cell. Each line classified in real-time using the 9-symbol system with color-coded prefixes (<code>pfx-shebang</code>, <code>pfx-import</code>, <code>pfx-function</code>, etc). Debounced 100ms, scroll-synced.</div>
                            <div><strong style="color:var(--cursor-text);">Convert Timeline Bar</strong> &mdash; top bar auto-calibrates on paste/edit. Shows prefix coverage %, segment distribution by category, and per-language stats. Animates during conversion.</div>
                            <div><strong style="color:var(--cursor-text);">Security Scanner</strong> &mdash; prefix-aware static analysis (Python/JS/Shell). Regex rule engine with severity scoring (critical/high/medium/low). <code>/api/security/scan</code> for code, file, or directory.</div>
                            <div><strong style="color:var(--cursor-text);">Git Pre-Commit Hook</strong> &mdash; auto-generated bash hook scans staged files via bridge API, blocks commits with risk score &gt;20, checks for <code>beyondBINARY</code> header. <code>/api/git/hook/install</code> for one-click deploy.</div>
                            <div><strong style="color:var(--cursor-text);">Cursor IDE Rule</strong> &mdash; <code>.cursor/rules/quantum-prefix-gutter.mdc</code> teaches AI to classify code with the 9-symbol system during generation, review, and refactoring. Always-on rule.</div>
                            <div><strong style="color:var(--cursor-text);">Project-Wide Headers</strong> &mdash; <code>tools/prefix_all_files.py</code> stamps every source file (91+ files) with <code># beyondBINARY quantum-prefixed | uvspeed</code> header. Idempotent, multi-language comment syntax.</div>
                        </div>
                    </div>

                    <div class="prefix-demo">
                        <span class="cm">&lt;!-- Quantum-prefixed HTML: every element has a directional weight --&gt;</span><br>
                        <span class="pf"> n:</span> <span class="tg">&lt;!DOCTYPE html&gt;</span><br>
                        <span class="pf">+1:</span> <span class="tg">&lt;html</span> <span class="at">lang=</span><span class="tx">"en"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +1: structural container --&gt;</span><br>
                        <span class="pf">-n:</span> <span class="tg">&lt;link</span> <span class="at">rel=</span><span class="tx">"stylesheet"</span> <span class="at">href=</span><span class="tx">"theme.css"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- -n: dependency import --&gt;</span><br>
                        <span class="pf">-n:</span> <span class="tg">&lt;script</span> <span class="at">src=</span><span class="tx">"mermaid.min.js"</span><span class="tg">&gt;&lt;/script&gt;</span> <span class="cm">&lt;!-- -n: dependency import --&gt;</span><br>
                        <span class="pf">+0:</span> <span class="tg">&lt;div</span> <span class="at">class=</span><span class="tx">"notepad-container"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +0: class / structure --&gt;</span><br>
                        <span class="pf"> 0:</span> <span class="tg">&lt;div</span> <span class="at">class=</span><span class="tx">"notepad-header"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- 0: function / method --&gt;</span><br>
                        <span class="pf">+n:</span> <span class="tg">&lt;div</span> <span class="at">v-if=</span><span class="tx">"cells.length"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +n: conditional --&gt;</span><br>
                        <span class="pf">+2:</span> <span class="tg">&lt;li</span> <span class="at">v-for=</span><span class="tx">"cell in cells"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +2: loop / iteration --&gt;</span><br>
                        <span class="pf">-1:</span> <span class="tg">&lt;div</span> <span class="at">class=</span><span class="tx">"output-error"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- -1: error handling --&gt;</span><br>
                        <span class="pf">+3:</span> <span class="tg">&lt;span</span> <span class="at">id=</span><span class="tx">"position-display"</span><span class="tg">&gt;</span> <span class="cm">&lt;!-- +3: output / render --&gt;</span><br>
                        <span class="pf">-0:</span> <span class="tg">&lt;/div&gt;&lt;/html&gt;</span> <span class="cm">&lt;!-- -0: return / exit / close --&gt;</span>
                    </div>

                    <p style="margin-bottom: var(--cursor-space-sm);">
                        <strong>What this enables:</strong> A quantum web scraper reads any URL, assigns prefixes to every DOM node,
                        and builds a 3D navigable map of that page in milliseconds. CSS rules get <code>+0:</code> (structure),
                        event handlers get <code>0:</code> (function), API fetches get <code>-n:</code> (dependency).
                        The same system works on <code>.py</code>, <code>.rs</code>, <code>.go</code>, <code>.sh</code>,
                        <code>.json</code>, <code>.yaml</code>, <code>.toml</code>, Dockerfiles, Makefiles, and assembly.
                    </p>

                    <div class="tag-row" style="margin-bottom: 0;">
                        <span class="tag tag--green">HTML / CSS / JS</span>
                        <span class="tag tag--green">Python / Rust / Go / C</span>
                        <span class="tag tag--blue">YAML / TOML / JSON</span>
                        <span class="tag tag--blue">Docker / Make / Shell</span>
                        <span class="tag tag--yellow">Any future language</span>
                        <span class="tag tag--green">Gutter LIVE</span>
                        <span class="tag tag--green">Timeline LIVE</span>
                        <span class="tag tag--green">Security LIVE</span>
                        <span class="tag tag--green">Git Hook LIVE</span>
                    </div>
                </div>

                <!-- ====== AI CONVERSION ROADMAP ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; AI-Compatible Conversion Roadmap</h3>
                    <p style="margin-bottom: var(--cursor-space-sm);">
                        Every open LLM/AI framework below has a concrete path to quantum-prefix conversion.
                        The bridge server exposes <code>POST /api/roadmap/scan</code> and <code>POST /api/roadmap/convert</code>
                        to batch-convert any codebase. Status reflects current prefix engine support.
                    </p>

                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:8px;margin-bottom:var(--cursor-space-md);">

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ§  tinygrad</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Ultra-minimal ML framework (~10K lines Python). Prefix coverage: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">Loaded in bridge</span>
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Tensor in namespace</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ”¬ micrograd</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Tiny autograd engine (~150 lines). Prefix coverage: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">Value in namespace</span>
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Pure Python</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ¦™ Ollama (llama3.2)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Local LLM server. Bridge connects at <code>localhost:11434</code>. Go codebase: <strong style="color:#7ee787;">93%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">API integrated</span>
                                <span class="tag tag--purple" style="font-size:0.5rem;padding:1px 5px;">Local inference</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ¤– OpenAI / GPT-4o</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Cloud API via bridge. Code: Python/JS. Prefix coverage: <strong style="color:#7ee787;">96%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">API integrated</span>
                                <span class="tag tag--yellow" style="font-size:0.5rem;padding:1px 5px;">Needs API key</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ§¬ Anthropic / Claude</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Cloud API via bridge. Code: Python/TS. Prefix coverage: <strong style="color:#7ee787;">96%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">API integrated</span>
                                <span class="tag tag--yellow" style="font-size:0.5rem;padding:1px 5px;">Needs API key</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ”¥ PyTorch</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Python + C++ core. Python prefix: <strong style="color:#7ee787;">98%</strong> Â· C++ prefix: <strong style="color:#7ee787;">91%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--yellow" style="font-size:0.5rem;padding:1px 5px;">~150K files</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ¤— Hugging Face Transformers</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Python library. Prefix coverage: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--purple" style="font-size:0.5rem;padding:1px 5px;">Phase 3</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">âš¡ JAX / Flax</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Python + XLA. Prefix coverage: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--purple" style="font-size:0.5rem;padding:1px 5px;">Phase 3</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ§ª ONNX Runtime</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">C++ / Python. C++ prefix: <strong style="color:#7ee787;">91%</strong> Â· Python: <strong style="color:#7ee787;">98%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--yellow" style="font-size:0.5rem;padding:1px 5px;">Multi-lang</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸŒ€ llama.cpp / ggml</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">C / C++ inference. Prefix coverage: <strong style="color:#7ee787;">91%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">Offline</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ¦€ Candle (Rust ML)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Rust ML framework. Prefix coverage: <strong style="color:#7ee787;">94%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--purple" style="font-size:0.5rem;padding:1px 5px;">Phase 3</span>
                            </div>
                        </div>

                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ”® MLX (Apple)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">Python + C++ for Apple Silicon. Python: <strong style="color:#7ee787;">98%</strong> Â· C++: <strong style="color:#7ee787;">91%</strong></div>
                            <div style="display:flex;gap:4px;flex-wrap:wrap;">
                                <span class="tag tag--blue" style="font-size:0.5rem;padding:1px 5px;">Scan ready</span>
                                <span class="tag tag--green" style="font-size:0.5rem;padding:1px 5px;">AMX native</span>
                            </div>
                        </div>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">4 loaded in bridge (tinygrad, micrograd, Ollama, dynamic models)</span>
                        <span class="tag tag--blue">12 frameworks scan-ready</span>
                        <span class="tag tag--purple">55+ endpoints &middot; 10 MCP tools &middot; tinygrad classifier LIVE</span>
                    </div>
                </div>

                <!-- ====== beyondBINARY TRAINING FORMULA ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; beyond<span style="font-weight:900;">BINARY</span> Training Formula for LLMs &amp; MCPs</h3>
                    <p style="margin-bottom: var(--cursor-space-sm);">
                        A universal formula and training protocol for any LLM, MCP server, or AI agent to learn,
                        adopt, and enhance the beyond<strong>BINARY</strong> 9-symbol paradigm &mdash; shifting code architecture
                        from <code>{0, 1}</code> to <code>{+1, 1, -1, +0, 0, -0, +n, n, -n}</code>.
                    </p>

                    <!-- The Formula -->
                    <div style="background:var(--cursor-bg);border:2px solid var(--cursor-accent);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);text-align:center;">
                        <div style="font-size:0.625rem;text-transform:uppercase;letter-spacing:1px;color:var(--cursor-accent);margin-bottom:8px;font-weight:700;">beyondBINARY Quantum Weight Formula</div>
                        <div style="font-family:var(--cursor-font-mono);font-size:1rem;font-weight:700;color:var(--cursor-text);line-height:1.8;">
                            Q<sub>w</sub>(line) = P<sub>prefix</sub> &times; D<sub>depth</sub> &times; C<sub>context</sub> &times; S<sub>semantic</sub>
                        </div>
                        <div style="font-size:0.6875rem;color:var(--cursor-text-muted);margin-top:8px;text-align:left;">
                            <strong>P<sub>prefix</sub></strong> = quantum prefix symbol from {+1, 1, -1, +0, 0, -0, +n, n, -n} mapped to weight [-1.0 &hellip; +1.0]<br>
                            <strong>D<sub>depth</sub></strong> = indentation depth / structural nesting level (normalized 0&hellip;1)<br>
                            <strong>C<sub>context</sub></strong> = contextual relevance to 3D position [X=deps, Y=lines, Z=complexity]<br>
                            <strong>S<sub>semantic</sub></strong> = semantic role weight (import=0.9, function=1.0, comment=0.3, error=0.8, loop=0.7)
                        </div>
                    </div>

                    <!-- Prefix Weight Map -->
                    <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:var(--cursor-space-sm) var(--cursor-space-md);margin-bottom:var(--cursor-space-md);">
                        <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Prefix &rarr; Weight Map (for LLM training embeddings)</div>
                        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:4px;font-family:var(--cursor-font-mono);font-size:0.625rem;">
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">+1:</span> <span style="color:var(--cursor-text-muted);">comment/doc</span> <span style="margin-left:auto;color:#7ee787;">+0.3</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;"> 1:</span> <span style="color:var(--cursor-text-muted);">variable</span> <span style="margin-left:auto;color:#7ee787;">+0.5</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">-1:</span> <span style="color:var(--cursor-text-muted);">error/except</span> <span style="margin-left:auto;color:#f97583;">-0.8</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">+0:</span> <span style="color:var(--cursor-text-muted);">class/struct</span> <span style="margin-left:auto;color:#7ee787;">+1.0</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;"> 0:</span> <span style="color:var(--cursor-text-muted);">function/def</span> <span style="margin-left:auto;color:#7ee787;">+0.9</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">-0:</span> <span style="color:var(--cursor-text-muted);">return/yield</span> <span style="margin-left:auto;color:#f0d852;">+0.4</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">+n:</span> <span style="color:var(--cursor-text-muted);">conditional</span> <span style="margin-left:auto;color:#f0d852;">+0.6</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;"> n:</span> <span style="color:var(--cursor-text-muted);">entry/shebang</span> <span style="margin-left:auto;color:#7ee787;">+0.7</span></div>
                            <div style="display:flex;align-items:center;gap:6px;"><span style="color:var(--cursor-accent);font-weight:700;">-n:</span> <span style="color:var(--cursor-text-muted);">import/dep</span> <span style="margin-left:auto;color:#d2a8ff;">+0.85</span></div>
                        </div>
                    </div>

                    <!-- LLM Training Protocol -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">LLM / MCP Training Protocol</div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:8px;margin-bottom:var(--cursor-space-md);">

                        <!-- GPT / OpenAI -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ¤– GPT-4o / GPT-5 (OpenAI)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Fine-tune on prefixed codebases using JSONL format.
                                Each training sample = raw code + quantum-prefixed version + Q<sub>w</sub> weight vector.
                                System prompt injection: "All code exists in 3D space addressed by {+1, 1, -1, +0, 0, -0, +n, n, -n}."
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>MCP integration:</strong> Expose <code>/api/prefix</code> as MCP tool.
                                GPT reads raw code â†’ calls prefix tool â†’ returns dimensionally-addressed output.
                            </div>
                        </div>

                        <!-- Claude / Anthropic -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ§¬ Claude 4 / Opus (Anthropic)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Constitutional AI + beyondBINARY principles as system constraints.
                                Teach: "Every line of code has a quantum weight Q<sub>w</sub> that determines its structural importance."
                                RLHF reward model tuned on prefix-quality scoring.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>MCP integration:</strong> MCP server with <code>prefix</code>, <code>execute</code>, <code>navigate</code>, <code>diff</code> tools.
                                Claude navigates code in 3D using quantum coordinates.
                            </div>
                        </div>

                        <!-- Gemini / Google -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ’Ž Gemini 2.5 Pro (Google)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Multi-modal training with prefixed code + 3D spatial visualization.
                                Gemini's code understanding + beyondBINARY structural layer = code-as-topology model.
                                Token weighting by Q<sub>w</sub> during attention computation.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>Integration:</strong> Vertex AI pipeline â†’ prefix conversion â†’ weighted inference.
                            </div>
                        </div>

                        <!-- Llama / Meta -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ¦™ Llama 4 (Meta)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Open-weight fine-tuning on quantum-prefixed datasets.
                                LoRA adapters for beyondBINARY: prefix recognition head + Q<sub>w</sub> prediction head.
                                Local training via Ollama â†’ <code>ollama create beyondBINARY -f Modelfile</code>.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>MCP integration:</strong> Ollama API â†’ bridge server â†’ <code>/api/ai</code> endpoint.
                            </div>
                        </div>

                        <!-- Mistral -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸŒŠ Mistral / Codestral</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Code-specialized model + prefix layer.
                                Codestral's 32K context â†’ full-file quantum weighting in one pass.
                                Mixture-of-experts: route prefix-heavy tokens to dedicated expert.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>Advantage:</strong> EU-hosted, air-gapped compatible. Matches uvspeed offline-first.
                            </div>
                        </div>

                        <!-- DeepSeek -->
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ”¬ DeepSeek-Coder V3</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Training approach:</strong> Fill-in-the-middle (FIM) + prefix insertion.
                                Train to predict missing quantum prefix given code context.
                                Reward: Q<sub>w</sub> accuracy on held-out prefixed codebases.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>Key value:</strong> Open-source. Community can train custom beyondBINARY models.
                            </div>
                        </div>

                        <!-- Cursor / Copilot âœ… SHIPPED -->
                        <div style="background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#7ee787;margin-bottom:4px;">âš¡ Cursor / GitHub Copilot &mdash; âœ… LIVE</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Shipped:</strong> <code>.cursor/rules/quantum-prefix-gutter.mdc</code> + dedicated <code>mcp_server.py</code> (10 tools).
                                Live quantum gutter, convert timeline, 3D nav with Visual Slice / Cube / Orb.
                                Dynamic Ollama model picker + tinygrad prefix classifier integrated.
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>MCP server:</strong> <code>src/01-core/mcp_server.py</code> (stdio) &mdash; 10 tools: prefix, execute, navigate, diff, AI, models, security, sessions, languages + 55+ bridge endpoints.
                            </div>
                        </div>

                        <!-- MCP Protocol âœ… EXPANDED -->
                        <div style="background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#7ee787;margin-bottom:4px;">ðŸ”Œ MCP (Model Context Protocol) &mdash; 10 tools + 55+ endpoints</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);margin-bottom:6px;">
                                <strong>Dedicated MCP server (<code>mcp_server.py</code>, stdio transport):</strong><br>
                                <code>uvspeed_status</code> &mdash; bridge health + version<br>
                                <code>uvspeed_prefix</code> &mdash; classify code with quantum prefixes<br>
                                <code>uvspeed_execute</code> &mdash; run code via bridge (Python/shell/uv)<br>
                                <code>uvspeed_navigate</code> &mdash; move through 3D code space<br>
                                <code>uvspeed_diff</code> &mdash; prefix-aware structural diff<br>
                                <code>uvspeed_ai</code> &mdash; multi-model AI inference<br>
                                <code>uvspeed_ai_models</code> &mdash; list available AI models<br>
                                <code>uvspeed_security_scan</code> &mdash; prefix-aware security scanning<br>
                                <code>uvspeed_sessions</code> &mdash; session management<br>
                                <code>uvspeed_languages</code> &mdash; supported language list
                            </div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                <strong>Any LLM + this MCP = beyondBINARY capable.</strong> No fine-tuning required. Cursor / Claude Desktop / any MCP client.
                            </div>
                        </div>
                    </div>

                    <!-- Training Dataset Formula -->
                    <div style="background:var(--cursor-bg);border:2px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);">
                        <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:8px;">Training Dataset Generation Formula</div>
                        <div style="font-family:var(--cursor-font-mono);font-size:0.625rem;color:var(--cursor-text-muted);line-height:1.8;">
                            <strong style="color:var(--cursor-text);">Step 1:</strong> <code>POST /api/roadmap/scan</code> &rarr; inventory all files by language<br>
                            <strong style="color:var(--cursor-text);">Step 2:</strong> <code>POST /api/roadmap/convert</code> &rarr; batch prefix-convert (20 langs, 68-98% coverage)<br>
                            <strong style="color:var(--cursor-text);">Step 3:</strong> For each file pair (raw, prefixed), generate training sample:<br>
                            &emsp;<code>{"input": raw_code, "output": prefixed_code, "Qw": [weight_vector], "lang": language, "coords": [x,y,z]}</code><br>
                            <strong style="color:var(--cursor-text);">Step 4:</strong> <code>POST /api/security/scan</code> &rarr; annotate each sample with security findings + risk score<br>
                            <strong style="color:var(--cursor-text);">Step 5:</strong> Fine-tune with loss = <code>CrossEntropy(predicted_prefix, actual_prefix) + MSE(predicted_Qw, actual_Qw)</code><br>
                            <strong style="color:var(--cursor-text);">Step 6:</strong> Validate on held-out codebases: target &ge; 90% prefix accuracy across all 20 languages<br>
                            <strong style="color:var(--cursor-text);">Step 7:</strong> Deploy as MCP server (25 endpoints) or embed in LLM context window via <code>.cursor/rules/quantum-prefix-gutter.mdc</code>
                        </div>
                    </div>

                    <!-- Future Tech Impact -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Future Tech Enhancement via beyondBINARY</div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:6px;margin-bottom:var(--cursor-space-md);">
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">ðŸ§Š Quantum Computing</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Q<sub>w</sub> maps directly to qubit amplitudes. Classical code becomes quantum-executable via prefix â†’ gate compilation. CUDA-Q / Cirq / Qiskit as targets.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">ðŸ§¬ Neuromorphic Chips</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">9-symbol prefix = 9-spike pattern. Map code structure to spiking neural networks. Intel Loihi / IBM TrueNorth targets. Code runs as neural topology.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">ðŸŒ Spatial Computing</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">3D code coordinates [X,Y,Z] render as spatial objects. Apple Vision Pro / Meta Quest as code visualization. Walk through code in VR.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">âš¡ Edge AI / TinyML</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">beyondBINARY prefix = 4-bit encoding. Fits in 64B headers. On-device code understanding for IoT, embedded, RISC-V. tinygrad as runtime.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">ðŸ”— Autonomous Agents</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Agents navigate code by Q<sub>w</sub> weight, not line number. Agent A (prefix) â†’ Agent B (execute) â†’ Agent C (review) pipeline via quantum coordinates.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;">
                            <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);">ðŸ›¡ï¸ Post-Quantum Security</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Prefix weights create a structural fingerprint per codebase. Tamper detection: if Q<sub>w</sub> vector changes, code was modified. Lattice-based signing over prefix space.</div>
                        </div>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">Q<sub>w</sub> formula ready for embedding</span>
                        <span class="tag tag--blue">8 LLM/MCP training paths defined</span>
                        <span class="tag tag--green">Cursor rule LIVE (.mdc)</span>
                        <span class="tag tag--green">Quantum gutter + Visual Slice LIVE</span>
                        <span class="tag tag--green">55+ endpoints + 10 MCP tools LIVE</span>
                        <span class="tag tag--purple">MCP server = instant beyondBINARY for any LLM</span>
                        <span class="tag tag--yellow">6 future tech domains mapped</span>
                    </div>
                </div>

                <!-- ====== IDE PLUGIN: .mdc PREFIX GUTTER RULE ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; IDE Plugin: Quantum Prefix Gutter Rule (<code>.mdc</code>)</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);">
                        A <strong>Cursor IDE rule</strong> that teaches any AI model the beyondBINARY 9-symbol system natively.
                        Installed at <code>.cursor/rules/quantum-prefix-gutter.mdc</code> &mdash; always active, zero config.
                        Any AI agent in Cursor automatically classifies, generates, and reviews code with quantum prefixes.
                    </p>

                    <!-- Status badge -->
                    <div style="display:flex;gap:var(--cursor-space-sm);align-items:center;margin-bottom:var(--cursor-space-md);">
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… SHIPPED &amp; LIVE</span>
                        <span style="font-size:0.625rem;color:var(--cursor-text-muted);">Path: <code>.cursor/rules/quantum-prefix-gutter.mdc</code> &middot; <code>alwaysApply: true</code> &middot; 74 lines</span>
                    </div>

                    <!-- Rule file content preview -->
                    <div style="background:var(--cursor-bg);border:2px solid var(--cursor-accent);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.625rem;line-height:1.7;overflow-x:auto;">
                        <div style="color:var(--cursor-accent);font-weight:700;margin-bottom:8px;">// .cursor/rules/quantum-prefix-gutter.mdc</div>
                        <span style="color:#484f58;">---</span><br>
                        <span style="color:#d2a8ff;">alwaysApply:</span> <span style="color:#7ee787;">true</span><br>
                        <span style="color:#484f58;">---</span><br>
                        <span style="color:#7ee787;font-weight:700;"># Quantum beyondBINARY Prefix System</span><br><br>
                        <span style="color:var(--cursor-text-muted);">All code in this project uses the <strong style="color:var(--cursor-text);">9-symbol quantum prefix system</strong>.</span><br>
                        <span style="color:var(--cursor-text-muted);">Every line of code gets a prefix that classifies its structural role.</span><br><br>
                        <span style="color:#7ee787;">## The 9 Symbols</span><br>
                        <div style="display:grid;grid-template-columns:60px 80px 1fr;gap:2px 12px;margin:6px 0 6px 8px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">n:</span>  <span style="color:#f97583;">shebang</span>   <span style="color:var(--cursor-text-muted);">Entry points, shebangs</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span> <span style="color:#7ee787;">comment</span>   <span style="color:var(--cursor-text-muted);">Comments, documentation, decorators</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">-n:</span> <span style="color:#d2a8ff;">import</span>    <span style="color:var(--cursor-text-muted);">Imports, includes, requires</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+0:</span> <span style="color:#79c0ff;">class</span>     <span style="color:var(--cursor-text-muted);">Class, struct, type, enum defs</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">0:</span>  <span style="color:#79c0ff;">function</span>  <span style="color:var(--cursor-text-muted);">Function, method definitions</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">-1:</span> <span style="color:#f97583;">error</span>     <span style="color:var(--cursor-text-muted);">Error handling, try/catch/raise</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+n:</span> <span style="color:#f0d852;">condition</span> <span style="color:var(--cursor-text-muted);">If/else/switch/match conditionals</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+2:</span> <span style="color:#f0883e;">loop</span>      <span style="color:var(--cursor-text-muted);">For/while/repeat loops</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">-0:</span> <span style="color:#f0d852;">return</span>    <span style="color:var(--cursor-text-muted);">Return/yield statements</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">+3:</span> <span style="color:#7ee787;">output</span>    <span style="color:var(--cursor-text-muted);">Print/echo/log/render output</span>
                            <span style="color:var(--cursor-accent);font-weight:700;">1:</span>  <span style="color:var(--cursor-text);">variable</span> <span style="color:var(--cursor-text-muted);">Variable declarations/assignments</span>
                        </div>
                        <br>
                        <span style="color:#7ee787;">## Rules for AI</span><br>
                        <span style="color:var(--cursor-text-muted);">1. When writing or editing code, mentally classify each line by its prefix</span><br>
                        <span style="color:var(--cursor-text-muted);">2. When showing code examples, include prefix annotations as comments</span><br>
                        <span style="color:var(--cursor-text-muted);">3. When reviewing code, note which prefix categories changed</span><br>
                        <span style="color:var(--cursor-text-muted);">4. Prefix-aware diffs should show which quantum coordinates shifted</span><br>
                        <span style="color:var(--cursor-text-muted);">5. All 20 supported languages use the same 9-symbol system</span><br><br>
                        <span style="color:#7ee787;">## Supported Languages (20)</span><br>
                        <span style="color:var(--cursor-text);">python, javascript, typescript, rust, go, c, shell, html, css, java, swift, kotlin, ruby, yaml, toml, sql, dockerfile, nushell, zig, assembly</span><br><br>
                        <span style="color:#7ee787;">## When Generating Files</span><br>
                        <span style="color:var(--cursor-text-muted);">Every file includes header: </span><span style="color:var(--cursor-text);font-weight:600;"># beyondBINARY quantum-prefixed | uvspeed | {+1, 1, -1, +0, 0, -0, +n, n, -n}</span>
                    </div>

                    <!-- How it works -->
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:8px;margin-bottom:var(--cursor-space-md);">
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ§  How It Trains the AI</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                The <code>alwaysApply: true</code> flag injects the rule into every AI interaction in Cursor.
                                The AI learns the 9-symbol table, the classification rules, and the 20-language support.
                                Every code generation, review, and refactor inherits quantum prefix awareness.
                            </div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">âš¡ Live Quantum Gutter (Notepad)</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                In <code>quantum-notepad.html</code>, every cell has a live gutter column.
                                Each line is classified in real-time using the same 9-symbol rules.
                                Color-coded prefixes (<code>pfx-shebang</code> through <code>pfx-default</code>), debounced 100ms, scroll-synced with textarea.
                            </div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ“Š Convert Timeline Bar</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                Top bar auto-calibrates when code is pasted or edited.
                                Shows prefix coverage %, per-category segment distribution, and detected language.
                                Animates a 1.5s pulse during conversion. Updates on cell focus.
                            </div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);margin-bottom:4px;">ðŸ”Œ Bridge API Integration</div>
                            <div style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                Server-side prefix engine mirrors the client gutter: <code>POST /api/prefix</code> for code, <code>POST /api/prefix/file</code> for files.
                                Security scanner uses prefix context to weight findings.
                                Git hooks validate prefix headers on commit.
                            </div>
                        </div>
                    </div>

                    <!-- Python example with live prefixes -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Example: Python with Quantum Prefix Gutter</div>
                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:12px 14px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.625rem;line-height:1.8;overflow-x:auto;">
                        <div style="display:grid;grid-template-columns:36px 28px 1fr;gap:0 6px;">
                            <span style="color:#f97583;font-weight:700;text-align:right;">n:</span>   <span style="color:#484f58;text-align:right;">1</span> <span style="color:var(--cursor-text-muted);">#!/usr/bin/env python3</span>
                            <span style="color:#7ee787;font-weight:700;text-align:right;">+1:</span>  <span style="color:#484f58;text-align:right;">2</span> <span style="color:#7ee787;"># Quantum computation module</span>
                            <span style="color:#d2a8ff;font-weight:700;text-align:right;">-n:</span>  <span style="color:#484f58;text-align:right;">3</span> <span style="color:var(--cursor-text);">import numpy as np</span>
                            <span style="color:#d2a8ff;font-weight:700;text-align:right;">-n:</span>  <span style="color:#484f58;text-align:right;">4</span> <span style="color:var(--cursor-text);">from tinygrad.tensor import Tensor</span>
                            <span style="color:#484f58;font-weight:700;text-align:right;"></span>    <span style="color:#484f58;text-align:right;">5</span> <span></span>
                            <span style="color:#79c0ff;font-weight:700;text-align:right;">+0:</span>  <span style="color:#484f58;text-align:right;">6</span> <span style="color:var(--cursor-text);font-weight:600;">class QuantumState:</span>
                            <span style="color:#7ee787;font-weight:700;text-align:right;">+1:</span>  <span style="color:#484f58;text-align:right;">7</span> <span style="color:#7ee787;">    &quot;&quot;&quot;Represents a quantum state vector.&quot;&quot;&quot;</span>
                            <span style="color:#484f58;font-weight:700;text-align:right;"></span>    <span style="color:#484f58;text-align:right;">8</span> <span></span>
                            <span style="color:#79c0ff;font-weight:700;text-align:right;">0:</span>   <span style="color:#484f58;text-align:right;">9</span> <span style="color:var(--cursor-text);">    def __init__(self, qubits=3):</span>
                            <span style="color:var(--cursor-text);font-weight:700;text-align:right;">1:</span>   <span style="color:#484f58;text-align:right;">10</span> <span style="color:var(--cursor-text);">        self.n = qubits</span>
                            <span style="color:var(--cursor-text);font-weight:700;text-align:right;">1:</span>   <span style="color:#484f58;text-align:right;">11</span> <span style="color:var(--cursor-text);">        self.state = Tensor.randn(2 ** qubits)</span>
                            <span style="color:#79c0ff;font-weight:700;text-align:right;">0:</span>   <span style="color:#484f58;text-align:right;">13</span> <span style="color:var(--cursor-text);">    def normalize(self):</span>
                            <span style="color:#f0d852;font-weight:700;text-align:right;">-0:</span>  <span style="color:#484f58;text-align:right;">14</span> <span style="color:var(--cursor-text);">        return self.state / self.state.norm()</span>
                            <span style="color:#79c0ff;font-weight:700;text-align:right;">0:</span>   <span style="color:#484f58;text-align:right;">16</span> <span style="color:var(--cursor-text);">    def measure(self):</span>
                            <span style="color:#f97583;font-weight:700;text-align:right;">-1:</span>  <span style="color:#484f58;text-align:right;">17</span> <span style="color:var(--cursor-text);">        try:</span>
                            <span style="color:var(--cursor-text);font-weight:700;text-align:right;">1:</span>   <span style="color:#484f58;text-align:right;">18</span> <span style="color:var(--cursor-text);">            probs = (self.state ** 2).numpy()</span>
                            <span style="color:#f0d852;font-weight:700;text-align:right;">-0:</span>  <span style="color:#484f58;text-align:right;">19</span> <span style="color:var(--cursor-text);">            return probs</span>
                            <span style="color:#f97583;font-weight:700;text-align:right;">-1:</span>  <span style="color:#484f58;text-align:right;">20</span> <span style="color:var(--cursor-text);">        except Exception as e:</span>
                            <span style="color:#7ee787;font-weight:700;text-align:right;">+3:</span>  <span style="color:#484f58;text-align:right;">21</span> <span style="color:var(--cursor-text);">            print(f&quot;Measurement error: {e}&quot;)</span>
                        </div>
                    </div>

                    <!-- Installation -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Install in Any Project</div>
                    <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 14px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.625rem;line-height:1.8;">
                        <span style="color:#7ee787;"># 1. Copy the rule file into any project</span><br>
                        <span style="color:var(--cursor-text);">mkdir -p .cursor/rules</span><br>
                        <span style="color:var(--cursor-text);">cp uvspeed/.cursor/rules/quantum-prefix-gutter.mdc .cursor/rules/</span><br><br>
                        <span style="color:#7ee787;"># 2. That's it. Cursor AI now understands quantum prefixes.</span><br>
                        <span style="color:#7ee787;"># Every code generation, review, and refactor is prefix-aware.</span><br><br>
                        <span style="color:#7ee787;"># 3. Optional: stamp all files with beyondBINARY header</span><br>
                        <span style="color:var(--cursor-text);">python3 tools/prefix_all_files.py</span><br><br>
                        <span style="color:#7ee787;"># 4. Optional: install quantum pre-commit hook</span><br>
                        <span style="color:var(--cursor-text);">curl -s http://localhost:8085/api/git/hook/install -X POST -d '{"repo":"."}'</span>
                    </div>

                    <!-- Compatibility -->
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:6px;margin-bottom:var(--cursor-space-md);">
                        <div style="background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:#7ee787;">Cursor IDE</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);"><code>.mdc</code> rules &middot; always-on</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">GitHub Copilot</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);"><code>.github/copilot-instructions.md</code></div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">VS Code</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);"><code>.vscode/settings.json</code> context</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Any MCP Client</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);"><code>quantum_bridge_server.py</code></div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:8px 10px;text-align:center;">
                            <div style="font-size:0.75rem;font-weight:700;color:var(--cursor-text);">Windsurf</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Rules-compatible format</div>
                        </div>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">alwaysApply: true</span>
                        <span class="tag tag--green">9 symbols &middot; 20 languages</span>
                        <span class="tag tag--green">Live gutter + timeline</span>
                        <span class="tag tag--blue">Zero config &middot; copy 1 file</span>
                        <span class="tag tag--purple">Works with any AI model in Cursor</span>
                    </div>

                    <!-- Multi-IDE Config Files -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin:var(--cursor-space-md) 0 6px;">Shipped IDE Configuration Files</div>
                    <div style="display:grid;grid-template-columns:1fr;gap:3px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.5625rem;">
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.cursor/rules/quantum-prefix-gutter.mdc</span>
                            <span style="color:#7ee787;">Cursor &mdash; always-on prefix rule (alwaysApply: true)</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.cursor/rules/quantum-commands.mdc</span>
                            <span style="color:#7ee787;">Cursor &mdash; bridge API commands reference</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.cursor/skills/quantum-prefix-skill.md</span>
                            <span style="color:#7ee787;">Cursor &mdash; prefix conversion skill + API reference</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.github/copilot-instructions.md</span>
                            <span style="color:#7ee787;">GitHub Copilot &mdash; 9-symbol training + Q<sub>w</sub> formula</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.vscode/settings.json</span>
                            <span style="color:#7ee787;">VS Code &mdash; project settings, file associations, env</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 280px 1fr;gap:6px;padding:4px 10px;background:rgba(126,231,135,0.06);border-radius:2px;">
                            <span style="color:var(--cursor-accent);font-weight:700;">+1:</span>
                            <span style="color:var(--cursor-text);">.windsurf/rules/quantum-prefix.md</span>
                            <span style="color:#7ee787;">Windsurf &mdash; AI rule for prefix-aware generation</span>
                        </div>
                    </div>

                    <!-- Quantum Folder Structure -->
                    <div style="font-size:0.6875rem;font-weight:700;color:var(--cursor-text);margin-bottom:6px;">Quantum-Organized Folder Structure (<code>src/MANIFEST.md</code>)</div>
                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:12px 14px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.5625rem;line-height:1.8;">
                        <span style="color:var(--cursor-text-muted);">uvspeed/src/</span><br>
                        <span style="color:#f97583;font-weight:700;">&ensp;n:</span>&ensp; <span style="color:var(--cursor-text);">n-entry/</span> <span style="color:var(--cursor-text-muted);">&mdash; launchers, entry points, shell scripts</span><br>
                        <span style="color:#7ee787;font-weight:700;">+1:</span>&ensp; <span style="color:var(--cursor-text);">p1-docs/</span> <span style="color:var(--cursor-text-muted);">&mdash; README, docs, config, themes, demo data</span><br>
                        <span style="color:#d2a8ff;font-weight:700;">-n:</span>&ensp; <span style="color:var(--cursor-text);">mn-deps/</span> <span style="color:var(--cursor-text-muted);">&mdash; pyproject.toml, package.json, manifest.json</span><br>
                        <span style="color:#79c0ff;font-weight:700;">+0:</span>&ensp; <span style="color:var(--cursor-text);">p0-core/</span> <span style="color:var(--cursor-text-muted);">&mdash; bridge server, notepad, prototype (main app)</span><br>
                        <span style="color:#79c0ff;font-weight:700;">&ensp;0:</span>&ensp; <span style="color:var(--cursor-text);">z-functions/</span> <span style="color:var(--cursor-text-muted);">&mdash; tools, utilities, helper scripts</span><br>
                        <span style="color:#f97583;font-weight:700;">-1:</span>&ensp; <span style="color:var(--cursor-text);">m1-tests/</span> <span style="color:var(--cursor-text-muted);">&mdash; test scripts, verification, QA</span><br>
                        <span style="color:#f0d852;font-weight:700;">+n:</span>&ensp; <span style="color:var(--cursor-text);">pn-platforms/</span> <span style="color:var(--cursor-text-muted);">&mdash; platform-specific builds (Firefox, multi)</span><br>
                        <span style="color:#f0883e;font-weight:700;">+2:</span>&ensp; <span style="color:var(--cursor-text);">p2-versions/</span> <span style="color:var(--cursor-text-muted);">&mdash; progressive version snapshots</span><br>
                        <span style="color:#f0d852;font-weight:700;">-0:</span>&ensp; <span style="color:var(--cursor-text);">m0-output/</span> <span style="color:var(--cursor-text-muted);">&mdash; build output, dist, compiled assets</span><br>
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">6 IDE config files shipped</span>
                        <span class="tag tag--green">9 prefix-mapped folders</span>
                        <span class="tag tag--blue">MANIFEST.md index for AI navigation</span>
                    </div>
                </div>

                <!-- ====== FREYA UNITS â€” PRECISION CONVERTER ====== -->
                <div class="inspect-section">
                    <h3>ðŸ”¬ FreyaUnits &mdash; Precision Unit Converter</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);">
                        <strong style="color:#a78bfa;">FreyaUnits</strong> is a full-stack precision conversion system spanning <strong style="color:#06b6d4;">Planck length</strong> (1.616&times;10&sup;â»Â³âµ m) to <strong style="color:#84cc16;">Parsec</strong> (3.086&times;10&sup;Â¹â¶ m).
                        Integrated as both a <em>notebook cell tool</em> and a <em>game companion</em> in the brotherNumsy runner.
                        <span style="color:var(--cursor-text-muted);font-style:italic;">"A father's love, measured in infinite precision."</span>
                    </p>

                    <div style="display:flex;gap:var(--cursor-space-sm);align-items:center;margin-bottom:var(--cursor-space-md);flex-wrap:wrap;">
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… CELL TOOL LIVE</span>
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… GAME COMPANION LIVE</span>
                        <span class="tag tag--purple" style="font-size:0.6875rem;padding:3px 10px;">27 units &middot; 6 scale categories</span>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid #7c3aed44;border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;line-height:1.8;">
                        <div style="color:#a78bfa;font-weight:700;margin-bottom:6px;">Unit Scale Coverage (27 units)</div>
                        <div style="display:grid;grid-template-columns:90px 140px 1fr;gap:2px 12px;">
                            <span style="color:#8b5cf6;">&#x2113;p</span> <span style="color:var(--cursor-text-muted);">Planck Length</span> <span style="color:var(--cursor-text-muted);">1.616&times;10â»Â³âµ m</span>
                            <span style="color:#6366f1;">fm</span>  <span style="color:var(--cursor-text-muted);">Femtometer</span>   <span style="color:var(--cursor-text-muted);">10â»Â¹âµ m (nuclear)</span>
                            <span style="color:#3b82f6;">&Aring;</span>   <span style="color:var(--cursor-text-muted);">Angstrom</span>     <span style="color:var(--cursor-text-muted);">10â»Â¹â° m (atomic bonds)</span>
                            <span style="color:#06b6d4;">nm</span>  <span style="color:var(--cursor-text-muted);">Nanometer</span>    <span style="color:var(--cursor-text-muted);">10â»â¹ m (DNA, light)</span>
                            <span style="color:#eab308;">&mu;m</span>  <span style="color:var(--cursor-text-muted);">Micrometer</span>   <span style="color:var(--cursor-text-muted);">10â»â¶ m (cells, bacteria)</span>
                            <span style="color:#ef4444;">mm, cm, in, ft, m</span> <span style="color:var(--cursor-text-muted);">Standard</span> <span style="color:var(--cursor-text-muted);">Human scale</span>
                            <span style="color:#f97316;">&lambda;RF, &lambda;VHF, &lambda;AM</span> <span style="color:var(--cursor-text-muted);">EM Waves</span> <span style="color:var(--cursor-text-muted);">Radio to ELF spectrum</span>
                            <span style="color:#dc2626;">km, mi, NM</span> <span style="color:var(--cursor-text-muted);">Large Scale</span> <span style="color:var(--cursor-text-muted);">Geographic distances</span>
                            <span style="color:#84cc16;">AU, ly, pc</span> <span style="color:var(--cursor-text-muted);">Astronomical</span> <span style="color:var(--cursor-text-muted);">Solar &rarr; Parsec</span>
                        </div>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="color:#06b6d4;font-weight:700;margin-bottom:6px;">How to Use</div>
                        <ul>
                            <li>Click <strong style="color:#a78bfa;">ðŸ”¬ FreyaUnits</strong> in the footer to add a converter cell</li>
                            <li>Select units, enter a value &mdash; see all 27 conversions + quantum properties instantly</li>
                            <li>Logarithmic scale visualization shows your position across the full range</li>
                            <li>Quantum properties: frequency, energy (J + eV), momentum, period, light travel time</li>
                            <li>Slow light mode: travel time at 17 m/s (BEC slow light)</li>
                        </ul>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="color:#e6b422;font-weight:700;margin-bottom:6px;">Game Integration: brotherNumsy &amp; Freya</div>
                        <ul>
                            <li><strong style="color:#c084fc;">Freya</strong> flies alongside the player as a 12x12 pixel companion</li>
                            <li>Live HUD converts run distance through all 27 units in real-time</li>
                            <li><strong style="color:#c084fc;">FreyaUnit tokens</strong> charge the conversion beam &mdash; collect 3 to fire</li>
                            <li>Scale milestone facts appear as you pass real-world distances</li>
                            <li><code>window.FreyaUnits.convert(1, 'mi', 'km')</code> &mdash; API available in console</li>
                        </ul>
                    </div>
                </div>

                <!-- ====== KBATCH â€” KEYBOARD PATTERN ANALYZER ====== -->
                <div class="inspect-section">
                    <h3>âŒ¨ kbatch &mdash; Keyboard Contrail/Pattern Analyzer</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);">
                        <strong style="color:#f0883e;">kbatch</strong> is a real-time keyboard analysis tool that visualizes typing patterns through 4 simultaneous canvases
                        &mdash; thermal heatmaps, finger contrails, geometric pattern mapping, and 3D language modeling.
                        Built from the kbatch ecosystem (<code>keyboard_pattern_analyzer.py</code>, <code>geometric_keyboard_mapper.py</code>,
                        <code>keyboard_contrails.py</code>, <code>live_pattern_processor.py</code>) into one self-contained HTML page.
                    </p>

                    <div style="display:flex;gap:var(--cursor-space-sm);align-items:center;margin-bottom:var(--cursor-space-md);flex-wrap:wrap;">
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… TOOL LIVE</span>
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… NOTEPAD CELL</span>
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… API: window.kbatch</span>
                        <span class="tag tag--yellow" style="font-size:0.6875rem;padding:3px 10px;">4 viz panels &middot; 8 stats &middot; terminal + code cell</span>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid #f0883e44;border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;line-height:1.8;">
                        <div style="color:#f0883e;font-weight:700;margin-bottom:6px;">4-Panel Visualization</div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                            <div><strong style="color:#da3633;">ðŸ”¥ Thermal Heatmap</strong> &mdash; Key usage intensity: cold blue â†’ green â†’ yellow â†’ orange â†’ red â†’ white. Glow effects &amp; press counts per key.</div>
                            <div><strong style="color:#58a6ff;">âœˆ Contrails</strong> &mdash; Finger movement paths with fading trail lines, glow endpoints, staggered QWERTY position mapping.</div>
                            <div><strong style="color:#d2a8ff;">â¬¡ Geometric Pattern</strong> &mdash; Radial ring: 30 keys orbit center, expanding by usage intensity. Spoke connections &amp; node glow.</div>
                            <div><strong style="color:#7ee787;">ðŸŽ¹ 3D Language Model</strong> &mdash; Word cloud with efficiency coloring (green/yellow/red), frequency badges (Ã—n), analysis bars.</div>
                        </div>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="color:#58a6ff;font-weight:700;margin-bottom:6px;">Analysis Engine</div>
                        <ul>
                            <li>QWERTY staggered key position mapping for accurate Euclidean distance calculation</li>
                            <li>Direction symbols: â†—â†˜â†™â†–â†’â†â†‘â†“ for movement path signatures</li>
                            <li>Per-word analysis: efficiency %, complexity %, distance, path signature</li>
                            <li>Hapax legomena detection (words appearing exactly once)</li>
                            <li>Stats: WPM, efficiency, complexity, finger strain, key count, total distance</li>
                        </ul>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="color:#7ee787;font-weight:700;margin-bottom:6px;">API: <code>window.kbatch</code></div>
                        <div style="font-family:var(--cursor-font-mono);font-size:0.625rem;line-height:1.8;color:var(--cursor-text-muted);">
                            <code>kbatch.state</code> â€” {wpm, efficiency, complexity, strain, totalKeys, hapax, ...}<br>
                            <code>kbatch.analyze('word')</code> â€” {efficiency, complexity, distance, path}<br>
                            <code>kbatch.processText(text)</code> â€” feed text for batch analysis<br>
                            <code>kbatch.topKeys(5)</code> â€” [{key, count}] most-used keys<br>
                            <code>kbatch.exportJSON()</code> â€” full state as JSON
                        </div>
                    </div>
                </div>

                <!-- ====== HEXCAST â€” LIVE VIDEO HEX BROADCAST ====== -->
                <div class="inspect-section">
                    <h3>ðŸ“¡ hexcast &mdash; Live Video Hex Broadcast</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);">
                        <strong style="color:#da3633;">hexcast</strong> captures live video (camera, screen, or test pattern), encodes each frame into a hex stream grid
                        using the same thermal/fax visualization from the notepad, and measures encode/decode/round-trip/jitter latency
                        on every frame. Cross-tab broadcasting via BroadcastChannel API.
                    </p>

                    <div style="display:flex;gap:var(--cursor-space-sm);align-items:center;margin-bottom:var(--cursor-space-md);flex-wrap:wrap;">
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… TOOL LIVE</span>
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… NOTEPAD CELL</span>
                        <span class="tag tag--green" style="font-size:0.6875rem;padding:3px 10px;">âœ… API: window.hexcast</span>
                        <span class="tag tag--red" style="font-size:0.6875rem;padding:3px 10px;">ðŸ“¡ BroadcastChannel cross-tab</span>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid #da363344;border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;line-height:1.8;">
                        <div style="color:#da3633;font-weight:700;margin-bottom:6px;">Video â†’ Hex Pipeline</div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                            <div><strong style="color:#f97583;">ðŸ“· Camera</strong> &mdash; Webcam â†’ getUserMedia â†’ per-frame pixel extraction â†’ hex encoding</div>
                            <div><strong style="color:#f97583;">ðŸ–µ Screen</strong> &mdash; getDisplayMedia â†’ screen/window share â†’ hex stream encoding</div>
                            <div><strong style="color:#f97583;">â–¦ Test Pattern</strong> &mdash; SMPTE-style color bars + animated scan line (no permissions needed)</div>
                            <div><strong style="color:#f97583;">ðŸ“¡ Broadcast</strong> &mdash; BroadcastChannel API: one tab sends frames, another receives &amp; renders</div>
                        </div>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="color:#f0883e;font-weight:700;margin-bottom:6px;">Encode Modes</div>
                        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;">
                            <div style="text-align:center;"><strong style="color:#f0883e;">Color Thermal</strong><br><span style="color:var(--cursor-text-muted);">Luminance + saturation weighted, full hue spectrum</span></div>
                            <div style="text-align:center;"><strong style="color:#8b949e;">Grayscale</strong><br><span style="color:var(--cursor-text-muted);">BT.601 luma coefficients</span></div>
                            <div style="text-align:center;"><strong style="color:var(--cursor-text);">Fax B/W</strong><br><span style="color:var(--cursor-text-muted);">Binary threshold, classic fax</span></div>
                            <div style="text-align:center;"><strong style="color:#7ee787;">Signal</strong><br><span style="color:var(--cursor-text-muted);">Green phosphor CRT style</span></div>
                        </div>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="color:#7ee787;font-weight:700;margin-bottom:6px;">Latency Benchmarking</div>
                        <ul>
                            <li><strong style="color:#f0883e;">Encode</strong> â€” time to convert raw pixels to hex array (measured per frame)</li>
                            <li><strong style="color:#d2a8ff;">Decode</strong> â€” time to render hex grid to canvas (measured per frame)</li>
                            <li><strong style="color:#7ee787;">Round-trip</strong> â€” encode + decode total (or broadcast latency in receive mode)</li>
                            <li><strong style="color:#e6b422;">Jitter</strong> â€” variance from expected frame interval</li>
                            <li>Real-time scrolling line chart with 4 color-coded series (up to 300 data points)</li>
                            <li>Automated benchmark: all 4 resolutions Ã— 4 modes Ã— 100 iterations each</li>
                        </ul>
                    </div>

                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="color:#7ee787;font-weight:700;margin-bottom:6px;">API: <code>window.hexcast</code></div>
                        <div style="font-family:var(--cursor-font-mono);font-size:0.625rem;line-height:1.8;color:var(--cursor-text-muted);">
                            <code>hexcast.state</code> â€” {source, fps, latency, throughput, frameSize, ...}<br>
                            <code>hexcast.startCamera()</code> / <code>startScreen()</code> / <code>startTestPattern()</code><br>
                            <code>hexcast.startBroadcast()</code> â€” send via BroadcastChannel<br>
                            <code>hexcast.startReceive()</code> â€” receive from another tab<br>
                            <code>hexcast.benchmark()</code> â€” [{resolution, mode, encodeMs, throughputMB}]<br>
                            <code>hexcast.snapshot()</code> â€” save hex frame as PNG<br>
                            <code>hexcast.setEncode('fax')</code> / <code>setResolution(108)</code> / <code>setFPS(30)</code><br>
                            <code>hexcast.exportJSON()</code> â€” full state + latency history
                        </div>
                    </div>
                </div>

                <!-- ====== PHASE 3 READINESS â€” NEXT PHASE CROSS-CHECK ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Phase 3 Readiness â€” What Our New Tools Unlock</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        Cross-check: how each Phase 2.x tool feeds into Phase 3 (Agent Orchestration) and Phase 4 (Production &amp; Scale).
                        <strong style="color:#7ee787;">Green = ready now.</strong>
                        <strong style="color:#e6b422;">Yellow = partial / needs integration.</strong>
                        <strong style="color:#f97583;">Red = blocked / needs new work.</strong>
                    </p>

                    <div style="display:grid;grid-template-columns:1fr;gap:6px;margin-bottom:var(--cursor-space-md);">
                        <!-- kbatch â†’ Agent -->
                        <div style="display:grid;grid-template-columns:120px 1fr 80px;gap:8px;padding:8px 12px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#f0883e;font-weight:700;">âŒ¨ kbatch</span>
                            <div>
                                <div style="color:#7ee787;">âœ… <strong>Agent input analysis</strong> â€” agents can call <code>kbatch.analyze()</code> to measure keyboard efficiency of generated code snippets</div>
                                <div style="color:#7ee787;">âœ… <strong>Language model training</strong> â€” word frequency + hapax detection feeds into vocabulary optimization</div>
                                <div style="color:#e6b422;">âš  <strong>Cross-device sync</strong> â€” needs WebSocket bridge to stream analysis between devices</div>
                                <div style="color:#e6b422;">âš  <strong>Neural enhancement</strong> â€” kbatch Python has neural analyzer (128â†’64â†’2 arch) â€” needs WASM port</div>
                                <div style="color:#f97583;">âŒ <strong>TinyGrad acceleration</strong> â€” kbatch Python supports tinygrad quantum mode â€” needs Pyodide/WebGPU</div>
                            </div>
                            <div style="text-align:right;"><span class="tag tag--green" style="font-size:0.5625rem;">2/5 ready</span></div>
                        </div>

                        <!-- hexcast â†’ Agent -->
                        <div style="display:grid;grid-template-columns:120px 1fr 80px;gap:8px;padding:8px 12px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#da3633;font-weight:700;">ðŸ“¡ hexcast</span>
                            <div>
                                <div style="color:#7ee787;">âœ… <strong>Visual testing agent</strong> â€” agents snapshot hex frames to verify UI state</div>
                                <div style="color:#7ee787;">âœ… <strong>Latency benchmarking</strong> â€” automated encode/decode profiling across resolutions</div>
                                <div style="color:#7ee787;">âœ… <strong>Cross-tab broadcast</strong> â€” BroadcastChannel already working for multi-tab orchestration</div>
                                <div style="color:#e6b422;">âš  <strong>WebRTC P2P</strong> â€” upgrade BroadcastChannel to WebRTC for true cross-device streaming</div>
                                <div style="color:#e6b422;">âš  <strong>WebSocket bridge</strong> â€” connect hexcast to bridge server for device-to-server streaming</div>
                                <div style="color:#f97583;">âŒ <strong>WebCodecs API</strong> â€” hardware-accelerated encode/decode for real video compression</div>
                            </div>
                            <div style="text-align:right;"><span class="tag tag--green" style="font-size:0.5625rem;">3/6 ready</span></div>
                        </div>

                        <!-- brotherNumsy â†’ Agent -->
                        <div style="display:grid;grid-template-columns:120px 1fr 80px;gap:8px;padding:8px 12px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#e6b422;font-weight:700;">ðŸŽ® brotherNumsy</span>
                            <div>
                                <div style="color:#7ee787;">âœ… <strong>RL training API</strong> â€” <code>numsyAI.getState()</code> + <code>numsyAI.act()</code> + <code>numsyAI.onFrame(cb)</code> ready for agents</div>
                                <div style="color:#7ee787;">âœ… <strong>Live code cell</strong> â€” inline JS execution with game state sync</div>
                                <div style="color:#7ee787;">âœ… <strong>Terminal integration</strong> â€” CLI commands for game control + FreyaUnits</div>
                                <div style="color:#e6b422;">âš  <strong>Headless mode</strong> â€” needs canvas-free mode for server-side RL training</div>
                                <div style="color:#e6b422;">âš  <strong>Multi-agent tournament</strong> â€” needs agent-vs-agent scoring infrastructure</div>
                            </div>
                            <div style="text-align:right;"><span class="tag tag--green" style="font-size:0.5625rem;">3/5 ready</span></div>
                        </div>

                        <!-- FreyaUnits â†’ Agent -->
                        <div style="display:grid;grid-template-columns:120px 1fr 80px;gap:8px;padding:8px 12px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#a78bfa;font-weight:700;">ðŸ”¬ FreyaUnits</span>
                            <div>
                                <div style="color:#7ee787;">âœ… <strong>Conversion API</strong> â€” agents call <code>FreyaUnits.convert()</code> for physics/math tasks</div>
                                <div style="color:#7ee787;">âœ… <strong>Scale awareness</strong> â€” agents understand Planckâ†’Parsec scale for quantum/astro code</div>
                                <div style="color:#7ee787;">âœ… <strong>Notebook cell</strong> â€” interactive converter with quantum properties</div>
                                <div style="color:#e6b422;">âš  <strong>MCP tool</strong> â€” needs <code>FreyaUnits.convert</code> exposed as MCP tool resource</div>
                                <div style="color:#7ee787;">âœ… <strong>Game companion</strong> â€” Freya character integrated with distance tracking</div>
                            </div>
                            <div style="text-align:right;"><span class="tag tag--green" style="font-size:0.5625rem;">4/5 ready</span></div>
                        </div>

                        <!-- Notepad â†’ Agent -->
                        <div style="display:grid;grid-template-columns:120px 1fr 80px;gap:8px;padding:8px 12px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#58a6ff;font-weight:700;">ðŸ“ Notepad Core</span>
                            <div>
                                <div style="color:#7ee787;">âœ… <strong>8 cell types</strong> â€” code, markdown, visualization, quantum, mermaid, freya, kbatch, hexcast</div>
                                <div style="color:#7ee787;">âœ… <strong>Bridge API</strong> â€” 40+ endpoints for agent-driven cell management</div>
                                <div style="color:#7ee787;">âœ… <strong>6 JavaScript APIs</strong> â€” numsyAI, FreyaUnits, kbatch, hexcast, bridge, security</div>
                                <div style="color:#e6b422;">âš  <strong>Pyodide</strong> â€” WebAssembly Python for in-browser compute (unblocks agent code execution)</div>
                                <div style="color:#e6b422;">âš  <strong>Yjs CRDT</strong> â€” real-time collab needed for multi-agent simultaneous editing</div>
                                <div style="color:#f97583;">âŒ <strong>Persistent storage</strong> â€” localStorage only, needs IndexedDB/cloud for agent state persistence</div>
                            </div>
                            <div style="text-align:right;"><span class="tag tag--green" style="font-size:0.5625rem;">3/6 ready</span></div>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div style="background:var(--cursor-bg);border:2px solid var(--cursor-accent);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="font-weight:700;color:var(--cursor-accent);margin-bottom:8px;">Phase 3 Unlock Checklist â€” Agent Orchestration</div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                            <div>
                                <div style="font-weight:700;color:#7ee787;margin-bottom:4px;">âœ… Ready (15/27)</div>
                                <ul style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                    <li>6 browser-side APIs exposed</li>
                                    <li>8 interactive cell types</li>
                                    <li>40+ bridge endpoints</li>
                                    <li>AI training API (RL game)</li>
                                    <li>Cross-tab broadcast</li>
                                    <li>Latency benchmarking</li>
                                    <li>Keyboard pattern analysis</li>
                                    <li>27-unit conversion engine</li>
                                </ul>
                            </div>
                            <div>
                                <div style="font-weight:700;color:#f97583;margin-bottom:4px;">ðŸ”“ Boundary-Breaking Targets</div>
                                <ul style="font-size:0.625rem;color:var(--cursor-text-muted);">
                                    <li><strong style="color:#e6b422;">WebRTC P2P</strong> â€” hexcast â†’ true device-to-device streaming</li>
                                    <li><strong style="color:#e6b422;">Pyodide WASM</strong> â€” execute Python in-browser, no server</li>
                                    <li><strong style="color:#e6b422;">WebGPU compute</strong> â€” tinygrad + kbatch neural in browser</li>
                                    <li><strong style="color:#e6b422;">MCP tool server</strong> â€” expose all APIs as MCP resources</li>
                                    <li><strong style="color:#f97583;">WebCodecs</strong> â€” hardware video encode for hexcast</li>
                                    <li><strong style="color:#f97583;">IndexedDB persistence</strong> â€” agent state across sessions</li>
                                    <li><strong style="color:#f97583;">Yjs CRDT collab</strong> â€” multi-agent live editing</li>
                                    <li><strong style="color:#f97583;">Headless game mode</strong> â€” server-side RL training</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">15/27 capabilities Phase 3 ready</span>
                        <span class="tag tag--yellow">8 partial â€” need integration work</span>
                        <span class="tag tag--red">4 blocked â€” new technology required</span>
                        <span class="tag tag--purple">Top priority: WebRTC + Pyodide + MCP tools</span>
                    </div>
                </div>

                <!-- ====== v3.0 PROJECT RESTRUCTURE ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; v3.0.0 Project Restructure</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        Phase 3.0 â€” numbered <code>src/</code> layout, clean root, Electron 40.4, all references updated.
                    </p>
                    <div style="font-family:var(--cursor-font-mono);font-size:0.625rem;background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);line-height:1.6;white-space:pre;">uvspeed/
â”œâ”€â”€ web/                         <span style="color:#7ee787;"># GitHub Pages â€” notepad, game, kbatch, hexcast</span>
â”œâ”€â”€ icons/                       <span style="color:#7ee787;"># 23 numbered screenshots + favicons + banner</span>
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ 01-core/                 <span style="color:#58a6ff;"># Python backend (bridge server, notepad, prototype)</span>
â”‚   â”œâ”€â”€ 02-electron/             <span style="color:#58a6ff;"># Desktop app (Electron 40.4, quantum menus)</span>
â”‚   â”œâ”€â”€ 03-tools/                <span style="color:#58a6ff;"># Scripts &amp; utilities (16 launchers, prefix tool)</span>
â”‚   â”œâ”€â”€ 04-tests/                <span style="color:#58a6ff;"># All test files (12 test scripts)</span>
â”‚   â”œâ”€â”€ 05-examples/             <span style="color:#58a6ff;"># Example projects (hello-quantum)</span>
â”‚   â”œâ”€â”€ 06-extensions/           <span style="color:#58a6ff;"># Browser extensions (Chrome, Firefox, PWA)</span>
â”‚   â””â”€â”€ 07-archive/              <span style="color:#484f58;"># Historical versions (v1, v2, v3, old configs)</span>
â”œâ”€â”€ package.json                 <span style="color:#e6b422;"># npm â€” Electron 40.4, express 4.21, ws 8.18</span>
â”œâ”€â”€ pyproject.toml               <span style="color:#e6b422;"># PyPI â€” uvspeed-quantum 3.0.0</span>
â”œâ”€â”€ uvspeed_cli.py               <span style="color:#e6b422;"># CLI entry point for pip install</span>
â”œâ”€â”€ CHANGELOG.md / README.md     <span style="color:#484f58;"># Docs</span>
â””â”€â”€ LICENSE                      <span style="color:#484f58;"># MIT</span></div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">Root: 6 items (was 40+)</span>
                        <span class="tag tag--green">src/ numbered 01-07</span>
                        <span class="tag tag--blue">Electron 40.4.0 (Chromium 144)</span>
                        <span class="tag tag--yellow">v3.0.0 across all configs</span>
                    </div>
                </div>

                <!-- ====== PHASE 4 VISION â€” TERMINAL/OS APP ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Phase 4 Vision â€” Terminal/OS App</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        Once Phase 3.1 (Agent Orchestration) completes and the system is self-training, the next milestone is
                        a unified terminal/OS application built from the ground up â€” combining every tool under one hood.
                    </p>
                    <div style="display:grid;grid-template-columns:1fr;gap:6px;margin-bottom:var(--cursor-space-md);">
                        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;padding:8px 12px;background:rgba(88,166,255,0.06);border:1px solid rgba(88,166,255,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#58a6ff;font-weight:700;">ðŸ–¥ Terminal Core</span>
                            <div style="color:var(--cursor-text-muted);">Native terminal emulator with quantum prefix gutter built in â€” every shell command structurally addressed in 3D</div>
                        </div>
                        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;padding:8px 12px;background:rgba(88,166,255,0.06);border:1px solid rgba(88,166,255,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#f0883e;font-weight:700;">ðŸ“¡ Live Streaming</span>
                            <div style="color:var(--cursor-text-muted);">hexcast video &amp; hex stream engine embedded â€” broadcast terminal sessions, screen, camera between devices</div>
                        </div>
                        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;padding:8px 12px;background:rgba(88,166,255,0.06);border:1px solid rgba(88,166,255,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#e6b422;font-weight:700;">âŒ¨ kbatch Analysis</span>
                            <div style="color:var(--cursor-text-muted);">Live keyboard thermal heatmap, contrails, geometric patterns running on every keystroke â€” training the language model in real-time</div>
                        </div>
                        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;padding:8px 12px;background:rgba(88,166,255,0.06);border:1px solid rgba(88,166,255,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#a78bfa;font-weight:700;">ðŸ”¬ FreyaUnits</span>
                            <div style="color:var(--cursor-text-muted);">27-unit precision engine integrated into shell output â€” auto-convert distances, sizes, scales in any context</div>
                        </div>
                        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;padding:8px 12px;background:rgba(88,166,255,0.06);border:1px solid rgba(88,166,255,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#7ee787;font-weight:700;">ðŸŽ¨ Thermal Visuals</span>
                            <div style="color:var(--cursor-text-muted);">Quantum lattice/flow/GPU thermal visualization in sidebar â€” live system state as 3D thermal gradients</div>
                        </div>
                        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;padding:8px 12px;background:rgba(88,166,255,0.06);border:1px solid rgba(88,166,255,0.25);border-radius:var(--cursor-radius-sm);font-size:0.6875rem;">
                            <span style="color:#da3633;font-weight:700;">ðŸ¤– Self-Training</span>
                            <div style="color:var(--cursor-text-muted);">Agent orchestration built in â€” the app trains itself through usage patterns, keyboard analysis, code generation, and game AI feedback loops</div>
                        </div>
                    </div>
                    <div style="background:var(--cursor-bg);border:2px solid rgba(88,166,255,0.4);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);margin-bottom:var(--cursor-space-md);font-size:0.6875rem;">
                        <div style="font-weight:700;color:#58a6ff;margin-bottom:8px;">Tech Stack (Proposed)</div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:0.625rem;color:var(--cursor-text-muted);">
                            <div><strong style="color:#7ee787;">Runtime:</strong> Zig/Rust native + Python embedded</div>
                            <div><strong style="color:#7ee787;">Terminal:</strong> GPU-accelerated (wgpu/Metal/Vulkan)</div>
                            <div><strong style="color:#7ee787;">UI:</strong> Custom renderer (not Electron â€” native perf)</div>
                            <div><strong style="color:#7ee787;">Networking:</strong> WebRTC P2P + WebSocket bridge</div>
                            <div><strong style="color:#7ee787;">AI:</strong> tinygrad + Ollama local + cloud fallback</div>
                            <div><strong style="color:#7ee787;">Data:</strong> SQLite + IndexedDB + cloud sync</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--blue">Phase 4 â€” after self-training is active</span>
                        <span class="tag tag--purple">All Phase 2-3 tools unified</span>
                        <span class="tag tag--yellow">Native performance, no Electron</span>
                    </div>
                </div>

                <!-- ====== UPGRADE ENHANCEMENT PLANS ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Upgrade Enhancement Roadmap</h3>
                    <p style="margin-bottom: var(--cursor-space-md);">
                        Detailed plans for each capability gap identified in the benchmark standings.
                        Each card shows the current state, target state, key technologies, and the SOW phase that delivers it.
                    </p>

                    <div class="plan-grid">

                        <!-- 1. Visualization Paradigm -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">ðŸ“Š</span>
                                <span class="plan-title">Visualization Paradigm</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Mermaid diagrams, 3D prefix topology (text-based)<br>
                                <strong>Target:</strong> GPU-accelerated 3D code-space with fly-through navigation
                                <ul>
                                    <li>ChartGPU / WebGPU for 60fps realtime charting in-browser</li>
                                    <li>Three.js or Babylon.js 3D scene: X/Y/Z code-space rendered as a navigable volume</li>
                                    <li>Prefix heatmaps: color each line by its quantum weight type</li>
                                    <li>Charm Gum progress bars &amp; Glow markdown in terminal mode</li>
                                    <li>Mermaid auto-generation from prefix topology (code &rarr; diagram)</li>
                                    <li>WebXR support: fly through code-space in Quest headset</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 2&ndash;3</span>
                                <span class="tag tag--green">WebGPU + Three.js + Charm</span>
                            </div>
                        </div>

                        <!-- 2. Code Execution + AI Libraries -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">âš¡</span>
                                <span class="plan-title">Code Execution &amp; AI Libraries</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Stub output (simulated)<br>
                                <strong>Target:</strong> Multi-runtime execution with AI-assisted code generation
                                <ul>
                                    <li><code>uv run</code> backend via WebSocket bridge (real Python)</li>
                                    <li>Pyodide (WASM Python) for zero-install in-browser execution</li>
                                    <li>tinygrad tensor ops running client-side via WebGPU</li>
                                    <li>AI library chain: Cursor &rarr; Copilot &rarr; GrepAI &rarr; Crush &rarr; OpenCode</li>
                                    <li>Prefix-aware linting: AI suggests prefix corrections</li>
                                    <li>Auto-prefix on paste: raw code &rarr; quantum-weighted in one pass</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 2</span>
                                <span class="tag tag--green">Pyodide + uv + tinygrad</span>
                            </div>
                        </div>

                        <!-- 3. Quantum Hardware Support -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">ðŸŒŒ</span>
                                <span class="plan-title">Quantum Hardware Support</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Prefix system (structural quantum, no QPU)<br>
                                <strong>Target:</strong> Prefix &rarr; circuit transpilation &rarr; QPU execution
                                <ul>
                                    <li>NVIDIA CUDA-Q integration for quantum kernel offload</li>
                                    <li>Prefix-to-Cirq transpiler: <code>+n:</code> &rarr; conditional gate, <code>+2:</code> &rarr; loop unroll</li>
                                    <li>Qiskit backend adapter for IBM QPU access</li>
                                    <li>Amazon Braket connector via SageMaker</li>
                                    <li>IonQ cloud API for trapped-ion execution</li>
                                    <li>Simulator fallback: Pennylane local when offline</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--yellow">Phase 4</span>
                                <span class="tag tag--purple">CUDA-Q + Cirq + Qiskit</span>
                            </div>
                        </div>

                        <!-- 4. GPU / TPU Compute -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">ðŸ”¥</span>
                                <span class="plan-title">GPU / TPU Compute</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Apple AMX (local), no GPU offload<br>
                                <strong>Target:</strong> Multi-tier compute: browser GPU &rarr; local &rarr; cloud
                                <ul>
                                    <li><strong>Tier 1 â€” Browser:</strong> WebGPU shaders for tinygrad ops, ChartGPU viz</li>
                                    <li><strong>Tier 2 â€” Local:</strong> Apple AMX / Metal, tinygrad native backend</li>
                                    <li><strong>Tier 3 â€” Cloud:</strong> NVIDIA Blackwell (H100/B200) via CUDA-Q</li>
                                    <li><strong>Tier 4 â€” TPU:</strong> Google TPU v5e via JAX/XLA bridge</li>
                                    <li>Compute scheduler: auto-routes by tensor size &amp; latency budget</li>
                                    <li>Prefix-aware kernel fusion: merge adjacent <code>+2:</code> loops into one GPU dispatch</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 3&ndash;4</span>
                                <span class="tag tag--green">WebGPU + Metal + CUDA + TPU</span>
                            </div>
                        </div>

                        <!-- 5. STORAGE â€” the big one -->
                        <div class="plan-card" style="grid-column: 1 / -1;">
                            <div class="plan-card-header">
                                <span class="plan-icon">ðŸ’¾</span>
                                <span class="plan-title">Storage! Storage! Storage! &mdash; Quantum-Native Persistence</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> JSON export, no persistence, tab-lifetime only<br>
                                <strong>Target:</strong> Multi-layer smart storage with AI-driven compaction and evolution
                                <ul>
                                    <li><strong>Layer 0 â€” Instant (browser):</strong> IndexedDB + OPFS (Origin Private File System) for zero-latency local persistence. Every keystroke saved. Survives tab close, browser restart. ~50 MB per origin.</li>
                                    <li><strong>Layer 1 â€” Session (local):</strong> <code>s1db</code>-style key/value store (inspired by <a href="https://github.com/kognise/notes" style="color:var(--cursor-accent);">kognise/notes</a>). Nanoid-keyed notebooks with token-based access. Single JSON file on disk, append-only log for crash safety.</li>
                                    <li><strong>Layer 2 â€” Compaction (smart):</strong> AI-driven compaction engine. When cell count exceeds threshold, tinygrad model scores each cell by (last-access &times; execution-count &times; prefix-weight). Low-score cells compress to delta-only. Hot cells stay fully expanded. Target: 10&times; storage reduction without data loss.</li>
                                    <li><strong>Layer 3 â€” Sync (network):</strong> WebSocket mesh (based on kognise/notes server pattern): client connects with notebook key + auth token, edits broadcast to all peers on same key. CRDTs (Yjs) for conflict-free merge. Works over WiFi, 5G, BLE, or mesh network.</li>
                                    <li><strong>Layer 4 â€” Archive (cold):</strong> Prefix-indexed Git-compatible snapshots. Each save writes a <code>.qnb</code> (quantum notebook) file that <code>git diff</code> understands. Prefix metadata in YAML front-matter. Full version history with dimensional diff (show what moved in X/Y/Z, not just line changes).</li>
                                    <li><strong>Layer 5 â€” Evolving (AI):</strong> tinygrad model running in storage layer predicts which cells you'll need next, pre-loads them from cold storage, auto-tags and auto-prefixes new content, and suggests compaction candidates. Storage literally learns your workflow and evolves its layout to match.</li>
                                </ul>
                                <div style="margin-top: var(--cursor-space-sm);">
                                    <strong>Unique properties:</strong> No other notebook has storage that is simultaneously offline-first (Layer 0),
                                    real-time synced (Layer 3), AI-compacted (Layer 2), dimensionally diffable (Layer 4),
                                    and self-evolving (Layer 5). This is storage as a first-class quantum-aware subsystem, not an afterthought.
                                </div>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 2&ndash;4</span>
                                <span class="tag tag--green">IndexedDB + s1db + Yjs + tinygrad</span>
                                <span class="tag tag--yellow">6-layer architecture</span>
                            </div>
                        </div>

                        <!-- 6. Realtime Collab -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">ðŸ‘¥</span>
                                <span class="plan-title">Realtime Collab (kognise/notes pattern)</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Single-user, no sync<br>
                                <strong>Target:</strong> Multi-user with presence, cursors, and chat
                                <ul>
                                    <li><strong>Base:</strong> <a href="https://github.com/kognise/notes" style="color:var(--cursor-accent);">kognise/notes</a> WebSocket server (~50 lines). Nanoid room keys, token auth, broadcast-to-peers.</li>
                                    <li><strong>CRDT layer:</strong> Yjs document for conflict-free cell editing across peers</li>
                                    <li>Cursor presence: see collaborator positions in 3D quantum space</li>
                                    <li>Cell locking: prefix-aware â€” only one editor per <code>+0:</code> class at a time</li>
                                    <li>Chat sidebar: inline discussion threads anchored to cell coordinates</li>
                                    <li>Connection-agnostic: WebSocket &rarr; WebRTC &rarr; BLE mesh fallback chain</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--blue">Phase 3</span>
                                <span class="tag tag--green">ws + Yjs + nanoid + s1db</span>
                            </div>
                        </div>

                        <!-- 7. Ping / Direct Linking / Chat -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">ðŸ“¡</span>
                                <span class="plan-title">Ping, Chat &amp; Direct Linking</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> No networking<br>
                                <strong>Target:</strong> Universal connectivity with sub-100ms latency
                                <ul>
                                    <li><strong>Ping mesh:</strong> Every connected client pings all peers every 5s. Latency matrix displayed in sidebar. Auto-selects fastest relay path.</li>
                                    <li><strong>Direct link:</strong> Share a URL like <code>qnb.dev/abc123#[2,5,3]</code> â€” opens notebook at exact quantum coordinate. Deep-link into any cell at any position.</li>
                                    <li><strong>Chat protocol:</strong> Messages carry quantum coordinates. "I'm at [2,5,3] and this function is wrong" â€” receiver clicks and lands on the exact spot.</li>
                                    <li><strong>Connection cascade:</strong> WebSocket (primary) &rarr; WebRTC DataChannel (P2P) &rarr; Server-Sent Events (fallback) &rarr; HTTP long-poll (last resort)</li>
                                    <li>Future: Bluetooth LE for local mesh (hackathons, classrooms), NFC tap-to-share notebook key</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--yellow">Phase 3&ndash;4</span>
                                <span class="tag tag--purple">WebSocket + WebRTC + BLE</span>
                            </div>
                        </div>

                        <!-- 8. Universal Web Scraping / Weighting -->
                        <div class="plan-card">
                            <div class="plan-card-header">
                                <span class="plan-icon">ðŸŒ</span>
                                <span class="plan-title">Quantum Web Scraper &amp; Code Weighting</span>
                            </div>
                            <div class="plan-card-body">
                                <strong>Current:</strong> Manual file conversion<br>
                                <strong>Target:</strong> Point at any URL or repo, get a quantum-weighted map instantly
                                <ul>
                                    <li>URL input &rarr; fetch DOM &rarr; assign prefixes to every node &rarr; 3D map</li>
                                    <li>GitHub repo input &rarr; clone &rarr; prefix all files &rarr; navigable code-space</li>
                                    <li>npm/PyPI package &rarr; dependency tree as X-axis in quantum space</li>
                                    <li>GrepAI semantic search across prefixed web scrapes</li>
                                    <li>Weight scoring: complexity &times; dependency-depth &times; error-density = quantum gravity</li>
                                    <li>Prove: the entire web is dimensionally addressable with 9 symbols</li>
                                </ul>
                            </div>
                            <div class="plan-card-footer">
                                <span class="tag tag--yellow">Phase 3&ndash;4</span>
                                <span class="tag tag--green">GrepAI + Puppeteer + prefix engine</span>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- ====== PHASE 3 READINESS CROSS-CHECK ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Phase 3 Readiness Cross-Check</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        Every Phase 3 deliverable verified against actual codebase state. <strong style="color:#7ee787;">All 12 items PASS.</strong>
                    </p>
                    <div style="display:grid;grid-template-columns:1fr;gap:4px;margin-bottom:var(--cursor-space-md);font-size:0.625rem;">
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>Project restructure &mdash; <code>src/01-07/</code> numbered layout, clean root</span><span style="color:#7ee787;text-align:right;">3.0 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>Blackwell Live &mdash; SM heatmap (192 cells), data streams, deploy targets</span><span style="color:#7ee787;text-align:right;">3.1 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>questcast &mdash; Meta Quest + Detectron2/BabyTrack/SAM/DINOv3/Momentum</span><span style="color:#7ee787;text-align:right;">3.2 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>archflow &mdash; n8n-style nodes, connections, Mermaid editor, preset layouts</span><span style="color:#7ee787;text-align:right;">3.2 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>jawta-audio &mdash; Dolby Atmos 7.1.4, binaural HRTF, 8-band EQ, Strudel</span><span style="color:#7ee787;text-align:right;">3.2 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>MCP server &mdash; 10 tools, stdio JSON-RPC, <code>mcp_server.py</code></span><span style="color:#7ee787;text-align:right;">3.3 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>Multi-instance Electron &mdash; WindowRegistry, IPC, QubesOS-style isolation</span><span style="color:#7ee787;text-align:right;">3.3 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>Dynamic Ollama &mdash; <code>/api/tags</code> discovery, runtime model switching</span><span style="color:#7ee787;text-align:right;">3.3 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>tinygrad classifier &mdash; 15-feature vector, (15,13) weight matrix, softmax</span><span style="color:#7ee787;text-align:right;">3.3 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>GitHub community &mdash; CoC, Contributing, Security, issue/PR templates, Dependabot</span><span style="color:#7ee787;text-align:right;">3.3 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>GitHub health dashboard &mdash; traffic, code freq, community, dependencies</span><span style="color:#7ee787;text-align:right;">3.3 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(139,92,246,0.08);border:1px solid rgba(139,92,246,0.3);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#d2a8ff;">âœ…</span><span>Visual Slice / 3D Cube / Quantum Orb &mdash; new sidebar tab with 3 modes</span><span style="color:#d2a8ff;text-align:right;">3.3+ PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>In-cell tools &mdash; 14 client-side utilities (calc, unix, hash, JSON, CSV, map, CDN, file, export&hellip;)</span><span style="color:#7ee787;text-align:right;">3.4 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>Touch events &mdash; swipe tabs, double-tap tools, pinch zoom, cube rotation, mobile targets</span><span style="color:#7ee787;text-align:right;">3.4 PASS</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 80px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span>PWA Offline &mdash; Service Worker, manifest.json, cache-first, install-to-homescreen, network detection</span><span style="color:#7ee787;text-align:right;">3.4 PASS</span>
                        </div>
                    </div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">15/15 deliverables verified</span>
                        <span class="tag tag--green">0 regressions</span>
                        <span class="tag tag--purple">Phase 4.0 shipped &mdash; Tauri + hexterm + multi-stream + funding</span>
                    </div>
                </div>

                <!-- ====== UNLOCK CHECKLIST ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Unlock Checklist &mdash; What&rsquo;s Remaining</h3>
                    <div style="display:grid;grid-template-columns:1fr;gap:4px;margin-bottom:var(--cursor-space-md);font-size:0.625rem;">
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>Prefix system</strong> &mdash; 9 symbols, 20 languages, 68&ndash;98% coverage</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>3D Navigation</strong> &mdash; X/Y/Z + Visual Slice + 3D Cube + Quantum Orb</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>Execution bridge</strong> &mdash; 55+ endpoints, WebSocket, Python exec</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>MCP integration</strong> &mdash; 10 tools, stdio, Cursor/Claude Desktop</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>AI inference</strong> &mdash; tinygrad + Ollama (dynamic) + OpenAI + Anthropic</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>Multi-instance</strong> &mdash; QubesOS Electron, IPC, layout save/restore</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>Security</strong> &mdash; scanner, git hooks, community standards, Dependabot</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>In-cell tools</strong> &mdash; 14 utilities (calc, unix, hash, JSON, CSV, map, CDN, file&hellip;) &mdash; 100% client-side</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>Touch + Mobile</strong> &mdash; swipe nav, pinch zoom, double-tap tools, mobile targets</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:rgba(126,231,135,0.06);border:1px solid rgba(126,231,135,0.25);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#7ee787;">âœ…</span><span style="color:#7ee787;"><strong>PWA Offline</strong> &mdash; Service Worker, manifest, cache-first, install-to-homescreen</span><span style="color:#7ee787;text-align:right;">UNLOCKED</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#f0d852;">â¬œ</span><span><strong>Multi-agent orchestration</strong> &mdash; inter-agent protocol, role-based access</span><span style="color:#f0d852;text-align:right;">Phase 4.1</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#f0d852;">â¬œ</span><span><strong>Self-training loop</strong> &mdash; tinygrad feedback, improved classifier weights</span><span style="color:#f0d852;text-align:right;">Phase 4.1</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#484f58;">â¬œ</span><span><strong>Persistent storage</strong> &mdash; IndexedDB + OPFS + s1db pattern</span><span style="color:#484f58;text-align:right;">Phase 4</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#484f58;">â¬œ</span><span><strong>Real-time collab</strong> &mdash; Yjs CRDT, P2P mesh, quantum coordinate sync</span><span style="color:#484f58;text-align:right;">Phase 4</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#484f58;">â¬œ</span><span><strong>CUDA-Q offload</strong> &mdash; Blackwell Ultra quantum kernel mapping</span><span style="color:#484f58;text-align:right;">Phase 4</span>
                        </div>
                        <div style="display:grid;grid-template-columns:24px 1fr 100px;gap:8px;padding:6px 10px;background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);">
                            <span style="color:#484f58;">â¬œ</span><span><strong>Native terminal app</strong> &mdash; Zig/Rust, GPU-rendered, prefix engine native</span><span style="color:#484f58;text-align:right;">Phase 4</span>
                        </div>
                    </div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">10 / 13 unlocked (77%)</span>
                        <span class="tag tag--yellow">2 in Phase 4.1 pipeline</span>
                        <span class="tag tag--purple">4 Phase 5 targets</span>
                    </div>
                </div>

                <!-- ====== V3 RESTRUCTURE NOTES ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; v3 Restructure Notes</h3>
                    <div style="display:grid;grid-template-columns:80px 1fr;gap:6px;margin-bottom:var(--cursor-space-md);font-size:0.625rem;font-family:var(--cursor-font-mono);">
                        <span style="color:var(--cursor-accent);font-weight:700;">v1.0</span><span style="color:var(--cursor-text-muted);">1 KB &mdash; initial prefix concept, single HTML file</span>
                        <span style="color:var(--cursor-accent);font-weight:700;">v2.0</span><span style="color:var(--cursor-text-muted);">36 KB &mdash; bridge server, security, git hooks, 25 endpoints</span>
                        <span style="color:var(--cursor-accent);font-weight:700;">v3.0</span><span style="color:var(--cursor-text-muted);">2.4 MB &mdash; restructured src/01-07, Electron 40.4, 9 web apps</span>
                        <span style="color:var(--cursor-accent);font-weight:700;">v3.1</span><span style="color:var(--cursor-text-muted);">+Blackwell Live page, NVIDIA data viz, deploy targets</span>
                        <span style="color:var(--cursor-accent);font-weight:700;">v3.2</span><span style="color:var(--cursor-text-muted);">+questcast, archflow, jawta-audio dev pages</span>
                        <span style="color:#d2a8ff;font-weight:700;">v3.3</span><span style="color:#d2a8ff;">+MCP server (10 tools), multi-instance, Ollama, tinygrad, community, dashboard, Visual Slice</span>
                        <span style="color:#f0883e;font-weight:700;">v3.4</span><span style="color:#f0883e;">+14 in-cell tools, touch events, PWA offline mode, manifest.json, Service Worker, PWA&rarr;Terminal roadmap</span>
                        <span style="color:#3fb950;font-weight:700;">v3.5</span><span style="color:#3fb950;">+research-lab.html, data type matrix, tier checkmarks, PWA install prompt, install.sh, Tauri v2 scaffold, xterm.js terminal, Rust prefix, Numsy tamagotchi</span>
                        <span style="color:#d2a8ff;font-weight:700;">v4.0</span><span style="color:#d2a8ff;">+Tauri v2 desktop app (Rust), hexterm terminal emulator, multi-stream (feed/grid/launcher), hexcast CLI, hexbench voltage lab, sponsor page, funding infra, 18 web apps, PWA service worker on all apps, quantum-prefixes.js shared module</span>
                    </div>
                    <div style="background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:12px 14px;margin-bottom:var(--cursor-space-md);font-family:var(--cursor-font-mono);font-size:0.5625rem;line-height:1.7;">
                        <span style="color:var(--cursor-accent);font-weight:700;">Key restructure decisions (v3.0):</span><br>
                        &bull; Moved all Python to <code>src/01-core/</code> (bridge, notepad, prototype, MCP)<br>
                        &bull; Moved Electron to <code>src/02-electron/</code> (main, preload, renderer, menus)<br>
                        &bull; Moved scripts to <code>src/03-tools/</code> (16 launchers, prefix tool)<br>
                        &bull; Consolidated tests in <code>src/04-tests/</code> (12 test files)<br>
                        &bull; Archived v1/v2/v3 in <code>src/07-archive/</code><br>
                        &bull; Root kept clean: README, LICENSE, pyproject.toml, package.json<br>
                        &bull; All web apps under <code>web/</code> (9 HTML files, zero-dependency)<br>
                        &bull; All screenshots under <code>icons/</code> (30 numbered + assets)<br>
                        &bull; GitHub CI under <code>.github/</code> (workflows, templates, Dependabot)
                    </div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">v4.0.0 current &middot; Tauri v2 + 18 web apps</span>
                        <span class="tag tag--blue">200+ files &middot; Rust + Python + HTML/JS</span>
                        <span class="tag tag--purple">Clean root &middot; src-tauri/ &middot; web/ &middot; GitHub CI</span>
                    </div>
                </div>

                <!-- ====== PHASE 4 VISION EXPANDED ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Phase 4 Vision &mdash; Terminal/OS App</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        The end goal: a native, GPU-accelerated terminal application that unifies every Phase 1&ndash;3 tool
                        into a single binary with the prefix engine compiled natively. Not Electron &mdash; native performance.
                    </p>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:8px;margin-bottom:var(--cursor-space-md);">
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#58a6ff;">ðŸ–¥ï¸ Native Renderer</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Zig/Rust + wgpu/Metal/Vulkan. GPU-accelerated text, thermal visuals, 3D cube &mdash; all at native 120fps. No Chromium overhead.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#58a6ff;">âš¡ Compiled Prefix Engine</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Prefix classification in Rust/Zig &mdash; sub-microsecond per line. SIMD-vectorized 9-symbol pattern matching. WASM export for web fallback.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#58a6ff;">ðŸ§  Embedded AI</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">tinygrad compiled to native. Ollama sidecar. On-device inference with no network. Self-training from usage patterns, keyboard data, game AI.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#58a6ff;">ðŸŒ WebXR / Spatial</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Walk through 3D code in Apple Vision Pro / Meta Quest. Prefix nodes as spatial objects. Gesture-based navigation through quantum coordinates.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#58a6ff;">ðŸ”— P2P Collaboration</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Yjs CRDT + WebRTC mesh. Multi-cursor editing with quantum coordinate sync. Presence awareness. Works over WiFi, 5G, BLE mesh.</div>
                        </div>
                        <div style="background:var(--cursor-bg-tertiary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);padding:10px 12px;">
                            <div style="font-size:0.75rem;font-weight:700;color:#58a6ff;">ðŸ”Œ Plugin Ecosystem</div>
                            <div style="font-size:0.5625rem;color:var(--cursor-text-muted);">Community language packs, custom prefix rules, theme market, tool plugins. WASM-sandboxed extensions. npm/crate registry for quantum tools.</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--blue">Phase 4 &mdash; after multi-agent is stable</span>
                        <span class="tag tag--purple">All Phase 1&ndash;3 tools unified natively</span>
                        <span class="tag tag--yellow">Native perf &middot; WebXR &middot; P2P &middot; Plugins</span>
                    </div>
                </div>

                <!-- ====== DATA TYPE MATRIX (CORRECTED) ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Data Type Matrix (Corrected)</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.6875rem;color:var(--cursor-text-muted);">
                        Binary/Bits is the only universal full-speed data type across all tiers. INT8 is the universal compute type. The prefix classifier (4 bits for 9 symbols) maps to both.
                    </p>
                    <table style="width:100%;border-collapse:collapse;font-size:0.5625rem;font-family:var(--cursor-font-mono);margin-bottom:var(--cursor-space-md);">
                        <thead>
                            <tr style="background:var(--cursor-bg-tertiary);">
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-accent);font-weight:700;text-align:left;">Data Type</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#d2a8ff;font-weight:700;text-align:left;">Quantum QPU</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#76b900;font-weight:700;text-align:left;">Server GPU</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#58a6ff;font-weight:700;text-align:left;">Desktop</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#f0883e;font-weight:700;text-align:left;">Mobile</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#8b949e;font-weight:700;text-align:left;">IoT MCU</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#56d4dd;font-weight:700;text-align:left;">Photonic</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background:rgba(63,185,80,.08);">
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;font-weight:700;">Binary/Bits</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;font-weight:700;">NATIVE (measurement)</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                            </tr>
                            <tr>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-accent);font-weight:700;">INT8</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Post-process</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Tensor Core</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">NPU native</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">NPU fastest</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">ESP-DL native</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Digital post</td>
                            </tr>
                            <tr>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-accent);">FP16</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Not used</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Tensor Core</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">NPU accel</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">NPU accel</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Limited</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">R&amp;D</td>
                            </tr>
                            <tr>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-accent);">FP32</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Simulation only</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Limited</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Optical matmul</td>
                            </tr>
                            <tr>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-accent);">FP64</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">State vector sim</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full speed</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Emulated</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">N/A</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">N/A</td>
                            </tr>
                            <tr>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-accent);">BF16</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Not used</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">NVIDIA/AMD</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Apple M4</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Not practical</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">N/A</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">N/A</td>
                            </tr>
                            <tr>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-accent);">UTF-8 bytes</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Classical interface</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Unlimited</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">CPU bound</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Memory limited</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Flash limited</td>
                                <td style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Transport only</td>
                            </tr>
                        </tbody>
                    </table>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">Binary/Bits &mdash; universal full speed</span>
                        <span class="tag tag--blue">INT8 &mdash; universal compute (NPU accelerated)</span>
                        <span class="tag tag--purple">Prefix: 4 bits &rarr; 9 symbols &rarr; maps to both</span>
                    </div>
                </div>

                <!-- ====== TIER CHECKMARK MATRIX ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; Tier Checkmark Matrix</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.6875rem;color:var(--cursor-text-muted);">
                        Capability coverage across all deployment tiers. Each layer is additive &mdash; Layer 0 works alone.
                    </p>
                    <table style="width:100%;border-collapse:collapse;font-size:0.5625rem;font-family:var(--cursor-font-mono);margin-bottom:var(--cursor-space-md);">
                        <thead>
                            <tr style="background:var(--cursor-bg-tertiary);">
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:var(--cursor-accent);text-align:left;">Capability</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#58a6ff;text-align:left;">T0 PWA</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#f0883e;text-align:left;">T1 uv+bridge</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;text-align:left;">T2 Tauri</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#a78bfa;text-align:left;">T3 Mobile</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#8b949e;text-align:left;">T4 IoT</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#d2a8ff;text-align:left;">T5 QPU</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Prefix gutter</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">JS heuristic</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Python</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Rust native</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Rust WASM</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">ANSI</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#d2a8ff;">Quantum basis</td></tr>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Cell tools (14)</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">All</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">All</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">All</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">All</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">All</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">All</td></tr>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Viz (orb/cube)</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Canvas 2D</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Canvas 2D</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">wgpu/WebGL</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Canvas 2D</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Minimal</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">N/A</td></tr>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Terminal</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">No</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">SSH browser</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">PTY native</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">SSH</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">BusyBox</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">SSH QPU cloud</td></tr>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">AI inference</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">No</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Ollama+tinygrad</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Sidecar Ollama</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">NPU (CoreML)</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">INT8 micro</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#d2a8ff;">QPU circuits</td></tr>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Execution</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">No</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Python bridge</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Python sidecar</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">WiFi bridge</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">N/A</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Qiskit cloud</td></tr>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Auto-update</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">SW cache</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">uv self update</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Tauri updater</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">App Store</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">OTA</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">N/A</td></tr>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Offline</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full (SW)</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Full</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-muted);">Cloud-dependent</td></tr>
                            <tr><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:var(--cursor-text-s);">Install</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);color:#3fb950;">Open URL</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">curl | sh</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">brew install</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">App Store</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">Flash / PWA</td><td style="padding:3px 6px;border:1px solid var(--cursor-border);">API key</td></tr>
                        </tbody>
                    </table>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">Layer 0 (PWA) works alone</span>
                        <span class="tag tag--blue">Each tier additive, nothing breaks</span>
                        <span class="tag tag--purple">T0-3: HTML/JS + Rust + Python | T4: WASM + ANSI | T5: Qiskit + cloud QPU</span>
                    </div>
                </div>

                <!-- ====== PWA â†’ TERMINAL TRANSITION ROADMAP ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; PWA &rarr; Terminal App Transition Roadmap</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        The path from browser-based notepad to native terminal application is a three-stage pipeline.
                        Stage 1 (PWA) is shipping now. Stage 2 (Hybrid) runs alongside PWA once the local prefix engine compiles.
                        Stage 3 (Native) replaces Electron entirely with a GPU-accelerated binary.
                    </p>

                    <!-- PWA Stage -->
                    <div style="background:var(--cursor-bg-secondary);border:1px solid #238636;border-left:3px solid #238636;border-radius:var(--cursor-radius-sm);padding:10px 14px;margin-bottom:8px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                            <span style="font-size:0.75rem;font-weight:700;color:#3fb950;">Stage 1 &mdash; PWA (Shipped &middot; Phase 4.0)</span>
                            <span class="tag tag--green" style="font-size:0.5rem;">SHIPPED</span>
                        </div>
                        <div style="font-size:0.5625rem;color:var(--cursor-text-muted);line-height:1.5;">
                            <strong>What:</strong> Service Worker + Web App Manifest enable install-to-homescreen on any device.
                            Full offline operation via cache-first strategy. localStorage persistence for cells and quantum state.<br>
                            <strong>Runs on:</strong> Chrome, Safari, Firefox, Edge &mdash; desktop &amp; mobile. Electron wraps PWA for desktop menu integration.<br>
                            <strong>Bridge dependency:</strong> Cell tools (calc, unix, base, JSON, CSV, hash, color, regex, diff, CDN, map, file import/export) run 100% client-side.
                            Execution, AI inference, and MCP require local bridge (<code>uv run quantum_bridge_server.py</code>).<br>
                            <strong>Touch:</strong> Touch events, swipe sidebar nav, pinch-zoom canvases, double-tap cell tools, mobile-optimized tap targets.
                        </div>
                    </div>

                    <!-- Hybrid Stage -->
                    <div style="background:var(--cursor-bg-secondary);border:1px solid #58a6ff;border-left:3px solid #58a6ff;border-radius:var(--cursor-radius-sm);padding:10px 14px;margin-bottom:8px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                            <span style="font-size:0.75rem;font-weight:700;color:#58a6ff;">Stage 2 &mdash; Hybrid Terminal (Phase 4.1)</span>
                            <span class="tag tag--blue" style="font-size:0.5rem;">PLANNED</span>
                        </div>
                        <div style="font-size:0.5625rem;color:var(--cursor-text-muted);line-height:1.5;">
                            <strong>What:</strong> Nushell/Ghostty terminal embeds a local HTTP server that serves the PWA pages.
                            Bridge server runs as a daemon process. All features work without browser â€” terminal launches web views internally.<br>
                            <strong>Local prefix engine:</strong> Rust-compiled prefix classifier replaces Python bridge for sub-ms classification.
                            WASM build of prefix engine runs in both terminal and browser contexts.<br>
                            <strong>On-device AI:</strong> Ollama sidecar auto-starts with terminal launch. tinygrad compiled to native for CPU/GPU inference.
                            No cloud dependency for any feature.<br>
                            <strong>Why hybrid:</strong> Reuses all 18 web apps (with shared quantum-prefixes.js) and existing CSS/JS investment while gaining terminal-native execution speed.
                            Users can choose terminal or browser &mdash; same data, same tools.
                        </div>
                    </div>

                    <!-- Native Stage -->
                    <div style="background:var(--cursor-bg-secondary);border:1px solid #d2a8ff;border-left:3px solid #d2a8ff;border-radius:var(--cursor-radius-sm);padding:10px 14px;margin-bottom:8px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                            <span style="font-size:0.75rem;font-weight:700;color:#d2a8ff;">Stage 3 &mdash; Native Terminal App (Phase 4.1+)</span>
                            <span class="tag tag--purple" style="font-size:0.5rem;">VISION</span>
                        </div>
                        <div style="font-size:0.5625rem;color:var(--cursor-text-muted);line-height:1.5;">
                            <strong>What:</strong> Single binary (Zig/Rust) with wgpu renderer. No Electron, no browser, no web views.
                            GPU-accelerated text rendering, thermal visuals, 3D cube â€” all at native 120fps.<br>
                            <strong>Prefix engine:</strong> SIMD-vectorized 9-symbol classification. Sub-microsecond per line.
                            Tree-sitter integration for 50+ language grammars. Real-time AST diffing.<br>
                            <strong>Stack:</strong> Zig (renderer) &rarr; Rust (prefix engine, networking) &rarr; tinygrad (native AI) &rarr; wgpu (GPU) &rarr; WebXR (spatial).<br>
                            <strong>Distribution:</strong> Single <code>curl | sh</code> install. Self-updating. Cross-platform (macOS, Linux, Windows, Quest via sideload).
                        </div>
                    </div>

                    <!-- Decision table -->
                    <div style="font-size:0.5625rem;font-weight:700;text-transform:uppercase;color:var(--cursor-text-muted);margin:10px 0 6px;letter-spacing:0.5px;">
                        Feature Availability by Stage
                    </div>
                    <table style="width:100%;border-collapse:collapse;font-size:0.5625rem;margin-bottom:var(--cursor-space-sm);">
                        <thead>
                            <tr style="background:var(--cursor-bg-tertiary);">
                                <th style="text-align:left;padding:4px 8px;border:1px solid var(--cursor-border);">Feature</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#3fb950;">PWA</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#58a6ff;">Hybrid</th>
                                <th style="padding:4px 6px;border:1px solid var(--cursor-border);color:#d2a8ff;">Native</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Cell tools (calc, unix, hash, etc.)</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Offline operation</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Touch &amp; mobile</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">File import (all formats)</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Python execution</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#f0883e;">bridge</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">AI inference (local)</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#f0883e;">bridge</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">MCP tools</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#f0883e;">bridge</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">&#x2714;</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Prefix classification</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#f0883e;">JS heuristic</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#58a6ff;">Rust WASM</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#d2a8ff;">SIMD native</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">GPU rendering</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#8b949e;">Canvas 2D</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#58a6ff;">WebGL</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#d2a8ff;">wgpu 120fps</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Install method</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#3fb950;">Add to Home</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#58a6ff;">uv run / npm</td>
                                <td style="padding:3px 6px;border:1px solid var(--cursor-border-muted);text-align:center;color:#d2a8ff;">curl | sh</td></tr>
                        </tbody>
                    </table>

                    <div style="font-size:0.5625rem;font-weight:700;text-transform:uppercase;color:var(--cursor-text-muted);margin:10px 0 6px;letter-spacing:0.5px;">
                        Why PWA First?
                    </div>
                    <div class="lattice-info" style="margin-bottom:var(--cursor-space-sm);">
                        <strong>Zero friction.</strong> Any device with a browser runs uvspeed immediately &mdash; no install, no build, no dependencies.
                        The PWA layer adds homescreen install, offline cache, and touch optimization while reusing every line of existing HTML/CSS/JS.
                        This lets us validate the full UX (cell tools, visual slice, 3D cube, audio, archflow) before committing to a native rewrite.<br><br>
                        <strong>Terminal bridge is optional.</strong> The 14 in-cell tools (calc, unix, base, JSON, CSV, URL, hash, regex, diff, color, CDN, map, file, export)
                        plus all visualizations, mermaid diagrams, and the full quantum navigation system work with zero server dependencies.
                        Bridge-dependent features (execution, AI, MCP) require <code>uv run src/01-core/quantum_bridge_server.py</code> &mdash;
                        which Ghostty/Nushell/any terminal can launch in one command.<br><br>
                        <strong>PWA validates &rarr; Hybrid extends &rarr; Native replaces.</strong>
                        When the Rust prefix engine compiles, it drops in as a WASM module &mdash; no UI rewrite needed.
                        When the native renderer ships, it consumes the same data format and quantum state. Each stage builds on the previous one.
                    </div>

                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">PWA shipping &middot; 14 offline tools &middot; touch events</span>
                        <span class="tag tag--blue">Hybrid &mdash; Rust WASM prefix + terminal daemon</span>
                        <span class="tag tag--purple">Native &mdash; single binary &middot; wgpu 120fps</span>
                        <span class="tag tag--yellow">Each stage reuses existing code &mdash; no rewrites</span>
                    </div>
                </div>

                <!-- ====== CELL TOOLS REFERENCE ====== -->
                <div class="inspect-section">
                    <h3>uvspeed &mdash; In-Cell Utility Tools Reference</h3>
                    <p style="margin-bottom:var(--cursor-space-sm);font-size:0.75rem;color:var(--cursor-text-muted);">
                        Every cell includes a ðŸ§° tools bar with 14 client-side utilities. Zero bridge dependency &mdash; works offline, on mobile, in PWA.
                    </p>
                    <table style="width:100%;border-collapse:collapse;font-size:0.5625rem;margin-bottom:var(--cursor-space-sm);">
                        <thead>
                            <tr style="background:var(--cursor-bg-tertiary);">
                                <th style="text-align:left;padding:4px 8px;border:1px solid var(--cursor-border);">Tool</th>
                                <th style="text-align:left;padding:4px 8px;border:1px solid var(--cursor-border);">Function</th>
                                <th style="text-align:left;padding:4px 8px;border:1px solid var(--cursor-border);">Input</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸ§® Calc</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Evaluate math expressions (supports Math.*)</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">One expression per line</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">â± Unix</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Unix timestamp &harr; ISO date bidirectional</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Timestamp or date string</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸ”¢ Base</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Dec/Hex/Bin/Oct + ASCII character</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Number (0x, 0b, 0o prefix)</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">{ } JSON</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Validate + pretty-print JSON in-place</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Raw JSON text</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸ“‹ CSV</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Parse CSV/TSV to visual table</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Comma or tab separated</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸ”— URL</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">URL encode/decode</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">URL or encoded string</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸ” Hash</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">SHA-256 hash via Web Crypto API</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Any text</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">/./ Regex</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Test regex with match highlighting</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Line 1: pattern, rest: test text</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">&plusmn; Diff</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Line-by-line diff of two blocks</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Blocks separated by --- or ===</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸŽ¨ Color</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Hex/RGB/HSL converter + swatch</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">#hex or r,g,b values</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸŒ CDN</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">CDN URL lookup for 12 popular libraries</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Library name (e.g. mermaid, d3)</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸ—º Map</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">OpenStreetMap embed from coordinates</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">lat, lng (e.g. 37.77, -122.41)</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸ“ File</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Import 30+ file formats into cell</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">File picker (JSON, CSV, MD, PY, IMG&hellip;)</td></tr>
                            <tr><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">ðŸ’¾ Export</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Download cell as file</td><td style="padding:3px 8px;border:1px solid var(--cursor-border-muted);">Auto-detects .md/.mmd/.html/.txt</td></tr>
                        </tbody>
                    </table>
                    <div style="display:flex;gap:var(--cursor-space-sm);flex-wrap:wrap;">
                        <span class="tag tag--green">14 tools &middot; 100% client-side &middot; zero dependencies</span>
                        <span class="tag tag--blue">Works offline &middot; touch-friendly &middot; PWA-ready</span>
                        <span class="tag tag--purple">30+ file formats &middot; selection-aware &middot; in-cell output</span>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid with dark theme
        if (window.mermaid) {
            mermaid.initialize({
                startOnLoad: false,
                theme: 'dark',
                themeVariables: {
                    darkMode: true,
                    background: '#0d1117',
                    primaryColor: '#161b22',
                    primaryTextColor: '#c9d1d9',
                    primaryBorderColor: '#30363d',
                    lineColor: '#58a6ff',
                    secondaryColor: '#1c2128',
                    tertiaryColor: '#2d333b',
                    fontFamily: 'ui-monospace, SFMono-Regular, SF Mono, Menlo, monospace',
                    fontSize: '13px'
                }
            });
        }

        // Quantum Notepad Web Interface - Infinite scroll, no page limits
        class QuantumNotebookWeb {
            constructor() {
                this.cells = [];
                this.quantumPosition = [0, 0, 0];
                this.executionCount = 0;
                this.currentCellId = null;
                this.performanceMode = true;
                this.autoSave = true;
                this._lastExecMs = 0;

                // Execution bridge
                this.ws = null;
                this.wsConnected = false;
                this.bridgeUrl = 'ws://localhost:8086';
                this.apiUrl = 'http://localhost:8085';
                this._pendingCallbacks = {};
                this._gutterTimers = {};
                this._streamHistory = [];
                this._undoStack = [];
                this._redoStack = [];
                this._undoDebounce = null;

                this.init();
            }

            /* ---------- Bootstrap ---------- */
            init() {
                this.setupEventListeners();
                // Try loading from localStorage before creating default cells
                if (!this._loadFromLocalStorage()) {
                    this.createInitialCells();
                }
                this.connectBridge();
                this.updateUI();
                this.startPerformanceMonitoring();
            }

            /* ---------- WebSocket Bridge ---------- */
            connectBridge() {
                try {
                    this.ws = new WebSocket(this.bridgeUrl);
                    this.ws.onopen = () => {
                        this.wsConnected = true;
                        console.log('ðŸŒŒ Connected to Quantum Bridge');
                        this._updateBridgeStatus('connected');
                    };
                    this.ws.onmessage = (event) => {
                        try {
                            const msg = JSON.parse(event.data);
                            this._handleBridgeMessage(msg);
                        } catch (e) { console.warn('Bridge message parse error', e); }
                    };
                    this.ws.onclose = () => {
                        this.wsConnected = false;
                        this._updateBridgeStatus('disconnected');
                        // Reconnect after 5s
                        setTimeout(() => this.connectBridge(), 5000);
                    };
                    this.ws.onerror = () => {
                        this.wsConnected = false;
                        this._updateBridgeStatus('offline');
                    };
                } catch (e) {
                    this.wsConnected = false;
                    this._updateBridgeStatus('offline');
                }
            }

            _updateBridgeStatus(status) {
                const el = document.getElementById('bridge-status');
                if (el) {
                    const icons = { connected: 'ðŸŸ¢', disconnected: 'ðŸŸ¡', offline: 'ðŸ”´' };
                    el.textContent = `${icons[status] || 'âšª'} Bridge: ${status}`;
                }
            }

            _handleBridgeMessage(msg) {
                if (msg.type === 'execution-result' && msg.cell_id) {
                    const cb = this._pendingCallbacks[msg.cell_id];
                    if (cb) { cb(msg); delete this._pendingCallbacks[msg.cell_id]; }
                } else if (msg.type === 'position-changed') {
                    this.quantumPosition = msg.position;
                    this.updateQuantumPosition('bridge sync');
                } else if (msg.type === 'ai-result') {
                    const cb = this._pendingCallbacks['__ai__'];
                    if (cb) { cb(msg); delete this._pendingCallbacks['__ai__']; }
                }
            }

            /* ---------- LocalStorage Persistence ---------- */
            _saveToLocalStorage() {
                try {
                    // Include per-cell quantum prefix metadata in persistent storage
                    const cellsWithMeta = this.cells.map(cell => {
                        const meta = this.prefixMetadata(cell);
                        return { ...cell, quantumPrefix: { coverage: meta.coverage, prefixCounts: meta.prefixCounts, language: meta.language } };
                    });
                    const data = {
                        cells: cellsWithMeta,
                        quantumPosition: this.quantumPosition,
                        executionCount: this.executionCount,
                        savedAt: new Date().toISOString(),
                    };
                    const payload = JSON.stringify(data);
                    // Guard: warn if approaching 5MB localStorage limit
                    const sizeKB = Math.round(payload.length / 1024);
                    if (sizeKB > 4500) {
                        this._logStream('warn', `Save skipped â€” notebook too large (${sizeKB} KB). Export & trim cells.`, 'error');
                        return;
                    }
                    if (sizeKB > 3000) {
                        this._logStream('warn', `Notebook save is ${sizeKB} KB â€” approaching storage limit.`, 'warn');
                    }
                    localStorage.setItem('uvspeed-quantum-notepad', payload);
                } catch (e) {
                    if (e.name === 'QuotaExceededError') {
                        this._logStream('warn', 'localStorage full â€” cannot save. Export notebook & delete cells.', 'error');
                    }
                }
            }

            _loadFromLocalStorage() {
                try {
                    const raw = localStorage.getItem('uvspeed-quantum-notepad');
                    if (!raw) return false;
                    const data = JSON.parse(raw);
                    // Only restore if cells exist AND have actual content
                    if (data.cells && data.cells.length > 0) {
                        // Check if cells have meaningful content (not all empty)
                        const hasContent = data.cells.some(c => c.content && c.content.trim().length > 10);
                        if (!hasContent) return false; // stale/empty â€” load defaults instead
                        this.cells = data.cells;
                        this.quantumPosition = data.quantumPosition || [0, 0, 0];
                        this.executionCount = data.executionCount || 0;
                        this.renderAllCells();
                        return true;
                    }
                } catch (e) { /* corrupt data */ }
                return false;
            }

            /* ---------- JSON Import ---------- */
            loadNotebook() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        try {
                            const nb = JSON.parse(ev.target.result);
                            if (nb.cells) {
                                this.cells = nb.cells;
                                this.quantumPosition = nb.quantumPosition || [0, 0, 0];
                                this.executionCount = nb.executionCount || 0;
                                this.renderAllCells();
                                this.updateUI();
                                this._saveToLocalStorage();
                            }
                        } catch (err) {
                            alert('Invalid notebook JSON: ' + err.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            renderAllCells() {
                const container = document.getElementById('cells-container');
                container.innerHTML = '';
                this.cells.forEach(cell => {
                    this.renderCell(cell);
                });
                if (this.cells.length > 0) this.currentCellId = this.cells[0].id;
            }

            /* ---------- Events ---------- */
            setupEventListeners() {
                document.getElementById('add-cell-btn').addEventListener('click', () => {
                    const id = this.addCell('code');
                    requestAnimationFrame(() => {
                        const el = document.querySelector(`#${id} .cell-textarea`);
                        if (el) { el.focus(); el.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
                    });
                });

                document.getElementById('add-mermaid-btn').addEventListener('click', () => {
                    const id = this.addCell('mermaid', 'graph TD\n    A[Start] --> B{Decision}\n    B -->|Yes| C[Result A]\n    B -->|No| D[Result B]');
                    requestAnimationFrame(() => {
                        const el = document.querySelector(`#${id} .cell-textarea`);
                        if (el) { el.focus(); el.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
                    });
                });

                document.getElementById('run-all-btn').addEventListener('click', () => {
                    this.runAllCells();
                });

                // Cell nav bar buttons
                document.getElementById('cnav-first')?.addEventListener('click', () => this.jumpToCell(1));
                document.getElementById('cnav-up')?.addEventListener('click', () => this.navigateCell(-1));
                document.getElementById('cnav-down')?.addEventListener('click', () => this.navigateCell(1));
                document.getElementById('cnav-last')?.addEventListener('click', () => this.jumpToCell(this.cells.length));
                document.getElementById('cnav-jump')?.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') { this.jumpToCell(parseInt(e.target.value) || 1); e.target.value = ''; }
                });
                document.getElementById('cnav-jump')?.addEventListener('change', (e) => {
                    this.jumpToCell(parseInt(e.target.value) || 1); e.target.value = '';
                });

                document.getElementById('undo-btn').addEventListener('click', () => this.undo());
                document.getElementById('redo-btn').addEventListener('click', () => this.redo());

                document.getElementById('save-btn').addEventListener('click', () => {
                    this.saveNotebook();
                });

                document.getElementById('load-btn').addEventListener('click', () => {
                    this.loadNotebook();
                });

                // Quantum navigation â€” pass the clicked button explicitly
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.navigateQuantumSpace(btn.dataset.direction, e.currentTarget);
                    });
                });

                // ===== NAV CUBE 3D ROTATION =====
                try {
                this._navCubeRx = -20;
                this._navCubeRy = 30;
                const navCubeInner = document.getElementById('nav-cube-inner');
                const navCubeScene = document.getElementById('nav-cube-scene');
                console.log('ðŸŽ² Nav cube init:', !!navCubeInner, !!navCubeScene);

                const updateNavCube = () => {
                    if (!navCubeInner) return;
                    navCubeInner.style.transform = `rotateX(${this._navCubeRx}deg) rotateY(${this._navCubeRy}deg)`;
                    // Detect if a face is flat toward the viewer â€” enlarge numbers for readability
                    const rx = ((this._navCubeRx % 360) + 360) % 360;
                    const ry = ((this._navCubeRy % 360) + 360) % 360;
                    const snapThreshold = 12;
                    const nearSnap = (v) => [0, 90, 180, 270, 360].some(s => Math.abs(v - s) < snapThreshold);
                    const isFlat = nearSnap(rx) && nearSnap(ry);
                    navCubeInner.classList.toggle('ncf-flat', isFlat);
                };

                // Arrow buttons â€” rotate 45 degrees per click
                document.getElementById('nca-up')?.addEventListener('click', () => { this._navCubeRx -= 45; updateNavCube(); });
                document.getElementById('nca-down')?.addEventListener('click', () => { this._navCubeRx += 45; updateNavCube(); });
                document.getElementById('nca-left')?.addEventListener('click', () => { this._navCubeRy -= 45; updateNavCube(); });
                document.getElementById('nca-right')?.addEventListener('click', () => { this._navCubeRy += 45; updateNavCube(); });

                // Drag-to-rotate (mouse)
                if (navCubeScene) {
                    let ncDrag = null;
                    navCubeScene.addEventListener('pointerdown', (e) => {
                        if (e.target.dataset && e.target.dataset.nav) return; // let nav clicks through
                        ncDrag = { x: e.clientX, y: e.clientY, rx: this._navCubeRx, ry: this._navCubeRy };
                        navCubeScene.setPointerCapture(e.pointerId);
                    });
                    navCubeScene.addEventListener('pointermove', (e) => {
                        if (!ncDrag) return;
                        this._navCubeRy = ncDrag.ry + (e.clientX - ncDrag.x) * 0.7;
                        this._navCubeRx = ncDrag.rx + (e.clientY - ncDrag.y) * 0.7;
                        if (navCubeInner) {
                            navCubeInner.style.transition = 'none';
                            updateNavCube();
                        }
                    });
                    navCubeScene.addEventListener('pointerup', () => {
                        ncDrag = null;
                        if (navCubeInner) navCubeInner.style.transition = 'transform 0.25s ease';
                    });
                }

                // Double-click cube â†’ snap to nearest face (flat view with big numbers)
                if (navCubeScene) {
                    navCubeScene.addEventListener('dblclick', (e) => {
                        if (e.target.dataset && e.target.dataset.nav) return;
                        const snap = (v) => Math.round(v / 90) * 90;
                        this._navCubeRx = snap(this._navCubeRx);
                        this._navCubeRy = snap(this._navCubeRy);
                        if (navCubeInner) navCubeInner.style.transition = 'transform 0.35s ease';
                        updateNavCube();
                    });
                }

                // Click on cube face cells â†’ trigger nav
                document.querySelectorAll('.nav-cube-face span[data-nav]').forEach(cell => {
                    cell.addEventListener('click', () => {
                        const dir = cell.dataset.nav;
                        // Find the matching hidden nav-btn and trigger its action
                        const navBtn = document.querySelector(`.nav-btn[data-direction="${dir}"]`);
                        if (navBtn) navBtn.click();
                        // Highlight active cell on cube
                        document.querySelectorAll('.nav-cube-face span.ncf-active').forEach(s => s.classList.remove('ncf-active'));
                        cell.classList.add('ncf-active');
                    });
                });

                // ===== NAV CUBE: 2D / 3D TAB SWITCHING =====
                {
                    const ncv2dView = document.getElementById('ncv-2d-view');
                    const ncv3dView = document.getElementById('ncv-3d-view');
                    const ncv3dCtrl = document.getElementById('ncv-3d-controls');
                    console.log('ðŸŽ² Nav cube tabs init:', !!ncv2dView, !!ncv3dView, !!ncv3dCtrl);

                    document.querySelectorAll('.ncv-tab').forEach(tab => {
                        tab.addEventListener('click', () => {
                            document.querySelectorAll('.ncv-tab').forEach(t => t.classList.remove('active'));
                            tab.classList.add('active');
                            const mode = tab.dataset.ncv;
                            if (mode === '2d') {
                                ncv2dView.classList.remove('ncv-hidden');
                                ncv3dView.classList.add('ncv-hidden');
                                ncv3dCtrl.style.display = 'none';
                            } else {
                                ncv3dView.classList.remove('ncv-hidden');
                                ncv2dView.classList.add('ncv-hidden');
                                ncv3dCtrl.style.display = '';
                            }
                        });
                    });

                    // Wire up 2D grid nav buttons (same action as the hidden legacy grid)
                    document.querySelectorAll('#ncv-2d-grid .nav-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            this.navigateQuantumSpace(btn.dataset.direction, btn);
                            // Sync active state across both grids
                            document.querySelectorAll('#ncv-2d-grid .nav-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                        });
                    });

                    // Layer nav + position display are shared (outside both views)
                }
                } catch(navCubeErr) { console.warn('Nav cube init error:', navCubeErr); }

                // Layer up/down â€” versions the nav grid like Electron app
                document.getElementById('layer-up').addEventListener('click', () => {
                    this.quantumPosition[2] += 1;
                    this.updateQuantumPosition('layer â–² +Z');
                    // Visual pulse on layer change
                    const lv = document.getElementById('layer-value');
                    lv.style.transform = 'scale(1.4)';
                    lv.style.color = 'var(--cursor-accent)';
                    setTimeout(() => { lv.style.transform = ''; lv.style.color = ''; }, 300);
                    // Broadcast to bridge
                    if (this.wsConnected && this.ws) {
                        this.ws.send(JSON.stringify({ type: 'navigate', dx: 0, dy: 0, dz: 1 }));
                    }
                });
                document.getElementById('layer-down').addEventListener('click', () => {
                    this.quantumPosition[2] -= 1;
                    this.updateQuantumPosition('layer â–¼ -Z');
                    const lv = document.getElementById('layer-value');
                    lv.style.transform = 'scale(1.4)';
                    lv.style.color = '#f97583';
                    setTimeout(() => { lv.style.transform = ''; lv.style.color = ''; }, 300);
                    if (this.wsConnected && this.ws) {
                        this.ws.send(JSON.stringify({ type: 'navigate', dx: 0, dy: 0, dz: -1 }));
                    }
                });

                document.getElementById('performance-mode').addEventListener('change', (e) => {
                    this.performanceMode = e.target.checked;
                    this.updatePerformanceMode();
                });

                document.getElementById('auto-save').addEventListener('change', (e) => {
                    this.autoSave = e.target.checked;
                });

                document.getElementById('cells-container').addEventListener('scroll', () => {
                    this.handleInfiniteScroll();
                });

                // --- Footer terminal ---
                const aiInput = document.getElementById('ai-input');
                const cmdInput = document.getElementById('cmd-input');

                aiInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') { e.preventDefault(); this.handleAiInput(aiInput.value); aiInput.value = ''; }
                });
                document.getElementById('ai-send-btn').addEventListener('click', () => {
                    this.handleAiInput(aiInput.value); aiInput.value = '';
                });

                cmdInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') { e.preventDefault(); this.handleCommand(cmdInput.value); cmdInput.value = ''; }
                });
                document.getElementById('cmd-exec-btn').addEventListener('click', () => {
                    this.handleCommand(cmdInput.value); cmdInput.value = '';
                });

                document.querySelectorAll('.quick-cmd').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.handleCommand(btn.dataset.cmd);
                    });
                });

                // Footer tab switching (hexbench-style)
                document.querySelectorAll('#fqc-tabbar .fqc-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('#fqc-tabbar .fqc-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.footer-quick-cmds .fqc-panel').forEach(p => p.classList.remove('active'));
                        tab.classList.add('active');
                        const panel = document.querySelector(`.fqc-panel[data-fqc-panel="${tab.dataset.fqc}"]`);
                        if (panel) panel.classList.add('active');
                    });
                });

                // Top bar tab switching (mirrors footer)
                document.querySelectorAll('#tqc-tabbar .fqc-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('#tqc-tabbar .fqc-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('#top-quick-cmds .fqc-panel').forEach(p => p.classList.remove('active'));
                        tab.classList.add('active');
                        const panel = document.querySelector(`.fqc-panel[data-tqc-panel="${tab.dataset.tqc}"]`);
                        if (panel) panel.classList.add('active');
                    });
                });

                // Top bar action buttons
                document.getElementById('t-add-cell').addEventListener('click', () => this.addCell('code'));
                document.getElementById('t-add-mermaid').addEventListener('click', () => this.addCell('mermaid'));
                document.getElementById('t-run-all').addEventListener('click', () => this.runAllCells());
                document.getElementById('t-undo').addEventListener('click', () => this.undo());
                document.getElementById('t-redo').addEventListener('click', () => this.redo());
                document.getElementById('t-save').addEventListener('click', () => this.saveNotebook());

                document.getElementById('t-benchmark').addEventListener('click', () => {
                    const id = this.addCell('visualization', `# âš¡ UV-Speed System Benchmark & CDN Signal Trace\n# Run this cell to benchmark your machine in real-time`);
                    this.executeCell(id);
                    requestAnimationFrame(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); });
                });
                document.getElementById('t-security-scan').addEventListener('click', () => this._runSecurityScan());
                document.getElementById('t-git-hook').addEventListener('click', () => this._installGitHook());
                document.getElementById('t-quest')?.addEventListener('click', () => this._checkQuestStatus());

                document.getElementById('t-freya-units').addEventListener('click', () => {
                    const id = this.addCell('freya', '# ðŸ”¬ FreyaUnits â€” Precision Converter\n# Planck Length to Parsec â€” 27 units');
                    this.executeCell(id);
                    requestAnimationFrame(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); });
                });
                document.getElementById('t-play-numsy').addEventListener('click', () => openOverlay('brothernumsy.html', 'brotherNumsy & Freya'));
                document.getElementById('t-open-kbatch').addEventListener('click', () => openOverlay('kbatch.html', 'kbatch â€” Keyboard Analyzer'));
                document.getElementById('t-open-hexcast').addEventListener('click', () => openOverlay('hexcast.html', 'hexcast â€” Live Video Broadcast'));
                document.getElementById('t-add-quantum').addEventListener('click', () => {
                    const id = this.addCell('quantum', '# ðŸŒŒ Quantum Visual â€” Slice / Cube / Orb\n# Navigate code space in 3D. Click grid cells, scroll for Z-layer, drag to rotate cube.');
                    this.executeCell(id);
                    setTimeout(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                });
                document.getElementById('t-add-kbatch').addEventListener('click', () => {
                    const id = this.addCell('kbatch', '# âŒ¨ kbatch â€” Keyboard Pattern Analyzer\n# Thermal heatmap, contrails, geometric patterns');
                    this.executeCell(id);
                    setTimeout(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                });
                document.getElementById('t-add-hexcast').addEventListener('click', () => {
                    const id = this.addCell('hexcast', '# ðŸ“¡ hexcast â€” Live Video Hex Broadcast\n# Camera/screen/test â†’ hex stream + latency bench');
                    this.executeCell(id);
                    setTimeout(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                });
                document.getElementById('t-add-hexbench')?.addEventListener('click', () => {
                    const id = this.addCell('hexbench', '# âš¡ hexbench â€” Voltage Lab + Electronics Workbench\n# PSU monitor, Freya Dev Toolkit (13 tools), parts catalog, Arduino/Pybricks code');
                    this.executeCell(id);
                    setTimeout(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                });

                // Top tools dropdown
                const topToolsBtn = document.getElementById('t-tools');
                const topToolsDropdown = document.getElementById('top-tools-dropdown');
                if (topToolsBtn && topToolsDropdown) {
                    topToolsBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        topToolsDropdown.classList.toggle('show');
                    });
                    document.addEventListener('click', () => topToolsDropdown.classList.remove('show'));
                    topToolsDropdown.addEventListener('click', (e) => e.stopPropagation());
                    topToolsDropdown.querySelectorAll('.tools-dropdown-item').forEach(item => {
                        item.addEventListener('click', () => {
                            topToolsDropdown.classList.remove('show');
                            this._runTool(item.dataset.tool);
                        });
                    });
                }

                // Footer action buttons (mirrors header)
                document.getElementById('f-add-cell').addEventListener('click', () => this.addCell('code'));
                document.getElementById('f-add-mermaid').addEventListener('click', () => this.addCell('mermaid'));
                document.getElementById('f-run-all').addEventListener('click', () => this.runAllCells());
                document.getElementById('f-undo').addEventListener('click', () => this.undo());
                document.getElementById('f-redo').addEventListener('click', () => this.redo());
                document.getElementById('f-save').addEventListener('click', () => this.saveNotebook());

                document.getElementById('f-benchmark').addEventListener('click', () => {
                    const id = this.addCell('visualization', `# âš¡ UV-Speed System Benchmark & CDN Signal Trace\n# Run this cell to benchmark your machine in real-time`);
                    this.executeCell(id);
                    // Scroll to it
                    requestAnimationFrame(() => {
                        const el = document.getElementById(id);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                });

                // Security scan button
                document.getElementById('f-security-scan').addEventListener('click', () => {
                    this._runSecurityScan();
                });

                // Git hook install button
                document.getElementById('f-git-hook').addEventListener('click', () => {
                    this._installGitHook();
                });

                // FreyaUnits converter cell button
                document.getElementById('f-freya-units').addEventListener('click', () => {
                    const id = this.addCell('freya', '# ðŸ”¬ FreyaUnits â€” Precision Converter\n# Planck Length to Parsec â€” 27 units');
                    this.executeCell(id);
                    requestAnimationFrame(() => {
                        const el = document.getElementById(id);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                });

                // brotherNumsy game button â€” overlay
                document.getElementById('f-play-numsy').addEventListener('click', () => {
                    openOverlay('brothernumsy.html', 'brotherNumsy & Freya');
                });

                // kbatch keyboard analyzer â€” opens in new tab
                document.getElementById('f-open-kbatch').addEventListener('click', () => {
                    openOverlay('kbatch.html', 'kbatch â€” Keyboard Analyzer');
                });

                // hexcast live video broadcast â€” opens in new tab
                document.getElementById('f-open-hexcast').addEventListener('click', () => {
                    openOverlay('hexcast.html', 'hexcast â€” Live Video Broadcast');
                });

                // quantum cell â€” add inline visual slice/cube/orb
                document.getElementById('f-add-quantum').addEventListener('click', () => {
                    const id = this.addCell('quantum', '# ðŸŒŒ Quantum Visual â€” Slice / Cube / Orb\n# Navigate code space in 3D. Click grid cells, scroll for Z-layer, drag to rotate cube.');
                    this.executeCell(id);
                    setTimeout(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                });

                // kbatch cell â€” add inline keyboard analyzer
                document.getElementById('f-add-kbatch').addEventListener('click', () => {
                    const id = this.addCell('kbatch', '# âŒ¨ kbatch â€” Keyboard Pattern Analyzer\n# Thermal heatmap, contrails, geometric patterns');
                    this.executeCell(id);
                    setTimeout(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                });

                // hexcast cell â€” add inline video broadcast
                document.getElementById('f-add-hexcast').addEventListener('click', () => {
                    const id = this.addCell('hexcast', '# ðŸ“¡ hexcast â€” Live Video Hex Broadcast\n# Camera/screen/test â†’ hex stream + latency bench');
                    this.executeCell(id);
                    setTimeout(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                });

                // hexbench cell â€” add inline electronics workbench
                document.getElementById('f-add-hexbench')?.addEventListener('click', () => {
                    const id = this.addCell('hexbench', '# âš¡ hexbench â€” Voltage Lab + Electronics Workbench\n# PSU monitor, Freya Dev Toolkit (13 tools), parts catalog, Arduino/Pybricks code');
                    this.executeCell(id);
                    setTimeout(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100);
                });

                // Stream pipe in/out buttons
                document.getElementById('stream-pipe-in').addEventListener('click', () => {
                    const src = document.getElementById('stream-source');
                    const btn = document.getElementById('stream-pipe-in');
                    if (src.style.display === 'none') {
                        src.style.display = 'block';
                        btn.classList.add('active');
                        document.getElementById('stream-source-input').focus();
                    } else {
                        src.style.display = 'none';
                        btn.classList.remove('active');
                    }
                });

                document.getElementById('stream-pipe-out').addEventListener('click', () => {
                    const text = this._pipeStreamOut();
                    const btn = document.getElementById('stream-pipe-out');
                    btn.textContent = 'âœ“ copied';
                    btn.classList.add('active');
                    setTimeout(() => { btn.textContent = 'â‡¤ out'; btn.classList.remove('active'); }, 1500);
                });

                document.getElementById('stream-source-trace').addEventListener('click', () => {
                    const input = document.getElementById('stream-source-input');
                    this._pipeStreamIn(input.value);
                    input.value = '';
                    document.getElementById('stream-source').style.display = 'none';
                    document.getElementById('stream-pipe-in').classList.remove('active');
                });

                // ===== SIDEBAR TAB SWITCHING =====
                // Main row (Nav / Visual / Thermal)
                document.querySelectorAll('.sidebar-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Deactivate ext row
                        document.querySelectorAll('.sidebar-tab-ext').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.sidebar-tab-ext-panel').forEach(p => p.classList.remove('active'));
                        // Activate main row
                        document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.sidebar-tab-panel').forEach(p => p.classList.remove('active'));
                        tab.classList.add('active');
                        const panel = document.getElementById(tab.dataset.tab);
                        if (panel) panel.classList.add('active');
                        if (tab.dataset.tab === 'thermal-tab') {
                            this._initThermalViz();
                        } else {
                            this._stopThermalViz();
                        }
                        if (tab.dataset.tab === 'visual-tab') {
                            this._initVisualViz();
                        } else {
                            this._stopVisualViz();
                        }
                    });
                });

                // Extended row (AI/LLM / Language / Blocks)
                document.querySelectorAll('.sidebar-tab-ext').forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Deactivate main row
                        document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.sidebar-tab-panel').forEach(p => p.classList.remove('active'));
                        this._stopThermalViz();
                        this._stopVisualViz();
                        // Activate ext row
                        document.querySelectorAll('.sidebar-tab-ext').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.sidebar-tab-ext-panel').forEach(p => p.classList.remove('active'));
                        tab.classList.add('active');
                        const panel = document.getElementById(tab.dataset.extTab);
                        if (panel) panel.classList.add('active');
                    });
                });

                // ===== AI/LLM PANEL =====
                this._llmModel = 'local';
                document.querySelectorAll('.llm-model-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('.llm-model-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        this._llmModel = card.dataset.llm;
                        document.getElementById('llm-status').textContent = `Model: ${this._llmModel} Â· idle`;
                    });
                });
                document.getElementById('llm-send-btn')?.addEventListener('click', () => {
                    const input = document.getElementById('llm-prompt-input');
                    if (!input || !input.value.trim()) return;
                    const prompt = input.value.trim();
                    input.value = '';
                    // Create an AI cell with the prompt
                    const id = this.addCell('code', `# ðŸ¤– AI Prompt (${this._llmModel})\n# ${prompt}\n`);
                    document.getElementById('llm-status').textContent = `Model: ${this._llmModel} Â· sent â†’ cell`;
                    requestAnimationFrame(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); });
                });
                document.getElementById('llm-prompt-input')?.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') { e.preventDefault(); document.getElementById('llm-send-btn')?.click(); }
                });

                // ===== LANGUAGE PANEL =====
                const LANG_DATA = {
                    python:     { name: 'Python',     coverage: 98, rules: 47, map: '+1: class/def Â· +0: assign Â· n: import Â· -n: return Â· 0: pass/comment Â· -0: del Â· +n: raise Â· -1: except Â· +2: yield' },
                    javascript: { name: 'JavaScript', coverage: 96, rules: 42, map: '+1: class/function Â· +0: const/let Â· n: import Â· -n: return Â· 0: comment Â· -0: delete Â· +n: throw Â· -1: catch Â· +2: yield' },
                    typescript: { name: 'TypeScript', coverage: 96, rules: 44, map: '+1: class/interface Â· +0: const/let Â· n: import Â· -n: return Â· 0: comment Â· -0: delete Â· +n: throw Â· -1: catch Â· +2: yield' },
                    rust:       { name: 'Rust',       coverage: 94, rules: 38, map: '+1: struct/impl/fn Â· +0: let Â· n: use Â· -n: return Â· 0: comment Â· -0: drop Â· +n: panic Â· -1: match/err Â· +2: yield' },
                    go:         { name: 'Go',         coverage: 92, rules: 35, map: '+1: func/type Â· +0: var/:= Â· n: import Â· -n: return Â· 0: comment Â· -0: _ Â· +n: panic Â· -1: recover Â· +2: go' },
                    c:          { name: 'C',          coverage: 88, rules: 30, map: '+1: function Â· +0: = Â· n: #include Â· -n: return Â· 0: comment Â· -0: free Â· +n: exit Â· -1: goto Â· +2: setjmp' },
                    cpp:        { name: 'C++',        coverage: 90, rules: 36, map: '+1: class/fn Â· +0: = Â· n: #include Â· -n: return Â· 0: comment Â· -0: delete Â· +n: throw Â· -1: catch Â· +2: co_yield' },
                    java:       { name: 'Java',       coverage: 94, rules: 40, map: '+1: class/method Â· +0: = Â· n: import Â· -n: return Â· 0: comment Â· -0: null Â· +n: throw Â· -1: catch Â· +2: yield' },
                    shell:      { name: 'Shell',      coverage: 82, rules: 22, map: '+1: function Â· +0: = Â· n: source/. Â· -n: return/exit Â· 0: # Â· -0: unset Â· +n: trap Â· -1: || Â· +2: &' },
                    ruby:       { name: 'Ruby',       coverage: 86, rules: 28, map: '+1: class/def Â· +0: = Â· n: require Â· -n: return Â· 0: # Â· -0: nil Â· +n: raise Â· -1: rescue Â· +2: yield' },
                    swift:      { name: 'Swift',      coverage: 90, rules: 34, map: '+1: class/func Â· +0: let/var Â· n: import Â· -n: return Â· 0: // Â· -0: nil Â· +n: throw Â· -1: catch Â· +2: await' },
                    kotlin:     { name: 'Kotlin',     coverage: 90, rules: 33, map: '+1: class/fun Â· +0: val/var Â· n: import Â· -n: return Â· 0: // Â· -0: null Â· +n: throw Â· -1: catch Â· +2: yield' },
                    php:        { name: 'PHP',        coverage: 84, rules: 26, map: '+1: class/function Â· +0: $ Â· n: use/require Â· -n: return Â· 0: // Â· -0: unset Â· +n: throw Â· -1: catch Â· +2: yield' },
                    lua:        { name: 'Lua',        coverage: 80, rules: 20, map: '+1: function Â· +0: local Â· n: require Â· -n: return Â· 0: -- Â· -0: nil Â· +n: error Â· -1: pcall Â· +2: coroutine' },
                    r:          { name: 'R',          coverage: 78, rules: 18, map: '+1: function Â· +0: <- Â· n: library Â· -n: return Â· 0: # Â· -0: NULL Â· +n: stop Â· -1: tryCatch Â· +2: yield' },
                    sql:        { name: 'SQL',        coverage: 72, rules: 16, map: '+1: CREATE Â· +0: INSERT/UPDATE Â· n: USE Â· -n: RETURN Â· 0: -- Â· -0: DROP Â· +n: RAISE Â· -1: EXCEPTION Â· +2: CURSOR' },
                    html:       { name: 'HTML',       coverage: 68, rules: 14, map: '+1: <section> Â· +0: attribute Â· n: <link>/<script> Â· -n: </> Â· 0: <!-- --> Â· -0: hidden Â· +n: onerror Â· -1: noscript Â· +2: template' },
                    css:        { name: 'CSS',        coverage: 70, rules: 15, map: '+1: selector Â· +0: property Â· n: @import Â· -n: } Â· 0: /* */ Â· -0: display:none Â· +n: !important Â· -1: @supports Â· +2: @keyframes' },
                    yaml:       { name: 'YAML',       coverage: 74, rules: 12, map: '+1: mapping key Â· +0: value Â· n: anchors Â· -n: --- Â· 0: # Â· -0: null Â· +n: !! Â· -1: merge Â· +2: sequence' },
                    toml:       { name: 'TOML',       coverage: 76, rules: 13, map: '+1: [table] Â· +0: key = Â· n: include Â· -n: --- Â· 0: # Â· -0: empty Â· +n: [[array]] Â· -1: fallback Â· +2: datetime' },
                };
                document.querySelectorAll('.lang-chip').forEach(chip => {
                    chip.addEventListener('click', () => {
                        document.querySelectorAll('.lang-chip').forEach(c => c.classList.remove('active'));
                        chip.classList.add('active');
                        const lang = chip.dataset.lang;
                        const info = LANG_DATA[lang];
                        if (info) {
                            document.getElementById('lang-info-box').innerHTML =
                                `<strong>${info.name}</strong> â€” Coverage: <span style="color:#7ee787;">${info.coverage}%</span><br>` +
                                `AST rules: <span style="color:var(--cursor-accent);">${info.rules}</span> patterns<br>` +
                                `Prefixes: all 9 symbols mapped<br>` +
                                `<span style="color:var(--cursor-text-muted);">${info.map}</span>`;
                        }
                    });
                });
                document.getElementById('lang-detect-btn')?.addEventListener('click', () => {
                    const cell = this.currentCellId ? this.cells.find(c => c.id === this.currentCellId) : null;
                    const result = document.getElementById('lang-detect-result');
                    if (result) {
                        const detected = cell ? (cell.language || this._detectLanguage(cell.content || '')) : 'python';
                        result.style.display = 'block';
                        result.textContent = `Detected: ${detected}`;
                        // Highlight the matching chip
                        const chip = document.querySelector(`.lang-chip[data-lang="${detected}"]`);
                        if (chip) chip.click();
                    }
                });
                document.getElementById('lang-apply-btn')?.addEventListener('click', () => {
                    const activeChip = document.querySelector('.lang-chip.active');
                    if (activeChip && this.currentCellId) {
                        const cell = this.cells.find(c => c.id === this.currentCellId);
                        if (cell) { cell.language = activeChip.dataset.lang; this.renderAllCells(); }
                    }
                });

                // ===== Language sub-tab switching =====
                document.querySelectorAll('.lang-subtab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.lang-subtab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.lang-subpanel').forEach(p => p.classList.remove('active'));
                        tab.classList.add('active');
                        const panel = document.getElementById(tab.dataset.langSub);
                        if (panel) panel.classList.add('active');
                    });
                });

                // ===== kbatch sidebar analyzer =====
                (function initLkb() {
                    const ROWS = [
                        ['q','w','e','r','t','y','u','i','o','p'],
                        ['a','s','d','f','g','h','j','k','l',';'],
                        ['z','x','c','v','b','n','m',',','.','/']
                    ];
                    const KP = {};
                    ROWS.forEach((r, ri) => r.forEach((k, ci) => { KP[k] = { x: ci + ri * 0.25, y: ri }; }));
                    KP[' '] = { x: 4.5, y: 3.2 };

                    const hm = {}, trans = [];
                    let totalK = 0, totalD = 0, lastK = null, words = 0, wf = {}, buf = '';
                    let startTime = Date.now();
                    const outputEl = document.getElementById('lkb-output');
                    const logLines = [];

                    function tc(v) {
                        const n = v / 255;
                        if (n < 0.4) return `rgb(${n*2.5*80},${120+n*2.5*100},${180+n*75})`;
                        if (n < 0.7) return `rgb(${200+n*55},${200-n*80},0)`;
                        return `rgb(255,${120-n*80},${n*200})`;
                    }

                    function addLog(msg) {
                        logLines.push(msg);
                        if (logLines.length > 50) logLines.shift();
                        if (outputEl) {
                            outputEl.innerHTML = logLines.map(l => `<div>${l}</div>`).join('');
                            outputEl.scrollTop = outputEl.scrollHeight;
                        }
                    }

                    function pk(key) {
                        const k = key.toLowerCase();
                        if (!KP[k] && k !== ' ') return;
                        totalK++;
                        hm[k] = (hm[k] || 0) + 1;
                        if (lastK && KP[k] && KP[lastK]) {
                            const f = KP[lastK], t = KP[k];
                            const dx = t.x - f.x, dy = t.y - f.y;
                            const d = Math.sqrt(dx * dx + dy * dy);
                            totalD += d;
                            trans.push({ from: lastK, to: k, dx, dy, dist: d });
                            if (trans.length > 400) trans.shift();
                            const arrow = dx > 0.3 ? (dy < -0.3 ? 'â†—' : dy > 0.3 ? 'â†˜' : 'â†’') : dx < -0.3 ? (dy < -0.3 ? 'â†–' : dy > 0.3 ? 'â†™' : 'â†') : dy < -0.3 ? 'â†‘' : dy > 0.3 ? 'â†“' : 'Â·';
                            addLog(`<span style="color:#f0883e">${lastK}</span> ${arrow} <span style="color:#58a6ff">${k}</span> <span style="color:#484f58">d=${d.toFixed(1)}</span>`);
                        }
                        lastK = k;
                        if (k === ' ') {
                            const w = buf.trim();
                            if (w) { words++; wf[w] = (wf[w] || 0) + 1; }
                            buf = '';
                        } else { buf += k; }
                    }

                    function render() {
                        // Thermal
                        const ct = document.getElementById('lkb-cv-thermal');
                        if (!ct) return;
                        const cx = ct.getContext('2d'); ct.width = ct.clientWidth; ct.height = ct.clientHeight;
                        const W = ct.width, H = ct.height;
                        cx.fillStyle = '#0d1117'; cx.fillRect(0, 0, W, H);
                        const mx = Math.max(1, ...Object.values(hm));
                        const kw = W / 11.5, kh = H / 4.2, pl = (W - 10 * kw) / 2;
                        ROWS.forEach((row, r) => {
                            const off = r * 0.4 * kw;
                            row.forEach((key, c) => {
                                const x = pl + off + c * kw, y = 4 + r * (kh + 3);
                                const cnt = hm[key] || 0, int = cnt / mx;
                                cx.fillStyle = cnt > 0 ? tc(int * 255) : '#21262d';
                                cx.fillRect(x + 1, y + 1, kw - 2, kh - 2);
                                cx.strokeStyle = cnt > 0 ? '#f0883e33' : '#30363d';
                                cx.lineWidth = 0.5; cx.strokeRect(x + 1, y + 1, kw - 2, kh - 2);
                                cx.fillStyle = int > 0.5 ? '#0d1117' : '#8b949e';
                                cx.font = Math.max(6, kh * 0.32) + 'px monospace'; cx.textAlign = 'center';
                                cx.fillText(key.toUpperCase(), x + kw / 2, y + kh * 0.6);
                                cx.textAlign = 'start';
                            });
                        });

                        // Contrails
                        const cc = document.getElementById('lkb-cv-contrails');
                        if (!cc) return;
                        const cx2 = cc.getContext('2d'); cc.width = cc.clientWidth; cc.height = cc.clientHeight;
                        const W2 = cc.width, H2 = cc.height;
                        cx2.fillStyle = '#0d1117'; cx2.fillRect(0, 0, W2, H2);
                        function kx(k) { const p = KP[k]; return p ? (p.x / 10) * (W2 - 16) + 8 : W2 / 2; }
                        function ky(k) { const p = KP[k]; return p ? (p.y / 3.5) * (H2 - 16) + 8 : H2 / 2; }
                        const ln = trans.length;
                        for (let i = Math.max(0, ln - 120); i < ln; i++) {
                            const t = trans[i], a = (ln - i) / 120, al = 0.05 + (1 - a) * 0.6;
                            cx2.strokeStyle = `rgba(240,136,62,${al})`;
                            cx2.lineWidth = 1 + (1 - a) * 2;
                            cx2.beginPath(); cx2.moveTo(kx(t.from), ky(t.from)); cx2.lineTo(kx(t.to), ky(t.to)); cx2.stroke();
                        }
                        if (lastK && KP[lastK]) {
                            cx2.fillStyle = '#f0883e'; cx2.beginPath();
                            cx2.arc(kx(lastK), ky(lastK), 3, 0, Math.PI * 2); cx2.fill();
                        }

                        // Geometric
                        const cg = document.getElementById('lkb-cv-geo');
                        if (!cg) return;
                        const cx3 = cg.getContext('2d'); cg.width = cg.clientWidth; cg.height = cg.clientHeight;
                        const W3 = cg.width, H3 = cg.height;
                        cx3.fillStyle = '#0d1117'; cx3.fillRect(0, 0, W3, H3);
                        const cxc = W3 / 2, cyc = H3 / 2, rad = Math.min(W3, H3) * 0.38;
                        const allK = ROWS.flat(), n = allK.length;
                        allK.forEach((key, i) => {
                            const ang = (i / n) * Math.PI * 2 - Math.PI / 2;
                            const cnt = hm[key] || 0, int = cnt / mx;
                            const r2 = rad * (0.6 + int * 0.4);
                            const x = cxc + Math.cos(ang) * r2, y = cyc + Math.sin(ang) * r2;
                            cx3.fillStyle = cnt > 0 ? tc(int * 255) : '#30363d';
                            cx3.beginPath(); cx3.arc(x, y, 2 + int * 4, 0, Math.PI * 2); cx3.fill();
                            cx3.strokeStyle = `rgba(210,168,255,${0.03 + int * 0.1})`;
                            cx3.lineWidth = 0.3; cx3.beginPath(); cx3.moveTo(cxc, cyc); cx3.lineTo(x, y); cx3.stroke();
                        });

                        // Language (word freq)
                        const cl = document.getElementById('lkb-cv-lang');
                        if (!cl) return;
                        const cx4 = cl.getContext('2d'); cl.width = cl.clientWidth; cl.height = cl.clientHeight;
                        const W4 = cl.width, H4 = cl.height;
                        cx4.fillStyle = '#0d1117'; cx4.fillRect(0, 0, W4, H4);
                        const wds = Object.entries(wf).sort((a, b) => b[1] - a[1]).slice(0, 15);
                        if (wds.length === 0) {
                            cx4.fillStyle = '#484f58'; cx4.font = '8px monospace'; cx4.textAlign = 'center';
                            cx4.fillText('Type words...', W4 / 2, H4 / 2); cx4.textAlign = 'start'; return;
                        }
                        const mf = Math.max(1, wds[0][1]);
                        const cols = Math.ceil(Math.sqrt(wds.length));
                        const cw2 = W4 / (cols + 1), ch2 = H4 / (Math.ceil(wds.length / cols) + 1);
                        wds.forEach(([w, f], i) => {
                            const col = i % cols, row = Math.floor(i / cols);
                            const x = cw2 * (col + 0.5), y = ch2 * (row + 0.5);
                            const sz = Math.max(6, 7 + (f / mf) * 6);
                            cx4.fillStyle = f > 1 ? '#7ee787' : '#e6b422';
                            cx4.font = sz + 'px monospace'; cx4.textAlign = 'center'; cx4.fillText(w, x, y);
                            cx4.textAlign = 'start';
                        });
                    }

                    function stats() {
                        const el = (id, v) => { const e = document.getElementById(id); if (e) e.textContent = v; };
                        const elapsed = (Date.now() - startTime) / 1000;
                        const wpm = elapsed > 0 ? (words / elapsed) * 60 : 0;
                        el('lkb-wpm', wpm.toFixed(1));
                        const avgD = totalK > 1 ? totalD / (totalK - 1) : 0;
                        const eff = avgD > 0 ? Math.max(0, 100 - avgD * 30) : 100;
                        el('lkb-eff', eff.toFixed(0) + '%');
                        el('lkb-keys', totalK);
                        el('lkb-words', words);
                    }

                    const inp = document.getElementById('lkb-input');
                    if (!inp) return;
                    let timer = null;
                    inp.addEventListener('input', () => {
                        if (inp.value.length > 0) pk(inp.value[inp.value.length - 1]);
                        clearTimeout(timer);
                        timer = setTimeout(() => { render(); stats(); }, 30);
                    });
                    inp.addEventListener('keydown', e => {
                        e.stopPropagation();
                        if (e.key === 'Enter') {
                            if (buf.trim()) { words++; const w = buf.trim(); wf[w] = (wf[w] || 0) + 1; buf = ''; }
                            render(); stats();
                        }
                    });

                    document.getElementById('lkb-reset')?.addEventListener('click', () => {
                        Object.keys(hm).forEach(k => delete hm[k]);
                        trans.length = 0; totalK = 0; totalD = 0; lastK = null;
                        words = 0; Object.keys(wf).forEach(k => delete wf[k]); buf = '';
                        startTime = Date.now(); logLines.length = 0;
                        if (outputEl) outputEl.innerHTML = '<div style="color:#484f58;">Reset â€” start typing...</div>';
                        if (inp) inp.value = '';
                        render(); stats();
                    });

                    document.getElementById('lkb-export')?.addEventListener('click', () => {
                        const data = {
                            timestamp: new Date().toISOString(),
                            totalKeys: totalK, words, wpm: ((words / Math.max(1, (Date.now() - startTime) / 1000)) * 60).toFixed(1),
                            heatmap: { ...hm }, wordFreq: { ...wf },
                            recentTransitions: trans.slice(-50).map(t => `${t.from}â†’${t.to}`)
                        };
                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                        const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                        a.download = `kbatch-${Date.now()}.json`; a.click();
                        addLog('<span style="color:#7ee787;">âœ… Exported kbatch data</span>');
                    });

                    render();
                })();

                // ===== BLOCKS PANEL (mini Pybricks builder) =====
                this._nbBlocks = [];
                this._nbConnections = [];
                this._nbId = 0;
                const NB_TYPES = {
                    hub_init:    { cat:'hub',    color:'#58a6ff', label:'Hub Init',    rows:[{type:'select',key:'hub',options:['PrimeHub','InventorHub','CityHub']}] },
                    hub_light:   { cat:'hub',    color:'#58a6ff', label:'Hub Light',   rows:[{type:'select',key:'color',options:['red','green','blue','yellow','off']}] },
                    hub_beep:    { cat:'hub',    color:'#58a6ff', label:'Beep',        rows:[{type:'input',key:'freq',placeholder:'440',unit:'Hz'}] },
                    motor_run:   { cat:'motion', color:'#f0883e', label:'Motor Run',   rows:[{type:'select',key:'port',options:['A','B','C','D']},{type:'input',key:'speed',placeholder:'500',unit:'d/s'}] },
                    motor_stop:  { cat:'motion', color:'#f0883e', label:'Motor Stop',  rows:[{type:'select',key:'port',options:['A','B','C','D']}] },
                    color_read:  { cat:'sensor', color:'#3fb950', label:'Color Read',  rows:[{type:'select',key:'port',options:['1','2','3','4']}] },
                    dist_read:   { cat:'sensor', color:'#3fb950', label:'Distance',    rows:[{type:'select',key:'port',options:['1','2','3','4']}] },
                    if_then:     { cat:'logic',  color:'#d2a8ff', label:'If Then',     rows:[{type:'input',key:'cond',placeholder:'color == "red"'}] },
                    wait_ms:     { cat:'logic',  color:'#d2a8ff', label:'Wait',        rows:[{type:'input',key:'ms',placeholder:'1000',unit:'ms'}] },
                    loop_forever:{ cat:'loop',   color:'#ffe138', label:'Loop âˆž',      rows:[] },
                    loop_n:      { cat:'loop',   color:'#ffe138', label:'Loop N',      rows:[{type:'input',key:'n',placeholder:'10'}] },
                    set_var:     { cat:'var',    color:'#f97583', label:'Set Var',     rows:[{type:'input',key:'name',placeholder:'x'},{type:'input',key:'val',placeholder:'0'}] },
                    print_val:   { cat:'var',    color:'#f97583', label:'Print',       rows:[{type:'input',key:'val',placeholder:'x'}] },
                    stream_in:   { cat:'stream', color:'#c084fc', label:'Stream In',   rows:[{type:'input',key:'ch',placeholder:'hexterm'}] },
                };
                const nbCanvas = document.getElementById('nb-canvas');
                const nbSvg = document.getElementById('nb-connections-svg');

                const createNbBlock = (type, x, y) => {
                    const def = NB_TYPES[type]; if (!def) return;
                    const id = 'nb-' + (this._nbId++);
                    const block = { id, type, x, y, inputs: {} };
                    this._nbBlocks.push(block);
                    const el = document.createElement('div');
                    el.className = 'nb-block';
                    el.id = id;
                    el.style.left = x + 'px'; el.style.top = y + 'px'; el.style.background = def.color;
                    let bodyHtml = '';
                    def.rows.forEach(r => {
                        if (r.type === 'input') bodyHtml += `<input data-key="${r.key}" placeholder="${r.placeholder}" value="${r.placeholder}">`;
                        else if (r.type === 'select') bodyHtml += `<select data-key="${r.key}">${r.options.map(o => `<option>${o}</option>`).join('')}</select>`;
                    });
                    el.innerHTML = `<div class="nb-block-head">${def.label}</div>${bodyHtml ? `<div class="nb-block-body">${bodyHtml}</div>` : ''}<div class="nb-conn-dot" data-conn="${id}"></div>`;

                    // Drag
                    let drag = null;
                    el.addEventListener('pointerdown', (e) => {
                        if (e.target.classList.contains('nb-conn-dot')) return;
                        drag = { ox: e.clientX - block.x, oy: e.clientY - block.y };
                        el.setPointerCapture(e.pointerId);
                    });
                    el.addEventListener('pointermove', (e) => {
                        if (!drag) return;
                        block.x = Math.max(0, e.clientX - drag.ox);
                        block.y = Math.max(0, e.clientY - drag.oy);
                        el.style.left = block.x + 'px'; el.style.top = block.y + 'px';
                        drawNbConnections();
                    });
                    el.addEventListener('pointerup', () => { drag = null; });

                    // Connection dot
                    const dot = el.querySelector('.nb-conn-dot');
                    if (dot) {
                        dot.addEventListener('pointerdown', (e) => {
                            e.stopPropagation();
                            this._nbDrawingFrom = id;
                        });
                        dot.addEventListener('pointerup', (e) => {
                            e.stopPropagation();
                            if (this._nbDrawingFrom && this._nbDrawingFrom !== id) {
                                this._nbConnections.push({ from: this._nbDrawingFrom, to: id });
                                drawNbConnections();
                            }
                            this._nbDrawingFrom = null;
                        });
                    }

                    nbCanvas.appendChild(el);
                };

                const drawNbConnections = () => {
                    if (!nbSvg) return;
                    let paths = '';
                    this._nbConnections.forEach(c => {
                        const fromEl = document.getElementById(c.from);
                        const toEl = document.getElementById(c.to);
                        if (!fromEl || !toEl) return;
                        const fr = fromEl.getBoundingClientRect();
                        const tr = toEl.getBoundingClientRect();
                        const cr = nbCanvas.getBoundingClientRect();
                        const x1 = fr.right - cr.left, y1 = fr.top + fr.height/2 - cr.top;
                        const x2 = tr.left - cr.left, y2 = tr.top + tr.height/2 - cr.top;
                        const cx = (x1 + x2) / 2;
                        paths += `<path d="M${x1},${y1} C${cx},${y1} ${cx},${y2} ${x2},${y2}" fill="none" stroke="#ffe138" stroke-width="2" opacity="0.7"/>`;
                    });
                    nbSvg.innerHTML = paths;
                };

                const clearNbCanvas = () => {
                    this._nbBlocks = []; this._nbConnections = []; this._nbId = 0;
                    nbCanvas.querySelectorAll('.nb-block').forEach(b => b.remove());
                    if (nbSvg) nbSvg.innerHTML = '';
                };

                const loadNbPreset = (preset) => {
                    clearNbCanvas();
                    if (preset === 'drive') {
                        createNbBlock('hub_init', 10, 10);
                        createNbBlock('motor_run', 10, 55);
                        createNbBlock('motor_run', 10, 100);
                        this._nbConnections.push({ from: 'nb-0', to: 'nb-1' }, { from: 'nb-1', to: 'nb-2' });
                    } else if (preset === 'sorter') {
                        createNbBlock('hub_init', 10, 10);
                        createNbBlock('color_read', 10, 55);
                        createNbBlock('if_then', 10, 100);
                        createNbBlock('motor_run', 110, 100);
                        this._nbConnections.push({ from: 'nb-0', to: 'nb-1' }, { from: 'nb-1', to: 'nb-2' }, { from: 'nb-2', to: 'nb-3' });
                    }
                    drawNbConnections();
                };

                const exportNbPython = () => {
                    let code = '# ðŸ§± Generated from Block Builder\nfrom pybricks.hubs import PrimeHub\nfrom pybricks.pupdevices import Motor, ColorSensor\nfrom pybricks.parameters import Port, Color\n\nhub = PrimeHub()\n\n';
                    this._nbBlocks.forEach(b => {
                        const def = NB_TYPES[b.type];
                        const el = document.getElementById(b.id);
                        if (!el || !def) return;
                        const vals = {};
                        el.querySelectorAll('[data-key]').forEach(inp => { vals[inp.dataset.key] = inp.value; });
                        switch(b.type) {
                            case 'motor_run': code += `Motor(Port.${vals.port || 'A'}).run(${vals.speed || 500})\n`; break;
                            case 'motor_stop': code += `Motor(Port.${vals.port || 'A'}).stop()\n`; break;
                            case 'color_read': code += `color = ColorSensor(Port.${vals.port || '1'}).color()\n`; break;
                            case 'hub_light': code += `hub.light.on(Color.${(vals.color||'green').toUpperCase()})\n`; break;
                            case 'hub_beep': code += `hub.speaker.beep(${vals.freq || 440})\n`; break;
                            case 'if_then': code += `if ${vals.cond || 'True'}:\n    pass\n`; break;
                            case 'wait_ms': code += `from pybricks.tools import wait\nwait(${vals.ms || 1000})\n`; break;
                            case 'loop_forever': code += `while True:\n    pass\n`; break;
                            case 'loop_n': code += `for i in range(${vals.n || 10}):\n    pass\n`; break;
                            case 'set_var': code += `${vals.name || 'x'} = ${vals.val || 0}\n`; break;
                            case 'print_val': code += `print(${vals.val || 'x'})\n`; break;
                            case 'stream_in': code += `# stream from ${vals.ch || 'hexterm'}\n`; break;
                        }
                    });
                    const id = this.addCell('code', code);
                    requestAnimationFrame(() => { document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' }); });
                };

                // Palette chip clicks
                document.querySelectorAll('#nb-palette .nb-chip').forEach(chip => {
                    chip.addEventListener('click', () => {
                        const nextY = this._nbBlocks.length * 45 + 10;
                        createNbBlock(chip.dataset.nb, 10, nextY);
                    });
                });
                document.getElementById('nb-preset-drive')?.addEventListener('click', () => loadNbPreset('drive'));
                document.getElementById('nb-preset-sorter')?.addEventListener('click', () => loadNbPreset('sorter'));
                document.getElementById('nb-export')?.addEventListener('click', () => exportNbPython());
                document.getElementById('nb-clear')?.addEventListener('click', () => clearNbCanvas());

                // ===== QUANTUM VISUAL SLICE / 3D CUBE =====
                this._visualMode = 'slice';
                this._visualAnim = null;
                this._visualFrame = 0;
                this._cubeRotX = -25;
                this._cubeRotY = 35;
                this._cubeAutoRotate = false;
                this._cubeExploded = false;
                this._cubeLayerIsolate = -1; // -1 = show all
                this._cubeDrag = null;

                // Visual mode buttons
                document.querySelectorAll('[data-visual-mode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('[data-visual-mode]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this._visualMode = btn.dataset.visualMode;
                        this._showVisualView();
                    });
                });

                // Cube controls
                const cubeAuto = document.getElementById('cube-auto');
                const cubeExplode = document.getElementById('cube-explode');
                const cubeReset = document.getElementById('cube-reset');
                const cubeLayerBtn = document.getElementById('cube-layer-mode');
                if (cubeAuto) cubeAuto.addEventListener('click', () => {
                    this._cubeAutoRotate = !this._cubeAutoRotate;
                    cubeAuto.classList.toggle('active', this._cubeAutoRotate);
                });
                if (cubeExplode) cubeExplode.addEventListener('click', () => {
                    this._cubeExploded = !this._cubeExploded;
                    cubeExplode.classList.toggle('active', this._cubeExploded);
                    this._buildCube();
                });
                if (cubeReset) cubeReset.addEventListener('click', () => {
                    this._cubeRotX = -25; this._cubeRotY = 35;
                    this._cubeExploded = false; this._cubeLayerIsolate = -1;
                    cubeExplode?.classList.remove('active');
                    cubeLayerBtn?.classList.remove('active');
                    this._buildCube();
                });
                if (cubeLayerBtn) cubeLayerBtn.addEventListener('click', () => {
                    this._cubeLayerIsolate = this._cubeLayerIsolate === -1
                        ? Math.abs(this.quantumPosition[2]) % 3
                        : -1;
                    cubeLayerBtn.classList.toggle('active', this._cubeLayerIsolate !== -1);
                    this._buildCube();
                });

                // Cube drag rotation
                const cubeScene = document.getElementById('visual-cube-wrap');
                if (cubeScene) {
                    cubeScene.addEventListener('pointerdown', (e) => {
                        this._cubeDrag = { x: e.clientX, y: e.clientY, rx: this._cubeRotX, ry: this._cubeRotY };
                        cubeScene.setPointerCapture(e.pointerId);
                    });
                    cubeScene.addEventListener('pointermove', (e) => {
                        if (!this._cubeDrag) return;
                        this._cubeRotY = this._cubeDrag.ry + (e.clientX - this._cubeDrag.x) * 0.6;
                        this._cubeRotX = this._cubeDrag.rx + (e.clientY - this._cubeDrag.y) * 0.6;
                    });
                    cubeScene.addEventListener('pointerup', () => { this._cubeDrag = null; });
                }

                // ===== QUANTUM THERMAL VISUALIZATION =====
                this._thermalMode = 'lattice';
                this._thermalUnit = 'C';
                this._thermalAnim = null;
                this._thermalFrame = 0;
                this._thermalQubits = 50;

                // Thermal mode buttons
                document.querySelectorAll('[data-thermal-mode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('[data-thermal-mode]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this._thermalMode = btn.dataset.thermalMode;
                        this._thermalFrame = 0;
                    });
                });

                // Unit toggle
                ['c','f','k'].forEach(u => {
                    const btn = document.getElementById('unit-' + u);
                    if (!btn) return;
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('#unit-c,#unit-f,#unit-k').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this._thermalUnit = u.toUpperCase();
                        this._updateThermalStats();
                    });
                });

                // Qubit slider
                const qSlider = document.getElementById('qubit-slider');
                if (qSlider) {
                    qSlider.addEventListener('input', () => {
                        this._thermalQubits = parseInt(qSlider.value);
                        this._updateGpuQubitScaling();
                    });
                }

                // ===== CHARTGPU INTEGRATION =====
                this._hexMode = 'color';
                this._hexData = new Uint8Array(360 * 360);
                // Seed with random data (chunked â€” browser limit is 65536 bytes per call)
                for (let i = 0; i < this._hexData.length; i += 65536) {
                    crypto.getRandomValues(this._hexData.subarray(i, Math.min(i + 65536, this._hexData.length)));
                }

                document.getElementById('chartgpu-launch')?.addEventListener('click', () => {
                    window.open('http://localhost:3444', '_blank');
                });

                document.getElementById('chartgpu-metrics')?.addEventListener('click', () => {
                    this._fetchChartGPUMetrics();
                });

                // Hex mode buttons
                document.querySelectorAll('[data-hex-mode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('[data-hex-mode]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this._hexMode = btn.dataset.hexMode;
                        this._drawHexCanvas();
                    });
                });

                document.getElementById('hex-expand')?.addEventListener('click', () => {
                    this._openHexOverlay();
                });

                // Start hex canvas mini animation (Nyan Cat loop)
                this._hexCanvas = document.getElementById('hex-canvas');
                this._hexCtx = this._hexCanvas?.getContext('2d');
                this._nyanFrame = 0;
                this._hexInterval = setInterval(() => {
                    if (document.hidden) return; // pause when tab/app not visible
                    if (document.getElementById('thermal-tab')?.classList.contains('active')) {
                        // Shift background hex data
                        for (let i = 0; i < 64; i++) {
                            const idx = Math.floor(Math.random() * this._hexData.length);
                            this._hexData[idx] = (this._hexData[idx] + Math.floor(Math.random() * 8)) & 0xFF;
                        }
                        this._drawHexCanvas();
                    }
                }, 80);

                // ===== TOOLS DROPDOWN =====
                const toolsBtn = document.getElementById('f-tools');
                const toolsDropdown = document.getElementById('tools-dropdown');
                if (toolsBtn && toolsDropdown) {
                    toolsBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toolsDropdown.classList.toggle('show');
                    });
                    document.addEventListener('click', () => toolsDropdown.classList.remove('show'));
                    toolsDropdown.addEventListener('click', (e) => e.stopPropagation());

                    toolsDropdown.querySelectorAll('.tools-dropdown-item').forEach(item => {
                        item.addEventListener('click', () => {
                            toolsDropdown.classList.remove('show');
                            this._runTool(item.dataset.tool);
                        });
                    });
                }

                // ===== QUEST STATUS =====
                document.getElementById('f-quest')?.addEventListener('click', () => this._checkQuestStatus());
                document.getElementById('quest-status')?.addEventListener('click', () => this._checkQuestStatus());

                // Global keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.shiftKey && e.key === 'Enter' && this.currentCellId) {
                        e.preventDefault();
                        this.executeCell(this.currentCellId);
                    }
                    if ((e.metaKey || e.ctrlKey) && e.key === 's') {
                        e.preventDefault();
                        this.saveNotebook();
                    }
                    if ((e.metaKey || e.ctrlKey) && e.key === 'z' && !e.shiftKey) {
                        e.preventDefault();
                        this.undo();
                    }
                    if ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key === 'z') {
                        e.preventDefault();
                        this.redo();
                    }
                });
            }

            /* ---------- Initial Cells ---------- */
            createInitialCells() {
                this.addCell('markdown', `# âš› uvspeed v4.0 â€” Quantum beyondBINARY Development Platform

Welcome to **uvspeed** â€” a 17-app development platform built on the 9-symbol quantum prefix system.

## What's Here

| Tool | Description |
|------|-------------|
| **hexterm** | Full terminal emulator with virtual FS, device presets, quantum gutter |
| **hexcast** | Camera â†’ terminal video streaming (truecolor ANSI or hex grid) |
| **kbatch** | Keyboard heatmap with thermal contrails, geometric patterns |
| **brotherNumsy** | Endless runner game with AI training API + FreyaUnits converter |
| **grid + feed** | Multi-stream canvas grid + lightweight video/audio feed windows |
| **launcher** | Mode picker + command console for controlling connected devices |

## Quick Start

- **Prefix gutter:** Every line gets a symbol from \`{+1, 1, -1, +0, 0, -0, +n, n, -n}\`
- **3D Navigation:** Open the **Visual** sidebar tab â†’ Slice / Cube / Orb views
- **Inspect:** Click ðŸ” in the footer to see full project status & architecture
- **Terminal:** Click ðŸ’» to open the built-in terminal
- **Tools:** Each cell has a ðŸ§° toolbar with 14 built-in utilities (calc, hash, diff, mapâ€¦)
- **PWA:** Install to homescreen for offline use â€” zero server dependency`);

                this.addCell('code', `# beyondBINARY quantum prefix system â€” Python example
# Every line is structurally classified in 3D space:
#   X = dependency depth, Y = line position, Z = complexity

# n:  entry / shebang
#!/usr/bin/env python3

# +n: import / dependency
from tinygrad.tensor import Tensor
import numpy as np

# +0: class / structure definition
class QuantumState:
    # +1: documentation / comment
    """3-qubit quantum state vector with prefix-aware navigation."""

    # 0:  function / method
    def __init__(self, qubits=3):
        # +0: assignment / binding
        self.n = qubits
        self.state = Tensor.randn(2 ** qubits)

    # 0:  function / method
    def normalize(self):
        # -0: return / yield
        return self.state / self.state.norm()

    # 0:  function / method
    def measure(self):
        # -1: error handling
        try:
            # 1: logic / computation
            probs = (self.state ** 2).numpy()
            # -0: return
            return probs
        except Exception as e:
            # +3: output / render
            print(f"Measurement error: {e}")

# +0: instantiation
qs = QuantumState(3)
print(f"âš› State: {qs.normalize().shape}")
print(f"  Norm:  {qs.normalize().norm().numpy():.6f}")`);

                this.addCell('mermaid', `graph LR
    subgraph Platform["uvspeed v4.0 Architecture"]
        direction LR
        A["ðŸ–¥ Launcher<br/>mode picker"] -->|instance| B["ðŸ’» hexterm<br/>terminal"]
        A -->|grid| C["ðŸ“º Grid<br/>multi-stream"]
        A -->|web| D["ðŸŒ PWA<br/>browser"]
    end
    subgraph Streams["Multi-Stream"]
        B --> E["ðŸ“¡ Feed<br/>video/audio"]
        C --> E
        E --> F["âŒ¨ kbatch<br/>keyboard sync"]
        E --> G["ðŸ’¬ Transcript<br/>speech-to-text"]
    end
    subgraph Tools["17 Web Tools"]
        D --> H["ðŸ“ Notepad<br/>prefix gutter"]
        D --> I["ðŸ“¡ hexcast<br/>video stream"]
        D --> J["ðŸŽ® Numsy<br/>runner game"]
        D --> K["ðŸ“Š Blackwell<br/>GPU viz"]
    end
    subgraph Desktop["Tauri v2"]
        L["âš™ï¸ Rust<br/>native menus"] --> A
        L --> M["ðŸªŸ Window Mgr<br/>device presets"]
    end
    style A fill:#2d333b,stroke:#58a6ff,color:#c9d1d9
    style B fill:#2d333b,stroke:#7ee787,color:#c9d1d9
    style C fill:#2d333b,stroke:#f0883e,color:#c9d1d9
    style D fill:#2d333b,stroke:#d2a8ff,color:#c9d1d9
    style L fill:#2d333b,stroke:#f0d852,color:#c9d1d9`);

                this.addCell('visualization', `# âš¡ UV-Speed System Benchmark & CDN Signal Trace
# Run this cell to benchmark your machine in real-time
# Charts: Math throughput, DOM speed, Canvas perf, JSON ser/de
# CDN: 6-layer signal trace (DNSâ†’TLSâ†’TCPâ†’HTTPâ†’Edgeâ†’Origin)
# Prefix: Per-language classification speed (py/js/rs/go/sh/html)
# Data layers: L1-Cache through L5-Origin stacked throughput`);
            }

            /* ---------- Cell CRUD ---------- */
            static MAX_CELLS = 500;

            addCell(cellType = 'code', content = '') {
                if (this.cells.length >= QuantumNotebookWeb.MAX_CELLS) {
                    this._logStream('warn', `Cell limit reached (${QuantumNotebookWeb.MAX_CELLS}). Delete cells to add more.`, 'error');
                    alert(`Cell limit: ${QuantumNotebookWeb.MAX_CELLS} cells maximum.\nDelete unused cells to free space.`);
                    return null;
                }
                if (this.cells.length === QuantumNotebookWeb.MAX_CELLS - 50) {
                    this._logStream('warn', `Approaching cell limit (${this.cells.length}/${QuantumNotebookWeb.MAX_CELLS})`, 'warn');
                }

                const cellId = `cell_${this.cells.length}_${Date.now()}`;

                const cell = {
                    id: cellId,
                    type: cellType,
                    content: content,
                    output: [],
                    executionCount: 0,
                    quantumPosition: [...this.quantumPosition],
                    created: new Date().toISOString()
                };

                this.cells.push(cell);
                this.renderCell(cell);
                this.updateCellList();
                this.updateStats();

                return cellId;
            }

            renderCell(cell) {
                const container = document.getElementById('cells-container');

                const cellElement = document.createElement('div');
                cellElement.className = 'quantum-cell';
                cellElement.id = cell.id;

                const typeEmoji = { code: 'âš¡', markdown: 'ðŸ“', visualization: 'ðŸ“Š', quantum: 'ðŸŒŒ', mermaid: 'ðŸ§œ', freya: 'ðŸ”¬', kbatch: 'âŒ¨', hexcast: 'ðŸ“¡' };

                cellElement.innerHTML = `
                    <div class="cell-header">
                        <div class="cell-type">
                            ${typeEmoji[cell.type] || 'âš¡'} ${cell.type}
                            <span class="cell-coords">[${cell.quantumPosition.join(', ')}]</span>
                        </div>
                        <div class="cell-actions">
                            <button class="btn btn--sm" onclick="notebook.executeCell('${cell.id}')" title="Run cell (Shift+Enter)">â–¶ Run</button>
                            <button class="btn btn--sm" onclick="notebook.expandCellOutput('${cell.id}')" title="Expand output in overlay" style="font-size:0.875rem;">â†—</button>
                            <button class="btn btn--sm" onclick="notebook.toggleCellTools('${cell.id}')" title="In-cell tools (map, calc, unix, CDN, file)">ðŸ§°</button>
                            <button class="btn btn--sm" onclick="notebook.deleteCell('${cell.id}')" title="Delete cell">ðŸ—‘</button>
                        </div>
                    </div>
                    <div class="cell-tools-bar" id="${cell.id}-tools" style="display:none;">
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','calc')" title="Evaluate math expression">ðŸ§® Calc</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','unix')" title="Unix timestamp â†” date">â± Unix</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','base')" title="Base converter (hex/bin/oct/dec)">ðŸ”¢ Base</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','json')" title="Format / validate JSON">{ } JSON</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','csv')" title="Parse CSV to table">ðŸ“‹ CSV</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','url')" title="URL encode/decode">ðŸ”— URL</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','hash')" title="SHA-256 / MD5 hash">ðŸ” Hash</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','regex')" title="Test regex pattern">/./ Regex</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','diff')" title="Diff two blocks">Â± Diff</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','color')" title="Color converter (hex/rgb/hsl)">ðŸŽ¨ Color</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','cdn')" title="CDN link helper">ðŸŒ CDN</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','map')" title="Lat/Lng map preview">ðŸ—º Map</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','file')" title="Import file (JSON, CSV, TXT, MD, IMG, PDF, YAML)">ðŸ“ File</button>
                        <button class="cell-tool-btn" onclick="notebook.cellTool('${cell.id}','export')" title="Export cell (JSON, MD, HTML, TXT)">ðŸ’¾ Export</button>
                    </div>
                    <div class="cell-editor">
                        <div class="quantum-gutter" id="${cell.id}-gutter"></div>
                        <textarea class="cell-textarea auto-resize"
                                  placeholder="Enter ${cell.type} here..."
                                  oninput="notebook.updateCell('${cell.id}', this.value); notebook.autoResize(this); notebook.debouncedUpdateGutter('${cell.id}');"
                                  onfocus="notebook.focusCell('${cell.id}')"
                                  onpaste="setTimeout(()=>notebook.handlePaste('${cell.id}'),0)"
                                  onscroll="notebook.syncGutterScroll('${cell.id}', this)">${cell.content}</textarea>
                    </div>
                    <div class="cell-output" id="${cell.id}-output" style="display:none;"></div>
                `;

                container.appendChild(cellElement);

                const textarea = cellElement.querySelector('.cell-textarea');
                this.autoResize(textarea);
                // Initial gutter render
                this.updateGutter(cell.id);
            }

            /* ---------- Execution ---------- */
            executeCell(cellId) {
                const cell = this.cells.find(c => c.id === cellId);
                if (!cell) return;

                this.executionCount++;
                cell.executionCount = this.executionCount;
                this._logStream(`exec [${this.executionCount}]`, `${cell.type} ${cell.id.substring(0, 15)}`, 'exec');

                const outputElement = document.getElementById(`${cellId}-output`);
                outputElement.style.display = 'block';
                outputElement.innerHTML = '<div class="output-text" style="color:var(--cursor-accent);">â³ Executing&hellip;</div>';

                const t0 = performance.now();

                // Non-code cells execute locally
                if (cell.type === 'markdown' || cell.type === 'mermaid' || cell.type === 'quantum' || cell.type === 'kbatch' || cell.type === 'hexcast') {
                    const result = this._localExecution(cell);
                    this.displayOutput(cellId, result);
                    this._lastExecMs = Math.round(performance.now() - t0);
                    this.updateStats();
                    this.updateCellList();
                    if (this.autoSave) this._saveToLocalStorage();
                    return;
                }

                // Try real execution via bridge
                if (this.wsConnected && this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this._pendingCallbacks[cellId] = (msg) => {
                        this._lastExecMs = msg.elapsed_ms || Math.round(performance.now() - t0);
                        if (msg.success) {
                            const lines = [];
                            if (msg.stdout) lines.push(...msg.stdout.split('\n').filter(l => l));
                            if (msg.return_value) lines.push(`â†’ ${msg.return_value}`);
                            if (lines.length === 0) lines.push('âœ… Executed successfully (no output)');
                            lines.push(`â± ${this._lastExecMs} ms Â· Execution [${cell.executionCount}]`);
                            this.displayOutput(cellId, { type: 'text', data: lines });
                        } else {
                            this.displayError(cellId, msg.error || 'Execution failed');
                        }
                        this.updateStats();
                        this.updateCellList();
                        if (this.autoSave) this._saveToLocalStorage();
                    };
                    this.ws.send(JSON.stringify({
                        type: 'execute',
                        code: cell.content,
                        cell_id: cellId,
                        mode: 'python',
                    }));
                } else {
                    // Fallback: try HTTP API
                    fetch(`${this.apiUrl}/api/execute`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code: cell.content, cell_id: cellId, mode: 'python' }),
                    })
                    .then(r => r.json())
                    .then(msg => {
                        this._lastExecMs = msg.elapsed_ms || Math.round(performance.now() - t0);
                        if (msg.success) {
                            const lines = [];
                            if (msg.stdout) lines.push(...msg.stdout.split('\n').filter(l => l));
                            if (msg.return_value) lines.push(`â†’ ${msg.return_value}`);
                            if (lines.length === 0) lines.push('âœ… Executed successfully (no output)');
                            lines.push(`â± ${this._lastExecMs} ms Â· Execution [${cell.executionCount}]`);
                            this.displayOutput(cellId, { type: 'text', data: lines });
                        } else {
                            this.displayError(cellId, msg.error || 'Execution failed');
                        }
                        this.updateStats();
                        this.updateCellList();
                        if (this.autoSave) this._saveToLocalStorage();
                    })
                    .catch(() => {
                        // Last resort: local simulation
                        const result = this._localExecution(cell);
                        this.displayOutput(cellId, result);
                        this._lastExecMs = Math.round(performance.now() - t0);
                        this.updateStats();
                        this.updateCellList();
                        if (this.autoSave) this._saveToLocalStorage();
                    });
                }
            }

            _localExecution(cell) {
                if (cell.type === 'markdown') {
                    return { type: 'html', data: this.markdownToHtml(cell.content) };
                } else if (cell.type === 'mermaid') {
                    return { type: 'mermaid', data: cell.content };
                } else if (cell.type === 'visualization') {
                    // Run inline visualization â€” return HTML with live canvas
                    return { type: 'html', data: this._runVisualizationCell(cell) };
                } else if (cell.type === 'freya') {
                    // Run FreyaUnits interactive converter cell
                    return { type: 'html', data: this._runFreyaCell(cell) };
                } else if (cell.type === 'quantum') {
                    return { type: 'html', data: this._runQuantumCell(cell) };
                } else if (cell.type === 'kbatch') {
                    return { type: 'html', data: this._runKbatchCell(cell) };
                } else if (cell.type === 'hexcast') {
                    return { type: 'html', data: this._runHexcastCell(cell) };
                } else {
                    return {
                        type: 'text',
                        data: [
                            `ðŸŒŒ Quantum execution complete (bridge offline â€” local fallback)`,
                            `Position: [${this.quantumPosition.join(', ')}]`,
                            `Execution [${cell.executionCount}]`,
                            `Cell: ${cell.type}`,
                            `ðŸ’¡ Start bridge: python3 quantum_bridge_server.py`
                        ]
                    };
                }
            }

            /* ---------- Visualization Cell Engine ---------- */
            _runVisualizationCell(cell) {
                const uid = `viz_${cell.id}_${Date.now()}`;
                return `
<div id="${uid}" style="padding:12px;background:var(--cursor-bg);border-radius:var(--cursor-radius-md);font-family:var(--cursor-font-mono);font-size:0.75rem;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
        <span style="font-weight:700;color:var(--cursor-accent);font-size:0.8125rem;">âš¡ Live System Benchmark</span>
        <div style="display:flex;gap:4px;">
            <button id="${uid}_rerun" style="padding:2px 8px;border:1px solid var(--cursor-border);border-radius:4px;background:rgba(88,166,255,.1);color:#58a6ff;font-family:inherit;font-size:0.5625rem;cursor:pointer;">â†» Re-run</button>
            <button id="${uid}_pause" style="padding:2px 8px;border:1px solid var(--cursor-border);border-radius:4px;background:rgba(126,231,135,.1);color:#7ee787;font-family:inherit;font-size:0.5625rem;cursor:pointer;">â¸ Pause</button>
        </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;position:relative;">
            <div style="font-weight:700;margin-bottom:6px;color:var(--cursor-accent);font-size:0.8125rem;">âš¡ Machine Benchmark</div>
            <canvas id="${uid}_bench" width="360" height="180" style="width:100%;border-radius:4px;cursor:crosshair;"></canvas>
            <div id="${uid}_bench_tip" style="position:absolute;display:none;padding:3px 8px;background:#161b22ee;border:1px solid var(--cursor-border);border-radius:4px;font-size:0.5rem;color:#fff;pointer-events:none;white-space:nowrap;z-index:5;"></div>
            <div id="${uid}_bench_info" style="margin-top:6px;color:var(--cursor-text-secondary);font-size:0.5625rem;"></div>
        </div>
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;position:relative;">
            <div style="font-weight:700;margin-bottom:6px;color:#7ee787;font-size:0.8125rem;">ðŸ“¡ CDN Signal Trace <span id="${uid}_live" style="font-size:0.5rem;color:#3fb950;">â— LIVE</span></div>
            <canvas id="${uid}_cdn" width="360" height="180" style="width:100%;border-radius:4px;cursor:crosshair;"></canvas>
            <div id="${uid}_cdn_tip" style="position:absolute;display:none;padding:3px 8px;background:#161b22ee;border:1px solid var(--cursor-border);border-radius:4px;font-size:0.5rem;color:#fff;pointer-events:none;white-space:nowrap;z-index:5;"></div>
            <div id="${uid}_cdn_info" style="margin-top:6px;color:var(--cursor-text-secondary);font-size:0.5625rem;"></div>
        </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:12px;">
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;position:relative;">
            <div style="font-weight:700;margin-bottom:6px;color:#f0883e;font-size:0.8125rem;">ðŸ§® Compute Throughput</div>
            <canvas id="${uid}_compute" width="240" height="140" style="width:100%;border-radius:4px;cursor:crosshair;"></canvas>
            <div id="${uid}_compute_tip" style="position:absolute;display:none;padding:3px 8px;background:#161b22ee;border:1px solid var(--cursor-border);border-radius:4px;font-size:0.5rem;color:#fff;pointer-events:none;white-space:nowrap;z-index:5;"></div>
        </div>
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;position:relative;">
            <div style="font-weight:700;margin-bottom:6px;color:#d2a8ff;font-size:0.8125rem;">ðŸŒ Data Layer Stack</div>
            <canvas id="${uid}_layers" width="240" height="140" style="width:100%;border-radius:4px;cursor:crosshair;"></canvas>
            <div id="${uid}_layers_tip" style="position:absolute;display:none;padding:3px 8px;background:#161b22ee;border:1px solid var(--cursor-border);border-radius:4px;font-size:0.5rem;color:#fff;pointer-events:none;white-space:nowrap;z-index:5;"></div>
        </div>
        <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:10px;position:relative;">
            <div style="font-weight:700;margin-bottom:6px;color:#79c0ff;font-size:0.8125rem;">ðŸ“Š Prefix Speed</div>
            <canvas id="${uid}_prefix" width="240" height="140" style="width:100%;border-radius:4px;cursor:crosshair;"></canvas>
            <div id="${uid}_prefix_tip" style="position:absolute;display:none;padding:3px 8px;background:#161b22ee;border:1px solid var(--cursor-border);border-radius:4px;font-size:0.5rem;color:#fff;pointer-events:none;white-space:nowrap;z-index:5;"></div>
        </div>
    </div>
    <div id="${uid}_summary" style="background:linear-gradient(135deg, rgba(88,166,255,0.1), rgba(126,231,135,0.1));border-radius:var(--cursor-radius-md);padding:12px;border:1px solid var(--cursor-border);"></div>
</div>
<` + `script>
(function(){
    const id = '${uid}';
    const C = {accent:'#58a6ff',green:'#7ee787',orange:'#f0883e',purple:'#d2a8ff',cyan:'#79c0ff',red:'#f97583',bg:'#161b22',grid:'#21262d',text:'#8b949e'};
    let paused = false, frame = 0, rafId = null;

    /* â”€â”€ Shared draw helpers â”€â”€ */
    function drawGrid(ctx,w,h){
        ctx.fillStyle=C.bg; ctx.fillRect(0,0,w,h);
        ctx.strokeStyle=C.grid; ctx.lineWidth=0.5;
        for(let y=0;y<h;y+=20){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(w,y);ctx.stroke();}
        for(let x=0;x<w;x+=30){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,h);ctx.stroke();}
    }
    function drawLine(ctx,pts,color,w,h,maxVal){
        ctx.strokeStyle=color; ctx.lineWidth=2; ctx.beginPath();
        pts.forEach((v,i)=>{const x=(i/(pts.length-1))*w;const y=h-((v/maxVal)*h*0.85)-10;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
        ctx.stroke();
        ctx.strokeStyle=color+'40'; ctx.lineWidth=5; ctx.beginPath();
        pts.forEach((v,i)=>{const x=(i/(pts.length-1))*w;const y=h-((v/maxVal)*h*0.85)-10;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
        ctx.stroke();
    }
    function ptY(v,h,maxVal){ return h-((v/maxVal)*h*0.85)-10; }

    /* â”€â”€ Hover tooltip system â”€â”€ */
    function attachHover(canvasId, tipId, getData) {
        const cv = document.getElementById(canvasId);
        const tip = document.getElementById(tipId);
        if (!cv || !tip) return;
        cv.addEventListener('mousemove', e => {
            const rect = cv.getBoundingClientRect();
            const mx = (e.clientX - rect.left) / rect.width;
            const my = (e.clientY - rect.top) / rect.height;
            const info = getData(mx, my, cv.width, cv.height);
            if (info) {
                tip.style.display = 'block';
                tip.style.left = (e.clientX - rect.left + cv.offsetLeft + 12) + 'px';
                tip.style.top = (e.clientY - rect.top + cv.offsetTop - 8) + 'px';
                tip.innerHTML = info;
            }
        });
        cv.addEventListener('mouseleave', () => { tip.style.display = 'none'; });
    }

    /* â”€â”€ Crosshair â”€â”€ */
    const mousePos = {};
    function trackMouse(canvasId) {
        const cv = document.getElementById(canvasId);
        if (!cv) return;
        mousePos[canvasId] = { x: -1, y: -1 };
        cv.addEventListener('mousemove', e => {
            const r = cv.getBoundingClientRect();
            mousePos[canvasId] = { x: ((e.clientX - r.left) / r.width) * cv.width, y: ((e.clientY - r.top) / r.height) * cv.height };
        });
        cv.addEventListener('mouseleave', () => { mousePos[canvasId] = { x: -1, y: -1 }; });
    }
    function drawCrosshair(ctx, canvasId, w, h) {
        const m = mousePos[canvasId];
        if (!m || m.x < 0) return;
        ctx.strokeStyle = 'rgba(255,255,255,0.15)'; ctx.lineWidth = 1; ctx.setLineDash([4,4]);
        ctx.beginPath(); ctx.moveTo(m.x, 0); ctx.lineTo(m.x, h); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0, m.y); ctx.lineTo(w, m.y); ctx.stroke();
        ctx.setLineDash([]);
    }

    /* â”€â”€ Run benchmarks â”€â”€ */
    let benchMarks, domMs, canvasMs, jsonMs, regexMs;
    const computeLabels = ['Math','DOM','Canvas','JSON','RegEx'];
    const computeColors = [C.accent,C.green,C.orange,C.purple,C.cyan];
    let computeValues = [];
    const prefixLangs = ['py','js','rs','go','sh','html'];
    let prefixSpeeds = [];

    function runBenchmarks() {
        benchMarks = [];
        [100,500,1000,5000,10000,50000,100000].forEach(n=>{
            const t0=performance.now(); let s=0;
            for(let i=0;i<n;i++) s+=Math.sqrt(i)*Math.sin(i);
            benchMarks.push({size:n,ms:performance.now()-t0,ops:n});
        });
        let t0=performance.now();
        const frag=document.createDocumentFragment();
        for(let i=0;i<1000;i++){const d=document.createElement('div');d.textContent='x';frag.appendChild(d);}
        domMs=performance.now()-t0;
        t0=performance.now();
        const tc=document.createElement('canvas');tc.width=200;tc.height=200;const tx=tc.getContext('2d');
        for(let i=0;i<2000;i++){tx.fillStyle='hsl('+i+',80%,50%)';tx.fillRect(Math.random()*200,Math.random()*200,5,5);}
        canvasMs=performance.now()-t0;
        t0=performance.now();
        const big={};for(let i=0;i<5000;i++)big['k'+i]={v:Math.random(),n:'item'+i};
        JSON.parse(JSON.stringify(big)); jsonMs=performance.now()-t0;
        t0=performance.now();for(let i=0;i<5000;i++)/quantum_\\d+/.test('quantum_'+i);regexMs=performance.now()-t0;
        const totalOps=benchMarks.reduce((a,b)=>a+b.ops,0);
        const totalMs=benchMarks.reduce((a,b)=>a+b.ms,0);
        computeValues=[totalOps/totalMs,1000/domMs,2000/canvasMs,5000/jsonMs,5000/regexMs];
        const testLines=['import os','const x = 1','fn main()','func main()','#!/bin/bash','<div>'];
        prefixSpeeds=testLines.map(line=>{const t0=performance.now();for(let j=0;j<10000;j++){/^\\s*(import|from|def|class|#|if|for|while|return|print)/.test(line);}return 10000/(performance.now()-t0);});
        updateInfo();
    }

    function updateInfo() {
        const totalOps=benchMarks.reduce((a,b)=>a+b.ops,0);
        const totalMs=benchMarks.reduce((a,b)=>a+b.ms,0);
        const info=document.getElementById(id+'_bench_info');
        if(info) info.innerHTML='Math: <b style="color:'+C.accent+'">'+(totalOps/totalMs).toFixed(0)+' ops/ms</b> Â· DOM: <b style="color:'+C.green+'">'+(1000/domMs).toFixed(0)+' c/ms</b> Â· Canvas: <b style="color:'+C.orange+'">'+(2000/canvasMs).toFixed(0)+' r/ms</b> Â· JSON: <b style="color:'+C.purple+'">'+(5000/jsonMs).toFixed(1)+' o/ms</b>';
        const cdnInfo=document.getElementById(id+'_cdn_info');
        const perf=window.performance;
        const nav=perf.getEntriesByType&&perf.getEntriesByType('navigation')[0];
        if(nav&&cdnInfo) cdnInfo.innerHTML='DNS: <b style="color:'+C.cyan+'">'+(nav.domainLookupEnd-nav.domainLookupStart).toFixed(1)+'ms</b> Â· TLS: <b style="color:'+C.purple+'">'+(nav.connectEnd-(nav.secureConnectionStart||nav.connectStart)).toFixed(1)+'ms</b> Â· TTFB: <b style="color:'+C.green+'">'+(nav.responseStart-nav.requestStart).toFixed(1)+'ms</b> Â· Load: <b style="color:'+C.accent+'">'+(nav.loadEventEnd-nav.startTime).toFixed(0)+'ms</b>';
        else if(cdnInfo) cdnInfo.innerHTML='CDN: <b style="color:'+C.cyan+'">simulated 6-layer model</b>';
        // Summary
        const summary=document.getElementById(id+'_summary');
        if(summary){
            const cores=navigator.hardwareConcurrency||'?';
            const mem=navigator.deviceMemory||'?';
            const conn=navigator.connection;
            const netType=conn?conn.effectiveType:'unknown';
            const downlink=conn?conn.downlink+'Mbps':'N/A';
            summary.innerHTML='<div style="font-weight:700;font-size:0.875rem;margin-bottom:8px;color:var(--cursor-text);">ðŸ“ˆ System Performance Summary</div><div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;"><div style="text-align:center;"><div style="font-size:1.25rem;font-weight:700;color:'+C.accent+';">'+(totalOps/totalMs).toFixed(0)+'</div><div style="font-size:0.625rem;color:'+C.text+';">ops/ms (math)</div></div><div style="text-align:center;"><div style="font-size:1.25rem;font-weight:700;color:'+C.green+';">'+cores+'</div><div style="font-size:0.625rem;color:'+C.text+';">CPU cores</div></div><div style="text-align:center;"><div style="font-size:1.25rem;font-weight:700;color:'+C.orange+';">'+mem+'GB</div><div style="font-size:0.625rem;color:'+C.text+';">device memory</div></div><div style="text-align:center;"><div style="font-size:1.25rem;font-weight:700;color:'+C.purple+';">'+netType+'</div><div style="font-size:0.625rem;color:'+C.text+';">network ('+downlink+')</div></div></div><div style="margin-top:8px;font-size:0.6875rem;color:'+C.text+';text-align:center;">DOM: '+(1000/domMs).toFixed(0)+' creates/ms Â· Canvas: '+(2000/canvasMs).toFixed(0)+' rects/ms Â· JSON: '+(5000/jsonMs).toFixed(1)+' ser/ms Â· Quantum ready âš›</div>';
        }
    }

    /* â”€â”€ Live CDN data (scrolling) â”€â”€ */
    const cdnLayers=['DNS','TLS','TCP','HTTP','Edge','Origin'];
    const cdnColors=[C.cyan,C.purple,C.green,C.accent,C.orange,C.red];
    const cdnData=cdnLayers.map((_,li)=>{
        const pts=[];for(let i=0;i<60;i++){const base=(li+1)*3;pts.push(Math.max(0.5,base+Math.random()*8-4+Math.sin(i*0.3)*2));}return pts;
    });
    function pushCdnSample(){
        cdnData.forEach((pts,li)=>{
            const base=(li+1)*3;const spike=Math.random()>0.92?15:0;
            pts.push(Math.max(0.5,base+Math.random()*8-4+spike+Math.sin(frame*0.05+li)*2));
            if(pts.length>80)pts.shift();
        });
    }

    /* â”€â”€ Live stacked layers â”€â”€ */
    const layerNames=['L1-Cache','L2-Worker','L3-Bridge','L4-CDN','L5-Origin'];
    const layerCol=[C.accent+'90',C.green+'90',C.orange+'90',C.purple+'90',C.red+'60'];
    const stackData=layerNames.map((_,li)=>{
        const pts=[];for(let i=0;i<60;i++)pts.push(5+Math.random()*15+li*4+Math.sin(i*0.2+li)*5);return pts;
    });
    function pushStackSample(){
        stackData.forEach((pts,li)=>{
            pts.push(5+Math.random()*15+li*4+Math.sin(frame*0.04+li)*5);
            if(pts.length>80)pts.shift();
        });
    }

    /* â”€â”€ Draw functions â”€â”€ */
    function drawBench(){
        const cv=document.getElementById(id+'_bench');if(!cv||!benchMarks)return;
        const ctx=cv.getContext('2d'),w=cv.width,h=cv.height;
        drawGrid(ctx,w,h);
        const pts=benchMarks.map(b=>b.ops/(b.ms||0.01));
        const max=Math.max(...pts);
        drawLine(ctx,pts,C.accent,w,h,max);
        // Animated dot on last point
        const pulse=Math.sin(frame*0.1)*0.3+0.7;
        const lx=w, ly=ptY(pts[pts.length-1],h,max);
        ctx.fillStyle=C.accent; ctx.globalAlpha=pulse; ctx.beginPath(); ctx.arc(lx-2,ly,4,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1;
        ctx.fillStyle=C.text;ctx.font='10px monospace';ctx.fillText('ops/ms',5,12);ctx.fillText('â†’ array size',w-60,h-3);
        drawCrosshair(ctx,id+'_bench',w,h);
    }

    function drawCdn(){
        const cv=document.getElementById(id+'_cdn');if(!cv)return;
        const ctx=cv.getContext('2d'),w=cv.width,h=cv.height;
        drawGrid(ctx,w,h);
        const maxV=Math.max(...cdnData.flat())*1.1;
        cdnData.forEach((pts,li)=>drawLine(ctx,pts,cdnColors[li],w,h,maxV));
        cdnLayers.forEach((l,i)=>{ctx.fillStyle=cdnColors[i];ctx.font='bold 8px monospace';ctx.fillText('â— '+l,5,14+i*12);});
        // Live dot
        const pulse=Math.sin(frame*0.15)*0.3+0.7;
        const liveEl=document.getElementById(id+'_live');
        if(liveEl) liveEl.style.opacity=pulse;
        drawCrosshair(ctx,id+'_cdn',w,h);
    }

    function drawCompute(){
        const cv=document.getElementById(id+'_compute');if(!cv||!computeValues.length)return;
        const ctx=cv.getContext('2d'),w=cv.width,h=cv.height;
        drawGrid(ctx,w,h);
        const max=Math.max(...computeValues)*1.2;
        const barW=w/(computeLabels.length*2);
        // Animated bars (grow in)
        const grow=Math.min(1,(frame-initFrame)/30);
        computeLabels.forEach((l,i)=>{
            const x=barW+(i*barW*2);
            const bh=(computeValues[i]/max)*(h-30)*grow;
            ctx.fillStyle=computeColors[i];ctx.fillRect(x,h-bh-5,barW*0.8,bh);
            ctx.fillStyle=computeColors[i]+'40';ctx.fillRect(x-2,h-bh-7,barW*0.8+4,bh+4);
            ctx.fillStyle=C.text;ctx.font='9px monospace';ctx.textAlign='center';
            ctx.fillText(l,x+barW*0.4,h-bh-10);
            if(grow>0.5) ctx.fillText(computeValues[i].toFixed(1),x+barW*0.4,h-bh+14);
            ctx.textAlign='start';
        });
        drawCrosshair(ctx,id+'_compute',w,h);
    }

    function drawLayers(){
        const cv=document.getElementById(id+'_layers');if(!cv)return;
        const ctx=cv.getContext('2d'),w=cv.width,h=cv.height;
        drawGrid(ctx,w,h);
        const N=stackData[0].length;
        for(let li=stackData.length-1;li>=0;li--){
            ctx.fillStyle=layerCol[li];ctx.beginPath();ctx.moveTo(0,h);
            for(let i=0;i<N;i++){
                let sum=0;for(let j=0;j<=li;j++)sum+=stackData[j][i];
                ctx.lineTo((i/(N-1))*w, h-(sum/120)*h*0.85);
            }
            ctx.lineTo(w,h);ctx.closePath();ctx.fill();
        }
        layerNames.forEach((l,i)=>{ctx.fillStyle=layerCol[i].replace('90','').replace('60','');ctx.font='bold 8px monospace';ctx.fillText('â–  '+l,w-80,12+i*11);});
        drawCrosshair(ctx,id+'_layers',w,h);
    }

    function drawPrefix(){
        const cv=document.getElementById(id+'_prefix');if(!cv||!prefixSpeeds.length)return;
        const ctx=cv.getContext('2d'),w=cv.width,h=cv.height;
        drawGrid(ctx,w,h);
        const pColors=[C.accent,C.orange,C.red,C.cyan,C.green,C.purple];
        const max=Math.max(...prefixSpeeds)*1.2;
        const barW=w/(prefixLangs.length*2);
        const grow=Math.min(1,(frame-initFrame)/30);
        prefixLangs.forEach((l,i)=>{
            const x=barW+(i*barW*2);
            const bh=(prefixSpeeds[i]/max)*(h-30)*grow;
            ctx.fillStyle=pColors[i];ctx.fillRect(x,h-bh-5,barW*0.8,bh);
            ctx.fillStyle=pColors[i]+'40';ctx.fillRect(x-2,h-bh-7,barW*0.8+4,bh+4);
            ctx.fillStyle=C.text;ctx.font='9px monospace';ctx.textAlign='center';
            ctx.fillText(l,x+barW*0.4,h-bh-10);
            if(grow>0.5) ctx.fillText(prefixSpeeds[i].toFixed(1),x+barW*0.4,h-bh+14);
            ctx.textAlign='start';
        });
        ctx.fillStyle=C.text;ctx.font='8px monospace';ctx.fillText('lines/ms',5,10);
        drawCrosshair(ctx,id+'_prefix',w,h);
    }

    /* â”€â”€ Main animation loop â”€â”€ */
    let initFrame = 0;
    function tick(){
        if(!document.getElementById(id)) return; // cleanup if cell removed
        if(!paused){
            frame++;
            if(frame % 3 === 0){ pushCdnSample(); pushStackSample(); }
            drawBench(); drawCdn(); drawCompute(); drawLayers(); drawPrefix();
        }
        rafId = requestAnimationFrame(tick);
    }

    /* â”€â”€ Init â”€â”€ */
    runBenchmarks();
    // Track mouse on all canvases
    [id+'_bench',id+'_cdn',id+'_compute',id+'_layers',id+'_prefix'].forEach(trackMouse);

    // Hover tooltips
    attachHover(id+'_bench',id+'_bench_tip',(mx)=>{
        if(!benchMarks)return null;
        const i=Math.round(mx*(benchMarks.length-1));
        const b=benchMarks[i]; if(!b)return null;
        return 'Size: <b>'+b.size+'</b> Â· Time: <b>'+b.ms.toFixed(2)+'ms</b> Â· <b style="color:'+C.accent+'">'+(b.ops/(b.ms||0.01)).toFixed(0)+' ops/ms</b>';
    });
    attachHover(id+'_cdn',id+'_cdn_tip',(mx)=>{
        const N=cdnData[0].length;const i=Math.round(mx*(N-1));
        return cdnLayers.map((l,li)=>'<span style="color:'+cdnColors[li]+'">'+l+': '+cdnData[li][Math.min(i,cdnData[li].length-1)].toFixed(1)+'ms</span>').join(' Â· ');
    });
    attachHover(id+'_compute',id+'_compute_tip',(mx)=>{
        const i=Math.round(mx*(computeLabels.length-1));
        if(!computeValues[i])return null;
        return '<b style="color:'+computeColors[i]+'">'+computeLabels[i]+'</b>: '+computeValues[i].toFixed(1)+' ops/ms';
    });
    attachHover(id+'_layers',id+'_layers_tip',(mx)=>{
        const N=stackData[0].length;const i=Math.round(mx*(N-1));
        return layerNames.map((l,li)=>'<span style="color:'+layerCol[li].replace('90','').replace('60','')+'">'+l+': '+stackData[li][Math.min(i,stackData[li].length-1)].toFixed(1)+'</span>').join(' Â· ');
    });
    attachHover(id+'_prefix',id+'_prefix_tip',(mx)=>{
        const i=Math.round(mx*(prefixLangs.length-1));
        if(!prefixSpeeds[i])return null;
        return '<b>'+prefixLangs[i]+'</b>: '+prefixSpeeds[i].toFixed(1)+' lines/ms';
    });

    // Re-run button
    document.getElementById(id+'_rerun')?.addEventListener('click',()=>{
        initFrame=frame; runBenchmarks();
    });
    // Pause button
    document.getElementById(id+'_pause')?.addEventListener('click',function(){
        paused=!paused;
        this.textContent=paused?'â–¶ Resume':'â¸ Pause';
        this.style.color=paused?'#f97583':'#7ee787';
        this.style.background=paused?'rgba(249,117,131,.1)':'rgba(126,231,135,.1)';
        const liveEl=document.getElementById(id+'_live');
        if(liveEl){liveEl.textContent=paused?'â¸ PAUSED':'â— LIVE';liveEl.style.color=paused?'#f97583':'#3fb950';}
    });

    initFrame = 0;
    tick();
})();
</` + `script>`;
            }

            displayOutput(cellId, result) {
                const outputElement = document.getElementById(`${cellId}-output`);

                if (result.type === 'text') {
                    outputElement.innerHTML = result.data
                        .map(line => `<div class="output-text">${line}</div>`)
                        .join('');
                } else if (result.type === 'html') {
                    outputElement.innerHTML = `<div class="output-html">${result.data}</div>`;
                    // Activate <script> tags (innerHTML doesn't execute them)
                    outputElement.querySelectorAll('script').forEach(oldScript => {
                        const newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        oldScript.replaceWith(newScript);
                    });
                } else if (result.type === 'mermaid') {
                    const mermaidId = `mermaid_${cellId}_${Date.now()}`;
                    outputElement.innerHTML = `<div class="mermaid-output" onclick="notebook.expandCellOutput('${cellId}')" title="Click to expand diagram"><div class="mermaid" id="${mermaidId}">${result.data}</div></div>`;
                    try {
                        if (window.mermaid) {
                            window.mermaid.run({ nodes: [document.getElementById(mermaidId)] });
                        }
                    } catch (e) {
                        outputElement.innerHTML = `<div class="output-error">Mermaid render error: ${e.message}</div>`;
                    }
                } else if (result.type === 'plot') {
                    outputElement.innerHTML = `<img src="${result.data}" class="output-plot" alt="Plot output">`;
                }
            }

            displayError(cellId, message) {
                const outputElement = document.getElementById(`${cellId}-output`);
                outputElement.innerHTML = `<div class="output-error">Error: ${message}</div>`;
            }

            markdownToHtml(markdown) {
                return markdown
                    .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                    .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                    .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/^- (.*$)/gm, '&bull; $1<br>')
                    .replace(/\n{2,}/g, '<br><br>')
                    .replace(/\n/g, '<br>');
            }

            /* ---------- Quantum Navigation ---------- */
            navigateQuantumSpace(direction, btnElement) {
                // Remove active from all, then mark the clicked button
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                if (btnElement) btnElement.classList.add('active');

                // Sync 3D cube face highlight
                document.querySelectorAll('.nav-cube-face span.ncf-active').forEach(s => s.classList.remove('ncf-active'));
                const cubeCell = document.querySelector(`.nav-cube-face span[data-nav="${direction}"]`);
                if (cubeCell) cubeCell.classList.add('ncf-active');

                switch (direction) {
                    case '+1': this.quantumPosition[1] += 1; break;
                    case '-1': this.quantumPosition[1] -= 1; break;
                    case '+0': this.quantumPosition[0] += 1; break;
                    case '-0': this.quantumPosition[0] -= 1; break;
                    case '+n': this.quantumPosition[2] += 1; break;
                    case '-n': this.quantumPosition[2] -= 1; break;
                    case '+2': this.quantumPosition[1] += 2; break;
                    case '0':  /* no-op: neutral */ break;
                    case '\u269B': // âš› reset
                        this.quantumPosition = [0, 0, 0];
                        this._logStream('reset â†’ origin', '[0, 0, 0]', 'origin');
                        break;
                }

                const dirLabel = direction === '\u269B' ? 'âˆž reset' : direction;
                this.updateQuantumPosition(`nav ${dirLabel}`);
            }

            updateQuantumPosition(logAction) {
                const [x, y, z] = this.quantumPosition;
                document.getElementById('position-display').textContent = `[${x}, ${y}, ${z}]`;
                document.getElementById('layer-value').textContent = z;

                // Center button: âˆž at layer 0, âœ± at other layers (compute mode)
                const centerBtns = [document.getElementById('nav-center-btn')];
                centerBtns.forEach(centerBtn => {
                    if (!centerBtn) return;
                    if (z === 0 && x === 0 && y === 0) {
                        centerBtn.textContent = 'âˆž';
                        centerBtn.title = 'Origin â€” infinite state';
                    } else {
                        centerBtn.textContent = 'âœ±';
                        centerBtn.title = `Compute at [${x}, ${y}, ${z}] â€” click to reset`;
                    }
                });

                // Version the nav grid labels based on current layer (like Electron app)
                const baseSymbols = [
                    { dir: '+1', base: '+1' },
                    { dir: '0',  base: '0' },
                    { dir: '-1', base: '-1' },
                    { dir: '+n', base: '+n' },
                    { dir: '-n', base: '-n' },
                    { dir: '+0', base: '+0' },
                    { dir: '-0', base: '-0' },
                    { dir: '+2', base: '+2' },
                ];
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    const dir = btn.dataset.direction;
                    if (dir === 'âš›') return; // center handled above
                    const sym = baseSymbols.find(s => s.dir === dir);
                    if (!sym) return;
                    if (z === 0) {
                        btn.textContent = sym.base;
                    } else {
                        btn.textContent = `${sym.base}:${z}`;
                    }
                });

                // Log to stream history
                if (logAction) {
                    this._logStream(logAction, `[${x}, ${y}, ${z}]`);
                }
            }

            /* ---------- Stream History ---------- */
            _streamHistory = [];

            _logStream(action, detail, type = 'nav') {
                const now = new Date();
                const ts = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
                const entry = { action, detail, type, ts, position: [...this.quantumPosition] };
                this._streamHistory.push(entry);

                // Keep max 100 entries
                if (this._streamHistory.length > 100) this._streamHistory.shift();

                const log = document.getElementById('stream-log');
                if (!log) return;

                const icons = {
                    nav: 'â†’',
                    origin: 'âˆž',
                    exec: 'â–¶',
                    paste: 'ðŸ“‹',
                    pipe: 'â‡Œ',
                    layer: 'â—†',
                };

                const div = document.createElement('div');
                div.className = `stream-entry stream-${type}`;
                div.innerHTML = `<span class="stream-ts">${ts}</span>${icons[type] || 'Â·'} ${action} <span style="opacity:0.5">${detail}</span>`;
                div.title = `Click to jump to ${JSON.stringify(entry.position)}`;
                div.style.cursor = 'pointer';
                div.addEventListener('click', () => {
                    this.quantumPosition = [...entry.position];
                    this.updateQuantumPosition('jump');
                });

                log.appendChild(div);
                log.scrollTop = log.scrollHeight;
            }

            /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               FREYA UNITS â€” PRECISION CONVERTER CELL
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

            _runFreyaCell(cell) {
                const uid = `freya_${cell.id}_${Date.now()}`;
                return `
<div id="${uid}" style="padding:16px;background:var(--cursor-bg);border-radius:var(--cursor-radius-md);font-family:var(--cursor-font-mono);font-size:0.8125rem;">
    <div style="text-align:center;margin-bottom:14px;">
        <span style="font-size:1.25rem;font-weight:700;background:linear-gradient(135deg,#7c3aed,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">ðŸ”¬ FreyaUnits â€” Precision Converter</span>
        <div style="color:var(--cursor-text-muted);font-size:0.6875rem;margin-top:4px;">Planck Length (1.616Ã—10â»Â³âµ m) â†’ Parsec (3.086Ã—10Â¹â¶ m) â€” 27 units</div>
    </div>

    <!-- Converter UI -->
    <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:end;margin-bottom:14px;">
        <div>
            <label style="font-size:0.625rem;color:#a78bfa;display:block;margin-bottom:3px;">FROM</label>
            <input type="number" id="${uid}_val" value="1" step="any" style="width:100%;padding:8px;background:var(--cursor-bg-secondary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);color:var(--cursor-text);font-family:inherit;font-size:0.875rem;">
            <select id="${uid}_from" style="width:100%;padding:6px;margin-top:4px;background:var(--cursor-bg-secondary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);color:var(--cursor-text);font-family:inherit;font-size:0.75rem;"></select>
        </div>
        <div style="text-align:center;padding-bottom:14px;">
            <button id="${uid}_swap" style="background:none;border:1px solid var(--cursor-border);border-radius:50%;width:32px;height:32px;cursor:pointer;color:#06b6d4;font-size:1rem;line-height:32px;">â‡„</button>
        </div>
        <div>
            <label style="font-size:0.625rem;color:#06b6d4;display:block;margin-bottom:3px;">TO</label>
            <div id="${uid}_result" style="padding:8px;background:var(--cursor-bg-secondary);border:1px solid #7c3aed44;border-radius:var(--cursor-radius-sm);font-size:0.875rem;color:#c084fc;font-weight:700;min-height:36px;display:flex;align-items:center;">â€”</div>
            <select id="${uid}_to" style="width:100%;padding:6px;margin-top:4px;background:var(--cursor-bg-secondary);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-sm);color:var(--cursor-text);font-family:inherit;font-size:0.75rem;"></select>
        </div>
    </div>

    <!-- Quick convert buttons -->
    <div id="${uid}_quick" style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:14px;justify-content:center;"></div>

    <!-- Scale visualization -->
    <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:12px;margin-bottom:12px;">
        <div style="font-weight:700;margin-bottom:8px;color:#a78bfa;font-size:0.75rem;">ðŸ“ Logarithmic Scale Position</div>
        <canvas id="${uid}_scale" width="600" height="60" style="width:100%;border-radius:4px;"></canvas>
    </div>

    <!-- Conversion table -->
    <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:12px;">
        <div style="font-weight:700;margin-bottom:8px;color:#06b6d4;font-size:0.75rem;">ðŸ“‹ Full Conversion Table</div>
        <div id="${uid}_table" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:4px;font-size:0.6875rem;max-height:240px;overflow-y:auto;"></div>
    </div>

    <!-- Quantum properties -->
    <div style="background:var(--cursor-bg-secondary);border-radius:var(--cursor-radius-md);padding:12px;margin-top:12px;">
        <div style="font-weight:700;margin-bottom:8px;color:#f0883e;font-size:0.75rem;">âš› Quantum & Wave Properties</div>
        <div id="${uid}_quantum" style="font-size:0.6875rem;color:var(--cursor-text-muted);"></div>
    </div>

    <div style="text-align:center;margin-top:10px;font-size:0.5625rem;color:var(--cursor-text-muted);">
        FreyaUnits â€” "A father's love, measured in infinite precision" â€” <span style="color:#a78bfa;">..luvuFREYAbot</span>
    </div>
</div>
<` + `script>
(function(){
    const id = '${uid}';
    const c = 299792458; // speed of light m/s
    const h = 6.62607015e-34; // Planck constant JÂ·s
    const units = [
        {sym:'â„“p',  name:'Planck Length',    m:1.616255e-35, cat:'quantum'},
        {sym:'am',  name:'Attometer',        m:1e-18,        cat:'quantum'},
        {sym:'fm',  name:'Femtometer',       m:1e-15,        cat:'nuclear'},
        {sym:'pm',  name:'Picometer',        m:1e-12,        cat:'atomic'},
        {sym:'Ã…',   name:'Angstrom',         m:1e-10,        cat:'atomic'},
        {sym:'nm',  name:'Nanometer',        m:1e-9,         cat:'molecular'},
        {sym:'Âµin', name:'Microinch',        m:2.54e-8,      cat:'precision'},
        {sym:'Âµm',  name:'Micrometer',       m:1e-6,         cat:'micro'},
        {sym:'Î»IR', name:'IR Wavelength',    m:10e-6,        cat:'wave'},
        {sym:'mil', name:'Mil (thou)',       m:2.54e-5,      cat:'precision'},
        {sym:'mm',  name:'Millimeter',       m:1e-3,         cat:'standard'},
        {sym:'cm',  name:'Centimeter',       m:1e-2,         cat:'standard'},
        {sym:'in',  name:'Inch',             m:0.0254,       cat:'standard'},
        {sym:'ft',  name:'Foot',             m:0.3048,       cat:'standard'},
        {sym:'yd',  name:'Yard',             m:0.9144,       cat:'standard'},
        {sym:'m',   name:'Meter',            m:1,            cat:'standard'},
        {sym:'Î»RF', name:'RF Wavelength',    m:1,            cat:'wave'},
        {sym:'Î»VHF',name:'VHF Wavelength',   m:3,            cat:'wave'},
        {sym:'Î»AM', name:'AM Wavelength',    m:300,          cat:'wave'},
        {sym:'km',  name:'Kilometer',        m:1e3,          cat:'large'},
        {sym:'mi',  name:'Mile',             m:1609.34,      cat:'large'},
        {sym:'NM',  name:'Nautical Mile',    m:1852,         cat:'large'},
        {sym:'Î»LF', name:'Long Wave',        m:3000,         cat:'wave'},
        {sym:'Î»ELF',name:'ELF Wavelength',   m:5e6,          cat:'wave'},
        {sym:'AU',  name:'Astronomical Unit',m:1.496e11,     cat:'astro'},
        {sym:'ly',  name:'Light Year',       m:9.461e15,     cat:'astro'},
        {sym:'pc',  name:'Parsec',           m:3.086e16,     cat:'astro'},
    ];

    const catColors = {quantum:'#8b5cf6',nuclear:'#6366f1',atomic:'#3b82f6',molecular:'#06b6d4',precision:'#a3a3a3',micro:'#eab308',wave:'#f97316',standard:'#ef4444',large:'#dc2626',astro:'#84cc16'};

    // Populate selects
    const fromSel = document.getElementById(id+'_from');
    const toSel = document.getElementById(id+'_to');
    units.forEach((u,i)=>{
        const o1 = new Option(u.sym+' â€” '+u.name, i);
        const o2 = new Option(u.sym+' â€” '+u.name, i);
        fromSel.add(o1); toSel.add(o2);
    });
    fromSel.value = 15; // meter
    toSel.value = 12;   // inch

    // Quick buttons
    const quickUnits = ['â„“p','nm','Âµm','mm','in','m','km','mi','AU','ly','pc'];
    const quickDiv = document.getElementById(id+'_quick');
    quickUnits.forEach(sym=>{
        const u = units.find(x=>x.sym===sym);
        if(!u) return;
        const btn = document.createElement('button');
        btn.textContent = sym;
        btn.title = u.name;
        btn.style.cssText = 'padding:3px 8px;border:1px solid var(--cursor-border);border-radius:4px;background:var(--cursor-bg-secondary);color:'+(catColors[u.cat]||'#888')+';font-family:inherit;font-size:0.6875rem;cursor:pointer;';
        btn.addEventListener('click',()=>{
            toSel.value = units.indexOf(u);
            convert();
        });
        quickDiv.appendChild(btn);
    });

    function fmt(val){
        if(val===0) return '0';
        const a=Math.abs(val);
        if(a>=1e12||a<1e-4) return val.toExponential(6);
        if(a>=1e6) return val.toLocaleString(undefined,{maximumFractionDigits:4});
        if(a>=1) return val.toLocaleString(undefined,{maximumFractionDigits:8});
        return val.toFixed(10).replace(/0+$/,'').replace(/\\.$/,'');
    }

    function convert(){
        const val = parseFloat(document.getElementById(id+'_val').value)||0;
        const fromU = units[fromSel.value];
        const toU = units[toSel.value];
        const meters = val * fromU.m;
        const result = meters / toU.m;
        document.getElementById(id+'_result').textContent = fmt(result)+' '+toU.sym;

        // Update table
        const tbl = document.getElementById(id+'_table');
        tbl.innerHTML = '';
        units.forEach(u=>{
            const v = meters / u.m;
            const div = document.createElement('div');
            div.style.cssText = 'padding:3px 6px;border-radius:3px;background:var(--cursor-bg);display:flex;justify-content:space-between;gap:8px;';
            const isActive = u.sym===toU.sym;
            div.innerHTML = '<span style="color:'+(catColors[u.cat]||'#888')+';">'+(isActive?'<b>â–º</b> ':'')+u.sym+'</span><span style="color:var(--cursor-text);'+(isActive?'font-weight:700;color:#c084fc;':'')+'">'+fmt(v)+'</span>';
            tbl.appendChild(div);
        });

        // Update quantum/wave properties
        const qDiv = document.getElementById(id+'_quantum');
        if(meters > 0){
            const freq = c / meters;
            const energy = h * freq;
            const eV = energy / 1.602176634e-19;
            const momentum = h / meters;
            const slowLight17 = meters / 17;
            qDiv.innerHTML =
                '<div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;">'+
                '<div><b style="color:#f0883e;">Frequency:</b> '+freq.toExponential(4)+' Hz</div>'+
                '<div><b style="color:#f0883e;">Energy:</b> '+energy.toExponential(4)+' J ('+eV.toExponential(4)+' eV)</div>'+
                '<div><b style="color:#f0883e;">Momentum:</b> '+momentum.toExponential(4)+' kgÂ·m/s</div>'+
                '<div><b style="color:#f0883e;">Period:</b> '+(1/freq).toExponential(4)+' s</div>'+
                '<div><b style="color:#06b6d4;">Slow light (17 m/s):</b> '+slowLight17.toExponential(4)+' s travel time</div>'+
                '<div><b style="color:#06b6d4;">Light travel time:</b> '+(meters/c).toExponential(4)+' s</div>'+
                '</div>';
        } else {
            qDiv.textContent = 'Enter a value to see quantum properties.';
        }

        // Draw scale
        drawScale(meters);
    }

    function drawScale(meters){
        const canvas = document.getElementById(id+'_scale');
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        ctx.fillStyle = '#0d1117'; ctx.fillRect(0,0,W,H);

        // Log scale: -35 (Planck) to +17 (Parsec)
        const minLog = -35, maxLog = 17;
        const range = maxLog - minLog;

        // Draw unit markers
        units.forEach(u=>{
            const log = Math.log10(u.m);
            const x = ((log - minLog) / range) * (W - 20) + 10;
            ctx.fillStyle = catColors[u.cat] || '#888';
            ctx.fillRect(x-1, 10, 2, H-20);
            ctx.font = '8px monospace';
            ctx.textAlign = 'center';
            ctx.fillText(u.sym, x, 8);
        });

        // Draw current position
        if(meters > 0){
            const log = Math.log10(meters);
            const x = ((log - minLog) / range) * (W - 20) + 10;
            ctx.fillStyle = '#c084fc';
            ctx.beginPath();
            ctx.moveTo(x, H-6); ctx.lineTo(x-5, H); ctx.lineTo(x+5, H);
            ctx.fill();
            ctx.fillStyle = '#c084fc';
            ctx.fillRect(x-1, 10, 3, H-16);
            // Glow
            ctx.fillStyle = 'rgba(192,132,252,0.15)';
            ctx.fillRect(x-8, 0, 16, H);
        }
    }

    // Events
    document.getElementById(id+'_val').addEventListener('input', convert);
    fromSel.addEventListener('change', convert);
    toSel.addEventListener('change', convert);
    document.getElementById(id+'_swap').addEventListener('click',()=>{
        const tmp = fromSel.value;
        fromSel.value = toSel.value;
        toSel.value = tmp;
        convert();
    });

    // Initial convert
    convert();
})();
<` + `/script>`;
            }

            /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               QUANTUM â€” VISUAL SLICE / CUBE / ORB CELL
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

            _runQuantumCell(cell) {
                const uid = `qviz_${cell.id}_${Date.now()}`;
                return `
<div id="${uid}" style="padding:0;background:#0a0e14;border-radius:var(--cursor-radius-md);overflow:hidden;font-family:ui-monospace,SFMono-Regular,'SF Mono',Menlo,monospace;">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 12px;background:#161b22;border-bottom:1px solid #21262d;">
        <span style="font-weight:700;color:#8b5cf6;font-size:0.8125rem;">ðŸŒŒ Quantum Visual â€” Slice / Cube / Orb</span>
        <span id="${uid}_live" style="font-size:0.5rem;color:#3fb950;">â— LIVE</span>
    </div>
    <div style="display:flex;gap:4px;padding:4px 12px;background:#161b22;border-bottom:1px solid #21262d;font-size:0.625rem;align-items:center;flex-wrap:wrap;">
        <button id="${uid}_m_slice" class="qv-btn" style="padding:2px 8px;border:1px solid #8b5cf6;border-radius:4px;background:rgba(139,92,246,.2);color:#c4b5fd;font-family:inherit;font-size:0.625rem;cursor:pointer;">ðŸ§Š Slice</button>
        <button id="${uid}_m_cube" class="qv-btn" style="padding:2px 8px;border:1px solid #30363d;border-radius:4px;background:#21262d;color:#c9d1d9;font-family:inherit;font-size:0.625rem;cursor:pointer;">ðŸŽ² Cube</button>
        <button id="${uid}_m_orb" class="qv-btn" style="padding:2px 8px;border:1px solid #30363d;border-radius:4px;background:#21262d;color:#c9d1d9;font-family:inherit;font-size:0.625rem;cursor:pointer;">ðŸ”® Orb</button>
        <span style="flex:1;"></span>
        <span style="color:#484f58;">X:<b style="color:#3fb950;" id="${uid}_px">0</b></span>
        <span style="color:#484f58;">Y:<b style="color:#58a6ff;" id="${uid}_py">0</b></span>
        <span style="color:#484f58;">Z:<b style="color:#d2a8ff;" id="${uid}_pz">0</b></span>
        <span style="color:#484f58;">Prefix:<b style="color:#c4b5fd;" id="${uid}_ppfx">âˆž</b></span>
    </div>
    <div style="position:relative;">
        <canvas id="${uid}_canvas" width="480" height="360" style="width:100%;display:block;cursor:crosshair;"></canvas>
        <div id="${uid}_tip" style="position:absolute;display:none;padding:3px 8px;background:#161b22ee;border:1px solid #30363d;border-radius:4px;font-size:0.5rem;color:#fff;pointer-events:none;white-space:nowrap;z-index:5;"></div>
    </div>
    <div style="display:flex;gap:4px;padding:6px 12px;background:#161b22;border-top:1px solid #21262d;align-items:center;flex-wrap:wrap;">
        <button id="${uid}_nav_xn" style="padding:1px 6px;border:1px solid #30363d;border-radius:3px;background:#21262d;color:#3fb950;font-family:inherit;font-size:0.5625rem;cursor:pointer;">-X</button>
        <button id="${uid}_nav_xp" style="padding:1px 6px;border:1px solid #30363d;border-radius:3px;background:#21262d;color:#3fb950;font-family:inherit;font-size:0.5625rem;cursor:pointer;">+X</button>
        <button id="${uid}_nav_yn" style="padding:1px 6px;border:1px solid #30363d;border-radius:3px;background:#21262d;color:#58a6ff;font-family:inherit;font-size:0.5625rem;cursor:pointer;">-Y</button>
        <button id="${uid}_nav_yp" style="padding:1px 6px;border:1px solid #30363d;border-radius:3px;background:#21262d;color:#58a6ff;font-family:inherit;font-size:0.5625rem;cursor:pointer;">+Y</button>
        <button id="${uid}_nav_zn" style="padding:1px 6px;border:1px solid #30363d;border-radius:3px;background:#21262d;color:#d2a8ff;font-family:inherit;font-size:0.5625rem;cursor:pointer;">-Z</button>
        <button id="${uid}_nav_zp" style="padding:1px 6px;border:1px solid #30363d;border-radius:3px;background:#21262d;color:#d2a8ff;font-family:inherit;font-size:0.5625rem;cursor:pointer;">+Z</button>
        <button id="${uid}_reset" style="padding:1px 6px;border:1px solid #30363d;border-radius:3px;background:#21262d;color:#8b949e;font-family:inherit;font-size:0.5625rem;cursor:pointer;">âŠ™ Reset</button>
        <span style="flex:1;"></span>
        <span style="font-size:0.5rem;color:#484f58;" id="${uid}_info">Frame 0 Â· 9Ã—9 grid Â· Z-Layer 0</span>
    </div>
</div>
<` + `script>
(function(){
    const id = '${uid}';
    const cv = document.getElementById(id+'_canvas');
    if (!cv) return;
    const ctx = cv.getContext('2d');
    const W = cv.width, H = cv.height;

    let mode = 'slice', frame = 0, paused = false;
    let pos = [0, 0, 0]; // x, y, z
    let dragState = null, cubeRotX = -25, cubeRotY = 35;
    let mouseX = -1, mouseY = -1;

    const prefixes = ['+1','1','-1','+0','0','-0','+n','n','-n'];
    const colors = ['#3fb950','#58a6ff','#bc8cff','#f0883e','#8b949e','#f85149','#d2a8ff','#79c0ff','#e3b341'];

    function hexRgba(hex, a) {
        return 'rgba('+parseInt(hex.slice(1,3),16)+','+parseInt(hex.slice(3,5),16)+','+parseInt(hex.slice(5,7),16)+','+a+')';
    }

    function updatePos() {
        const el = (s,v) => { const e = document.getElementById(s); if(e) e.textContent = v; };
        el(id+'_px', pos[0]); el(id+'_py', pos[1]); el(id+'_pz', pos[2]);
        const pIdx = (Math.abs(pos[0]) + Math.abs(pos[1]) * 3 + Math.abs(pos[2])) % 9;
        el(id+'_ppfx', prefixes[pIdx]);
    }

    /* â”€â”€ SLICE â”€â”€ */
    function drawSlice() {
        const t = frame, p = pos;
        const layer = Math.abs(p[2]) % 6;
        ctx.fillStyle = '#0a0e14'; ctx.fillRect(0, 0, W, H);
        const grid = 9, cellW = W / grid, cellH = H / grid;
        for (let r = 0; r < grid; r++) {
            for (let c = 0; c < grid; c++) {
                const x = c * cellW, y = r * cellH;
                const heat = Math.sin(t * 0.02 + c * 0.8 + r * 0.6 + layer * 1.3) * 0.5 + 0.5;
                const active = (c === Math.abs(p[0]) % grid && r === Math.abs(p[1]) % grid);
                const baseColor = colors[c % colors.length];
                const alpha = 0.15 + heat * 0.35 + (active ? 0.35 : 0);
                ctx.fillStyle = active ? 'rgba(139,92,246,' + (0.5 + Math.sin(t * 0.08) * 0.2) + ')' : hexRgba(baseColor, alpha);
                ctx.fillRect(x + 1, y + 1, cellW - 2, cellH - 2);
                ctx.strokeStyle = active ? 'rgba(139,92,246,0.8)' : 'rgba(255,255,255,' + (0.05 + heat * 0.08) + ')';
                ctx.lineWidth = active ? 2 : 0.5;
                ctx.strokeRect(x + 1, y + 1, cellW - 2, cellH - 2);
                if (active) {
                    const grd = ctx.createRadialGradient(x+cellW/2, y+cellH/2, 0, x+cellW/2, y+cellH/2, cellW*0.6);
                    grd.addColorStop(0, 'rgba(139,92,246,0.3)'); grd.addColorStop(1, 'rgba(139,92,246,0)');
                    ctx.fillStyle = grd; ctx.fillRect(x, y, cellW, cellH);
                }
                if (heat > 0.6) {
                    const dotX = x + cellW * (0.2 + Math.sin(t * 0.03 + c) * 0.3 + 0.3);
                    const dotY = y + cellH * (0.2 + Math.cos(t * 0.025 + r) * 0.3 + 0.3);
                    ctx.beginPath(); ctx.arc(dotX, dotY, 2 + heat * 2, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255,255,255,' + heat * 0.6 + ')'; ctx.fill();
                }
            }
        }
        ctx.font = 'bold 11px monospace'; ctx.textAlign = 'center';
        for (let c = 0; c < grid; c++) { ctx.fillStyle = colors[c]; ctx.fillText(prefixes[c], c * cellW + cellW / 2, 14); }
        ctx.textAlign = 'start';
        // Crosshair
        const cx = (Math.abs(p[0]) % grid) * cellW + cellW / 2;
        const cy = (Math.abs(p[1]) % grid) * cellH + cellH / 2;
        ctx.setLineDash([4,4]); ctx.strokeStyle = 'rgba(139,92,246,' + (0.3 + Math.sin(t * 0.06) * 0.15) + ')'; ctx.lineWidth = 1;
        ctx.beginPath(); ctx.moveTo(cx, 0); ctx.lineTo(cx, H); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0, cy); ctx.lineTo(W, cy); ctx.stroke();
        ctx.setLineDash([]);
        // Mouse hover highlight
        if (mouseX >= 0 && mouseY >= 0) {
            const hc = Math.floor(mouseX / cellW), hr = Math.floor(mouseY / cellH);
            if (hc >= 0 && hc < grid && hr >= 0 && hr < grid) {
                ctx.strokeStyle = 'rgba(255,255,255,0.4)'; ctx.lineWidth = 1.5;
                ctx.strokeRect(hc * cellW + 1, hr * cellH + 1, cellW - 2, cellH - 2);
                const tip = document.getElementById(id + '_tip');
                if (tip) {
                    tip.style.display = 'block';
                    tip.style.left = (mouseX + 12) + 'px'; tip.style.top = (mouseY - 8) + 'px';
                    tip.innerHTML = '<b style="color:' + colors[hc % 9] + '">' + prefixes[hc % 9] + '</b> [' + hc + ',' + hr + ',' + p[2] + ']';
                }
            }
        }
        ctx.fillStyle = 'rgba(255,255,255,0.4)'; ctx.font = '9px monospace';
        ctx.fillText('Z-Layer ' + p[2] + '  |  Slice 9x9  |  Click to navigate', 6, H - 6);
    }

    /* â”€â”€ ORB â”€â”€ */
    function drawOrb() {
        const t = frame, p = pos;
        ctx.fillStyle = '#0a0e14'; ctx.fillRect(0, 0, W, H);
        const cx = W / 2, cy = H / 2, maxR = Math.min(W, H) * 0.42;
        for (let ring = 3; ring >= 0; ring--) {
            const r = maxR * (0.4 + ring * 0.2);
            const pulse = Math.sin(t * 0.02 + ring * 1.5) * 0.1 + 0.9;
            ctx.beginPath(); ctx.arc(cx, cy, r * pulse, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(139,92,246,' + (0.06 + ring * 0.04) + ')'; ctx.lineWidth = 1; ctx.stroke();
            ctx.beginPath(); ctx.ellipse(cx, cy, r * pulse, r * pulse * 0.35, t * 0.003 + ring, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(88,166,255,' + (0.05 + ring * 0.03) + ')'; ctx.stroke();
        }
        for (let i = 0; i < 120; i++) {
            const angle = (Math.PI * 2 / 120) * i + t * 0.008;
            const phi = Math.sin(t * 0.01 + i * 0.5) * Math.PI * 0.8;
            const rDist = maxR * (0.2 + Math.abs(Math.sin(i * 1.618 + t * 0.005)) * 0.75);
            const px = cx + Math.cos(angle) * rDist * Math.cos(phi);
            const py = cy + Math.sin(angle) * rDist * 0.6 + Math.sin(phi) * rDist * 0.3;
            const pIdx = i % 9;
            const sz = 1.5 + Math.sin(t * 0.015 + i) * 1;
            const bright = 0.2 + Math.abs(Math.sin(t * 0.01 + i * 0.7)) * 0.6;
            ctx.beginPath(); ctx.arc(px, py, sz, 0, Math.PI * 2);
            ctx.fillStyle = hexRgba(colors[pIdx], bright); ctx.fill();
        }
        // Position indicator
        const posAngle = (pos[0] * 0.5 + pos[1] * 0.3);
        const posR = maxR * 0.5;
        const posx = cx + Math.cos(posAngle) * posR;
        const posy = cy + Math.sin(posAngle) * posR * 0.6;
        const pp = Math.sin(t * 0.08) * 0.3 + 0.7;
        ctx.beginPath(); ctx.arc(posx, posy, 6, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(139,92,246,' + pp + ')'; ctx.fill();
        ctx.strokeStyle = 'rgba(139,92,246,0.9)'; ctx.lineWidth = 2; ctx.stroke();
        ctx.fillStyle = '#fff'; ctx.font = 'bold 6px monospace'; ctx.textAlign = 'center';
        ctx.fillText(prefixes[(Math.abs(pos[0]) + Math.abs(pos[1]) * 3) % 9], posx, posy + 2.5);
        ctx.textAlign = 'start';
        ctx.fillStyle = 'rgba(255,255,255,0.3)'; ctx.font = '9px monospace';
        ctx.fillText('Quantum Orb  |  120 particles  |  Drag to navigate', 6, H - 6);
    }

    /* â”€â”€ CUBE (flat 3D projection) â”€â”€ */
    function drawCube() {
        const t = frame, p = pos;
        ctx.fillStyle = '#0a0e14'; ctx.fillRect(0, 0, W, H);
        const cxc = W / 2, cyc = H / 2;
        const size = 3, gap = 42;
        const cosX = Math.cos(cubeRotX * Math.PI / 180), sinX = Math.sin(cubeRotX * Math.PI / 180);
        const cosY = Math.cos(cubeRotY * Math.PI / 180), sinY = Math.sin(cubeRotY * Math.PI / 180);
        function proj(x, y, z) {
            const ry = x * cosY + z * sinY;
            const rz = -x * sinY + z * cosY;
            const fy = y * cosX - rz * sinX;
            const fz = y * sinX + rz * cosX;
            const scale = 300 / (300 + fz);
            return { sx: cxc + ry * scale, sy: cyc + fy * scale, z: fz, scale: scale };
        }
        // Collect cubelets and sort by z for painter's algorithm
        const cells = [];
        for (let z = 0; z < size; z++) for (let y = 0; y < size; y++) for (let x = 0; x < size; x++) {
            const tx = (x - 1) * gap, ty = (y - 1) * gap, tz = (z - 1) * gap;
            const pr = proj(tx, ty, tz);
            const active = (Math.abs(p[0]) % 3 === x && Math.abs(p[1]) % 3 === y && Math.abs(p[2]) % 3 === z);
            const idx = (x + y * 3 + z) % 9;
            cells.push({ pr, active, idx, x, y, z });
        }
        cells.sort((a, b) => b.pr.z - a.pr.z);
        cells.forEach(c => {
            const sz = gap * 0.7 * c.pr.scale;
            const sx = c.pr.sx - sz / 2, sy = c.pr.sy - sz / 2;
            ctx.fillStyle = c.active ? 'rgba(139,92,246,' + (0.5 + Math.sin(t * 0.08) * 0.2) + ')' : hexRgba(colors[c.idx], 0.35 + c.pr.scale * 0.15);
            ctx.fillRect(sx, sy, sz, sz);
            ctx.strokeStyle = c.active ? 'rgba(139,92,246,0.9)' : hexRgba(colors[c.idx], 0.2 + c.pr.scale * 0.1);
            ctx.lineWidth = c.active ? 2 : 0.5;
            ctx.strokeRect(sx, sy, sz, sz);
            ctx.fillStyle = c.active ? '#fff' : 'rgba(255,255,255,' + (0.3 + c.pr.scale * 0.3) + ')';
            ctx.font = 'bold ' + Math.max(7, sz * 0.28) + 'px monospace'; ctx.textAlign = 'center';
            ctx.fillText(prefixes[c.idx], c.pr.sx, c.pr.sy + sz * 0.1);
            ctx.textAlign = 'start';
        });
        cubeRotY += 0.3;
        ctx.fillStyle = 'rgba(255,255,255,0.3)'; ctx.font = '9px monospace';
        ctx.fillText('3D Cube  |  27 cubelets  |  Drag to rotate', 6, H - 6);
    }

    /* â”€â”€ Animation loop â”€â”€ */
    function tick() {
        if (!document.getElementById(id)) return;
        if (!paused) {
            frame++;
            if (mode === 'slice') drawSlice();
            else if (mode === 'orb') drawOrb();
            else if (mode === 'cube') drawCube();
            const info = document.getElementById(id + '_info');
            if (info) info.textContent = 'Frame ' + frame + ' Â· ' + mode + ' Â· Z-Layer ' + pos[2];
        }
        requestAnimationFrame(tick);
    }

    /* â”€â”€ Mode switching â”€â”€ */
    ['slice','cube','orb'].forEach(m => {
        const btn = document.getElementById(id + '_m_' + m);
        if (btn) btn.addEventListener('click', () => {
            mode = m;
            document.querySelectorAll('#' + id + ' .qv-btn').forEach(b => {
                b.style.border = '1px solid #30363d'; b.style.background = '#21262d';
            });
            btn.style.border = '1px solid #8b5cf6'; btn.style.background = 'rgba(139,92,246,.2)';
        });
    });

    /* â”€â”€ Navigation buttons â”€â”€ */
    document.getElementById(id+'_nav_xp')?.addEventListener('click', () => { pos[0]++; updatePos(); });
    document.getElementById(id+'_nav_xn')?.addEventListener('click', () => { pos[0]--; updatePos(); });
    document.getElementById(id+'_nav_yp')?.addEventListener('click', () => { pos[1]++; updatePos(); });
    document.getElementById(id+'_nav_yn')?.addEventListener('click', () => { pos[1]--; updatePos(); });
    document.getElementById(id+'_nav_zp')?.addEventListener('click', () => { pos[2]++; updatePos(); });
    document.getElementById(id+'_nav_zn')?.addEventListener('click', () => { pos[2]--; updatePos(); });
    document.getElementById(id+'_reset')?.addEventListener('click', () => { pos = [0,0,0]; cubeRotX = -25; cubeRotY = 35; updatePos(); });

    /* â”€â”€ Canvas interaction: click to navigate, drag to rotate cube â”€â”€ */
    cv.addEventListener('click', e => {
        if (mode === 'slice') {
            const rect = cv.getBoundingClientRect();
            const mx = ((e.clientX - rect.left) / rect.width) * W;
            const my = ((e.clientY - rect.top) / rect.height) * H;
            pos[0] = Math.floor(mx / (W / 9));
            pos[1] = Math.floor(my / (H / 9));
            updatePos();
        }
    });
    cv.addEventListener('mousemove', e => {
        const rect = cv.getBoundingClientRect();
        mouseX = ((e.clientX - rect.left) / rect.width) * W;
        mouseY = ((e.clientY - rect.top) / rect.height) * H;
        if (mode === 'cube' && dragState) {
            cubeRotY = dragState.ry + (e.clientX - dragState.x) * 0.5;
            cubeRotX = dragState.rx + (e.clientY - dragState.y) * 0.5;
        }
    });
    cv.addEventListener('mouseleave', () => {
        mouseX = -1; mouseY = -1;
        const tip = document.getElementById(id + '_tip'); if (tip) tip.style.display = 'none';
    });
    cv.addEventListener('mousedown', e => {
        if (mode === 'cube') dragState = { x: e.clientX, y: e.clientY, rx: cubeRotX, ry: cubeRotY };
    });
    cv.addEventListener('mouseup', () => { dragState = null; });

    /* â”€â”€ Scroll for Z-layer â”€â”€ */
    cv.addEventListener('wheel', e => {
        e.preventDefault();
        pos[2] += e.deltaY > 0 ? -1 : 1;
        updatePos();
    }, { passive: false });

    updatePos();
    tick();
})();
<` + `/script>`;
            }

            /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               KBATCH â€” KEYBOARD PATTERN ANALYZER CELL
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

            _runKbatchCell(cell) {
                const uid = `kbatch_${cell.id}_${Date.now()}`;
                return `
<div id="${uid}" style="padding:0;background:#0d1117;border-radius:var(--cursor-radius-md);overflow:hidden;font-family:ui-monospace,SFMono-Regular,'SF Mono',Menlo,monospace;">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 12px;background:#161b22;border-bottom:1px solid #21262d;">
        <span style="font-weight:700;color:#f0883e;font-size:0.8125rem;">âŒ¨ kbatch â€” Keyboard Pattern Analyzer</span>
        <span style="font-size:0.5625rem;color:#484f58;">Type below â€” all panels update live</span>
    </div>
    <div style="display:flex;gap:8px;padding:4px 12px;background:#161b22;border-bottom:1px solid #21262d;font-size:0.625rem;flex-wrap:wrap;">
        <span>WPM: <b style="color:#58a6ff;" id="${uid}_wpm">0</b></span>
        <span>Eff: <b style="color:#7ee787;" id="${uid}_eff">0%</b></span>
        <span>Cpx: <b style="color:#f97583;" id="${uid}_cpx">0%</b></span>
        <span>Keys: <b style="color:#d2a8ff;" id="${uid}_keys">0</b></span>
        <span>Words: <b style="color:#c9d1d9;" id="${uid}_words">0</b></span>
        <span>Hapax: <b style="color:#e6b422;" id="${uid}_hapax">0</b></span>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;grid-template-rows:140px 140px;gap:1px;background:#21262d;">
        <div style="background:#0d1117;position:relative;"><div style="padding:2px 6px;font-size:0.5rem;color:#f0883e;background:#161b22;">ðŸ”¥ Thermal</div><canvas id="${uid}_thermal" style="width:100%;height:calc(100% - 16px);"></canvas></div>
        <div style="background:#0d1117;position:relative;"><div style="padding:2px 6px;font-size:0.5rem;color:#58a6ff;background:#161b22;">âœˆ Contrails</div><canvas id="${uid}_contrails" style="width:100%;height:calc(100% - 16px);"></canvas></div>
        <div style="background:#0d1117;position:relative;"><div style="padding:2px 6px;font-size:0.5rem;color:#d2a8ff;background:#161b22;">â¬¡ Geometric</div><canvas id="${uid}_geo" style="width:100%;height:calc(100% - 16px);"></canvas></div>
        <div style="background:#0d1117;position:relative;"><div style="padding:2px 6px;font-size:0.5rem;color:#7ee787;background:#161b22;">ðŸŽ¹ Language</div><canvas id="${uid}_lang" style="width:100%;height:calc(100% - 16px);"></canvas></div>
    </div>
    <div style="padding:6px 12px;background:#161b22;border-top:1px solid #21262d;">
        <input id="${uid}_input" type="text" placeholder="Start typing to analyze keyboard patterns..." autocomplete="off" spellcheck="false"
            style="width:100%;padding:8px 12px;background:#0d1117;border:1px solid #30363d;border-radius:6px;color:#c9d1d9;font-family:inherit;font-size:0.875rem;outline:none;">
    </div>
    <div style="padding:4px 12px 6px;font-size:0.5rem;color:#484f58;text-align:center;">
        kbatch â€” keyboard contrail/pattern analyzer | <a href="kbatch.html" target="_blank" style="color:#58a6ff;">Open Full Page</a>
    </div>
</div>
<` + `script>
(function(){
    const id = '${uid}';
    const ROWS = [['q','w','e','r','t','y','u','i','o','p'],['a','s','d','f','g','h','j','k','l',';'],['z','x','c','v','b','n','m',',','.','/']];
    const KP = {}; ROWS.forEach((r,ri) => r.forEach((k,ci) => { KP[k] = {x:ci+ri*0.25, y:ri}; })); KP[' '] = {x:4.5,y:3.2};
    const hm = {}, trans = []; let totalK = 0, totalD = 0, lastK = null, words = 0, wf = {}, buf = '';
    function tc(v){ const n=v/255; if(n<0.4) return 'rgb('+(n*2.5*80)+','+(120+n*2.5*100)+','+(180+n*75)+')'; if(n<0.7) return 'rgb('+(200+n*55)+','+(200-n*80)+',0)'; return 'rgb(255,'+(120-n*80)+','+(n*200)+')'; }
    function dir(dx,dy){ if(dx>0.3&&dy<-0.3) return 'â†—'; if(dx>0.3&&dy>0.3) return 'â†˜'; if(dx<-0.3&&dy<-0.3) return 'â†–'; if(dx<-0.3&&dy>0.3) return 'â†™'; if(dx>0.3) return 'â†’'; if(dx<-0.3) return 'â†'; if(dy<-0.3) return 'â†‘'; if(dy>0.3) return 'â†“'; return 'Â·'; }
    function pk(key){ const k=key.toLowerCase(); if(!KP[k]&&k!==' ') return; totalK++; hm[k]=(hm[k]||0)+1;
        if(lastK&&KP[k]&&KP[lastK]){ const f=KP[lastK],t=KP[k],dx=t.x-f.x,dy=t.y-f.y,d=Math.sqrt(dx*dx+dy*dy); totalD+=d; trans.push({from:lastK,to:k,dx,dy,dist:d}); if(trans.length>400) trans.shift(); }
        lastK=k; if(k===' '){ const w=buf.trim(); if(w){ words++; wf[w]=(wf[w]||0)+1; } buf=''; } else buf+=k; }
    function render(){
        // Thermal
        const ct=document.getElementById(id+'_thermal'); if(!ct) return; const cx=ct.getContext('2d'); ct.width=ct.clientWidth; ct.height=ct.clientHeight;
        const W=ct.width,H=ct.height; cx.fillStyle='#0d1117'; cx.fillRect(0,0,W,H);
        const mx=Math.max(1,...Object.values(hm)), kw=W/11.5, kh=H/4.2, pl=(W-10*kw)/2;
        ROWS.forEach((row,r)=>{ const off=r*0.4*kw; row.forEach((key,c)=>{ const x=pl+off+c*kw,y=4+r*(kh+3),cnt=hm[key]||0,int=cnt/mx;
            cx.fillStyle=cnt>0?tc(int*255):'#21262d'; cx.fillRect(x+1,y+1,kw-2,kh-2); cx.strokeStyle=cnt>0?'#f0883e33':'#30363d'; cx.lineWidth=0.5; cx.strokeRect(x+1,y+1,kw-2,kh-2);
            cx.fillStyle=int>0.5?'#0d1117':'#8b949e'; cx.font=Math.max(7,kh*0.32)+'px monospace'; cx.textAlign='center'; cx.fillText(key.toUpperCase(),x+kw/2,y+kh*0.55);
            if(cnt>0){ cx.fillStyle=int>0.5?'#0d1117':'#58a6ff'; cx.font=Math.max(6,kh*0.2)+'px monospace'; cx.fillText(cnt,x+kw/2,y+kh*0.82); } cx.textAlign='start'; }); });
        // Contrails
        const cc=document.getElementById(id+'_contrails'); if(!cc) return; const cx2=cc.getContext('2d'); cc.width=cc.clientWidth; cc.height=cc.clientHeight;
        const W2=cc.width,H2=cc.height; cx2.fillStyle='#0d1117'; cx2.fillRect(0,0,W2,H2);
        function kx(k){ const p=KP[k]; return p?(p.x/10)*(W2-20)+10:W2/2; } function ky(k){ const p=KP[k]; return p?(p.y/3.5)*(H2-20)+10:H2/2; }
        const ln=trans.length; for(let i=Math.max(0,ln-150);i<ln;i++){ const t=trans[i],a=(ln-i)/150,al=0.05+(1-a)*0.6;
            cx2.strokeStyle='rgba(240,136,62,'+al+')'; cx2.lineWidth=1+(1-a)*2; cx2.beginPath(); cx2.moveTo(kx(t.from),ky(t.from)); cx2.lineTo(kx(t.to),ky(t.to)); cx2.stroke(); }
        if(lastK&&KP[lastK]){ cx2.fillStyle='#f0883e'; cx2.beginPath(); cx2.arc(kx(lastK),ky(lastK),4,0,Math.PI*2); cx2.fill(); }
        // Geometric
        const cg=document.getElementById(id+'_geo'); if(!cg) return; const cx3=cg.getContext('2d'); cg.width=cg.clientWidth; cg.height=cg.clientHeight;
        const W3=cg.width,H3=cg.height; cx3.fillStyle='#0d1117'; cx3.fillRect(0,0,W3,H3);
        const cxc=W3/2,cyc=H3/2,rad=Math.min(W3,H3)*0.38; const allK=ROWS.flat(),n=allK.length;
        allK.forEach((key,i)=>{ const ang=(i/n)*Math.PI*2-Math.PI/2,cnt=hm[key]||0,int=cnt/mx,r2=rad*(0.6+int*0.4);
            const x=cxc+Math.cos(ang)*r2,y=cyc+Math.sin(ang)*r2; cx3.fillStyle=cnt>0?tc(int*255):'#30363d'; cx3.beginPath(); cx3.arc(x,y,2+int*5,0,Math.PI*2); cx3.fill();
            cx3.strokeStyle='rgba(210,168,255,'+(0.03+int*0.1)+')'; cx3.lineWidth=0.3; cx3.beginPath(); cx3.moveTo(cxc,cyc); cx3.lineTo(x,y); cx3.stroke(); });
        // Language
        const cl=document.getElementById(id+'_lang'); if(!cl) return; const cx4=cl.getContext('2d'); cl.width=cl.clientWidth; cl.height=cl.clientHeight;
        const W4=cl.width,H4=cl.height; cx4.fillStyle='#0d1117'; cx4.fillRect(0,0,W4,H4);
        const wds=Object.entries(wf).sort((a,b)=>b[1]-a[1]).slice(0,20); if(wds.length===0){ cx4.fillStyle='#484f58'; cx4.font='10px monospace'; cx4.textAlign='center'; cx4.fillText('Type words...',W4/2,H4/2); cx4.textAlign='start'; return; }
        const mf=Math.max(1,wds[0][1]),cols=Math.ceil(Math.sqrt(wds.length)),cw2=W4/(cols+1),ch2=H4/(Math.ceil(wds.length/cols)+1);
        wds.forEach(([w,f],i)=>{ const col=i%cols,row=Math.floor(i/cols),x=cw2*(col+0.5),y=ch2*(row+0.5),sz=Math.max(7,8+(f/mf)*8);
            cx4.fillStyle=f>1?'#7ee787':'#e6b422'; cx4.font=sz+'px monospace'; cx4.textAlign='center'; cx4.fillText(w,x,y);
            if(f>1){ cx4.fillStyle='#484f58'; cx4.font=Math.max(6,sz*0.5)+'px monospace'; cx4.fillText('x'+f,x,y-sz*0.5); } cx4.textAlign='start'; });
    }
    function stats(){ const el=(d,v)=>{ const e=document.getElementById(d); if(e) e.textContent=v; };
        const elapsed=(Date.now()-st)/1000, wpm=elapsed>0?(words/elapsed)*60:0, avgD=totalK>1?totalD/(totalK-1):0;
        const eff=avgD>0?Math.max(0,100-avgD*30):100, strain=Math.min(100,avgD*25);
        const rowCh=trans.filter(t=>Math.abs(t.dy)>0.3).length, cpx=trans.length>0?Math.min(100,(rowCh/trans.length)*150):0;
        const hpx=Object.values(wf).filter(c=>c===1).length;
        el(id+'_wpm',wpm.toFixed(1)); el(id+'_eff',eff.toFixed(0)+'%'); el(id+'_cpx',cpx.toFixed(0)+'%');
        el(id+'_keys',totalK); el(id+'_words',words); el(id+'_hapax',hpx);
    }
    const st=Date.now(); let timer=null;
    const inp=document.getElementById(id+'_input'); if(!inp) return;
    inp.addEventListener('input',()=>{ if(inp.value.length>0) pk(inp.value[inp.value.length-1]); clearTimeout(timer); timer=setTimeout(()=>{render();stats();},30); });
    inp.addEventListener('keydown',e=>{ e.stopPropagation(); if(e.key==='Enter'){ if(buf.trim()){words++;const w=buf.trim();wf[w]=(wf[w]||0)+1;buf='';} render();stats(); } });
    render();
})();
<` + `/script>`;
            }

            /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               HEXCAST â€” LIVE VIDEO HEX BROADCAST CELL
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

            _runHexcastCell(cell) {
                const uid = `hexcast_${cell.id}_${Date.now()}`;
                return `
<div id="${uid}" style="padding:0;background:#0d1117;border-radius:var(--cursor-radius-md);overflow:hidden;font-family:ui-monospace,SFMono-Regular,'SF Mono',Menlo,monospace;">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:6px 12px;background:#161b22;border-bottom:1px solid #21262d;">
        <span style="font-weight:700;color:#da3633;font-size:0.8125rem;">ðŸ“¡ hexcast â€” Live Video Hex Broadcast</span>
        <span id="${uid}_dot" style="width:8px;height:8px;border-radius:50%;background:#484f58;display:inline-block;"></span>
    </div>
    <div style="display:flex;gap:4px;padding:4px 12px;background:#161b22;border-bottom:1px solid #21262d;font-size:0.625rem;flex-wrap:wrap;align-items:center;">
        <button id="${uid}_cam" style="padding:2px 8px;border:1px solid #30363d;border-radius:4px;background:#da3633;color:#fff;font-family:inherit;font-size:0.625rem;cursor:pointer;">ðŸ“· Camera</button>
        <button id="${uid}_scr" style="padding:2px 8px;border:1px solid #30363d;border-radius:4px;background:#21262d;color:#c9d1d9;font-family:inherit;font-size:0.625rem;cursor:pointer;">ðŸ–µ Screen</button>
        <button id="${uid}_tst" style="padding:2px 8px;border:1px solid #30363d;border-radius:4px;background:#21262d;color:#c9d1d9;font-family:inherit;font-size:0.625rem;cursor:pointer;">â–¦ Test</button>
        <select id="${uid}_mode" style="padding:2px 6px;background:#0d1117;border:1px solid #30363d;border-radius:4px;color:#c9d1d9;font-family:inherit;font-size:0.625rem;">
            <option value="color">Color</option><option value="gray">Gray</option><option value="fax">Fax</option><option value="signal">Signal</option>
        </select>
        <span style="flex:1;"></span>
        <span>FPS: <b style="color:#58a6ff;" id="${uid}_fps">0</b></span>
        <span>Enc: <b style="color:#f0883e;" id="${uid}_enc">0ms</b></span>
        <span>Dec: <b style="color:#d2a8ff;" id="${uid}_dec">0ms</b></span>
        <span>RT: <b style="color:#7ee787;" id="${uid}_rt">0ms</b></span>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1px;background:#21262d;">
        <div style="background:#0d1117;position:relative;height:200px;">
            <div style="padding:2px 6px;font-size:0.5rem;color:#da3633;background:#161b22;">â—‰ Source</div>
            <video id="${uid}_video" autoplay muted playsinline style="width:100%;height:calc(100% - 16px);object-fit:cover;background:#000;display:none;"></video>
            <canvas id="${uid}_src" style="width:100%;height:calc(100% - 16px);display:none;"></canvas>
            <div id="${uid}_ph" style="position:absolute;inset:16px 0 0 0;display:flex;align-items:center;justify-content:center;color:#484f58;font-size:0.6875rem;">Click Camera, Screen, or Test</div>
        </div>
        <div style="background:#0d1117;position:relative;height:200px;">
            <div style="padding:2px 6px;font-size:0.5rem;color:#f0883e;background:#161b22;">â¬¡ Hex Stream</div>
            <canvas id="${uid}_hex" style="width:100%;height:calc(100% - 16px);"></canvas>
        </div>
    </div>
    <div style="position:relative;height:60px;background:#161b22;border-top:1px solid #21262d;">
        <div style="padding:2px 6px;font-size:0.5rem;color:#7ee787;">ðŸ“ˆ Latency</div>
        <canvas id="${uid}_lat" style="width:100%;height:calc(100% - 16px);"></canvas>
    </div>
    <div style="padding:4px 12px 6px;font-size:0.5rem;color:#484f58;text-align:center;">
        hexcast â€” live video hex broadcast + latency bench | <a href="hexcast.html" target="_blank" style="color:#58a6ff;">Open Full Page</a>
    </div>
</div>
<` + `script>
(function(){
    const id = '${uid}';
    const vid = document.getElementById(id+'_video');
    const cvSrc = document.getElementById(id+'_src');
    const cvHex = document.getElementById(id+'_hex');
    const cvLat = document.getElementById(id+'_lat');
    const ph = document.getElementById(id+'_ph');
    const dot = document.getElementById(id+'_dot');
    const ctxSrc = cvSrc.getContext('2d',{willReadFrequently:true});
    let stream=null, source='none', mode='color', res=48, animId=null, fc=0, startT=0, latHist=[];
    function tc(v,m){ const n=v/255; if(m==='gray'){const g=Math.floor(n*220);return 'rgb('+g+','+g+','+g+')';} if(m==='fax') return n>0.5?'#fff':'#000'; if(m==='signal'){const g=Math.floor(n*200);return 'rgb(0,'+g+','+Math.floor(g*0.3)+')';} const h=(1-n)*200; return 'hsl('+h+',85%,'+(20+n*50)+'%)'; }
    function stopSrc(){ if(stream){stream.getTracks().forEach(t=>t.stop());stream=null;} vid.srcObject=null;vid.style.display='none';cvSrc.style.display='none';source='none';dot.style.background='#484f58';if(animId)cancelAnimationFrame(animId); ph.style.display=''; }
    async function startCam(){ stopSrc(); try{ stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:320},height:{ideal:240}},audio:false}); vid.srcObject=stream;vid.style.display='block';ph.style.display='none';source='camera';dot.style.background='#da3633';startT=performance.now();fc=0;latHist=[];loop(); }catch(e){ph.textContent='Camera denied: '+e.message;} }
    async function startScr(){ stopSrc(); try{ stream=await navigator.mediaDevices.getDisplayMedia({video:true}); vid.srcObject=stream;vid.style.display='block';ph.style.display='none';source='screen';dot.style.background='#da3633';startT=performance.now();fc=0;latHist=[];stream.getVideoTracks()[0].onended=stopSrc;loop(); }catch(e){} }
    function startTest(){ stopSrc(); source='test';ph.style.display='none';cvSrc.style.display='block';dot.style.background='#da3633';startT=performance.now();fc=0;latHist=[];loop(); }
    let lastFT=0;
    function loop(now){ if(source==='none') return; const interval=1000/15; if(now-lastFT<interval){animId=requestAnimationFrame(loop);return;} lastFT=now;
        cvSrc.width=res;cvSrc.height=res;
        if(source==='test'){ const t=(performance.now()/50)%res; for(let y=0;y<res;y++) for(let x=0;x<res;x++){ const bi=Math.floor(x/(res/8)),cs=[[255,255,255],[255,255,0],[0,255,255],[0,255,0],[255,0,255],[255,0,0],[0,0,255],[0,0,0]],c=cs[bi]||[0,0,0]; const sd=Math.abs(y-t),sb=sd<2?1.4:1; ctxSrc.fillStyle='rgb('+Math.min(255,c[0]*sb)+','+Math.min(255,c[1]*sb)+','+Math.min(255,c[2]*sb)+')'; ctxSrc.fillRect(x,y,1,1); }
        } else if(vid.readyState>=vid.HAVE_CURRENT_DATA){ ctxSrc.drawImage(vid,0,0,res,res); } else { animId=requestAnimationFrame(loop); return; }
        const img=ctxSrc.getImageData(0,0,res,res); const t0=performance.now(); const hex=new Uint8Array(res*res);
        for(let i=0;i<res*res;i++){ const o=i*4,r=img.data[o],g=img.data[o+1],b=img.data[o+2]; hex[i]=Math.floor(0.299*r+0.587*g+0.114*b); }
        const encT=performance.now()-t0;
        const ctx=cvHex.getContext('2d'); cvHex.width=cvHex.clientWidth;cvHex.height=cvHex.clientHeight; const W=cvHex.width,H=cvHex.height; ctx.fillStyle='#0d1117'; ctx.fillRect(0,0,W,H);
        const t1=performance.now(); const cw=W/res,ch=H/res; const m=document.getElementById(id+'_mode').value;
        for(let r2=0;r2<res;r2++) for(let c=0;c<res;c++){ ctx.fillStyle=tc(hex[r2*res+c],m); ctx.fillRect(c*cw,r2*ch,cw-0.2,ch-0.2); }
        const decT=performance.now()-t1; const rt=encT+decT; fc++;
        latHist.push({enc:encT,dec:decT,rt:rt}); if(latHist.length>200) latHist.shift();
        const el=(d,v)=>{const e=document.getElementById(d);if(e)e.textContent=v;};
        const elapsed=(performance.now()-startT)/1000;
        el(id+'_fps',(elapsed>0?(fc/elapsed):0).toFixed(1)); el(id+'_enc',encT.toFixed(1)+'ms'); el(id+'_dec',decT.toFixed(1)+'ms'); el(id+'_rt',rt.toFixed(1)+'ms');
        // Latency chart
        const cl=cvLat.getContext('2d'); cvLat.width=cvLat.clientWidth; cvLat.height=cvLat.clientHeight;
        const LW=cvLat.width,LH=cvLat.height; cl.fillStyle='#161b22'; cl.fillRect(0,0,LW,LH);
        if(latHist.length>1){ const mx2=Math.max(1,...latHist.map(d=>d.rt)),xs=LW/(latHist.length-1);
            [{k:'enc',c:'#f0883e'},{k:'dec',c:'#d2a8ff'},{k:'rt',c:'#7ee787'}].forEach(s=>{ cl.strokeStyle=s.c; cl.lineWidth=1; cl.beginPath();
                latHist.forEach((d,i)=>{ const x=i*xs,y=LH-(d[s.k]/mx2)*LH*0.9; i===0?cl.moveTo(x,y):cl.lineTo(x,y); }); cl.stroke(); }); }
        animId=requestAnimationFrame(loop);
    }
    document.getElementById(id+'_cam').addEventListener('click',startCam);
    document.getElementById(id+'_scr').addEventListener('click',startScr);
    document.getElementById(id+'_tst').addEventListener('click',startTest);
})();
<` + `/script>`;
            }

            /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               SECURITY SCAN + GIT HOOKS (Phase 2)
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

            async _runSecurityScan() {
                this._showProgress('Security scan');
                this._logStream('security scan', 'scanning all cells', 'exec');
                const codeCells = this.cells.filter(c => c.type === 'code' || c.type === 'shell');
                const results = [];

                for (let i = 0; i < codeCells.length; i++) {
                    const cell = codeCells[i];
                    const content = document.getElementById(`${cell.id}-editor`)?.value || cell.content;
                    this._updateProgress(i + 1, codeCells.length, cell.id);

                    // Try bridge first
                    if (this.bridgeConnected && this.ws?.readyState === 1) {
                        try {
                            const resp = await fetch('http://localhost:8085/api/security/scan', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({ code: content, language: this.detectCellLanguage(cell) }),
                            });
                            const data = await resp.json();
                            if (data.total_findings > 0) results.push({ cell: cell.id, ...data });
                        } catch(e) { /* fallback below */ }
                    }

                    // Client-side fallback scan
                    if (!this.bridgeConnected) {
                        const findings = this._clientSecurityScan(content, this.detectCellLanguage(cell));
                        if (findings.length > 0) results.push({ cell: cell.id, findings, total_findings: findings.length });
                    }

                    await new Promise(r => setTimeout(r, 50));
                }

                this._hideProgress(800);

                // Display results
                const id = this.addCell('code', '# Security Scan Results');
                const total = results.reduce((s, r) => s + (r.total_findings || 0), 0);
                let output;
                if (total === 0) {
                    output = { type: 'text', data: ['âœ… Security scan passed â€” 0 findings across ' + codeCells.length + ' cells.'] };
                } else {
                    const lines = [`ðŸ›¡ Security Scan: ${total} finding(s) across ${results.length} cell(s)`, ''];
                    results.forEach(r => {
                        lines.push(`â”€â”€ Cell: ${r.cell}`);
                        (r.findings || []).forEach(f => {
                            const icon = f.severity === 'critical' ? 'ðŸ”´' : f.severity === 'high' ? 'ðŸŸ ' : f.severity === 'medium' ? 'ðŸŸ¡' : 'âšª';
                            lines.push(`  ${icon} [${f.severity}] L${f.line || '?'} ${f.prefix || ''} â€” ${f.description}`);
                            if (f.code) lines.push(`    â†’ ${f.code}`);
                        });
                        lines.push('');
                    });
                    output = { type: 'text', data: lines };
                }

                this.displayOutput(id, output);
                this._logStream('scan done', `${total} findings`, 'exec');
                requestAnimationFrame(() => {
                    const el = document.getElementById(id);
                    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            }

            _clientSecurityScan(code, language) {
                const rules = {
                    python: [
                        { pattern: /\bexec\s*\(/, severity: 'high', desc: 'Dynamic code execution (exec)' },
                        { pattern: /\beval\s*\(/, severity: 'high', desc: 'Dynamic code evaluation (eval)' },
                        { pattern: /os\.system\s*\(/, severity: 'high', desc: 'OS command execution' },
                        { pattern: /(password|secret|api_key|token)\s*=\s*['"][^'"]+['"]/, severity: 'critical', desc: 'Hardcoded secret' },
                        { pattern: /pickle\.loads?\s*\(/, severity: 'high', desc: 'Unsafe deserialization' },
                    ],
                    javascript: [
                        { pattern: /\beval\s*\(/, severity: 'high', desc: 'eval() â€” injection risk' },
                        { pattern: /innerHTML\s*=/, severity: 'medium', desc: 'innerHTML â€” XSS risk' },
                        { pattern: /(password|secret|api_key|token)\s*[:=]\s*['"][^'"]+['"]/, severity: 'critical', desc: 'Hardcoded secret' },
                    ],
                    shell: [
                        { pattern: /curl\s.*\|\s*(bash|sh)/, severity: 'critical', desc: 'Pipe-to-shell RCE' },
                        { pattern: /chmod\s+777/, severity: 'high', desc: 'World-writable perms' },
                        { pattern: /rm\s+-rf\s+\//, severity: 'critical', desc: 'Recursive root delete' },
                    ],
                };
                const ruleSet = rules[language] || rules.python;
                const findings = [];
                code.split('\n').forEach((line, i) => {
                    ruleSet.forEach(r => {
                        if (r.pattern.test(line)) {
                            findings.push({ line: i + 1, severity: r.severity, description: r.desc, code: line.trim().substring(0, 120) });
                        }
                    });
                });
                return findings;
            }

            async _installGitHook() {
                this._showProgress('Git hook install');
                this._logStream('git hook', 'installing pre-commit', 'exec');

                let result;
                if (this.bridgeConnected && this.ws?.readyState === 1) {
                    try {
                        const resp = await fetch('http://localhost:8085/api/git/hook/install', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({ repo: '.' }),
                        });
                        result = await resp.json();
                    } catch(e) {
                        result = { error: 'Bridge offline â€” cannot install hook remotely.' };
                    }
                } else {
                    result = { error: 'Bridge not connected. Start quantum_bridge_server.py first.' };
                }

                this._hideProgress(600);

                const id = this.addCell('code', '# Git Pre-Commit Hook');
                let output;
                if (result.installed) {
                    output = { type: 'text', data: [
                        'âœ… Quantum pre-commit hook installed!',
                        `   Path: ${result.path}`,
                        `   Size: ${result.size_bytes} bytes`,
                        '',
                        'The hook will:',
                        '  â€¢ Security-scan staged files via /api/security/scan',
                        '  â€¢ Block commits with risk score > 20',
                        '  â€¢ Check for beyondBINARY header on source files',
                        '',
                        'Bypass with: git commit --no-verify',
                    ]};
                    this._logStream('hook installed', result.path, 'exec');
                } else {
                    output = { type: 'text', data: ['âŒ ' + (result.error || 'Unknown error')] };
                    this._logStream('hook error', result.error || 'failed', 'exec');
                }

                this.displayOutput(id, output);
                requestAnimationFrame(() => {
                    const el = document.getElementById(id);
                    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            }

            /* ========== QUANTUM THERMAL VISUALIZATION ========== */
            _stopThermalViz() {
                if (this._thermalAnim) {
                    cancelAnimationFrame(this._thermalAnim);
                    this._thermalAnim = null;
                }
            }

            _initThermalViz() {
                if (this._thermalAnim) return; // already running
                const canvas = document.getElementById('thermal-canvas');
                if (!canvas) return;
                this._thermalCtx = canvas.getContext('2d');
                this._thermalFrame = 0;
                this._updateThermalStats();
                this._updateGpuQubitScaling();
                const tick = () => {
                    this._thermalFrame++;
                    this._drawThermalCanvas();
                    this._thermalAnim = requestAnimationFrame(tick);
                };
                tick();
            }

            _drawThermalCanvas() {
                const ctx = this._thermalCtx;
                if (!ctx) return;
                const W = ctx.canvas.width, H = ctx.canvas.height;
                const t = this._thermalFrame;

                // Background fade
                ctx.fillStyle = 'rgba(10,14,20,0.15)';
                ctx.fillRect(0, 0, W, H);

                if (this._thermalMode === 'lattice') {
                    this._drawLattice(ctx, W, H, t);
                } else if (this._thermalMode === 'flow') {
                    this._drawFlow(ctx, W, H, t);
                } else if (this._thermalMode === 'gpu') {
                    this._drawGpuVsQubit(ctx, W, H, t);
                }
            }

            /* --- Lattice: egg-crate optical lattice with Rydberg excitation --- */
            _drawLattice(ctx, W, H, t) {
                const grid = 8; // 8x8 visible slice of the Rubik multi-stack
                const spacing = W / (grid + 1);
                const layer = Math.abs(this.quantumPosition[2]) % 6;
                const qPos = this.quantumPosition;

                for (let r = 0; r < grid; r++) {
                    for (let c = 0; c < grid; c++) {
                        const x = spacing * (c + 1);
                        const y = spacing * (r + 1);

                        // Rydberg entanglement â€” atoms near the quantum position glow
                        const dx = (c - qPos[0] % grid + grid) % grid;
                        const dy = (r - qPos[1] % grid + grid) % grid;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        // Entanglement oscillation
                        const phase = Math.sin(t * 0.04 + r * 0.7 + c * 0.5 + layer) * 0.5 + 0.5;
                        const excited = dist < 2.5 && phase > 0.5;

                        // Thermal color: cryo-blue â†’ warm-green â†’ hot-red
                        const temp = excited ? 0.7 + phase * 0.3 : 0.05 + phase * 0.15;
                        const hue = (1 - temp) * 200; // 200=blue, 0=red
                        const alpha = 0.4 + phase * 0.6;
                        const radius = spacing * 0.18 * (excited ? 1.4 + Math.sin(t * 0.1) * 0.3 : 0.8);

                        // Entanglement lines
                        if (excited && r > 0 && c > 0) {
                            ctx.strokeStyle = `hsla(${hue}, 80%, 70%, ${alpha * 0.3})`;
                            ctx.lineWidth = 1;
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(x - spacing, y);
                            ctx.moveTo(x, y);
                            ctx.lineTo(x, y - spacing);
                            ctx.stroke();
                        }

                        // Atom
                        ctx.beginPath();
                        ctx.arc(x, y, radius, 0, Math.PI * 2);
                        const grad = ctx.createRadialGradient(x, y, 0, x, y, radius);
                        grad.addColorStop(0, `hsla(${hue}, 90%, 75%, ${alpha})`);
                        grad.addColorStop(1, `hsla(${hue}, 70%, 40%, 0)`);
                        ctx.fillStyle = grad;
                        ctx.fill();
                    }
                }

                // Layer label
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = '10px monospace';
                ctx.fillText(`Lattice Z=${qPos[2]}  Slice ${grid}x${grid}  ` +
                    `Spacing 0.5Âµm  Rydberg:${this._thermalQubits}q`, 6, H - 6);
            }

            /* --- Flow: live data heat-map of quantum prefix layers --- */
            _drawFlow(ctx, W, H, t) {
                const prefixes = ['+1','1','-1','+0','0','-0','+n','n','-n'];
                const cols = prefixes.length;
                const colW = W / cols;
                const rows = 32;
                const rowH = H / rows;

                for (let c = 0; c < cols; c++) {
                    for (let r = 0; r < rows; r++) {
                        const flow = Math.sin(t * 0.03 + c * 1.2 + r * 0.25) * 0.5 + 0.5;
                        const burst = Math.sin(t * 0.07 + c * 0.9) > 0.8 ? 0.3 : 0;
                        const val = Math.min(1, flow + burst);
                        const hue = (1 - val) * 200;
                        ctx.fillStyle = `hsla(${hue}, 85%, ${30 + val * 45}%, ${0.6 + val * 0.4})`;
                        ctx.fillRect(c * colW, r * rowH, colW - 1, rowH - 1);
                    }
                    // Prefix label
                    ctx.fillStyle = 'rgba(255,255,255,0.7)';
                    ctx.font = 'bold 9px monospace';
                    ctx.textAlign = 'center';
                    ctx.fillText(prefixes[c], c * colW + colW / 2, H - 4);
                }
                ctx.textAlign = 'start';

                // Flow title
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                ctx.font = '10px monospace';
                ctx.fillText('Data Flow â€” 9-prefix layers â€” live heat', 6, 12);
            }

            /* --- GPU vs Qubit: scaling comparison visualization --- */
            _drawGpuVsQubit(ctx, W, H, t) {
                const q = this._thermalQubits;
                ctx.clearRect(0, 0, W, H);
                ctx.fillStyle = '#0a0e14';
                ctx.fillRect(0, 0, W, H);

                // --- Left side: GPU tower ---
                const gpuCount = this._gpuForQubits(q);
                const maxBars = 20;
                const gpuBars = Math.min(maxBars, typeof gpuCount === 'number' ? Math.ceil(Math.log2(gpuCount + 1)) : maxBars);
                const barH = (H - 60) / maxBars;

                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = 'bold 11px monospace';
                ctx.fillText('NVIDIA B200', 10, 20);
                ctx.font = '9px monospace';
                ctx.fillText(typeof gpuCount === 'number' ? `${gpuCount.toLocaleString()} GPUs` : 'âˆž impossible', 10, 34);

                for (let i = 0; i < gpuBars; i++) {
                    const prog = Math.min(1, (t * 0.02 - i * 0.15));
                    if (prog <= 0) continue;
                    const pulse = Math.sin(t * 0.05 + i * 0.4) * 0.15 + 0.85;
                    const w = (W / 2 - 30) * prog * pulse;
                    const y = 44 + i * barH;
                    const grad = ctx.createLinearGradient(10, y, 10 + w, y);
                    grad.addColorStop(0, '#f85149');
                    grad.addColorStop(0.6, '#f0883e');
                    grad.addColorStop(1, '#e3b341');
                    ctx.fillStyle = grad;
                    ctx.fillRect(10, y, w, barH - 2);
                }

                // --- Right side: Qubit sphere ---
                const cx = W * 0.72, cy = H * 0.45, R = Math.min(W, H) * 0.25;

                // Bloch-like sphere
                ctx.strokeStyle = 'rgba(0,191,255,0.25)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(cx, cy, R, 0, Math.PI * 2);
                ctx.stroke();
                ctx.beginPath();
                ctx.ellipse(cx, cy, R, R * 0.35, 0, 0, Math.PI * 2);
                ctx.stroke();

                // Qubit nodes orbiting
                const nNodes = Math.min(q, 30);
                for (let i = 0; i < nNodes; i++) {
                    const angle = (Math.PI * 2 / nNodes) * i + t * 0.015;
                    const rr = R * (0.6 + Math.sin(t * 0.02 + i) * 0.35);
                    const nx = cx + Math.cos(angle) * rr;
                    const ny = cy + Math.sin(angle) * rr * 0.6;
                    const pulse = Math.sin(t * 0.06 + i * 0.8) * 0.4 + 0.6;
                    ctx.beginPath();
                    ctx.arc(nx, ny, 3 + pulse * 3, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(210,168,255,${pulse})`;
                    ctx.fill();
                }

                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = 'bold 11px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(`${q} Qubits`, cx, cy + R + 18);
                ctx.font = '9px monospace';
                const state = q <= 30 ? 'classical sim OK' : q <= 40 ? 'cluster needed' : q < 50 ? 'supercomputer' : 'quantum only';
                ctx.fillText(state, cx, cy + R + 32);
                ctx.textAlign = 'start';

                // Photonic badge
                ctx.fillStyle = '#d2a8ff';
                ctx.font = '9px monospace';
                ctx.fillText('â—ˆ Xanadu photonic â€” 25Â°C room temp', 10, H - 8);
            }

            _gpuForQubits(q) {
                if (q <= 30) return 1;
                if (q <= 33) return 1;
                if (q <= 34) return 8;
                if (q <= 36) return 64;
                if (q <= 38) return 256;
                if (q <= 40) return 1024;
                if (q <= 45) return 32768;
                if (q <= 49) return 1048576;
                return null; // impossible
            }

            _updateGpuQubitScaling() {
                const q = this._thermalQubits;
                const gpuCount = this._gpuForQubits(q);
                const qEl = document.getElementById('th-qubits');
                const gEl = document.getElementById('th-gpus');
                if (qEl) qEl.textContent = q;
                if (gEl) gEl.textContent = gpuCount !== null ? gpuCount.toLocaleString() + ' GPUs' : 'âˆž (impossible)';

                // Fill bar
                const fill = document.getElementById('gpu-fill');
                if (fill) {
                    const pct = gpuCount !== null ? Math.min(100, Math.log2(gpuCount + 1) * 5) : 100;
                    fill.style.width = pct + '%';
                    fill.style.background = pct < 30 ? '#3fb950' : pct < 70 ? 'linear-gradient(90deg,#3fb950,#f0883e)' : 'linear-gradient(90deg,#3fb950,#f0883e,#f85149)';
                }

                // Update lattice dims
                const dim = Math.max(2, Math.ceil(Math.pow(q, 1/3)));
                const dimEl = document.getElementById('lattice-dim');
                const sitesEl = document.getElementById('lattice-sites');
                if (dimEl) dimEl.textContent = `${dim}x${dim}x${dim}`;
                if (sitesEl) sitesEl.textContent = dim * dim * dim;
            }

            _updateThermalStats() {
                const unit = this._thermalUnit;
                // Base values in Celsius
                const vals = {
                    cryo: -273.135,     // 15mK
                    fridge: -272.87,    // dilution
                    photonic: 25.0,     // Xanadu room-temp
                    gpu: 83.2,          // GPU junction
                };
                const convert = (c) => {
                    if (unit === 'C') return c.toFixed(c < -200 ? 3 : 1) + ' Â°C';
                    if (unit === 'F') return (c * 9/5 + 32).toFixed(1) + ' Â°F';
                    return (c + 273.15).toFixed(c < -200 ? 3 : 1) + ' K';
                };
                const special = (mK) => {
                    if (unit === 'C') return (mK / 1000 - 273.15).toFixed(3) + ' Â°C';
                    if (unit === 'F') return ((mK / 1000 - 273.15) * 9/5 + 32).toFixed(3) + ' Â°F';
                    return (mK / 1000).toFixed(3) + ' K';
                };

                const el = (id, v) => { const e = document.getElementById(id); if (e) e.textContent = v; };
                el('th-cryo', special(15));
                el('th-fridge', convert(vals.fridge));
                el('th-photonic', convert(vals.photonic));
                el('th-gpu', convert(vals.gpu));
            }

            /* ========== VISUAL SLICE / 3D CUBE ========== */

            _showVisualView() {
                const sliceWrap = document.getElementById('visual-slice-wrap');
                const cubeWrap = document.getElementById('visual-cube-wrap');
                const orbWrap = document.getElementById('visual-orb-wrap');
                const controls = document.getElementById('cube-controls');
                if (sliceWrap) sliceWrap.style.display = this._visualMode === 'slice' ? '' : 'none';
                if (cubeWrap) cubeWrap.style.display = this._visualMode === 'cube' ? '' : 'none';
                if (orbWrap) orbWrap.style.display = this._visualMode === 'orb' ? '' : 'none';
                if (controls) controls.style.display = '';
                if (this._visualMode === 'cube') this._buildCube();
            }

            _initVisualViz() {
                if (this._visualAnim) return;
                // Slice canvas
                const sliceCanvas = document.getElementById('visual-slice-canvas');
                if (sliceCanvas) this._visualSliceCtx = sliceCanvas.getContext('2d');
                // Orb canvas
                const orbCanvas = document.getElementById('visual-orb-canvas');
                if (orbCanvas) this._visualOrbCtx = orbCanvas.getContext('2d');
                // Build cube DOM
                this._buildCube();
                this._showVisualView();
                this._visualFrame = 0;
                const tick = () => {
                    this._visualFrame++;
                    if (this._visualMode === 'slice') this._drawSlice();
                    else if (this._visualMode === 'orb') this._drawOrb();
                    if (this._visualMode === 'cube' && this._cubeAutoRotate) {
                        this._cubeRotY += 0.4;
                        this._cubeRotX += 0.1;
                    }
                    if (this._visualMode === 'cube') this._updateCubeTransform();
                    this._updateVisualStats();
                    this._visualAnim = requestAnimationFrame(tick);
                };
                tick();
            }

            _stopVisualViz() {
                if (this._visualAnim) {
                    cancelAnimationFrame(this._visualAnim);
                    this._visualAnim = null;
                }
            }

            _updateVisualStats() {
                const p = this.quantumPosition || [0,0,0];
                const el = (id, v) => { const e = document.getElementById(id); if (e) e.textContent = v; };
                el('vs-x', p[0]);
                el('vs-y', p[1]);
                el('vs-z', p[2]);
                el('vs-layer', Math.abs(p[2]) % 3);
                // Determine current prefix from direction
                const prefixes = ['+1','1','-1','+0','0','-0','+n','n','-n'];
                const idx = ((Math.abs(p[0]) + Math.abs(p[1]) + Math.abs(p[2])) % 9);
                el('vs-prefix', prefixes[idx] || 'âˆž');
            }

            /* --- 2D Visual Slice: cross-section at current Z layer --- */
            _drawSlice() {
                const ctx = this._visualSliceCtx;
                if (!ctx) return;
                const W = ctx.canvas.width, H = ctx.canvas.height;
                const t = this._visualFrame;
                const p = this.quantumPosition || [0,0,0];
                const layer = Math.abs(p[2]) % 6;

                // Clear
                ctx.fillStyle = '#0a0e14';
                ctx.fillRect(0, 0, W, H);

                const grid = 9; // 9 columns for 9 prefixes
                const cellW = W / grid;
                const cellH = H / grid;
                const prefixes = ['+1','1','-1','+0','0','-0','+n','n','-n'];
                const colors = ['#3fb950','#58a6ff','#bc8cff','#f0883e','#8b949e','#f85149','#d2a8ff','#79c0ff','#e3b341'];

                // Grid of prefix-addressed cells
                for (let r = 0; r < grid; r++) {
                    for (let c = 0; c < grid; c++) {
                        const x = c * cellW;
                        const y = r * cellH;

                        // Heat based on code density simulation
                        const heat = Math.sin(t * 0.02 + c * 0.8 + r * 0.6 + layer * 1.3) * 0.5 + 0.5;
                        const active = (c === Math.abs(p[0]) % grid && r === Math.abs(p[1]) % grid);

                        // Cell background
                        const baseColor = colors[c % colors.length];
                        const alpha = 0.15 + heat * 0.35 + (active ? 0.35 : 0);
                        ctx.fillStyle = active
                            ? `rgba(139, 92, 246, ${0.5 + Math.sin(t * 0.08) * 0.2})`
                            : this._hexToRgba(baseColor, alpha);
                        ctx.fillRect(x + 1, y + 1, cellW - 2, cellH - 2);

                        // Cell border
                        ctx.strokeStyle = active
                            ? `rgba(139, 92, 246, 0.8)`
                            : `rgba(255,255,255,${0.05 + heat * 0.08})`;
                        ctx.lineWidth = active ? 2 : 0.5;
                        ctx.strokeRect(x + 1, y + 1, cellW - 2, cellH - 2);

                        // Inner glow for active cells
                        if (active) {
                            const grd = ctx.createRadialGradient(x + cellW/2, y + cellH/2, 0, x + cellW/2, y + cellH/2, cellW * 0.6);
                            grd.addColorStop(0, 'rgba(139, 92, 246, 0.3)');
                            grd.addColorStop(1, 'rgba(139, 92, 246, 0)');
                            ctx.fillStyle = grd;
                            ctx.fillRect(x, y, cellW, cellH);
                        }

                        // Flowing data dots
                        if (heat > 0.6) {
                            const dotX = x + cellW * (0.2 + Math.sin(t * 0.03 + c) * 0.3 + 0.3);
                            const dotY = y + cellH * (0.2 + Math.cos(t * 0.025 + r) * 0.3 + 0.3);
                            ctx.beginPath();
                            ctx.arc(dotX, dotY, 2 + heat * 2, 0, Math.PI * 2);
                            ctx.fillStyle = `rgba(255,255,255,${heat * 0.6})`;
                            ctx.fill();
                        }
                    }
                }

                // Prefix labels along top
                ctx.font = 'bold 10px monospace';
                ctx.textAlign = 'center';
                for (let c = 0; c < grid; c++) {
                    ctx.fillStyle = colors[c];
                    ctx.fillText(prefixes[c], c * cellW + cellW/2, 14);
                }
                ctx.textAlign = 'start';

                // Axis labels
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                ctx.font = '9px monospace';
                ctx.fillText(`Z-Layer ${p[2]}  â”‚  Slice ${grid}Ã—${grid}  â”‚  Visual Addressing`, 6, H - 6);

                // Cross-hairs at current position
                const cx = (Math.abs(p[0]) % grid) * cellW + cellW / 2;
                const cy = (Math.abs(p[1]) % grid) * cellH + cellH / 2;
                ctx.setLineDash([4, 4]);
                ctx.strokeStyle = `rgba(139, 92, 246, ${0.3 + Math.sin(t * 0.06) * 0.15})`;
                ctx.lineWidth = 1;
                ctx.beginPath(); ctx.moveTo(cx, 0); ctx.lineTo(cx, H); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, cy); ctx.lineTo(W, cy); ctx.stroke();
                ctx.setLineDash([]);
            }

            _hexToRgba(hex, a) {
                const r = parseInt(hex.slice(1,3), 16);
                const g = parseInt(hex.slice(3,5), 16);
                const b = parseInt(hex.slice(5,7), 16);
                return `rgba(${r},${g},${b},${a})`;
            }

            /* --- 3D Rubik's Cube: CSS 3D transformed cubelets --- */
            _buildCube() {
                const wrap = document.getElementById('cube-wrap');
                if (!wrap) return;
                wrap.innerHTML = '';
                const size = 3;
                const p = this.quantumPosition || [0,0,0];
                const gap = this._cubeExploded ? 52 : 36;
                const prefixes = ['+1','1','-1','+0','0','-0','+n','n','-n'];
                const colors = ['#3fb950','#58a6ff','#bc8cff','#f0883e','#8b949e','#f85149','#d2a8ff','#79c0ff','#e3b341'];
                let idx = 0;

                for (let z = 0; z < size; z++) {
                    for (let y = 0; y < size; y++) {
                        for (let x = 0; x < size; x++) {
                            if (this._cubeLayerIsolate !== -1 && z !== this._cubeLayerIsolate) continue;

                            const cell = document.createElement('div');
                            cell.className = 'cube-cell';

                            // True 3D positioning using translate3d
                            const tx = (x - 1) * gap;
                            const ty = (y - 1) * gap;
                            const tz = (z - 1) * gap;
                            cell.style.width = (gap - 4) + 'px';
                            cell.style.height = (gap - 4) + 'px';
                            cell.style.left = '50%';
                            cell.style.top = '50%';
                            cell.style.marginLeft = -(gap - 4) / 2 + 'px';
                            cell.style.marginTop = -(gap - 4) / 2 + 'px';
                            cell.style.transform = `translate3d(${tx}px, ${ty}px, ${tz}px)`;

                            // Color based on layer position
                            const colorIdx = (x + y * 3 + z) % colors.length;
                            const isActive = (Math.abs(p[0]) % 3 === x && Math.abs(p[1]) % 3 === y && Math.abs(p[2]) % 3 === z);
                            cell.style.background = isActive
                                ? 'rgba(139, 92, 246, 0.7)'
                                : this._hexToRgba(colors[colorIdx], 0.35);
                            cell.style.borderColor = isActive
                                ? 'rgba(139, 92, 246, 0.8)'
                                : this._hexToRgba(colors[colorIdx], 0.2);

                            if (isActive) cell.classList.add('active-cell');

                            // Label
                            cell.textContent = prefixes[idx % 9];
                            cell.title = `[${x},${y},${z}] â€” ${prefixes[idx % 9]}`;

                            wrap.appendChild(cell);
                            idx++;
                        }
                    }
                }
                this._updateCubeTransform();
            }

            _updateCubeTransform() {
                const wrap = document.getElementById('cube-wrap');
                if (wrap) {
                    wrap.style.transform = `rotateX(${this._cubeRotX}deg) rotateY(${this._cubeRotY}deg)`;
                }
            }

            /* --- Quantum Orb: spherical probability density visualization --- */
            _drawOrb() {
                const ctx = this._visualOrbCtx;
                if (!ctx) return;
                const W = ctx.canvas.width, H = ctx.canvas.height;
                const t = this._visualFrame;
                const p = this.quantumPosition || [0,0,0];

                // Clear
                ctx.fillStyle = '#0a0e14';
                ctx.fillRect(0, 0, W, H);

                const cx = W / 2, cy = H / 2;
                const maxR = Math.min(W, H) * 0.42;

                // Outer shell rings
                for (let ring = 3; ring >= 0; ring--) {
                    const r = maxR * (0.4 + ring * 0.2);
                    const pulse = Math.sin(t * 0.02 + ring * 1.5) * 0.1 + 0.9;
                    ctx.beginPath();
                    ctx.arc(cx, cy, r * pulse, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(139, 92, 246, ${0.06 + ring * 0.04})`;
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    // Tilted ellipse
                    ctx.beginPath();
                    ctx.ellipse(cx, cy, r * pulse, r * pulse * 0.35, t * 0.003 + ring, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(88, 166, 255, ${0.05 + ring * 0.03})`;
                    ctx.stroke();
                }

                // Probability cloud particles
                const nParticles = 120;
                for (let i = 0; i < nParticles; i++) {
                    const angle = (Math.PI * 2 / nParticles) * i + t * 0.008;
                    const phi = Math.sin(t * 0.01 + i * 0.5) * Math.PI * 0.8;
                    const rDist = maxR * (0.2 + Math.abs(Math.sin(i * 1.618 + t * 0.005)) * 0.75);

                    const px = cx + Math.cos(angle) * rDist * Math.cos(phi);
                    const py = cy + Math.sin(angle) * rDist * 0.6 + Math.sin(phi) * rDist * 0.3;

                    // Color based on which prefix region
                    const prefixIdx = i % 9;
                    const colors = ['#3fb950','#58a6ff','#bc8cff','#f0883e','#8b949e','#f85149','#d2a8ff','#79c0ff','#e3b341'];
                    const alpha = 0.3 + Math.sin(t * 0.04 + i * 0.3) * 0.25;
                    const size = 1.5 + Math.sin(t * 0.03 + i) * 1;

                    ctx.beginPath();
                    ctx.arc(px, py, size, 0, Math.PI * 2);
                    ctx.fillStyle = this._hexToRgba(colors[prefixIdx], alpha);
                    ctx.fill();
                }

                // Central quantum state indicator
                const coreR = 8 + Math.sin(t * 0.05) * 3;
                const coreGrad = ctx.createRadialGradient(cx, cy, 0, cx, cy, coreR * 3);
                coreGrad.addColorStop(0, 'rgba(139, 92, 246, 0.8)');
                coreGrad.addColorStop(0.5, 'rgba(139, 92, 246, 0.2)');
                coreGrad.addColorStop(1, 'rgba(139, 92, 246, 0)');
                ctx.beginPath();
                ctx.arc(cx, cy, coreR * 3, 0, Math.PI * 2);
                ctx.fillStyle = coreGrad;
                ctx.fill();

                ctx.beginPath();
                ctx.arc(cx, cy, coreR, 0, Math.PI * 2);
                ctx.fillStyle = '#8b5cf6';
                ctx.fill();

                // Position vector arrow
                const vx = p[0] * 15, vy = p[1] * 15;
                const arrowLen = Math.sqrt(vx*vx + vy*vy);
                if (arrowLen > 2) {
                    ctx.beginPath();
                    ctx.moveTo(cx, cy);
                    ctx.lineTo(cx + vx, cy + vy);
                    ctx.strokeStyle = 'rgba(255,255,255,0.5)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }

                // Labels
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = '10px monospace';
                ctx.textAlign = 'center';
                ctx.fillText(`Quantum Orbital â€” [${p[0]}, ${p[1]}, ${p[2]}]`, cx, H - 12);
                ctx.font = '8px monospace';
                ctx.fillStyle = 'rgba(139, 92, 246, 0.6)';
                ctx.fillText('probability density Ã— prefix space', cx, H - 2);
                ctx.textAlign = 'start';

                // Prefix legend around the orb
                const prefixes = ['+1','1','-1','+0','0','-0','+n','n','-n'];
                const legendColors = ['#3fb950','#58a6ff','#bc8cff','#f0883e','#8b949e','#f85149','#d2a8ff','#79c0ff','#e3b341'];
                ctx.font = 'bold 8px monospace';
                for (let i = 0; i < 9; i++) {
                    const a = (Math.PI * 2 / 9) * i - Math.PI / 2;
                    const lx = cx + Math.cos(a) * (maxR + 14);
                    const ly = cy + Math.sin(a) * (maxR + 14);
                    ctx.fillStyle = legendColors[i];
                    ctx.textAlign = 'center';
                    ctx.fillText(prefixes[i], lx, ly + 3);
                }
                ctx.textAlign = 'start';
            }

            /* ========== CHARTGPU INTEGRATION ========== */
            async _fetchChartGPUMetrics() {
                try {
                    const resp = await fetch('http://localhost:8085/api/chartgpu/metrics');
                    const data = await resp.json();
                    if (data.metrics) {
                        const m = data.metrics;
                        const el = (id, v) => { const e = document.getElementById(id); if (e) e.textContent = v; };
                        el('cg-cpu', m.cpu.toFixed(1) + '%');
                        el('cg-mem', m.memory.toFixed(1) + '%');
                        el('chartgpu-status-val', 'live');
                        document.getElementById('chartgpu-status-val').style.color = '#3fb950';
                        this._logStream('chartgpu', `CPU ${m.cpu.toFixed(1)}% MEM ${m.memory.toFixed(1)}%`, 'data');
                    }
                } catch(e) {
                    const el = document.getElementById('chartgpu-status-val');
                    if (el) { el.textContent = 'offline'; el.style.color = 'var(--cursor-text-muted)'; }
                }
            }

            /* ========== HEX / FAX STREAM VIEWER ========== */

            /* ----- Nyan Cat pixel sprite data ----- */
            _nyanSprite() {
                if (this.__nyanSpr) return this.__nyanSpr;
                // 21Ã—14 pixel art â€” 0=transparent, 1-7=palette indices
                // Palette: 1=darkgray(feet), 2=gray(body), 3=pink(cheeks/nose), 4=poptart-tan, 5=poptart-pink, 6=white(eyes), 7=black(outline)
                const rows = [
                    [0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,0,0,0],
                    [0,0,0,0,0,0,0,0,0,7,4,4,5,4,5,4,5,4,7,0,0],
                    [0,0,0,0,0,0,0,0,7,4,5,5,4,5,4,5,4,5,4,7,0],
                    [0,0,0,0,0,0,0,0,7,4,4,5,5,4,5,4,5,4,5,7,0],
                    [0,0,7,7,0,0,0,7,4,4,4,4,4,4,4,4,4,4,4,7,7,],
                    [0,7,2,2,7,0,7,2,2,2,2,2,2,2,2,2,2,2,2,2,7],
                    [7,2,2,2,2,7,2,6,7,2,2,2,2,2,6,7,2,2,2,2,7],
                    [7,2,2,2,2,7,2,7,7,2,3,2,3,2,7,7,2,2,2,2,7],
                    [0,7,2,2,7,0,7,2,2,2,2,3,2,2,2,2,2,2,2,2,7],
                    [0,0,7,7,0,0,0,7,2,2,2,2,2,2,2,2,2,2,2,7,0],
                    [0,0,0,0,0,0,7,2,2,7,0,0,0,0,7,2,2,7,0,0,0],
                    [0,0,0,0,0,0,7,1,1,7,0,0,0,0,7,1,1,7,0,0,0],
                    [0,0,0,0,0,0,0,7,7,0,0,0,0,0,0,7,7,0,0,0,0],
                ];
                // Rainbow colors for trail (red, orange, yellow, green, blue, violet)
                const rainbow = ['#ff0000','#ff9900','#ffff00','#33ff00','#0099ff','#6633ff'];
                this.__nyanSpr = { rows, rainbow, w: 21, h: rows.length };
                return this.__nyanSpr;
            }

            _nyanPalette(mode) {
                // Returns palette array indexed 1-7 per mode
                if (mode === 'color') {
                    return [null,'#555','#999','#ff6699','#ffcc99','#ff99cc','#fff','#222'];
                } else if (mode === 'gray') {
                    return [null,'#333','#888','#aaa','#bbb','#999','#ddd','#111'];
                } else { // fax
                    return [null,'#000','#888','#fff','#ccc','#aaa','#fff','#000'];
                }
            }

            _drawHexCanvas() {
                const ctx = this._hexCtx;
                if (!ctx) return;
                const W = ctx.canvas.width, H = ctx.canvas.height;
                const cols = 36, rows = 36;
                const cw = W / cols, ch = H / rows;
                const mode = this._hexMode;

                // Dark space background
                ctx.fillStyle = '#0d1117';
                ctx.fillRect(0, 0, W, H);

                // Background hex grid (dimmed)
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        const val = this._hexData[r * cols + c] || 0;
                        const norm = val / 255;
                        if (mode === 'color') {
                            const hue = (1 - norm) * 200;
                            ctx.fillStyle = `hsla(${hue}, 85%, ${20 + norm * 50}%, 0.25)`;
                        } else if (mode === 'gray') {
                            const g = Math.floor(norm * 80);
                            ctx.fillStyle = `rgb(${g},${g},${g})`;
                        } else {
                            const g = norm > 0.5 ? 60 : 0;
                            ctx.fillStyle = `rgb(${g},${g},${g})`;
                        }
                        ctx.fillRect(c * cw, r * ch, cw - 0.5, ch - 0.5);
                    }
                }

                // --- Nyan Cat animation ---
                const spr = this._nyanSprite();
                const pal = this._nyanPalette(mode);
                const t = this._nyanFrame || 0;
                this._nyanFrame = (t + 1) % (cols + spr.w + 6);

                const catX = t - spr.w; // scrolls left to right, wraps
                const catY = Math.floor(rows / 2 - spr.h / 2) + Math.round(Math.sin(t * 0.3) * 1.5); // bobbing
                const bounce = (t % 4 < 2) ? 0 : -1; // leg bounce

                // Draw rainbow trail behind cat
                const trailLen = Math.min(catX, cols);
                for (let band = 0; band < 6; band++) {
                    const bandY = catY + 3 + band;
                    if (bandY < 0 || bandY >= rows) continue;
                    for (let x = Math.max(0, catX - trailLen); x < Math.max(0, catX + 2); x++) {
                        if (x >= cols) break;
                        if (mode === 'color') {
                            ctx.fillStyle = spr.rainbow[band];
                        } else if (mode === 'gray') {
                            const g = 180 - band * 25;
                            ctx.fillStyle = `rgb(${g},${g},${g})`;
                        } else { // fax
                            ctx.fillStyle = band % 2 === 0 ? '#fff' : '#000';
                        }
                        ctx.fillRect(x * cw, bandY * ch, cw - 0.3, ch - 0.3);
                    }
                }

                // Draw Nyan Cat sprite
                for (let sr = 0; sr < spr.h; sr++) {
                    const dy = catY + sr + (sr >= 10 ? bounce : 0); // bounce legs
                    if (dy < 0 || dy >= rows) continue;
                    for (let sc = 0; sc < spr.w; sc++) {
                        const dx = catX + sc;
                        if (dx < 0 || dx >= cols) continue;
                        const pidx = spr.rows[sr]?.[sc];
                        if (!pidx) continue;
                        ctx.fillStyle = pal[pidx];
                        ctx.fillRect(dx * cw, dy * ch, cw - 0.3, ch - 0.3);
                    }
                }

                // Sparkle stars (small white pixels that blink)
                ctx.fillStyle = mode === 'fax' ? '#fff' : 'rgba(255,255,255,0.8)';
                const starSeed = t * 7;
                for (let s = 0; s < 8; s++) {
                    const sx = ((starSeed + s * 137) % cols);
                    const sy = ((starSeed + s * 89) % rows);
                    const phase = (t + s * 3) % 6;
                    if (phase < 3) {
                        const sz = phase === 1 ? 2 : 1;
                        // Draw + shaped star
                        ctx.fillRect(sx * cw + cw/2 - sz/2, sy * ch, sz, ch);
                        ctx.fillRect(sx * cw, sy * ch + ch/2 - sz/2, cw, sz);
                    }
                }

                // Hex labels on top rows (dimmer, behind animation if overlapping)
                ctx.fillStyle = 'rgba(255,255,255,0.35)';
                ctx.font = `${Math.max(6, cw * 0.45)}px monospace`;
                ctx.textAlign = 'center';
                for (let r = 0; r < Math.min(4, rows); r++) {
                    for (let c = 0; c < cols; c++) {
                        const val = this._hexData[r * cols + c] || 0;
                        ctx.fillText(val.toString(16).toUpperCase().padStart(2, '0'),
                            c * cw + cw / 2, r * ch + ch * 0.75);
                    }
                }
                ctx.textAlign = 'start';
            }

            _openHexOverlay() {
                // Create full-screen hex viewer overlay
                let overlay = document.getElementById('hex-overlay');
                if (overlay) { overlay.remove(); return; }

                overlay = document.createElement('div');
                overlay.id = 'hex-overlay';
                overlay.className = 'hex-overlay';
                overlay.innerHTML = `
                    <div class="hex-overlay-bar">
                        <button class="active" data-omode="color">Color</button>
                        <button data-omode="gray">Grayscale</button>
                        <button data-omode="fax">Fax</button>
                        <button data-omode="signal">Signal</button>
                        <span style="flex:1;"></span>
                        <span style="font-size:0.6875rem;color:#888;padding:0 8px;">HF Fax / Hex Stream â€” 1080x1080 Instagram</span>
                        <button id="hex-overlay-close">âœ• Close</button>
                    </div>
                    <canvas id="hex-overlay-canvas" width="1080" height="1080"></canvas>
                `;
                document.body.appendChild(overlay);

                const canvas = document.getElementById('hex-overlay-canvas');
                const ctx = canvas.getContext('2d');
                const bigData = new Uint8Array(108 * 108);
                // Seed from hex data
                for (let i = 0; i < bigData.length; i++) {
                    bigData[i] = this._hexData[i % this._hexData.length];
                    bigData[i] = (bigData[i] + Math.floor(Math.random() * 4)) & 0xFF;
                }

                let oMode = this._hexMode;
                const spr = this._nyanSprite();
                let oFrame = 0;

                const draw = () => {
                    const W = 1080, H = 1080, cols = 108, rows = 108;
                    const cw = W / cols, ch = H / rows;

                    // Space background
                    ctx.fillStyle = '#0d1117';
                    ctx.fillRect(0, 0, W, H);

                    // Background hex grid (dimmed)
                    for (let r = 0; r < rows; r++) {
                        for (let c = 0; c < cols; c++) {
                            const val = bigData[r * cols + c] || 0;
                            const norm = val / 255;
                            if (oMode === 'color') {
                                const hue = (1 - norm) * 200;
                                ctx.fillStyle = `hsla(${hue}, 85%, ${20 + norm * 50}%, 0.2)`;
                            } else if (oMode === 'gray') {
                                const g = Math.floor(norm * 60);
                                ctx.fillStyle = `rgb(${g},${g},${g})`;
                            } else if (oMode === 'fax') {
                                const g = norm > 0.5 ? 40 : 0;
                                ctx.fillStyle = `rgb(${g},${g},${g})`;
                            } else { // signal
                                const r2 = Math.floor(norm * 40);
                                const g2 = Math.floor(Math.sin(norm * Math.PI) * 60);
                                const b2 = Math.floor((1 - norm) * 50);
                                ctx.fillStyle = `rgb(${r2},${g2},${b2})`;
                            }
                            ctx.fillRect(c * cw, r * ch, cw - 0.3, ch - 0.3);
                        }
                    }

                    // Scale sprite to overlay (3x)
                    const scale = 3;
                    const pal = this._nyanPalette(oMode);
                    const catX = oFrame - spr.w * scale;
                    const catY = Math.floor(rows / 2 - (spr.h * scale) / 2) + Math.round(Math.sin(oFrame * 0.15) * 3);
                    const bounce = (oFrame % 6 < 3) ? 0 : -1;

                    // Rainbow trail (6 bands, scaled)
                    const trailLen = Math.min(catX, cols);
                    for (let band = 0; band < 6; band++) {
                        for (let sy = 0; sy < scale; sy++) {
                            const bandY = catY + (3 + band) * scale + sy;
                            if (bandY < 0 || bandY >= rows) continue;
                            for (let x = Math.max(0, catX - trailLen); x < Math.max(0, catX + scale * 2); x++) {
                                if (x >= cols) break;
                                if (oMode === 'color') {
                                    ctx.fillStyle = spr.rainbow[band];
                                } else if (oMode === 'gray') {
                                    const g = 200 - band * 30;
                                    ctx.fillStyle = `rgb(${g},${g},${g})`;
                                } else if (oMode === 'signal') {
                                    const hue = band * 50;
                                    ctx.fillStyle = `hsl(${hue}, 70%, 50%)`;
                                } else {
                                    ctx.fillStyle = band % 2 === 0 ? '#fff' : '#000';
                                }
                                ctx.fillRect(x * cw, bandY * ch, cw - 0.2, ch - 0.2);
                            }
                        }
                    }

                    // Draw Nyan Cat sprite (scaled)
                    for (let sr = 0; sr < spr.h; sr++) {
                        for (let sc = 0; sc < spr.w; sc++) {
                            const pidx = spr.rows[sr]?.[sc];
                            if (!pidx) continue;
                            ctx.fillStyle = pal[pidx];
                            for (let py = 0; py < scale; py++) {
                                for (let px = 0; px < scale; px++) {
                                    const dy = catY + sr * scale + py + (sr >= 10 ? bounce * scale : 0);
                                    const dx = catX + sc * scale + px;
                                    if (dx < 0 || dx >= cols || dy < 0 || dy >= rows) continue;
                                    ctx.fillRect(dx * cw, dy * ch, cw - 0.1, ch - 0.1);
                                }
                            }
                        }
                    }

                    // Sparkle stars
                    ctx.fillStyle = oMode === 'fax' ? '#fff' : 'rgba(255,255,255,0.85)';
                    const ss = oFrame * 5;
                    for (let s = 0; s < 20; s++) {
                        const sx = (ss + s * 137) % cols;
                        const sy2 = (ss + s * 89) % rows;
                        const phase = (oFrame + s * 3) % 6;
                        if (phase < 3) {
                            const sz = (phase === 1 ? 3 : 1);
                            ctx.fillRect(sx * cw + cw/2 - sz/2, sy2 * ch, sz, ch);
                            ctx.fillRect(sx * cw, sy2 * ch + ch/2 - sz/2, cw, sz);
                        }
                    }

                    oFrame = (oFrame + 1) % (cols + spr.w * scale + 10);
                };
                draw();

                // Animate at ~20fps for smooth nyan
                const anim = setInterval(() => {
                    for (let i = 0; i < 200; i++) {
                        const idx = Math.floor(Math.random() * bigData.length);
                        bigData[idx] = (bigData[idx] + Math.floor(Math.random() * 6)) & 0xFF;
                    }
                    draw();
                }, 50);

                overlay.querySelectorAll('[data-omode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        overlay.querySelectorAll('[data-omode]').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        oMode = btn.dataset.omode;
                        draw();
                    });
                });

                document.getElementById('hex-overlay-close').addEventListener('click', () => {
                    clearInterval(anim);
                    overlay.remove();
                });
            }

            /* ========== TOOLS DROPDOWN RUNNER ========== */
            async _runTool(toolId) {
                this._logStream('tool', toolId, 'exec');
                const BRIDGE = 'http://localhost:8085';

                const toolMap = {
                    'kbatch': async () => {
                        const text = prompt('Enter text for keyboard analysis:');
                        if (!text) return;
                        const resp = await fetch(`${BRIDGE}/api/day/kbatch`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({text, mode: 'analyze'}),
                        });
                        const data = await resp.json();
                        const id = this.addCell('code', `# Kbatch Keyboard Analysis\n# Input: "${text.slice(0,50)}..."`);
                        this.displayOutput(id, {type:'text', data: (data.output || data.error || JSON.stringify(data)).split('\\n')});
                    },
                    'signal': async () => {
                        const text = prompt('Enter text for signal analysis:');
                        if (!text) return;
                        const resp = await fetch(`${BRIDGE}/api/day/signal`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({text}),
                        });
                        const data = await resp.json();
                        const id = this.addCell('code', '# Signal Analysis â€” Morse / Binary / Waveform');
                        this.displayOutput(id, {type:'text', data: [
                            `Input: ${data.input || text}`,
                            `Morse: ${data.morse || 'â€”'}`,
                            `Binary: ${(data.binary || '').slice(0, 200)}`,
                            `Chars: ${data.char_count || 0}`,
                            '',
                            'Waveform (first 20 chars):',
                            ...(data.waveform || []).slice(0, 20).map(w => `  ${w.char} â†’ ${w.freq}Hz  ${w.morse}`),
                        ]});
                    },
                    'geokey': async () => {
                        const text = prompt('Enter text for geometric key mapping:');
                        if (!text) return;
                        const resp = await fetch(`${BRIDGE}/api/day/geokey`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({text, layout: 'hex'}),
                        });
                        const data = await resp.json();
                        const id = this.addCell('code', '# GeoKey â€” Geometric Keyboard Mapper');
                        this.displayOutput(id, {type:'text', data: (data.output || JSON.stringify(data.mapping || data, null, 2)).split('\\n')});
                    },
                    'youtube': async () => {
                        const url = prompt('Enter YouTube URL:');
                        if (!url) return;
                        this._showProgress('Fetching transcript...');
                        const resp = await fetch(`${BRIDGE}/api/day/youtube`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({url}),
                        });
                        const data = await resp.json();
                        this._hideProgress(300);
                        const id = this.addCell('code', `# YouTube Transcript\n# ${url}`);
                        this.displayOutput(id, {type:'text', data: (data.transcript || data.error || 'No transcript available').split('\\n')});
                    },
                    'chartgpu-dash': () => window.open('http://localhost:3444', '_blank'),
                    'chartgpu-metrics': () => this._fetchChartGPUMetrics(),
                    'jawta': async () => {
                        const text = prompt('Enter text for Jawta signal intel:');
                        if (!text) return;
                        const resp = await fetch(`${BRIDGE}/api/jawta/signal`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({text, mode: 'morse'}),
                        });
                        const data = await resp.json();
                        const id = this.addCell('code', '# Jawta Signal Intel â€” Spectrum Analysis');
                        this.displayOutput(id, {type:'text', data: [
                            `Morse: ${data.morse || 'â€”'}`,
                            `Binary: ${(data.binary || '').slice(0, 200)}`,
                            `Spectrum points: ${(data.spectrum || []).length}`,
                            '',
                            ...(data.spectrum || []).slice(0, 20).map(s => `  [${s.index}] ${s.freq}Hz  amp:${s.amplitude}`),
                        ]});
                    },
                    'media': async () => {
                        const source = prompt('Enter source URL or text:');
                        if (!source) return;
                        this._showProgress('Processing media...');
                        const resp = await fetch(`${BRIDGE}/api/media/process`, {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({source, type: 'auto'}),
                        });
                        const data = await resp.json();
                        this._hideProgress(300);
                        const id = this.addCell('code', `# Media Pipeline â€” ${data.type || 'auto'}`);
                        const lines = [`Pipeline: ${data.type}`, `Source: ${data.source}`, `Stages: ${data.stage_count}`, ''];
                        (data.stages || []).forEach(s => {
                            lines.push(`--- ${s.name} ---`);
                            lines.push(JSON.stringify(s.result || s, null, 2));
                        });
                        this.displayOutput(id, {type:'text', data: lines});
                    },
                    'hexbench': () => openOverlay('hexbench.html', 'hexbench â€” Voltage Lab'),
                    'quest-status': () => this._checkQuestStatus(),
                    'quest-logs': async () => {
                        const resp = await fetch('http://localhost:8085/api/quest/logs');
                        const data = await resp.json();
                        const id = this.addCell('code', '# Quest Logcat');
                        this.displayOutput(id, {type:'text', data: JSON.stringify(data, null, 2).split('\\n')});
                    },
                    'quest-screenshot': async () => {
                        const resp = await fetch('http://localhost:8085/api/quest/screenshot');
                        const data = await resp.json();
                        const id = this.addCell('code', '# Quest Screenshot');
                        this.displayOutput(id, {type:'text', data: JSON.stringify(data, null, 2).split('\\n')});
                    },
                    'lark-status': async () => {
                        const resp = await fetch('http://localhost:8085/api/lark/status');
                        const data = await resp.json();
                        const id = this.addCell('code', '# Lark IANA Status');
                        this.displayOutput(id, {type:'text', data: [
                            `Available: ${data.available}`,
                            `Path: ${data.path}`,
                            `Version: ${data.version}`,
                            `Components: ${(data.components || []).join(', ')}`,
                            `Embed URL: ${data.embed_url || 'none'}`,
                        ]});
                    },
                };

                const handler = toolMap[toolId];
                if (handler) {
                    try { await handler(); }
                    catch(e) {
                        const id = this.addCell('code', `# Tool Error: ${toolId}`);
                        this.displayOutput(id, {type:'text', data: [
                            'Error: ' + e.message,
                            '',
                            'Make sure the quantum bridge server is running:',
                            '  cd /Users/tref/uvspeed && python3 quantum_bridge_server.py',
                        ]});
                    }
                }
            }

            /* ========== QUEST STATUS CHECK ========== */
            async _checkQuestStatus() {
                const el = document.getElementById('quest-status');
                try {
                    const resp = await fetch('http://localhost:8085/api/quest/status');
                    const data = await resp.json();
                    if (data.quest_connected) {
                        if (el) { el.textContent = 'ðŸ¥½ Quest: connected'; el.style.color = '#3fb950'; }
                        this._logStream('quest', `${data.adb_devices.length} device(s)`, 'data');
                    } else if (data.hub_online) {
                        if (el) { el.textContent = 'ðŸ¥½ Quest: hub only'; el.style.color = '#f0883e'; }
                    } else {
                        if (el) { el.textContent = 'ðŸ¥½ Quest: offline'; el.style.color = 'var(--cursor-text-muted)'; }
                    }
                    // Show details in a cell
                    const id = this.addCell('code', '# Quest Device Status');
                    this.displayOutput(id, {type:'text', data: [
                        `Hub Online: ${data.hub_online}`,
                        `Hub URL: ${data.hub_url}`,
                        `Quest Connected: ${data.quest_connected}`,
                        `ADB Devices: ${data.adb_devices?.length || 0}`,
                        ...(data.adb_devices || []).map(d => `  ${d.serial} â€” ${d.state}`),
                    ]});
                } catch(e) {
                    if (el) { el.textContent = 'ðŸ¥½ Quest: â€”'; el.style.color = 'var(--cursor-text-muted)'; }
                }
            }

            _pipeStreamOut() {
                const lines = this._streamHistory.map(e =>
                    `${e.ts} | ${e.type.padEnd(6)} | ${e.action.padEnd(20)} | ${e.detail}`
                );
                const header = `# Quantum Stream â€” ${this._streamHistory.length} entries\n# Position: [${this.quantumPosition.join(', ')}]\n# ${'â”€'.repeat(50)}\n`;
                const text = header + lines.join('\n');
                navigator.clipboard.writeText(text).then(() => {
                    this._logStream('exported', `${this._streamHistory.length} entries`, 'pipe');
                });
                return text;
            }

            _pipeStreamIn(source) {
                if (!source || !source.trim()) return;
                // Parse pasted source: show each line's quantum prefix classification
                const lines = source.split('\n');
                const lang = this._detectSourceLanguage(source);
                this._logStream(`source piped`, `${lines.length} lines (${lang})`, 'pipe');

                lines.forEach((line, i) => {
                    if (!line.trim()) return;
                    const { sym, category } = this.classifyLine(line, lang);
                    this._logStream(`${sym} L${i + 1}`, line.trim().substring(0, 40), 'pipe');
                });
            }

            _detectSourceLanguage(source) {
                // Quick detection for piped source
                if (/^\s*(import|from)\s.*\n.*def\s/m.test(source)) return 'python';
                if (/^\s*def\s|^\s*class\s.*:/m.test(source)) return 'python';
                if (/^\s*(const|let|var|function|=>)/m.test(source)) return 'javascript';
                if (/^\s*(fn\s|let\s+mut|impl\s)/m.test(source)) return 'rust';
                if (/^\s*(func\s|package\s)/m.test(source)) return 'go';
                if (/^\s*<(!DOCTYPE|html|div)/im.test(source)) return 'html';
                if (/^\s*(graph|flowchart|sequenceDiagram)/m.test(source)) return 'mermaid';
                return 'python';
            }

            /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               QUANTUM PREFIX CLASSIFIER (client-side, 9-symbol)
               Mirrors QuantumPrefixEngine from quantum_bridge_server.py
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

            // Prefix definitions: category â†’ { symbol, cssClass }
            static PREFIXES = {
                shebang:   { sym: 'n:',  cls: 'pfx-shebang' },
                comment:   { sym: '+1:', cls: 'pfx-comment' },
                import:    { sym: '-n:', cls: 'pfx-import' },
                class:     { sym: '+0:', cls: 'pfx-class' },
                function:  { sym: '0:',  cls: 'pfx-function' },
                error:     { sym: '-1:', cls: 'pfx-error' },
                condition: { sym: '+n:', cls: 'pfx-condition' },
                loop:      { sym: '+2:', cls: 'pfx-loop' },
                return:    { sym: '-0:', cls: 'pfx-return' },
                output:    { sym: '+3:', cls: 'pfx-output' },
                variable:  { sym: '1:',  cls: 'pfx-variable' },
                decorator: { sym: '+1:', cls: 'pfx-decorator' },
                default:   { sym: '   ', cls: 'pfx-default' },
            };

            // Language pattern rules (regex per category)
            static LANG_PATTERNS = {
                python: {
                    shebang:   /^#!.*python/,
                    comment:   /^\s*#/,
                    import:    /^\s*(import|from)\s/,
                    class:     /^\s*class\s/,
                    function:  /^\s*(def|async\s+def)\s/,
                    decorator: /^\s*@/,
                    error:     /^\s*(try|except|finally|raise)/,
                    condition: /^\s*(if|elif|else)\b/,
                    loop:      /^\s*(for|while)\s/,
                    return:    /^\s*(return|yield)\s/,
                    output:    /^\s*print\(/,
                    variable:  /^\s*\w+\s*=/,
                },
                javascript: {
                    shebang:   /^#!.*node/,
                    comment:   /^\s*(\/\/|\/\*|\*)/,
                    import:    /^\s*(import|require|const\s+.*=\s*require|export)/,
                    class:     /^\s*(class|interface)\s/,
                    function:  /^\s*(function|const\s+\w+\s*=\s*(\(|async)|=>)/,
                    error:     /^\s*(try|catch|finally|throw)\b/,
                    condition: /^\s*(if|else\s+if|else|switch|case)\b/,
                    loop:      /^\s*(for|while|do)\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*console\./,
                    variable:  /^\s*(const|let|var)\s/,
                },
                typescript: {
                    comment:   /^\s*(\/\/|\/\*|\*)/,
                    import:    /^\s*(import|require|from|export)/,
                    class:     /^\s*(class|interface|type|enum)\s/,
                    function:  /^\s*(function|const\s+\w+\s*[:=]|=>)/,
                    decorator: /^\s*@/,
                    error:     /^\s*(try|catch|finally|throw)\b/,
                    condition: /^\s*(if|else|switch|case)\b/,
                    loop:      /^\s*(for|while|do)\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*console\./,
                    variable:  /^\s*(const|let|var)\s/,
                },
                rust: {
                    comment:   /^\s*(\/\/|\/\*)/,
                    import:    /^\s*(use|extern\s+crate|mod)\s/,
                    class:     /^\s*(struct|enum|trait|impl)\s/,
                    function:  /^\s*(pub\s+)?(fn|async\s+fn)\s/,
                    decorator: /^\s*#\[/,
                    error:     /^\s*(panic!|unwrap|expect|Result|Err)/,
                    condition: /^\s*(if|else|match)\b/,
                    loop:      /^\s*(for|while|loop)\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*(println!|print!|eprintln!)/,
                    variable:  /^\s*(let|mut|const)\s/,
                },
                go: {
                    comment:   /^\s*\/\//,
                    import:    /^\s*(import|package)\s/,
                    class:     /^\s*type\s+\w+\s+(struct|interface)/,
                    function:  /^\s*func\s/,
                    error:     /^\s*(if\s+err|panic\(|log\.(Fatal|Panic))/,
                    condition: /^\s*(if|else|switch|case)\b/,
                    loop:      /^\s*for\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*fmt\./,
                    variable:  /^\s*(var|:=)\s/,
                },
                shell: {
                    shebang:   /^#!\/(bin|usr)\/(bash|sh|zsh)/,
                    comment:   /^\s*#/,
                    import:    /^\s*(source|\.)\s/,
                    function:  /^\s*(\w+\s*\(\)\s*\{|function\s+\w+)/,
                    error:     /^\s*(trap|set\s+-e)/,
                    condition: /^\s*(if|elif|else|fi|then)\b/,
                    loop:      /^\s*(for|while|until|do|done)\b/,
                    return:    /^\s*return\s/,
                    output:    /^\s*echo\s/,
                    variable:  /^\s*\w+=/,
                },
                html: {
                    comment:   /^\s*<!--/,
                    import:    /^\s*<(link|script|meta)/,
                    class:     /^\s*<(div|section|article|main|header|footer|nav)/,
                    function:  /^\s*<(form|button|input)/,
                    condition: /^\s*<(template|slot)/,
                    output:    /^\s*<(p|h[1-6]|span|a|li|td)/,
                },
                css: {
                    comment:   /^\s*\/\*/,
                    import:    /^\s*@(import|charset|font-face)/,
                    class:     /^\s*\./,
                    variable:  /^\s*--/,
                    condition: /^\s*@(media|supports|keyframes)/,
                },
                markdown: {
                    shebang:   /^---/,
                    comment:   /^\s*<!--/,
                    import:    /^\s*!\[/,
                    class:     /^\s*#{1,6}\s/,
                    function:  /^\s*```/,
                    condition: /^\s*>/,
                    loop:      /^\s*[-*+]\s/,
                    output:    /^\s*\|/,
                    variable:  /^\s*\[.*\]:/,
                },
                mermaid: {
                    comment:   /^\s*%%/,
                    class:     /^\s*(graph|subgraph|flowchart|sequenceDiagram|classDiagram|stateDiagram|gantt|pie|erDiagram|journey)/,
                    function:  /^\s*(style|click|class)\b/,
                    condition: /^\s*(end|direction)\b/,
                    output:    /-->/,
                    variable:  /^\s*\w+[\[\({"]/,
                },
                sql: {
                    comment:   /^\s*--/,
                    import:    /^\s*(USE|DATABASE)\b/i,
                    class:     /^\s*(CREATE|ALTER|DROP)\b/i,
                    function:  /^\s*(SELECT|INSERT|UPDATE|DELETE)\b/i,
                    condition: /^\s*(WHERE|CASE|WHEN|IF)\b/i,
                    loop:      /^\s*(JOIN|UNION|GROUP)\b/i,
                },
                yaml: {
                    comment:   /^\s*#/,
                    import:    /^\s*---/,
                    variable:  /^\s*\w+\s*:/,
                    class:     /^\s*-\s/,
                },
                json: {
                    class:     /^\s*\{/,
                    variable:  /^\s*"/,
                    loop:      /^\s*\[/,
                },
            };

            // Detect language from cell type and content heuristics
            detectCellLanguage(cell) {
                if (cell.type === 'markdown') return 'markdown';
                if (cell.type === 'mermaid') return 'mermaid';
                if (cell.type === 'visualization') return 'python';
                if (cell.type === 'quantum') return 'javascript';
                const c = cell.content || '';
                // Shebang detection
                if (/^#!.*python/.test(c)) return 'python';
                if (/^#!.*node/.test(c)) return 'javascript';
                if (/^#!\/(bin|usr)/.test(c)) return 'shell';
                // Keyword heuristics
                if (/^\s*(import|from)\s.*\n.*def\s/m.test(c)) return 'python';
                if (/^\s*def\s|^\s*class\s.*:/m.test(c)) return 'python';
                if (/^\s*(const|let|var|function|=>|require\(|import\s.*from)/m.test(c)) return 'javascript';
                if (/^\s*(fn\s|let\s+mut|impl\s|use\s+\w+::)/m.test(c)) return 'rust';
                if (/^\s*(func\s|package\s|fmt\.)/m.test(c)) return 'go';
                if (/^\s*(SELECT|CREATE|INSERT|ALTER)\b/im.test(c)) return 'sql';
                if (/^\s*<(!DOCTYPE|html|div|section)/im.test(c)) return 'html';
                if (/^\s*(@media|\.[\w-]+\s*\{)/m.test(c)) return 'css';
                if (/^\s*(graph|flowchart|sequenceDiagram|classDiagram)/m.test(c)) return 'mermaid';
                if (/^\s*---\s*\n/m.test(c) && /^\s*\w+:/m.test(c)) return 'yaml';
                if (/^\s*\{[\s]*"/.test(c)) return 'json';
                if (/^\s*#.*\n/m.test(c) && /^\s*(echo|export|source)\b/m.test(c)) return 'shell';
                // Default
                return cell.type === 'code' ? 'python' : 'markdown';
            }

            // Classify a single line â†’ { sym, cls, category }
            classifyLine(line, language) {
                const patterns = QuantumNotebookWeb.LANG_PATTERNS[language]
                                || QuantumNotebookWeb.LANG_PATTERNS.python;
                for (const [category, regex] of Object.entries(patterns)) {
                    if (regex.test(line)) {
                        const pfx = QuantumNotebookWeb.PREFIXES[category]
                                   || QuantumNotebookWeb.PREFIXES.default;
                        return { ...pfx, category };
                    }
                }
                return { ...QuantumNotebookWeb.PREFIXES.default, category: 'default' };
            }

            // Generate prefixed version of cell content (quantum gutter prepended to each line)
            prefixContent(cell) {
                const language = this.detectCellLanguage(cell);
                const lines = (cell.content || '').split('\n');
                return lines.map(line => {
                    const { sym } = this.classifyLine(line, language);
                    return `${sym} ${line}`;
                }).join('\n');
            }

            // Generate prefix metadata for a cell (per-line classification + aggregate counts)
            prefixMetadata(cell) {
                const language = this.detectCellLanguage(cell);
                const lines = (cell.content || '').split('\n');
                const counts = {};
                let classified = 0;
                const lineData = lines.map((line, i) => {
                    const { sym, category } = this.classifyLine(line, language);
                    counts[category] = (counts[category] || 0) + 1;
                    if (category !== 'default') classified++;
                    return { line: i + 1, sym, category };
                });
                return {
                    language,
                    totalLines: lines.length,
                    classifiedLines: classified,
                    coverage: lines.length > 0 ? Math.round((classified / lines.length) * 100) : 0,
                    prefixCounts: counts,
                    lines: lineData
                };
            }

            // Debounced gutter update (100ms) to avoid thrashing on rapid typing
            _gutterTimers = {};
            debouncedUpdateGutter(cellId) {
                clearTimeout(this._gutterTimers[cellId]);
                this._gutterTimers[cellId] = setTimeout(() => this.updateGutter(cellId), 100);
            }

            // Update the quantum gutter for a cell
            updateGutter(cellId) {
                const cell = this.cells.find(c => c.id === cellId);
                const gutterEl = document.getElementById(`${cellId}-gutter`);
                if (!cell || !gutterEl) return;

                const language = this.detectCellLanguage(cell);
                const lines = (cell.content || '').split('\n');
                const prefixCounts = {};
                let classified = 0;

                let html = '';
                lines.forEach((line, i) => {
                    const { sym, cls, category } = this.classifyLine(line, language);
                    prefixCounts[category] = (prefixCounts[category] || 0) + 1;
                    if (category !== 'default') classified++;
                    html += `<div class="gutter-line"><span class="gutter-prefix ${cls}">${sym}</span><span class="gutter-num">${i + 1}</span></div>`;
                });

                gutterEl.innerHTML = html;

                // Update the convert timeline with aggregate stats
                this._updateConvertTimeline(lines.length, classified, language, prefixCounts);
            }

            // Sync gutter scroll with textarea scroll
            syncGutterScroll(cellId, textarea) {
                const gutterEl = document.getElementById(`${cellId}-gutter`);
                if (gutterEl) {
                    gutterEl.scrollTop = textarea.scrollTop;
                }
            }

            /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               CONVERT TIMELINE â€” auto-recalibrate on paste/edit
               â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

            _updateConvertTimeline(totalLines, classifiedLines, language, prefixCounts) {
                const coverage = totalLines > 0 ? Math.round((classifiedLines / totalLines) * 100) : 0;

                const fill = document.getElementById('ctl-fill');
                const linesEl = document.getElementById('ctl-lines');
                const covEl = document.getElementById('ctl-coverage');
                const langEl = document.getElementById('ctl-lang');

                if (fill) fill.style.width = `${coverage}%`;
                if (linesEl) linesEl.innerHTML = `Lines: <b>${totalLines}</b>`;
                if (covEl) covEl.innerHTML = `Coverage: <b>${coverage}%</b>`;
                if (langEl) langEl.innerHTML = `Lang: <b>${language}</b>`;

                // Color the 9 segment bars proportionally
                const timeline = document.getElementById('convert-timeline');
                if (!timeline) return;
                const segOrder = ['shebang','comment','import','class','function','error','condition','variable','return'];
                const segs = timeline.querySelectorAll('.ctl-seg');
                const total = Object.values(prefixCounts).reduce((a, b) => a + b, 0) || 1;
                segs.forEach((seg, i) => {
                    const cat = segOrder[i];
                    const count = prefixCounts[cat] || 0;
                    const pct = (count / total) * 100;
                    const pfx = QuantumNotebookWeb.PREFIXES[cat] || QuantumNotebookWeb.PREFIXES.default;
                    if (pct > 0) {
                        seg.style.background = `var(--cursor-bg)`;
                        seg.style.borderBottom = `3px solid`;
                        seg.style.borderBottomColor = getComputedStyle(document.createElement('span')).color; // fallback
                        // Use a temp element to get the color from the CSS class
                        const tmp = document.createElement('span');
                        tmp.className = pfx.cls;
                        document.body.appendChild(tmp);
                        const clr = getComputedStyle(tmp).color;
                        document.body.removeChild(tmp);
                        seg.style.borderBottomColor = clr;
                        seg.style.opacity = Math.max(0.3, pct / 50);
                    } else {
                        seg.style.borderBottom = 'none';
                        seg.style.opacity = '0.15';
                    }
                    const label = seg.querySelector('.ctl-seg-label');
                    if (label && count > 0) {
                        label.textContent = `${pfx.sym} ${count}`;
                    }
                });
            }

            // Handle paste event â€” auto-prefix the pasted content
            handlePaste(cellId) {
                const cell = this.cells.find(c => c.id === cellId);
                if (!cell) return;

                // Refresh the cell content from the textarea
                const ta = document.querySelector(`#${cellId} .cell-textarea`);
                if (ta) {
                    cell.content = ta.value;
                }

                // Log paste to stream
                const lineCount = (cell.content || '').split('\n').length;
                this._logStream(`paste ${lineCount}L`, cellId.substring(0, 15), 'paste');

                // Animate the timeline converting
                const timeline = document.getElementById('convert-timeline');
                if (timeline) {
                    timeline.classList.add('converting');
                    setTimeout(() => timeline.classList.remove('converting'), 1500);
                }

                // Auto-detect language on paste
                const language = this.detectCellLanguage(cell);

                // Update gutter (which also updates the timeline)
                this.updateGutter(cellId);

                // If bridge is connected, also send for server-side prefix analysis
                if (this.wsConnected && this.ws) {
                    this.ws.send(JSON.stringify({
                        type: 'prefix',
                        code: cell.content,
                        language: language,
                    }));
                }
            }

            /* ---------- Undo / Redo ---------- */
            _pushUndo() {
                // Snapshot current state
                const snapshot = JSON.stringify(this.cells.map(c => ({
                    id: c.id, type: c.type, content: c.content,
                    quantumPosition: c.quantumPosition, executionCount: c.executionCount,
                })));
                // Don't push if identical to top
                if (this._undoStack.length > 0 && this._undoStack[this._undoStack.length - 1] === snapshot) return;
                this._undoStack.push(snapshot);
                if (this._undoStack.length > 50) this._undoStack.shift(); // cap at 50
                this._redoStack = []; // clear redo on new action
            }

            undo() {
                if (this._undoStack.length === 0) return;
                // Save current to redo
                const currentSnapshot = JSON.stringify(this.cells.map(c => ({
                    id: c.id, type: c.type, content: c.content,
                    quantumPosition: c.quantumPosition, executionCount: c.executionCount,
                })));
                this._redoStack.push(currentSnapshot);
                if (this._redoStack.length > 50) this._redoStack.shift(); // cap at 50

                const prev = JSON.parse(this._undoStack.pop());
                prev.forEach(snap => {
                    const cell = this.cells.find(c => c.id === snap.id);
                    if (cell) {
                        cell.content = snap.content;
                        cell.type = snap.type;
                        const ta = document.querySelector(`#${cell.id} .cell-textarea`);
                        if (ta) { ta.value = cell.content; this.autoResize(ta); }
                        this.updateGutter(cell.id);
                    }
                });
                this._logStream('undo', `stack: ${this._undoStack.length}`, 'nav');
            }

            redo() {
                if (this._redoStack.length === 0) return;
                // Save current to undo
                const currentSnapshot = JSON.stringify(this.cells.map(c => ({
                    id: c.id, type: c.type, content: c.content,
                    quantumPosition: c.quantumPosition, executionCount: c.executionCount,
                })));
                this._undoStack.push(currentSnapshot);

                const next = JSON.parse(this._redoStack.pop());
                next.forEach(snap => {
                    const cell = this.cells.find(c => c.id === snap.id);
                    if (cell) {
                        cell.content = snap.content;
                        cell.type = snap.type;
                        const ta = document.querySelector(`#${cell.id} .cell-textarea`);
                        if (ta) { ta.value = cell.content; this.autoResize(ta); }
                        this.updateGutter(cell.id);
                    }
                });
                this._logStream('redo', `stack: ${this._redoStack.length}`, 'nav');
            }

            /* ---------- Cell Helpers ---------- */
            updateCell(cellId, content) {
                const cell = this.cells.find(c => c.id === cellId);
                if (cell) {
                    // Debounced undo snapshot (every 500ms of inactivity)
                    clearTimeout(this._undoDebounce);
                    this._undoDebounce = setTimeout(() => this._pushUndo(), 500);
                    cell.content = content;
                    if (this.autoSave) this.saveNotebook();
                }
            }

            focusCell(cellId) {
                this.currentCellId = cellId;
                document.querySelectorAll('.quantum-cell').forEach(c => c.classList.remove('focused'));
                const el = document.getElementById(cellId);
                if (el) el.classList.add('focused');
                // Refresh timeline for the focused cell
                this.updateGutter(cellId);
            }

            deleteCell(cellId) {
                if (this.cells.length <= 1) return; // keep at least one cell
                this.cells = this.cells.filter(c => c.id !== cellId);
                const el = document.getElementById(cellId);
                if (el) el.remove();
                if (this.currentCellId === cellId) this.currentCellId = null;
                this.updateCellList();
                this.updateStats();
            }

            /* ---------- Footer: AI Input ---------- */
            handleAiInput(text) {
                text = text.trim();
                if (!text) return;

                // If bridge is connected, send to AI endpoint
                if (this.wsConnected) {
                    const id = this.addCell('code', `# ðŸ¤– AI Query: ${text}`);
                    const outputEl = document.getElementById(`${id}-output`);
                    if (outputEl) {
                        outputEl.style.display = 'block';
                        outputEl.innerHTML = '<div class="output-text" style="color:var(--cursor-accent);">â³ Querying AI&hellip;</div>';
                    }
                    fetch(`${this.apiUrl}/api/ai`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: text }),
                    })
                    .then(r => r.json())
                    .then(msg => {
                        if (outputEl) {
                            const lines = [];
                            if (msg.text) lines.push(...msg.text.split('\n'));
                            if (msg.model) lines.push(`\nðŸ¤– Model: ${msg.model}`);
                            if (msg.error) lines.push(`âŒ ${msg.error}`);
                            if (lines.length === 0) lines.push('(no response)');
                            outputEl.innerHTML = lines.map(l => `<div class="output-text">${l}</div>`).join('');
                        }
                    })
                    .catch(() => {
                        if (outputEl) outputEl.innerHTML = '<div class="output-error">AI bridge unreachable</div>';
                    });
                    requestAnimationFrame(() => {
                        const el = document.querySelector(`#${id} .cell-textarea`);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                } else {
                    const id = this.addCell('code', `# ðŸ¤– AI Query: ${text}\nprint("AI processing: ${text.replace(/"/g, '\\"')}")`);
                    requestAnimationFrame(() => {
                        const el = document.querySelector(`#${id} .cell-textarea`);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                    this.executeCell(id);
                }
            }

            /* ---------- Footer: Command Input ---------- */
            handleCommand(cmd) {
                cmd = cmd.trim();
                if (!cmd) return;

                const responses = {
                    'qstatus': () => {
                        // Run real benchmarks inline
                        const mathT0 = performance.now();
                        let s = 0; for (let i = 0; i < 100000; i++) s += Math.sqrt(i) * Math.sin(i);
                        const mathMs = performance.now() - mathT0;

                        const domT0 = performance.now();
                        const frag = document.createDocumentFragment();
                        for (let i = 0; i < 1000; i++) { const d = document.createElement('div'); d.textContent = 'x'; frag.appendChild(d); }
                        const domMs = performance.now() - domT0;

                        const jsonT0 = performance.now();
                        const obj = {}; for (let i = 0; i < 3000; i++) obj['k' + i] = { v: Math.random() };
                        JSON.parse(JSON.stringify(obj));
                        const jsonMs = performance.now() - jsonT0;

                        const canvasT0 = performance.now();
                        const tc = document.createElement('canvas'); tc.width = 100; tc.height = 100;
                        const ctx = tc.getContext('2d');
                        for (let i = 0; i < 2000; i++) { ctx.fillStyle = 'hsl(' + i + ',50%,50%)'; ctx.fillRect(Math.random()*100, Math.random()*100, 3, 3); }
                        const canvasMs = performance.now() - canvasT0;

                        const cores = navigator.hardwareConcurrency || '?';
                        const mem = navigator.deviceMemory || '?';
                        const conn = navigator.connection;
                        const netType = conn ? conn.effectiveType : 'unknown';
                        const downlink = conn ? conn.downlink + ' Mbps' : 'N/A';
                        const rtt = conn ? conn.rtt + ' ms' : 'N/A';

                        const nav = performance.getEntriesByType && performance.getEntriesByType('navigation')[0];
                        let netTrace = '';
                        if (nav) {
                            netTrace = `\n\nðŸ“¡ NETWORK TRACE (page load)\n` +
                                `   DNS lookup:    ${(nav.domainLookupEnd - nav.domainLookupStart).toFixed(1)} ms\n` +
                                `   TCP connect:   ${(nav.connectEnd - nav.connectStart).toFixed(1)} ms\n` +
                                `   TLS handshake: ${(nav.connectEnd - (nav.secureConnectionStart || nav.connectStart)).toFixed(1)} ms\n` +
                                `   TTFB:          ${(nav.responseStart - nav.requestStart).toFixed(1)} ms\n` +
                                `   Download:      ${(nav.responseEnd - nav.responseStart).toFixed(1)} ms\n` +
                                `   DOM ready:     ${(nav.domContentLoadedEventEnd - nav.startTime).toFixed(0)} ms\n` +
                                `   Full load:     ${(nav.loadEventEnd - nav.startTime).toFixed(0)} ms`;
                        }

                        const gpu = (() => {
                            try {
                                const c = document.createElement('canvas');
                                const gl = c.getContext('webgl2') || c.getContext('webgl');
                                if (!gl) return 'N/A';
                                const ext = gl.getExtension('WEBGL_debug_renderer_info');
                                return ext ? gl.getParameter(ext.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
                            } catch(e) { return 'N/A'; }
                        })();

                        return `ðŸŒŒ QUANTUM STATUS\n` +
                            `   Position:  [${this.quantumPosition.join(', ')}]\n` +
                            `   Layer:     ${this.quantumPosition[2]} (${this.quantumPosition[2] === 0 ? 'âˆž origin' : 'âœ± compute'})\n` +
                            `   Cells:     ${this.cells.length}\n` +
                            `   Executions:${this.executionCount}\n` +
                            `   Bridge:    ${this.wsConnected ? 'ðŸŸ¢ Connected' : 'ðŸ”´ Offline'}\n` +
                            `   Stream:    ${this._streamHistory.length} events\n` +
                            `   Undo stack:${this._undoStack.length} / Redo: ${this._redoStack.length}\n` +
                            `\nðŸ–¥ï¸  HARDWARE\n` +
                            `   CPU cores:     ${cores}\n` +
                            `   Device memory: ${mem} GB\n` +
                            `   GPU:           ${gpu}\n` +
                            `   Platform:      ${navigator.platform}\n` +
                            `   User agent:    ${navigator.userAgent.substring(0, 80)}...\n` +
                            `\nâš¡ CPU BENCHMARKS\n` +
                            `   Math (100K ops): ${mathMs.toFixed(1)} ms  (${(100000 / mathMs).toFixed(0)} ops/ms)\n` +
                            `   DOM (1K create):  ${domMs.toFixed(1)} ms  (${(1000 / domMs).toFixed(0)} creates/ms)\n` +
                            `   Canvas (2K rect): ${canvasMs.toFixed(1)} ms  (${(2000 / canvasMs).toFixed(0)} rects/ms)\n` +
                            `   JSON (3K ser):    ${jsonMs.toFixed(1)} ms  (${(3000 / jsonMs).toFixed(1)} obj/ms)\n` +
                            `\nðŸŒ NETWORK\n` +
                            `   Type:     ${netType}\n` +
                            `   Downlink: ${downlink}\n` +
                            `   RTT:      ${rtt}` +
                            netTrace +
                            `\n\nâœ… UV-Speed Stack: Active`;
                    },
                    'help': () => 'ðŸŒŒ UV-Speed Quantum Terminal\n\nCommands:\n  qstatus â€” Show quantum state + benchmarks\n  pos â€” Current position\n  cells â€” List cells\n  uv [cmd] â€” UV package manager (real exec via bridge)\n  q [term] â€” Semantic search\n  ai [prompt] â€” AI inference\n  bridge â€” Show bridge status\n  scan â€” Security scan all cells\n  hook â€” Install quantum pre-commit hook\n  save â€” Save to localStorage\n  load â€” Load .json notebook\n  help â€” This message',
                    'scan': () => { this._runSecurityScan(); return 'ðŸ›¡ Security scan starting...'; },
                    'hook': () => { this._installGitHook(); return 'ðŸª Installing quantum pre-commit hook...'; },
                    'pos': () => `ðŸ“ Position: [${this.quantumPosition.join(', ')}]\n   X=${this.quantumPosition[0]} (deps)  Y=${this.quantumPosition[1]} (lines)  Z=${this.quantumPosition[2]} (complexity)`,
                    'cells': () => this.cells.map((c, i) => `  [${i}] ${c.type} â€” ${c.content.split('\\n')[0].slice(0, 40)}`).join('\n'),
                    'bridge': () => `ðŸ”Œ Bridge Status: ${this.wsConnected ? 'ðŸŸ¢ Connected' : 'ðŸ”´ Offline'}\n   HTTP: ${this.apiUrl}\n   WS: ${this.bridgeUrl}`,
                    'save': () => { this._saveToLocalStorage(); return 'ðŸ’¾ Saved to localStorage'; },
                    'load': () => { this.loadNotebook(); return 'ðŸ“‚ Opening file picker...'; },
                    'kbatch': () => { this._runTool('kbatch'); return 'âŒ¨ Launching kbatch analysis...'; },
                    'signal': () => { this._runTool('signal'); return 'ðŸ“¡ Launching signal analysis...'; },
                    'geokey': () => { this._runTool('geokey'); return 'ðŸ”· Launching GeoKey mapper...'; },
                    'youtube': () => { this._runTool('youtube'); return 'ðŸŽ¬ Launching YouTube transcript...'; },
                    'chartgpu': () => { this._fetchChartGPUMetrics(); return 'ðŸ“Š Fetching ChartGPU metrics...'; },
                    'quest': () => { this._checkQuestStatus(); return 'ðŸ¥½ Checking Quest status...'; },
                    'jawta': () => { this._runTool('jawta'); return 'ðŸ“¡ Launching Jawta signal intel...'; },
                    'media': () => { this._runTool('media'); return 'ðŸŽž Launching media pipeline...'; },
                    'lark': () => { this._runTool('lark-status'); return 'ðŸ¦ Checking Lark status...'; },
                    'hexbench': () => { openOverlay('hexbench.html', 'hexbench'); return 'âš¡ Opening hexbench Voltage Lab...'; },
                    'tools': () => {
                        return 'ðŸ”§ Available tools:\n  kbatch   â€” keyboard analysis\n  signal   â€” Morse/binary/waveform\n  geokey   â€” geometric keyboard mapper\n  youtube  â€” transcript extraction\n  chartgpu â€” GPU metrics + AI analysis\n  quest    â€” Meta Quest device status\n  jawta    â€” signal intel + spectrum\n  media    â€” audio/video pipeline\n  lark     â€” Lark IANA status\n  hexbench â€” voltage lab + electronics workbench';
                    },
                };

                const showOutput = (output) => {
                    const id = this.addCell('code', `# Terminal: ${cmd}`);
                    const cell = this.cells.find(c => c.id === id);
                    if (cell) cell.executionCount = ++this.executionCount;
                    const outputEl = document.getElementById(`${id}-output`);
                    if (outputEl) {
                        outputEl.style.display = 'block';
                        outputEl.innerHTML = output.split('\n').map(l => `<div class="output-text">${l}</div>`).join('');
                    }
                    this.updateStats();
                    this.updateCellList();
                    requestAnimationFrame(() => {
                        const el = document.getElementById(id);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                };

                if (responses[cmd]) {
                    // Show progress for qstatus (benchmarks take a moment)
                    if (cmd === 'qstatus') {
                        this._showProgress('ðŸ“Š Benchmarking');
                        this._updateProgress(1, 4, 'running CPU tests...');
                    }
                    const result = responses[cmd]();
                    if (cmd === 'qstatus') this._hideProgress(800);
                    showOutput(result);
                } else if (cmd.startsWith('uv ')) {
                    // Execute via bridge shell mode
                    if (this.wsConnected) {
                        this._showProgress('ðŸš€ ' + cmd);
                        this._updateProgress(1, 3, 'sending to bridge...');
                        const id = this.addCell('code', `# Terminal: ${cmd}`);
                        const outputEl = document.getElementById(`${id}-output`);
                        if (outputEl) {
                            outputEl.style.display = 'block';
                            outputEl.innerHTML = '<div class="output-text" style="color:var(--cursor-accent);">â³ Executing via uv&hellip;</div>';
                        }
                        this._updateProgress(2, 3, 'awaiting response...');
                        fetch(`${this.apiUrl}/api/execute`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ code: cmd, mode: 'shell' }),
                        })
                        .then(r => r.json())
                        .then(msg => {
                            const lines = [];
                            if (msg.stdout) lines.push(...msg.stdout.split('\n').filter(l => l));
                            if (msg.stderr) lines.push(`âš  ${msg.stderr}`);
                            if (msg.error) lines.push(`âŒ ${msg.error}`);
                            if (lines.length === 0) lines.push('âœ… Command completed');
                            lines.push(`â± ${msg.elapsed_ms || 0} ms`);
                            if (outputEl) outputEl.innerHTML = lines.map(l => `<div class="output-text">${l}</div>`).join('');
                            this._hideProgress(1000);
                        })
                        .catch(() => { if (outputEl) outputEl.innerHTML = '<div class="output-error">Bridge unreachable</div>'; this._hideProgress(500); });
                    } else {
                        showOutput(`ðŸš€ UV executing: ${cmd.slice(3)}\n   ðŸ’¡ Start bridge: python3 quantum_bridge_server.py`);
                    }
                } else if (cmd.startsWith('ai ')) {
                    this.handleAiInput(cmd.slice(3));
                } else if (cmd.startsWith('q ')) {
                    showOutput(`ðŸ” Semantic search: "${cmd.slice(2)}"\n   (GrepAI integration coming in Phase 3)`);
                } else {
                    // Try executing as a shell command via bridge
                    if (this.wsConnected) {
                        this._showProgress('âš¡ ' + cmd.substring(0, 30));
                        this._updateProgress(1, 2, 'executing...');
                        const id = this.addCell('code', `# Terminal: ${cmd}`);
                        const outputEl = document.getElementById(`${id}-output`);
                        if (outputEl) {
                            outputEl.style.display = 'block';
                            outputEl.innerHTML = '<div class="output-text" style="color:var(--cursor-accent);">â³ Executing&hellip;</div>';
                        }
                        fetch(`${this.apiUrl}/api/execute`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ code: cmd, mode: 'shell' }),
                        })
                        .then(r => r.json())
                        .then(msg => {
                            const lines = [];
                            if (msg.stdout) lines.push(...msg.stdout.split('\n').filter(l => l));
                            if (msg.stderr) lines.push(`âš  ${msg.stderr}`);
                            if (msg.error) lines.push(`âŒ ${msg.error}`);
                            if (lines.length === 0) lines.push(`âœ… Exit ${msg.returncode || 0}`);
                            if (outputEl) outputEl.innerHTML = lines.map(l => `<div class="output-text">${l}</div>`).join('');
                            this._hideProgress(1000);
                        })
                        .catch(() => { if (outputEl) outputEl.innerHTML = '<div class="output-error">Bridge unreachable</div>'; this._hideProgress(500); });
                    } else {
                        showOutput(`âš¡ Command: ${cmd}\n   Processed at [${this.quantumPosition.join(', ')}]\n   ðŸ’¡ Start bridge for real execution: python3 quantum_bridge_server.py`);
                    }
                }
            }

            /* ---------- In-Cell Utility Tools ---------- */
            toggleCellTools(cellId) {
                const bar = document.getElementById(`${cellId}-tools`);
                if (!bar) return;
                bar.style.display = bar.style.display === 'none' ? 'flex' : 'none';
            }

            cellTool(cellId, tool) {
                const cell = this.cells.find(c => c.id === cellId);
                if (!cell) return;
                const ta = document.querySelector(`#${cellId} .cell-textarea`);
                const content = ta ? ta.value : cell.content;
                const sel = ta && ta.selectionStart !== ta.selectionEnd
                    ? content.substring(ta.selectionStart, ta.selectionEnd)
                    : content.trim();
                const outputEl = document.getElementById(`${cellId}-output`);

                const show = (html) => {
                    if (outputEl) { outputEl.style.display = 'block'; outputEl.innerHTML = `<div class="cell-tool-result">${html}</div>`; }
                };

                switch (tool) {
                    case 'calc': {
                        try {
                            // Evaluate each line that looks like math
                            const lines = sel.split('\n').map(l => {
                                const expr = l.replace(/#.*/, '').trim();
                                if (!expr) return '';
                                try {
                                    // Safe math eval (no Function constructor tricks â€” basic arithmetic, Math.*)
                                    const safe = expr.replace(/\b(Math\.\w+|pi|e|sqrt|abs|sin|cos|tan|log|pow|ceil|floor|round|min|max|random)\b/gi,
                                        m => m.startsWith('Math.') ? m : `Math.${m.toLowerCase()}`);
                                    const result = Function('"use strict"; return (' + safe + ')')();
                                    return `${expr} = <span style="color:#7ee787;font-weight:700;">${result}</span>`;
                                } catch { return `${expr} â†’ <span style="color:#f97583;">error</span>`; }
                            }).filter(Boolean);
                            show(`ðŸ§® <strong>Calculator</strong><br>${lines.join('<br>')}`);
                        } catch (e) { show(`ðŸ§® Error: ${e.message}`); }
                        break;
                    }
                    case 'unix': {
                        const num = parseInt(sel, 10);
                        if (!isNaN(num) && sel.match(/^\d{9,13}$/)) {
                            const ms = num > 9999999999 ? num : num * 1000;
                            const d = new Date(ms);
                            show(`â± <strong>Unix â†’ Date</strong><br>
                                Input: <code>${num}</code><br>
                                ISO: <span style="color:#7ee787;">${d.toISOString()}</span><br>
                                Local: <span style="color:#58a6ff;">${d.toLocaleString()}</span><br>
                                UTC: ${d.toUTCString()}`);
                        } else {
                            const d = new Date(sel || Date.now());
                            const unix = Math.floor(d.getTime() / 1000);
                            show(`â± <strong>Date â†’ Unix</strong><br>
                                Input: <code>${sel || 'now'}</code><br>
                                Unix (s): <span style="color:#7ee787;font-weight:700;">${unix}</span><br>
                                Unix (ms): ${d.getTime()}<br>
                                ISO: ${d.toISOString()}`);
                        }
                        break;
                    }
                    case 'base': {
                        const num = parseInt(sel.replace(/^0[xXbBoO]/, (m) => m), sel.startsWith('0b') ? 2 : sel.startsWith('0o') ? 8 : sel.startsWith('0x') ? 16 : 10);
                        if (isNaN(num)) { show('ðŸ”¢ Enter a number (dec, 0x hex, 0b bin, 0o oct)'); break; }
                        show(`ðŸ”¢ <strong>Base Converter</strong><br>
                            Dec: <span style="color:#7ee787;font-weight:700;">${num}</span><br>
                            Hex: <span style="color:#58a6ff;">0x${num.toString(16).toUpperCase()}</span><br>
                            Bin: <span style="color:#d2a8ff;">0b${num.toString(2)}</span><br>
                            Oct: <span style="color:#f0883e;">0o${num.toString(8)}</span><br>
                            Char: ${num > 31 && num < 127 ? String.fromCharCode(num) : 'â€”'}`);
                        break;
                    }
                    case 'json': {
                        try {
                            const parsed = JSON.parse(sel);
                            const pretty = JSON.stringify(parsed, null, 2);
                            if (ta) { ta.value = pretty; cell.content = pretty; this.autoResize(ta); }
                            show(`{ } <strong>JSON</strong> â€” valid âœ… (${typeof parsed === 'object' ? (Array.isArray(parsed) ? parsed.length + ' items' : Object.keys(parsed).length + ' keys') : typeof parsed})`);
                        } catch (e) { show(`{ } <strong>JSON</strong> â€” <span style="color:#f97583;">invalid</span>: ${e.message}`); }
                        break;
                    }
                    case 'csv': {
                        const rows = sel.split('\n').filter(Boolean).map(r => r.split(/[,\t]/));
                        const headers = rows[0] || [];
                        let table = '<table style="border-collapse:collapse;width:100%;font-size:0.625rem;"><thead><tr>';
                        headers.forEach(h => { table += `<th style="border:1px solid var(--cursor-border);padding:2px 6px;background:var(--cursor-bg-tertiary);color:var(--cursor-accent);text-align:left;">${h.trim()}</th>`; });
                        table += '</tr></thead><tbody>';
                        rows.slice(1).forEach(r => {
                            table += '<tr>';
                            r.forEach(c => { table += `<td style="border:1px solid var(--cursor-border-muted);padding:2px 6px;">${c.trim()}</td>`; });
                            table += '</tr>';
                        });
                        table += '</tbody></table>';
                        show(`ðŸ“‹ <strong>CSV</strong> â€” ${rows.length} rows Ã— ${headers.length} cols<br>${table}`);
                        break;
                    }
                    case 'url': {
                        try {
                            const decoded = decodeURIComponent(sel);
                            const encoded = encodeURIComponent(sel);
                            show(`ðŸ”— <strong>URL</strong><br>Decoded: <code>${decoded}</code><br>Encoded: <code>${encoded}</code>`);
                        } catch (e) { show(`ðŸ”— Error: ${e.message}`); }
                        break;
                    }
                    case 'hash': {
                        const encoder = new TextEncoder();
                        const data = encoder.encode(sel);
                        crypto.subtle.digest('SHA-256', data).then(buf => {
                            const hex = [...new Uint8Array(buf)].map(b => b.toString(16).padStart(2, '0')).join('');
                            show(`ðŸ” <strong>SHA-256</strong><br><code style="word-break:break-all;color:#7ee787;">${hex}</code><br>
                                <small>Input: ${sel.length} chars Â· ${data.byteLength} bytes</small>`);
                        });
                        break;
                    }
                    case 'regex': {
                        const lines = sel.split('\n');
                        const pattern = lines[0] || '';
                        const testStr = lines.slice(1).join('\n') || '';
                        try {
                            const re = new RegExp(pattern, 'gm');
                            const matches = [...testStr.matchAll(re)];
                            show(`/./ <strong>Regex</strong> â€” <code>/${pattern}/gm</code><br>
                                Matches: <span style="color:#7ee787;font-weight:700;">${matches.length}</span><br>
                                ${matches.slice(0, 20).map((m, i) => `[${i}] <code>${m[0]}</code> @${m.index}`).join('<br>')}`);
                        } catch (e) { show(`/./ <strong>Regex error</strong>: ${e.message}`); }
                        break;
                    }
                    case 'diff': {
                        const parts = sel.split(/\n---\n|\n===\n/);
                        if (parts.length < 2) { show('Â± <strong>Diff</strong> â€” separate two blocks with <code>---</code> or <code>===</code> on its own line'); break; }
                        const a = parts[0].split('\n'), b = parts[1].split('\n');
                        const maxLen = Math.max(a.length, b.length);
                        let html = 'Â± <strong>Diff</strong><br><div style="font-size:0.5625rem;">';
                        for (let i = 0; i < maxLen; i++) {
                            const la = a[i] ?? '', lb = b[i] ?? '';
                            if (la === lb) { html += `<div style="color:var(--cursor-text-muted);">&nbsp; ${la.replace(/</g,'&lt;')}</div>`; }
                            else {
                                if (la) html += `<div style="color:#f97583;">- ${la.replace(/</g,'&lt;')}</div>`;
                                if (lb) html += `<div style="color:#7ee787;">+ ${lb.replace(/</g,'&lt;')}</div>`;
                            }
                        }
                        html += '</div>';
                        show(html);
                        break;
                    }
                    case 'color': {
                        let r = 0, g = 0, b = 0;
                        const hexMatch = sel.match(/#?([0-9a-fA-F]{6})/);
                        const rgbMatch = sel.match(/(\d{1,3})\s*[,\s]\s*(\d{1,3})\s*[,\s]\s*(\d{1,3})/);
                        if (hexMatch) {
                            const h = hexMatch[1]; r = parseInt(h.slice(0,2),16); g = parseInt(h.slice(2,4),16); b = parseInt(h.slice(4,6),16);
                        } else if (rgbMatch) {
                            r = +rgbMatch[1]; g = +rgbMatch[2]; b = +rgbMatch[3];
                        } else { show('ðŸŽ¨ Enter a hex (#ff5733) or RGB (255, 87, 51) color'); break; }
                        const hex = `#${[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('')}`;
                        const max = Math.max(r,g,b)/255, min = Math.min(r,g,b)/255, l = (max+min)/2;
                        show(`ðŸŽ¨ <strong>Color</strong><br>
                            <span style="display:inline-block;width:32px;height:16px;border-radius:3px;background:${hex};border:1px solid var(--cursor-border);vertical-align:middle;"></span>
                            Hex: <code>${hex}</code><br>
                            RGB: <code>rgb(${r}, ${g}, ${b})</code><br>
                            HSL: <code>hsl(â€”, â€”, ${Math.round(l*100)}%)</code><br>
                            CSS: <code>rgba(${r}, ${g}, ${b}, 1.0)</code>`);
                        break;
                    }
                    case 'cdn': {
                        const libs = {
                            'mermaid': 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs',
                            'chart.js': 'https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js',
                            'three': 'https://cdn.jsdelivr.net/npm/three@0.170/build/three.module.min.js',
                            'd3': 'https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js',
                            'htmx': 'https://cdn.jsdelivr.net/npm/htmx.org@2/dist/htmx.min.js',
                            'alpine': 'https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js',
                            'monaco': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.52/min/vs/loader.js',
                            'strudel': 'https://cdn.jsdelivr.net/npm/@strudel/repl@latest',
                            'tone': 'https://cdn.jsdelivr.net/npm/tone@15/build/Tone.min.js',
                            'marked': 'https://cdn.jsdelivr.net/npm/marked@15/marked.min.js',
                            'prism': 'https://cdn.jsdelivr.net/npm/prismjs@1/prism.min.js',
                            'katex': 'https://cdn.jsdelivr.net/npm/katex@0.16/dist/katex.min.js',
                        };
                        const key = sel.toLowerCase().trim();
                        if (libs[key]) {
                            show(`ðŸŒ <strong>CDN</strong> â€” ${key}<br><code style="word-break:break-all;color:#58a6ff;">${libs[key]}</code><br>
                                <button class="cell-tool-btn" onclick="navigator.clipboard.writeText('${libs[key]}')">ðŸ“‹ Copy URL</button>
                                <button class="cell-tool-btn" onclick="navigator.clipboard.writeText('&lt;script src=\\&quot;${libs[key]}\\&quot;&gt;&lt;/script&gt;')">ðŸ“‹ Copy Tag</button>`);
                        } else {
                            show(`ðŸŒ <strong>CDN Library Reference</strong><br>${Object.entries(libs).map(([k,v]) =>
                                `<span style="color:var(--cursor-accent);font-weight:600;">${k}</span>: <code style="font-size:0.5rem;word-break:break-all;">${v}</code>`).join('<br>')}<br><br><em>Type a library name in the cell and click CDN</em>`);
                        }
                        break;
                    }
                    case 'map': {
                        const coords = sel.match(/([-+]?\d+\.?\d*)\s*[,\s]\s*([-+]?\d+\.?\d*)/);
                        if (coords) {
                            const lat = parseFloat(coords[1]), lng = parseFloat(coords[2]);
                            show(`ðŸ—º <strong>Map</strong> â€” ${lat.toFixed(4)}, ${lng.toFixed(4)}<br>
                                <iframe src="https://www.openstreetmap.org/export/embed.html?bbox=${lng-0.01},${lat-0.01},${lng+0.01},${lat+0.01}&layer=mapnik&marker=${lat},${lng}"
                                    style="width:100%;height:200px;border:1px solid var(--cursor-border);border-radius:4px;" loading="lazy"></iframe>
                                <br><a href="https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=15/${lat}/${lng}" target="_blank" style="color:var(--cursor-accent);font-size:0.5625rem;">Open in OpenStreetMap â†—</a>`);
                        } else {
                            show('ðŸ—º <strong>Map</strong> â€” enter coordinates as <code>lat, lng</code> (e.g. <code>37.7749, -122.4194</code>)');
                        }
                        break;
                    }
                    case 'file': {
                        const input = document.createElement('input');
                        input.type = 'file';
                        input.accept = '.json,.csv,.tsv,.txt,.md,.yaml,.yml,.xml,.html,.htm,.svg,.png,.jpg,.jpeg,.gif,.webp,.pdf,.py,.js,.ts,.rs,.zig,.go,.c,.cpp,.h,.toml,.ini,.env,.log';
                        input.onchange = (e) => {
                            const file = e.target.files[0];
                            if (!file) return;
                            const ext = file.name.split('.').pop().toLowerCase();
                            const isImage = ['png','jpg','jpeg','gif','webp','svg'].includes(ext);
                            if (isImage) {
                                const reader = new FileReader();
                                reader.onload = (ev) => {
                                    show(`ðŸ“ <strong>${file.name}</strong> (${(file.size/1024).toFixed(1)} KB)<br>
                                        <img src="${ev.target.result}" style="max-width:100%;max-height:300px;border-radius:4px;border:1px solid var(--cursor-border);">`);
                                };
                                reader.readAsDataURL(file);
                            } else {
                                const reader = new FileReader();
                                reader.onload = (ev) => {
                                    const text = ev.target.result;
                                    if (ta) { ta.value = text; cell.content = text; this.autoResize(ta); this.updateGutter(cellId); }
                                    show(`ðŸ“ <strong>${file.name}</strong> loaded (${(file.size/1024).toFixed(1)} KB Â· ${text.split('\n').length} lines Â· .${ext})`);
                                };
                                reader.readAsText(file);
                            }
                        };
                        input.click();
                        break;
                    }
                    case 'export': {
                        // Build prefixed content with quantum gutter header
                        const prefixed = this.prefixContent(cell);
                        const meta = this.prefixMetadata(cell);
                        const header = `# âš› Quantum Prefix Gutter â€” ${meta.language} â€” ${meta.coverage}% coverage (${meta.classifiedLines}/${meta.totalLines} lines)\n# Symbols: n: +1: -n: +0: 0: -1: +n: 1: -0:\n# ${Object.entries(meta.prefixCounts).map(([k,v]) => `${k}:${v}`).join(' Â· ')}\n\n`;
                        const exportContent = header + prefixed;
                        const blob = new Blob([exportContent], { type: 'text/plain' });
                        const url = URL.createObjectURL(blob);
                        const ext = cell.type === 'markdown' ? 'md' : cell.type === 'mermaid' ? 'mmd' : cell.type === 'visualization' || cell.type === 'quantum' ? 'html' : 'txt';
                        const a = document.createElement('a');
                        a.href = url; a.download = `${cellId}.${ext}`; a.click();
                        URL.revokeObjectURL(url);
                        show(`ðŸ’¾ <strong>Exported</strong> with quantum gutter as <code>${cellId}.${ext}</code> (${meta.coverage}% coverage)`);
                        break;
                    }
                }
            }

            /* ---------- Cell Output Overlay ---------- */
            expandCellOutput(cellId) {
                const cell = this.cells.find(c => c.id === cellId);
                if (!cell) return;

                const overlay = document.getElementById('cell-overlay');
                const title = document.getElementById('cell-overlay-title');
                const body = document.getElementById('cell-overlay-body');
                const typeEmoji = { code: 'âš¡', markdown: 'ðŸ“', visualization: 'ðŸ“Š', quantum: 'ðŸŒŒ', mermaid: 'ðŸ§œ', freya: 'ðŸ”¬', kbatch: 'âŒ¨', hexcast: 'ðŸ“¡' };

                title.innerHTML = `${typeEmoji[cell.type] || 'âš¡'} ${cell.type} â€” [${cell.quantumPosition.join(', ')}]`;

                // Source code block
                const sourceHtml = `<details style="margin-bottom:var(--cursor-space-md);">
                    <summary style="cursor:pointer;font-size:0.75rem;color:var(--cursor-text-muted);font-weight:600;padding:6px 0;">ðŸ“„ Source Code</summary>
                    <div style="padding:var(--cursor-space-sm) var(--cursor-space-md);background:var(--cursor-bg);border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);white-space:pre-wrap;color:var(--cursor-text-secondary);font-size:0.8125rem;font-family:var(--cursor-font-mono);max-height:200px;overflow:auto;">${cell.content.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
                </details>`;

                // Clone existing output or generate fresh
                const existingOutput = document.getElementById(`${cellId}-output`);
                let outputHtml = '';

                if (cell.type === 'visualization' || cell.type === 'quantum') {
                    // Re-run visualization / quantum visual at full overlay size
                    const vizResult = cell.type === 'quantum' ? this._runQuantumCell(cell) : this._runVisualizationCell(cell);
                    body.innerHTML = sourceHtml + `<div class="output-html">${vizResult}</div>`;
                    overlay.classList.add('open');
                    requestAnimationFrame(() => {
                        body.querySelectorAll('script').forEach(oldScript => {
                            const newScript = document.createElement('script');
                            newScript.textContent = oldScript.textContent;
                            oldScript.replaceWith(newScript);
                        });
                    });
                    return;
                } else if (cell.type === 'mermaid') {
                    // Mermaid: re-render at full size with pan/drag/zoom
                    const mermaidId = `overlay_mermaid_${cellId}_${Date.now()}`;
                    const canvasId = `mermaid_canvas_${Date.now()}`;
                    outputHtml = `
                        <div style="display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap;align-items:center;">
                            <button class="btn btn--sm" id="${canvasId}_zin" title="Zoom in">ðŸ”+</button>
                            <button class="btn btn--sm" id="${canvasId}_zreset" title="Reset zoom &amp; pan">1:1</button>
                            <button class="btn btn--sm" id="${canvasId}_zout" title="Zoom out">ðŸ”-</button>
                            <button class="btn btn--sm" id="${canvasId}_fit" title="Fit to view">âŠž Fit</button>
                            <button class="btn btn--sm" onclick="const svg=document.querySelector('#${canvasId} svg');if(svg){const b=new Blob([svg.outerHTML],{type:'image/svg+xml'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='mermaid-diagram.svg';a.click();}" title="Download SVG">ðŸ’¾ SVG</button>
                            <span style="margin-left:auto;font-size:0.625rem;color:var(--cursor-text-muted);" id="${canvasId}_info">Drag to pan Â· Scroll to zoom</span>
                        </div>
                        <div id="${canvasId}" style="overflow:hidden;max-height:70vh;border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);background:var(--cursor-bg-tertiary);cursor:grab;position:relative;">
                            <div id="${canvasId}_inner" style="transform-origin:0 0;transition:none;padding:var(--cursor-space-md);">
                                <div class="mermaid" id="${mermaidId}">${cell.content}</div>
                            </div>
                        </div>`;

                    body.innerHTML = sourceHtml + outputHtml;

                    // Render mermaid then wire up pan/zoom
                    requestAnimationFrame(() => {
                        try {
                            if (window.mermaid) {
                                window.mermaid.run({ nodes: [document.getElementById(mermaidId)] });
                            }
                        } catch (e) {
                            document.getElementById(mermaidId).innerHTML = '<div class="output-error">Mermaid render error: ' + e.message + '</div>';
                        }

                        // Pan/zoom state
                        const container = document.getElementById(canvasId);
                        const inner = document.getElementById(canvasId + '_inner');
                        const info = document.getElementById(canvasId + '_info');
                        if (!container || !inner) return;

                        let scale = 1, panX = 0, panY = 0, dragging = false, startX = 0, startY = 0;

                        function applyTransform() {
                            inner.style.transform = 'translate(' + panX + 'px,' + panY + 'px) scale(' + scale + ')';
                            if (info) info.textContent = Math.round(scale * 100) + '% Â· [' + Math.round(panX) + ', ' + Math.round(panY) + ']';
                        }

                        // Mouse drag to pan
                        container.addEventListener('mousedown', function(e) {
                            dragging = true; startX = e.clientX - panX; startY = e.clientY - panY;
                            container.style.cursor = 'grabbing';
                            e.preventDefault();
                        });
                        document.addEventListener('mousemove', function(e) {
                            if (!dragging) return;
                            panX = e.clientX - startX; panY = e.clientY - startY;
                            applyTransform();
                        });
                        document.addEventListener('mouseup', function() {
                            dragging = false; container.style.cursor = 'grab';
                        });

                        // Scroll to zoom
                        container.addEventListener('wheel', function(e) {
                            e.preventDefault();
                            const delta = e.deltaY > 0 ? 0.9 : 1.1;
                            const rect = container.getBoundingClientRect();
                            const mx = e.clientX - rect.left, my = e.clientY - rect.top;
                            const newScale = Math.min(5, Math.max(0.2, scale * delta));
                            panX = mx - (mx - panX) * (newScale / scale);
                            panY = my - (my - panY) * (newScale / scale);
                            scale = newScale;
                            applyTransform();
                        }, { passive: false });

                        // Touch drag
                        container.addEventListener('touchstart', function(e) {
                            if (e.touches.length === 1) {
                                dragging = true; startX = e.touches[0].clientX - panX; startY = e.touches[0].clientY - panY;
                            }
                        }, { passive: true });
                        container.addEventListener('touchmove', function(e) {
                            if (!dragging || e.touches.length !== 1) return;
                            panX = e.touches[0].clientX - startX; panY = e.touches[0].clientY - startY;
                            applyTransform();
                        }, { passive: true });
                        container.addEventListener('touchend', function() { dragging = false; });

                        // Zoom buttons
                        document.getElementById(canvasId + '_zin').addEventListener('click', function() {
                            scale = Math.min(5, scale * 1.3); applyTransform();
                        });
                        document.getElementById(canvasId + '_zout').addEventListener('click', function() {
                            scale = Math.max(0.2, scale * 0.7); applyTransform();
                        });
                        document.getElementById(canvasId + '_zreset').addEventListener('click', function() {
                            scale = 1; panX = 0; panY = 0; applyTransform();
                        });
                        document.getElementById(canvasId + '_fit').addEventListener('click', function() {
                            const svg = inner.querySelector('svg');
                            if (!svg) return;
                            const cr = container.getBoundingClientRect();
                            const sr = svg.getBoundingClientRect();
                            const fitScale = Math.min(cr.width / (sr.width / scale), cr.height / (sr.height / scale)) * 0.9;
                            scale = fitScale; panX = 0; panY = 0; applyTransform();
                        });
                    });
                } else if (existingOutput && existingOutput.innerHTML && existingOutput.style.display !== 'none') {
                    outputHtml = existingOutput.innerHTML;
                    body.innerHTML = sourceHtml + `<div style="border:1px solid var(--cursor-border);border-radius:var(--cursor-radius-md);padding:var(--cursor-space-md);background:var(--cursor-bg-tertiary);max-height:70vh;overflow:auto;">${outputHtml}</div>`;
                } else {
                    const result = this._localExecution(cell);
                    if (result.type === 'text') {
                        outputHtml = result.data.map(l => `<div class="output-text">${l}</div>`).join('');
                    } else if (result.type === 'html') {
                        outputHtml = `<div class="output-html">${result.data}</div>`;
                    }
                    body.innerHTML = sourceHtml + outputHtml;
                }

                overlay.classList.add('open');

                // Activate any <script> tags in the overlay body
                requestAnimationFrame(() => {
                    body.querySelectorAll('script').forEach(oldScript => {
                        const newScript = document.createElement('script');
                        newScript.textContent = oldScript.textContent;
                        oldScript.replaceWith(newScript);
                    });
                });
            }

            /* ---------- Execution Progress ---------- */
            _showProgress(label = 'â–¶ Running') {
                const bar = document.getElementById('exec-progress');
                document.getElementById('exec-progress-label').textContent = label;
                document.getElementById('exec-progress-fill').style.width = '0%';
                document.getElementById('exec-progress-pct').textContent = '0%';
                document.getElementById('exec-progress-detail').textContent = '';
                document.getElementById('exec-progress-elapsed').textContent = '';
                bar.classList.add('active');
                this._progressStart = performance.now();
            }

            _updateProgress(current, total, detail = '') {
                const pct = Math.round((current / total) * 100);
                document.getElementById('exec-progress-fill').style.width = pct + '%';
                document.getElementById('exec-progress-pct').textContent = pct + '%';
                document.getElementById('exec-progress-detail').textContent = detail;
                const elapsed = ((performance.now() - (this._progressStart || 0)) / 1000).toFixed(1);
                document.getElementById('exec-progress-elapsed').textContent = elapsed + 's';
            }

            _hideProgress(delay = 1500) {
                const fill = document.getElementById('exec-progress-fill');
                const label = document.getElementById('exec-progress-label');
                const pct = document.getElementById('exec-progress-pct');
                fill.style.width = '100%';
                pct.textContent = '100%';
                label.textContent = 'âœ“ Done';
                const elapsed = ((performance.now() - (this._progressStart || 0)) / 1000).toFixed(1);
                document.getElementById('exec-progress-elapsed').textContent = elapsed + 's';
                setTimeout(() => {
                    document.getElementById('exec-progress').classList.remove('active');
                }, delay);
            }

            async runAllCells() {
                const total = this.cells.length;
                if (total === 0) return;

                this._showProgress(`â–¶ Run All (${total})`);

                for (let i = 0; i < total; i++) {
                    const cell = this.cells[i];
                    const shortName = cell.type + ' ' + (cell.content || '').split('\n')[0].substring(0, 25);
                    this._updateProgress(i, total, shortName);

                    // Execute and wait a tick so the UI updates
                    this.executeCell(cell.id);
                    await new Promise(r => setTimeout(r, 60));
                }

                this._updateProgress(total, total, 'all cells complete');
                this._hideProgress(2000);
            }

            saveNotebook() {
                // Build cells with quantum prefix metadata + prefixed content
                const cellsWithPrefixes = this.cells.map(cell => ({
                    ...cell,
                    prefixedContent: this.prefixContent(cell),
                    quantumPrefix: this.prefixMetadata(cell)
                }));

                // Compute aggregate notebook-level prefix stats
                let totalLines = 0, totalClassified = 0;
                const globalCounts = {};
                cellsWithPrefixes.forEach(c => {
                    if (c.quantumPrefix) {
                        totalLines += c.quantumPrefix.totalLines;
                        totalClassified += c.quantumPrefix.classifiedLines;
                        for (const [cat, count] of Object.entries(c.quantumPrefix.prefixCounts)) {
                            globalCounts[cat] = (globalCounts[cat] || 0) + count;
                        }
                    }
                });

                const nb = {
                    cells: cellsWithPrefixes,
                    quantumPosition: this.quantumPosition,
                    executionCount: this.executionCount,
                    metadata: {
                        created: new Date().toISOString(),
                        type: 'uvspeed-quantum-notepad',
                        quantumGutter: {
                            totalLines,
                            classifiedLines: totalClassified,
                            coverage: totalLines > 0 ? Math.round((totalClassified / totalLines) * 100) + '%' : '0%',
                            prefixCounts: globalCounts,
                            symbols: ['n:', '+1:', '-n:', '+0:', '0:', '-1:', '+n:', '1:', '-0:'],
                            version: '9-symbol-v1'
                        }
                    }
                };

                // Always save to localStorage
                this._saveToLocalStorage();

                // Also save to bridge server if connected
                if (this.wsConnected) {
                    fetch(`${this.apiUrl}/api/sessions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ...nb, id: 'current' }),
                    }).catch(() => {});
                }

                // Download as file
                const blob = new Blob([JSON.stringify(nb, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `quantum-notebook-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            /* ---------- Sidebar: Cell List ---------- */
            updateCellList() {
                const typeEmoji = { code: 'âš¡', markdown: 'ðŸ“', visualization: 'ðŸ“Š', quantum: 'ðŸŒŒ', mermaid: 'ðŸ§œ', freya: 'ðŸ”¬', kbatch: 'âŒ¨', hexcast: 'ðŸ“¡' };
                const cellList = document.getElementById('cell-list');
                const total = this.cells.length;
                const curIdx = this.currentCellId ? this.cells.findIndex(c => c.id === this.currentCellId) : -1;
                cellList.innerHTML = this.cells.map((cell, i) => {
                    const emoji = typeEmoji[cell.type] || 'âš¡';
                    const exec = cell.executionCount ? `[${cell.executionCount}]` : '';
                    const preview = cell.content
                        ? cell.content.split('\n')[0].slice(0, 24)
                        : '(empty)';
                    const isActive = cell.id === this.currentCellId ? ' active' : '';
                    return `<li class="cell-list-item${isActive}" data-cell-idx="${i}" onclick="notebook.focusAndScrollToCell('${cell.id}')">
                        <span class="cell-list-icon">${emoji}</span>
                        <span style="flex:1;overflow:hidden;text-overflow:ellipsis">${preview}</span>
                        <span style="opacity:0.5;flex-shrink:0">${exec}</span>
                        <span class="cli-move" onclick="event.stopPropagation();notebook.moveCellUp(${i})" title="Move up">â–´</span>
                        <span class="cli-move" onclick="event.stopPropagation();notebook.moveCellDown(${i})" title="Move down">â–¾</span>
                    </li>`;
                }).join('');
                // Update counter
                const counter = document.getElementById('cnav-counter');
                if (counter) counter.textContent = curIdx >= 0 ? `${curIdx + 1}/${total}` : `â€”/${total}`;
            }

            /* ---------- Cell Navigation ---------- */
            focusAndScrollToCell(cellId) {
                this.focusCell(cellId);
                const el = document.getElementById(cellId);
                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                this.updateCellList();
            }

            navigateCell(delta) {
                if (!this.cells.length) return;
                let idx = this.currentCellId ? this.cells.findIndex(c => c.id === this.currentCellId) : -1;
                idx = Math.max(0, Math.min(this.cells.length - 1, idx + delta));
                this.focusAndScrollToCell(this.cells[idx].id);
            }

            jumpToCell(num) {
                const idx = Math.max(0, Math.min(this.cells.length - 1, num - 1));
                if (this.cells[idx]) this.focusAndScrollToCell(this.cells[idx].id);
            }

            moveCellUp(idx) {
                if (idx <= 0 || idx >= this.cells.length) return;
                [this.cells[idx - 1], this.cells[idx]] = [this.cells[idx], this.cells[idx - 1]];
                this.renderAllCells(); this.updateCellList();
            }

            moveCellDown(idx) {
                if (idx < 0 || idx >= this.cells.length - 1) return;
                [this.cells[idx], this.cells[idx + 1]] = [this.cells[idx + 1], this.cells[idx]];
                this.renderAllCells(); this.updateCellList();
            }

            /* ---------- Stats ---------- */
            updateStats() {
                document.getElementById('cells-loaded').textContent = this.cells.length;
                document.getElementById('execution-time').textContent = `${this._lastExecMs} ms`;
            }

            /* ---------- Infinite Scroll ---------- */
            handleInfiniteScroll() {
                const container = document.getElementById('cells-container');
                const scrollPosition = container.scrollTop + container.clientHeight;
                const totalHeight = container.scrollHeight;

                if (scrollPosition > totalHeight - 200) {
                    // Could add virtual cells or load more content
                }
            }

            /* ---------- Performance Mode ---------- */
            updatePerformanceMode() {
                const container = document.querySelector('.notepad-container');
                container.classList.toggle('performance-mode', this.performanceMode);
            }

            /* ---------- Auto-resize Textarea ---------- */
            autoResize(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = Math.max(textarea.scrollHeight, 60) + 'px';
            }

            /* ---------- UI Sync ---------- */
            updateUI() {
                this.updateQuantumPosition();
                this.updateCellList();
                this.updateStats();
                this.updatePerformanceMode();
            }

            /* ---------- Performance Monitoring ---------- */
            startPerformanceMonitoring() {
                const update = () => {
                    if (performance.memory) {
                        const mb = (performance.memory.usedJSHeapSize / 1048576).toFixed(1);
                        document.getElementById('memory-usage').textContent = `~${mb} MB`;
                    } else {
                        const est = (this.cells.length * 0.3 + 0.8).toFixed(1);
                        document.getElementById('memory-usage').textContent = `~${est} MB`;
                    }
                };
                update();
                setInterval(update, 5000);
            }
        }

        // Initialize
        let notebook;
        try {
            notebook = new QuantumNotebookWeb();
            window.notebook = notebook;
        } catch (e) {
            console.error('QuantumNotebook init failed:', e);
            document.getElementById('cells-container').innerHTML =
                '<div style="padding:2rem;color:#f85149;font-family:monospace;">' +
                '<h3>âš  Initialization Error</h3><pre>' + e.message + '</pre>' +
                '<p style="color:#8b949e;">Try refreshing the page. If this persists, open locally: <code>open web/quantum-notepad.html</code></p></div>';
        }

        // --- Inspect panel toggle ---
        (() => {
            const overlay   = document.getElementById('inspect-overlay');
            const backdrop  = document.getElementById('inspect-backdrop');
            const closeBtn  = document.getElementById('inspect-close');
            const openBtn   = document.getElementById('inspect-btn');

            const open  = () => {
                overlay.classList.add('open');
                const tsEl = document.getElementById('inspect-unix-ts');
                if (tsEl) {
                    const now = Math.floor(Date.now() / 1000);
                    tsEl.textContent = now;
                    const iso = new Date(now * 1000).toISOString();
                    tsEl.title = `unix ${now}\n${iso}`;
                }
                // Update version/phase stamp dynamically
                const verEl = document.getElementById('inspect-version-stamp');
                if (verEl) {
                    const phase = window._uvspeedPhase || '4.0';
                    const ver   = window._uvspeedVersion || '4.0';
                    const mode  = notebook && notebook._offlineMode ? ' Â· offline' : '';
                    verEl.textContent = `v${ver} Â· Phase ${phase}${mode}`;
                }
            };
            const close = () => overlay.classList.remove('open');

            openBtn.addEventListener('click', open);
            closeBtn.addEventListener('click', close);
            backdrop.addEventListener('click', close);

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('open')) {
                    close();
                }
            });
        })();

        // --- Cell output overlay toggle ---
        (() => {
            const overlay  = document.getElementById('cell-overlay');
            const backdrop = document.getElementById('cell-overlay-backdrop');
            const closeBtn = document.getElementById('cell-overlay-close');

            const close = () => overlay.classList.remove('open');

            closeBtn.addEventListener('click', close);
            backdrop.addEventListener('click', close);

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('open')) {
                    close();
                }
            });
        })();

        // ===== QUANTUM HEATMAP MODULE (COIN360-style treemap) =====
        (() => {
            if (!notebook) return;

            const overlay = document.getElementById('qheat-overlay');
            const canvas  = document.getElementById('qheat-canvas');
            const ctx     = canvas ? canvas.getContext('2d') : null;
            const tooltip = document.getElementById('qheat-tooltip');
            const openBtn = document.getElementById('ctl-expand');
            const closeBtn= document.getElementById('qheat-close');
            if (!overlay || !canvas || !ctx) return;

            let qheatMode = 'treemap';
            let qheatData = []; // {label, cat, sym, color, lines, cellId, cellIdx, pct}
            let qheatRects = []; // rendered rectangles for hit-testing
            let dpr = window.devicePixelRatio || 1;

            const PREFIX_COLORS = {
                shebang:   '#3fb950', comment:  '#58a6ff', import:   '#d2a8ff',
                class:     '#ff3838', function: '#f0883e', error:    '#da3633',
                condition: '#ffe138', loop:     '#e6b422', return:   '#484f58',
                output:    '#c084fc', variable: '#7ee787', decorator:'#bc8cff',
                default:   '#30363d'
            };
            const PREFIX_SYMS = {
                shebang:'n:', comment:'+1:', import:'-n:', class:'+0:', function:'0:',
                error:'-1:', condition:'+n:', loop:'+2:', return:'-0:', output:'+3:',
                variable:'1:', decorator:'+1:', default:'  '
            };

            // Build legend
            const legend = document.getElementById('qheat-legend');
            if (legend) {
                const cats = ['shebang','comment','import','class','function','error','condition','variable','return'];
                legend.innerHTML = cats.map(c =>
                    `<span class="qheat-legend-item"><span class="qheat-legend-swatch" style="background:${PREFIX_COLORS[c]}"></span>${PREFIX_SYMS[c]} ${c}</span>`
                ).join('');
            }

            // Gather data from all notebook cells
            function gatherData() {
                qheatData = [];
                let totalLines = 0, classifiedLines = 0, activePrefixes = new Set();
                const lang = notebook.cells.length > 0 ? notebook.detectCellLanguage(notebook.cells[0]) : 'python';

                notebook.cells.forEach((cell, idx) => {
                    if (!cell.content) return;
                    const lines = cell.content.split('\n');
                    const cellCounts = {};
                    lines.forEach(line => {
                        const { category } = notebook.classifyLine(line, notebook.detectCellLanguage(cell));
                        cellCounts[category] = (cellCounts[category] || 0) + 1;
                        totalLines++;
                        if (category !== 'default') { classifiedLines++; activePrefixes.add(category); }
                    });
                    for (const [cat, count] of Object.entries(cellCounts)) {
                        if (count === 0) continue;
                        qheatData.push({
                            label: `Cell ${idx + 1}: ${cell.content.split('\n')[0]?.substring(0, 30) || '(empty)'}`,
                            cat, sym: PREFIX_SYMS[cat] || '  ',
                            color: PREFIX_COLORS[cat] || '#30363d',
                            lines: count, cellId: cell.id, cellIdx: idx,
                            pct: 0
                        });
                    }
                });

                // Calculate percentages
                qheatData.forEach(d => { d.pct = totalLines > 0 ? ((d.lines / totalLines) * 100) : 0; });
                // Sort by size descending
                qheatData.sort((a, b) => b.lines - a.lines);

                // Update stats
                const coverage = totalLines > 0 ? Math.round((classifiedLines / totalLines) * 100) : 0;
                const el = (id, v) => { const e = document.getElementById(id); if (e) e.textContent = v; };
                el('qh-cells', notebook.cells.length);
                el('qh-lines', totalLines);
                el('qh-coverage', coverage + '%');
                el('qh-lang', lang);
                el('qh-prefixes', activePrefixes.size + '/9');
            }

            // Squarified treemap layout
            function layoutTreemap(items, x, y, w, h) {
                const rects = [];
                const total = items.reduce((s, d) => s + d.lines, 0) || 1;
                const sorted = [...items].sort((a, b) => b.lines - a.lines);
                let remaining = sorted.slice();
                let cx = x, cy = y, cw = w, ch = h;

                while (remaining.length > 0) {
                    const isWide = cw >= ch;
                    const side = isWide ? ch : cw;
                    const remTotal = remaining.reduce((s, d) => s + d.lines, 0);

                    // Greedily pick items for this row
                    let row = [remaining[0]];
                    let rowSum = remaining[0].lines;
                    let bestAspect = Infinity;

                    for (let i = 1; i < remaining.length; i++) {
                        const newSum = rowSum + remaining[i].lines;
                        const rowArea = (newSum / remTotal) * cw * ch;
                        const rowSide = rowArea / side;
                        let worstAspect = 0;
                        [...row, remaining[i]].forEach(d => {
                            const itemSide = (d.lines / newSum) * side;
                            const ratio = Math.max(rowSide / itemSide, itemSide / rowSide);
                            worstAspect = Math.max(worstAspect, ratio);
                        });
                        if (worstAspect < bestAspect) {
                            bestAspect = worstAspect;
                            row.push(remaining[i]);
                            rowSum = newSum;
                        } else break;
                    }

                    // Layout this row
                    const rowFrac = rowSum / remTotal;
                    let offset = 0;
                    row.forEach(d => {
                        const frac = d.lines / rowSum;
                        if (isWide) {
                            const rw = cw * rowFrac;
                            const rh = ch * frac;
                            rects.push({ ...d, rx: cx, ry: cy + offset, rw, rh });
                            offset += rh;
                        } else {
                            const rh = ch * rowFrac;
                            const rw = cw * frac;
                            rects.push({ ...d, rx: cx + offset, ry: cy, rw, rh });
                            offset += rw;
                        }
                    });

                    // Shrink remaining area
                    if (isWide) { const rw = cw * rowFrac; cx += rw; cw -= rw; }
                    else { const rh = ch * rowFrac; cy += rh; ch -= rh; }

                    remaining = remaining.filter(d => !row.includes(d));
                    if (cw < 1 || ch < 1) break;
                }
                return rects;
            }

            // Bubble layout
            function layoutBubble(items, w, h) {
                const total = items.reduce((s, d) => s + d.lines, 0) || 1;
                const maxR = Math.min(w, h) * 0.35;
                const cx = w / 2, cy = h / 2;
                const sorted = [...items].sort((a, b) => b.lines - a.lines);
                const rects = [];
                const placed = [];

                sorted.forEach(d => {
                    const r = Math.max(8, Math.sqrt(d.lines / total) * maxR * 2);
                    let bx = cx, by = cy, angle = 0, dist = 0;
                    // Spiral placement
                    for (let attempt = 0; attempt < 500; attempt++) {
                        bx = cx + Math.cos(angle) * dist;
                        by = cy + Math.sin(angle) * dist;
                        let overlap = false;
                        for (const p of placed) {
                            const dx = bx - p.bx, dy = by - p.by;
                            if (Math.sqrt(dx*dx + dy*dy) < r + p.r + 2) { overlap = true; break; }
                        }
                        if (!overlap && bx - r > 0 && bx + r < w && by - r > 0 && by + r < h) break;
                        angle += 0.5; dist += 0.8;
                    }
                    placed.push({ bx, by, r });
                    rects.push({ ...d, bx, by, br: r });
                });
                return rects;
            }

            // Render
            function render() {
                const body = document.getElementById('qheat-body');
                const bw = body.clientWidth, bh = body.clientHeight;
                dpr = window.devicePixelRatio || 1;
                canvas.width = bw * dpr; canvas.height = bh * dpr;
                canvas.style.width = bw + 'px'; canvas.style.height = bh + 'px';
                ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
                ctx.clearRect(0, 0, bw, bh);

                qheatRects = [];

                if (qheatData.length === 0) {
                    ctx.fillStyle = '#8b949e'; ctx.font = '14px system-ui';
                    ctx.textAlign = 'center'; ctx.fillText('No code cells â€” add cells to see the heatmap', bw/2, bh/2);
                    return;
                }

                const pad = 2;

                if (qheatMode === 'treemap') {
                    const rects = layoutTreemap(qheatData, pad, pad, bw - pad*2, bh - pad*2);
                    rects.forEach(r => {
                        const gap = 1.5;
                        ctx.fillStyle = r.color;
                        ctx.globalAlpha = 0.85;
                        ctx.beginPath();
                        ctx.roundRect(r.rx + gap, r.ry + gap, Math.max(0, r.rw - gap*2), Math.max(0, r.rh - gap*2), 3);
                        ctx.fill();
                        ctx.globalAlpha = 1;

                        // Label inside if big enough
                        if (r.rw > 40 && r.rh > 20) {
                            ctx.fillStyle = 'rgba(0,0,0,0.7)';
                            ctx.font = `bold ${Math.min(12, Math.max(8, r.rh * 0.25))}px system-ui`;
                            ctx.textAlign = 'left'; ctx.textBaseline = 'top';
                            const txt = `${r.sym} ${r.cat}`;
                            ctx.fillText(txt, r.rx + gap + 4, r.ry + gap + 3, r.rw - gap*2 - 8);
                        }
                        if (r.rw > 50 && r.rh > 34) {
                            ctx.fillStyle = 'rgba(0,0,0,0.5)';
                            ctx.font = `${Math.min(10, Math.max(7, r.rh * 0.18))}px monospace`;
                            ctx.fillText(`${r.lines}L Â· ${r.pct.toFixed(1)}%`, r.rx + gap + 4, r.ry + gap + 16, r.rw - gap*2 - 8);
                        }
                        if (r.rw > 70 && r.rh > 48) {
                            ctx.fillStyle = 'rgba(0,0,0,0.4)';
                            ctx.font = `${Math.min(9, Math.max(6, r.rh * 0.14))}px system-ui`;
                            const cellLabel = r.label.length > 35 ? r.label.substring(0, 35) + '...' : r.label;
                            ctx.fillText(cellLabel, r.rx + gap + 4, r.ry + gap + 28, r.rw - gap*2 - 8);
                        }

                        qheatRects.push({ x: r.rx, y: r.ry, w: r.rw, h: r.rh, data: r, shape: 'rect' });
                    });

                } else if (qheatMode === 'bubble') {
                    const bubbles = layoutBubble(qheatData, bw, bh);
                    bubbles.forEach(b => {
                        ctx.globalAlpha = 0.8;
                        ctx.fillStyle = b.color;
                        ctx.beginPath(); ctx.arc(b.bx, b.by, b.br, 0, Math.PI * 2); ctx.fill();
                        ctx.globalAlpha = 1;
                        ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.lineWidth = 1;
                        ctx.beginPath(); ctx.arc(b.bx, b.by, b.br, 0, Math.PI * 2); ctx.stroke();

                        if (b.br > 15) {
                            ctx.fillStyle = 'rgba(0,0,0,0.7)';
                            ctx.font = `bold ${Math.min(11, b.br * 0.4)}px system-ui`;
                            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                            ctx.fillText(b.sym, b.bx, b.by - 4);
                            ctx.font = `${Math.min(9, b.br * 0.3)}px monospace`;
                            ctx.fillStyle = 'rgba(0,0,0,0.5)';
                            ctx.fillText(`${b.lines}L`, b.bx, b.by + 8);
                        }
                        qheatRects.push({ bx: b.bx, by: b.by, br: b.br, data: b, shape: 'circle' });
                    });

                } else if (qheatMode === 'bar') {
                    // Group by category
                    const groups = {};
                    qheatData.forEach(d => { groups[d.cat] = (groups[d.cat] || 0) + d.lines; });
                    const entries = Object.entries(groups).sort((a, b) => b[1] - a[1]);
                    const maxVal = entries.length > 0 ? entries[0][1] : 1;
                    const barH = Math.min(40, (bh - 40) / entries.length - 4);
                    const barMaxW = bw - 140;

                    entries.forEach(([cat, count], i) => {
                        const y = 20 + i * (barH + 4);
                        const w = (count / maxVal) * barMaxW;
                        ctx.fillStyle = PREFIX_COLORS[cat] || '#30363d';
                        ctx.globalAlpha = 0.85;
                        ctx.beginPath(); ctx.roundRect(120, y, w, barH, 3); ctx.fill();
                        ctx.globalAlpha = 1;

                        ctx.fillStyle = '#8b949e'; ctx.font = '11px monospace';
                        ctx.textAlign = 'right'; ctx.textBaseline = 'middle';
                        ctx.fillText(`${PREFIX_SYMS[cat] || ''} ${cat}`, 112, y + barH/2);

                        ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.font = 'bold 10px monospace';
                        ctx.textAlign = 'left';
                        if (w > 40) ctx.fillText(`${count}L`, 126, y + barH/2);

                        qheatRects.push({ x: 120, y, w, h: barH, data: { cat, lines: count, sym: PREFIX_SYMS[cat], color: PREFIX_COLORS[cat], pct: 0, label: cat, cellId: '' }, shape: 'rect' });
                    });

                } else if (qheatMode === 'sunburst') {
                    const groups = {};
                    qheatData.forEach(d => {
                        if (!groups[d.cat]) groups[d.cat] = { lines: 0, items: [] };
                        groups[d.cat].lines += d.lines;
                        groups[d.cat].items.push(d);
                    });
                    const total = qheatData.reduce((s, d) => s + d.lines, 0) || 1;
                    const cx = bw / 2, cy = bh / 2;
                    const outerR = Math.min(bw, bh) * 0.42;
                    const innerR = outerR * 0.35;

                    let angle = -Math.PI / 2;
                    for (const [cat, group] of Object.entries(groups).sort((a, b) => b[1].lines - a[1].lines)) {
                        const sweep = (group.lines / total) * Math.PI * 2;
                        // Outer ring
                        ctx.fillStyle = PREFIX_COLORS[cat] || '#30363d';
                        ctx.globalAlpha = 0.8;
                        ctx.beginPath();
                        ctx.arc(cx, cy, outerR, angle, angle + sweep);
                        ctx.arc(cx, cy, innerR, angle + sweep, angle, true);
                        ctx.closePath(); ctx.fill();
                        ctx.globalAlpha = 1;
                        ctx.strokeStyle = 'rgba(13,17,23,0.8)'; ctx.lineWidth = 1.5;
                        ctx.beginPath();
                        ctx.arc(cx, cy, outerR, angle, angle + sweep);
                        ctx.arc(cx, cy, innerR, angle + sweep, angle, true);
                        ctx.closePath(); ctx.stroke();

                        // Label
                        if (sweep > 0.15) {
                            const mid = angle + sweep / 2;
                            const lx = cx + Math.cos(mid) * (innerR + (outerR - innerR) * 0.5);
                            const ly = cy + Math.sin(mid) * (innerR + (outerR - innerR) * 0.5);
                            ctx.fillStyle = 'rgba(0,0,0,0.7)';
                            ctx.font = 'bold 10px system-ui';
                            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                            ctx.fillText(`${PREFIX_SYMS[cat]} ${group.lines}L`, lx, ly);
                        }

                        qheatRects.push({
                            cx, cy, innerR, outerR, startAngle: angle, endAngle: angle + sweep,
                            data: { cat, lines: group.lines, sym: PREFIX_SYMS[cat], color: PREFIX_COLORS[cat], pct: (group.lines/total*100), label: cat, cellId: '' },
                            shape: 'arc'
                        });
                        angle += sweep;
                    }

                    // Center label
                    ctx.fillStyle = '#8b949e'; ctx.font = 'bold 13px system-ui';
                    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText(`${total} lines`, cx, cy - 6);
                    ctx.font = '10px monospace'; ctx.fillStyle = '#58a6ff';
                    const cov = qheatData.filter(d => d.cat !== 'default').reduce((s,d)=>s+d.lines,0);
                    ctx.fillText(`${Math.round(cov/total*100)}% covered`, cx, cy + 10);

                } else if (qheatMode === 'slice') {
                    // 2D Slice â€” 9Ã—9 grid heatmap colored by prefix density
                    const grid = 9, cellW = (bw - 20) / grid, cellH = (bh - 40) / grid;
                    const cats = ['shebang','comment','import','class','function','error','condition','variable','return'];
                    const total = qheatData.reduce((s,d)=>s+d.lines,0) || 1;
                    const catLines = {};
                    qheatData.forEach(d => { catLines[d.cat] = (catLines[d.cat] || 0) + d.lines; });

                    ctx.font = 'bold 9px monospace'; ctx.textAlign = 'center'; ctx.textBaseline = 'top';
                    for (let r = 0; r < grid; r++) for (let c = 0; c < grid; c++) {
                        const x = 10 + c * cellW, y = 24 + r * cellH;
                        const cat = cats[c] || 'default';
                        const heat = (catLines[cat] || 0) / total;
                        const rowHeat = Math.sin(r * 0.7 + c * 0.5) * 0.3 + 0.5;
                        const alpha = 0.1 + heat * 0.7 + rowHeat * 0.15;
                        ctx.fillStyle = PREFIX_COLORS[cat] || '#30363d';
                        ctx.globalAlpha = Math.min(0.95, alpha);
                        ctx.beginPath(); ctx.roundRect(x + 1, y + 1, cellW - 2, cellH - 2, 3); ctx.fill();
                        ctx.globalAlpha = 1;
                        ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth = 0.5;
                        ctx.strokeRect(x + 1, y + 1, cellW - 2, cellH - 2);
                        if (r === 0) { ctx.fillStyle = '#fff'; ctx.fillText(PREFIX_SYMS[cat] || '', x + cellW/2, y + cellH/2 - 4); }
                        qheatRects.push({ x: x+1, y: y+1, w: cellW-2, h: cellH-2, data: { cat, lines: catLines[cat]||0, sym: PREFIX_SYMS[cat]||'', color: PREFIX_COLORS[cat]||'#30363d', pct: (catLines[cat]||0)/total*100, label: cat, cellId:'' }, shape:'rect' });
                    }
                    // Column headers
                    ctx.fillStyle = '#8b949e'; ctx.font = 'bold 10px monospace'; ctx.textAlign = 'center'; ctx.textBaseline = 'top';
                    cats.forEach((cat, c) => { ctx.fillStyle = PREFIX_COLORS[cat]; ctx.fillText(PREFIX_SYMS[cat]||'', 10 + c*cellW + cellW/2, 6); });

                } else if (qheatMode === 'orb') {
                    // Orb â€” concentric probability rings + floating symbols
                    const cx = bw / 2, cy = bh / 2;
                    const maxR = Math.min(bw, bh) * 0.44;
                    const cats = Object.entries(PREFIX_COLORS).filter(([k]) => k !== 'default' && k !== 'decorator');
                    const total = qheatData.reduce((s,d)=>s+d.lines,0) || 1;
                    const catLines = {};
                    qheatData.forEach(d => { catLines[d.cat] = (catLines[d.cat] || 0) + d.lines; });

                    // Concentric glow rings
                    for (let i = 5; i >= 1; i--) {
                        const r = maxR * (i / 5);
                        const grd = ctx.createRadialGradient(cx, cy, r * 0.2, cx, cy, r);
                        grd.addColorStop(0, 'rgba(139,92,246,' + (0.04 * i) + ')');
                        grd.addColorStop(1, 'rgba(139,92,246,0)');
                        ctx.fillStyle = grd; ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.fill();
                    }
                    // Core orb
                    const coreGrd = ctx.createRadialGradient(cx, cy - maxR*0.1, maxR*0.05, cx, cy, maxR*0.3);
                    coreGrd.addColorStop(0, 'rgba(139,92,246,0.5)'); coreGrd.addColorStop(1, 'rgba(139,92,246,0.05)');
                    ctx.fillStyle = coreGrd; ctx.beginPath(); ctx.arc(cx, cy, maxR*0.3, 0, Math.PI*2); ctx.fill();

                    // Place prefix symbols as orbiting nodes
                    cats.forEach(([cat, color], i) => {
                        const weight = (catLines[cat] || 0) / total;
                        const angle = (i / cats.length) * Math.PI * 2 - Math.PI / 2;
                        const dist = maxR * (0.4 + weight * 1.2);
                        const nx = cx + Math.cos(angle) * Math.min(dist, maxR * 0.9);
                        const ny = cy + Math.sin(angle) * Math.min(dist, maxR * 0.9);
                        const nodeR = 8 + weight * 40;
                        ctx.fillStyle = color; ctx.globalAlpha = 0.6 + weight * 0.4;
                        ctx.beginPath(); ctx.arc(nx, ny, nodeR, 0, Math.PI*2); ctx.fill();
                        ctx.globalAlpha = 1;
                        // Connector line to center
                        ctx.strokeStyle = color; ctx.globalAlpha = 0.15; ctx.lineWidth = 1;
                        ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(nx, ny); ctx.stroke();
                        ctx.globalAlpha = 1;
                        // Label
                        ctx.fillStyle = '#fff'; ctx.font = `bold ${Math.max(9, nodeR * 0.6)}px monospace`;
                        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                        ctx.fillText(PREFIX_SYMS[cat] || cat, nx, ny);
                        qheatRects.push({ bx: nx, by: ny, br: nodeR, data: { cat, lines: catLines[cat]||0, sym: PREFIX_SYMS[cat]||'', color, pct: weight*100, label: cat, cellId:'' }, shape:'circle' });
                    });
                    ctx.fillStyle = '#c9d1d9'; ctx.font = 'bold 12px system-ui'; ctx.textAlign = 'center';
                    ctx.fillText(`${total} lines`, cx, cy + 2);

                } else if (qheatMode === 'lattice') {
                    // Lattice â€” interconnected nodes in a force-directed-style layout
                    const cats = Object.entries(PREFIX_COLORS).filter(([k]) => k !== 'default' && k !== 'decorator');
                    const total = qheatData.reduce((s,d)=>s+d.lines,0) || 1;
                    const catLines = {};
                    qheatData.forEach(d => { catLines[d.cat] = (catLines[d.cat] || 0) + d.lines; });

                    // Place nodes in a grid-like lattice
                    const cols = Math.ceil(Math.sqrt(cats.length));
                    const rows = Math.ceil(cats.length / cols);
                    const spacingX = (bw - 80) / Math.max(1, cols - 1);
                    const spacingY = (bh - 80) / Math.max(1, rows - 1);
                    const nodes = [];

                    cats.forEach(([cat, color], i) => {
                        const col = i % cols, row = Math.floor(i / cols);
                        const nx = 40 + col * spacingX + (Math.sin(i * 2.1) * spacingX * 0.12);
                        const ny = 40 + row * spacingY + (Math.cos(i * 1.7) * spacingY * 0.12);
                        const weight = (catLines[cat] || 0) / total;
                        const nodeR = 12 + weight * 50;
                        nodes.push({ nx, ny, nodeR, cat, color, weight });
                    });

                    // Draw connections between adjacent nodes
                    ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth = 1;
                    for (let i = 0; i < nodes.length; i++) for (let j = i + 1; j < nodes.length; j++) {
                        const dx = nodes[j].nx - nodes[i].nx, dy = nodes[j].ny - nodes[i].ny;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        if (dist < Math.max(spacingX, spacingY) * 1.5) {
                            ctx.globalAlpha = 0.3 * (1 - dist / (spacingX * 1.5));
                            ctx.strokeStyle = nodes[i].color;
                            ctx.beginPath(); ctx.moveTo(nodes[i].nx, nodes[i].ny); ctx.lineTo(nodes[j].nx, nodes[j].ny); ctx.stroke();
                        }
                    }
                    ctx.globalAlpha = 1;

                    // Draw nodes
                    nodes.forEach(n => {
                        // Glow
                        const grd = ctx.createRadialGradient(n.nx, n.ny, 0, n.nx, n.ny, n.nodeR * 1.5);
                        grd.addColorStop(0, n.color + '40'); grd.addColorStop(1, n.color + '00');
                        ctx.fillStyle = grd; ctx.beginPath(); ctx.arc(n.nx, n.ny, n.nodeR * 1.5, 0, Math.PI*2); ctx.fill();
                        // Core
                        ctx.fillStyle = n.color; ctx.globalAlpha = 0.75;
                        ctx.beginPath(); ctx.arc(n.nx, n.ny, n.nodeR, 0, Math.PI*2); ctx.fill();
                        ctx.globalAlpha = 1;
                        // Label
                        ctx.fillStyle = '#fff'; ctx.font = `bold ${Math.max(9, n.nodeR * 0.5)}px monospace`;
                        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                        ctx.fillText(PREFIX_SYMS[n.cat] || n.cat, n.nx, n.ny - 3);
                        ctx.font = `${Math.max(7, n.nodeR * 0.35)}px monospace`;
                        ctx.fillStyle = 'rgba(255,255,255,0.6)';
                        ctx.fillText(`${catLines[n.cat]||0}L`, n.nx, n.ny + 9);
                        qheatRects.push({ bx: n.nx, by: n.ny, br: n.nodeR, data: { cat: n.cat, lines: catLines[n.cat]||0, sym: PREFIX_SYMS[n.cat]||'', color: n.color, pct: n.weight*100, label: n.cat, cellId:'' }, shape:'circle' });
                    });

                } else if (qheatMode === 'cube3d') {
                    // 3D Cube â€” isometric projection of a prefix cube
                    const cx = bw / 2, cy = bh / 2;
                    const size = Math.min(bw, bh) * 0.28;
                    const total = qheatData.reduce((s,d)=>s+d.lines,0) || 1;
                    const catLines = {};
                    qheatData.forEach(d => { catLines[d.cat] = (catLines[d.cat] || 0) + d.lines; });
                    const cats = ['shebang','comment','import','class','function','error','condition','variable','return'];

                    // Isometric projection helpers
                    const iso = (x, y, z) => ({
                        px: cx + (x - z) * size * 0.866,
                        py: cy + (x + z) * size * 0.5 - y * size
                    });

                    // Draw 3Ã—3Ã—3 cube cells
                    for (let z = 0; z < 3; z++) for (let y = 2; y >= 0; y--) for (let x = 0; x < 3; x++) {
                        const idx = z * 3 + x;
                        const cat = cats[idx % cats.length];
                        const weight = (catLines[cat] || 0) / total;
                        const s = 0.9;
                        const corners = [
                            iso(x*s, y*s, z*s), iso((x+1)*s, y*s, z*s),
                            iso((x+1)*s, y*s, (z+1)*s), iso(x*s, y*s, (z+1)*s),
                            iso(x*s, (y+1)*s, z*s), iso((x+1)*s, (y+1)*s, z*s),
                            iso((x+1)*s, (y+1)*s, (z+1)*s), iso(x*s, (y+1)*s, (z+1)*s),
                        ];

                        const alpha = 0.2 + weight * 0.7;
                        const color = PREFIX_COLORS[cat] || '#30363d';

                        // Top face
                        ctx.fillStyle = color; ctx.globalAlpha = alpha;
                        ctx.beginPath();
                        ctx.moveTo(corners[4].px, corners[4].py); ctx.lineTo(corners[5].px, corners[5].py);
                        ctx.lineTo(corners[6].px, corners[6].py); ctx.lineTo(corners[7].px, corners[7].py);
                        ctx.closePath(); ctx.fill();
                        ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.lineWidth = 0.5; ctx.stroke();

                        // Right face
                        ctx.globalAlpha = alpha * 0.7;
                        ctx.beginPath();
                        ctx.moveTo(corners[1].px, corners[1].py); ctx.lineTo(corners[5].px, corners[5].py);
                        ctx.lineTo(corners[6].px, corners[6].py); ctx.lineTo(corners[2].px, corners[2].py);
                        ctx.closePath(); ctx.fill(); ctx.stroke();

                        // Left face
                        ctx.globalAlpha = alpha * 0.5;
                        ctx.beginPath();
                        ctx.moveTo(corners[2].px, corners[2].py); ctx.lineTo(corners[6].px, corners[6].py);
                        ctx.lineTo(corners[7].px, corners[7].py); ctx.lineTo(corners[3].px, corners[3].py);
                        ctx.closePath(); ctx.fill(); ctx.stroke();
                        ctx.globalAlpha = 1;

                        // Label on top face for visible cells
                        if (y === 2) {
                            const mid = iso((x+0.5)*s, (y+1)*s, (z+0.5)*s);
                            ctx.fillStyle = '#fff'; ctx.font = 'bold 9px monospace';
                            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                            ctx.fillText(PREFIX_SYMS[cat]||'', mid.px, mid.py);
                        }
                    }
                    ctx.fillStyle = '#8b949e'; ctx.font = '11px system-ui'; ctx.textAlign = 'center';
                    ctx.fillText(`${total} lines Â· 9 prefix dimensions`, cx, bh - 16);
                }
            }

            // Hit test
            function hitTest(mx, my) {
                for (const r of qheatRects) {
                    if (r.shape === 'rect') {
                        if (mx >= r.x && mx <= r.x + r.w && my >= r.y && my <= r.y + r.h) return r.data;
                    } else if (r.shape === 'circle') {
                        const dx = mx - r.bx, dy = my - r.by;
                        if (Math.sqrt(dx*dx + dy*dy) <= r.br) return r.data;
                    } else if (r.shape === 'arc') {
                        const dx = mx - r.cx, dy = my - r.cy;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        if (dist >= r.innerR && dist <= r.outerR) {
                            let a = Math.atan2(dy, dx);
                            if (a < -Math.PI/2) a += Math.PI * 2;
                            if (a >= r.startAngle && a <= r.endAngle) return r.data;
                        }
                    }
                }
                return null;
            }

            // Mouse move â†’ tooltip
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                const mx = e.clientX - rect.left, my = e.clientY - rect.top;
                const hit = hitTest(mx, my);
                if (hit) {
                    tooltip.classList.add('visible');
                    tooltip.style.left = Math.min(e.clientX + 12, window.innerWidth - 300) + 'px';
                    tooltip.style.top = Math.min(e.clientY + 12, window.innerHeight - 150) + 'px';
                    document.getElementById('qheat-tt-title').textContent = hit.label || hit.cat;
                    document.getElementById('qheat-tt-lines').textContent = hit.lines + ' lines';
                    document.getElementById('qheat-tt-weight').textContent = (hit.pct || 0).toFixed(1) + '%';
                    document.getElementById('qheat-tt-sym').textContent = hit.sym || '';
                    document.getElementById('qheat-tt-cat').textContent = hit.cat || '';
                    document.getElementById('qheat-tt-cell').textContent = hit.cellId ? `Cell ${hit.cellIdx + 1}` : 'Aggregate';
                    canvas.style.cursor = 'pointer';
                } else {
                    tooltip.classList.remove('visible');
                    canvas.style.cursor = 'default';
                }
            });

            canvas.addEventListener('mouseleave', () => { tooltip.classList.remove('visible'); });

            // Click â†’ scroll to cell
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const mx = e.clientX - rect.left, my = e.clientY - rect.top;
                const hit = hitTest(mx, my);
                if (hit && hit.cellId) {
                    overlay.classList.remove('open');
                    tooltip.classList.remove('visible');
                    setTimeout(() => {
                        const el = document.getElementById(hit.cellId);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            });

            // Mode switching
            document.querySelectorAll('.qheat-mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.qheat-mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    qheatMode = btn.dataset.qheatMode;
                    render();
                });
            });

            // Open / close
            openBtn.addEventListener('click', () => {
                gatherData();
                overlay.classList.add('open');
                requestAnimationFrame(() => render());
            });
            closeBtn.addEventListener('click', () => {
                overlay.classList.remove('open');
                tooltip.classList.remove('visible');
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && overlay.classList.contains('open')) {
                    overlay.classList.remove('open');
                    tooltip.classList.remove('visible');
                }
            });

            // Resize
            window.addEventListener('resize', () => {
                if (overlay.classList.contains('open')) render();
            });
        })();

        // ===== TOUCH EVENTS MODULE =====
        (() => {
            if (!notebook) return;

            // -- Swipe navigation on sidebar --
            const sidebar = document.querySelector('.quantum-sidebar');
            if (sidebar) {
                let touchStartX = 0, touchStartY = 0;
                sidebar.addEventListener('touchstart', (e) => {
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                }, { passive: true });
                sidebar.addEventListener('touchend', (e) => {
                    const dx = e.changedTouches[0].clientX - touchStartX;
                    const dy = e.changedTouches[0].clientY - touchStartY;
                    if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) {
                        // Horizontal swipe on sidebar â€” cycle whichever row is active
                        const extActive = document.querySelector('.sidebar-tab-ext.active');
                        const tabs = extActive
                            ? [...document.querySelectorAll('.sidebar-tab-ext')]
                            : [...document.querySelectorAll('.sidebar-tab')];
                        const active = tabs.findIndex(t => t.classList.contains('active'));
                        const next = dx > 0 ? (active - 1 + tabs.length) % tabs.length : (active + 1) % tabs.length;
                        tabs[next]?.click();
                    }
                }, { passive: true });
            }

            // -- Swipe between cells (vertical quick-nav) --
            const mainArea = document.querySelector('.cells-container') || document.querySelector('.quantum-main');
            if (mainArea) {
                let lastTap = 0;
                mainArea.addEventListener('touchend', (e) => {
                    const now = Date.now();
                    if (now - lastTap < 300) {
                        // Double-tap: toggle tools on focused cell
                        const cellEl = e.target.closest('.quantum-cell');
                        if (cellEl) notebook.toggleCellTools(cellEl.id);
                    }
                    lastTap = now;
                }, { passive: true });
            }

            // -- Pinch-to-zoom on Visual Slice / Orb canvases --
            ['visual-slice-canvas', 'visual-orb-canvas'].forEach(canvasId => {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                let initialDist = 0;
                canvas.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 2) {
                        initialDist = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                    }
                }, { passive: true });
                canvas.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 2 && initialDist > 0) {
                        const dist = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                        const scale = dist / initialDist;
                        canvas.style.transform = `scale(${Math.max(0.5, Math.min(3, scale))})`;
                    }
                }, { passive: true });
                canvas.addEventListener('touchend', () => {
                    initialDist = 0;
                    canvas.style.transform = '';
                }, { passive: true });
            });

            // -- Touch drag-rotate for 3D Cube --
            const cubeScene = document.getElementById('visual-cube-wrap');
            if (cubeScene) {
                let cubeTouch = null;
                cubeScene.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 1) {
                        cubeTouch = {
                            x: e.touches[0].clientX,
                            y: e.touches[0].clientY,
                            rx: notebook._cubeRotX,
                            ry: notebook._cubeRotY
                        };
                    }
                }, { passive: true });
                cubeScene.addEventListener('touchmove', (e) => {
                    if (!cubeTouch || e.touches.length !== 1) return;
                    notebook._cubeRotY = cubeTouch.ry + (e.touches[0].clientX - cubeTouch.x) * 0.6;
                    notebook._cubeRotX = cubeTouch.rx + (e.touches[0].clientY - cubeTouch.y) * 0.6;
                    e.preventDefault();
                }, { passive: false });
                cubeScene.addEventListener('touchend', () => { cubeTouch = null; }, { passive: true });
            }

            // -- Touch drag-rotate for Nav Cube --
            const navCubeSceneEl = document.getElementById('nav-cube-scene');
            const navCubeInnerEl = document.getElementById('nav-cube-inner');
            if (navCubeSceneEl && navCubeInnerEl) {
                let ncTouch = null;
                navCubeSceneEl.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 1) {
                        ncTouch = {
                            x: e.touches[0].clientX,
                            y: e.touches[0].clientY,
                            rx: notebook._navCubeRx,
                            ry: notebook._navCubeRy
                        };
                    }
                }, { passive: true });
                navCubeSceneEl.addEventListener('touchmove', (e) => {
                    if (!ncTouch || e.touches.length !== 1) return;
                    notebook._navCubeRy = ncTouch.ry + (e.touches[0].clientX - ncTouch.x) * 0.7;
                    notebook._navCubeRx = ncTouch.rx + (e.touches[0].clientY - ncTouch.y) * 0.7;
                    navCubeInnerEl.style.transition = 'none';
                    navCubeInnerEl.style.transform = `rotateX(${notebook._navCubeRx}deg) rotateY(${notebook._navCubeRy}deg)`;
                    // Flat-face detection for touch drag
                    const rx = ((notebook._navCubeRx % 360) + 360) % 360;
                    const ry = ((notebook._navCubeRy % 360) + 360) % 360;
                    const ns = (v) => [0,90,180,270,360].some(s => Math.abs(v-s) < 12);
                    navCubeInnerEl.classList.toggle('ncf-flat', ns(rx) && ns(ry));
                    e.preventDefault();
                }, { passive: false });
                navCubeSceneEl.addEventListener('touchend', () => {
                    ncTouch = null;
                    navCubeInnerEl.style.transition = 'transform 0.25s ease';
                }, { passive: true });
            }

            // -- Touch-friendly footer: long-press tools dropdown --
            const toolsBtn = document.getElementById('f-tools');
            if (toolsBtn) {
                let holdTimer = null;
                toolsBtn.addEventListener('touchstart', (e) => {
                    holdTimer = setTimeout(() => {
                        const dd = document.getElementById('tools-dropdown');
                        if (dd) dd.classList.toggle('show');
                    }, 400);
                }, { passive: true });
                toolsBtn.addEventListener('touchend', () => clearTimeout(holdTimer), { passive: true });
                toolsBtn.addEventListener('touchmove', () => clearTimeout(holdTimer), { passive: true });
            }

            // -- Prevent iOS bounce-scroll on body --
            document.body.addEventListener('touchmove', (e) => {
                if (e.target.closest('.quantum-sidebar, .cells-container, .inspect-body, .cell-overlay-body')) return;
                // Only prevent on the outer shell to stop rubber-banding
            }, { passive: true });

            // -- Add mobile CSS for touch targets --
            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                const touchCSS = document.createElement('style');
                touchCSS.textContent = `
                    /* Touch-friendly sizing */
                    .btn--sm, .btn--xs, .cell-tool-btn, .sidebar-tab, .cube-ctrl-btn, .visual-btn {
                        min-height: 36px !important;
                        min-width: 36px !important;
                    }
                    .cell-textarea { font-size: 16px !important; /* prevents iOS zoom on focus */ }
                    #ai-input, #cmd-input { font-size: 16px !important; }
                    .footer-quick-cmds { gap: 6px !important; }
                    .cell-tools-bar { gap: 6px !important; padding: 6px 10px !important; }
                    /* Larger tap areas on mobile */
                    @media (max-width: 860px) {
                        .quantum-cell { margin-bottom: var(--cursor-space-md); }
                        .cell-header { padding: 8px 12px; }
                        .sidebar-tab { padding: 8px 6px; font-size: 0.75rem; }
                    }
                `;
                document.head.appendChild(touchCSS);
            }

            console.log('ðŸ– Touch events module loaded');
        })();

        // ===== OFFLINE MODE =====
        (() => {
            // Track offline state
            notebook._offlineMode = !navigator.onLine;

            const updateOfflineUI = () => {
                notebook._offlineMode = !navigator.onLine;
                const badge = document.getElementById('bridge-status');
                if (!navigator.onLine && badge) {
                    badge.innerHTML = 'ðŸ“´ Offline mode';
                    badge.style.color = '#f0883e';
                }
            };

            window.addEventListener('online', () => {
                notebook._offlineMode = false;
                notebook.connectBridge?.();
                notebook._logStream?.('online', 'network restored', 'sys');
            });
            window.addEventListener('offline', () => {
                notebook._offlineMode = true;
                notebook._logStream?.('offline', 'network lost â€” local mode', 'sys');
                updateOfflineUI();
            });

            updateOfflineUI();

            // Register Service Worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').then(reg => {
                    console.log('âš¡ Service Worker registered:', reg.scope);
                }).catch(() => {
                    // SW not available (e.g. file:// protocol or sw.js missing) â€” graceful fallback
                    console.log('âš¡ Service Worker unavailable â€” offline caching disabled');
                });
            }

            console.log('ðŸ“´ Offline mode module loaded (online:', navigator.onLine, ')');

            // ===== PWA INSTALL PROMPT =====
            let _deferredInstallPrompt = null;

            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                _deferredInstallPrompt = e;
                // Show install button in toolbar
                const toolbar = document.querySelector('.toolbar');
                if (toolbar && !document.getElementById('pwa-install-btn')) {
                    const btn = document.createElement('button');
                    btn.id = 'pwa-install-btn';
                    btn.className = 'btn btn--sm';
                    btn.title = 'Install uvspeed as app';
                    btn.innerHTML = 'ðŸ“² Install';
                    btn.style.cssText = 'color:#3fb950;border-color:#3fb950;animation:pulse-border 2s ease infinite;';
                    btn.addEventListener('click', async () => {
                        if (!_deferredInstallPrompt) return;
                        _deferredInstallPrompt.prompt();
                        const { outcome } = await _deferredInstallPrompt.userChoice;
                        console.log('âš¡ PWA install:', outcome);
                        if (outcome === 'accepted') {
                            btn.innerHTML = 'âœ… Installed';
                            btn.style.color = '#3fb950';
                            setTimeout(() => btn.remove(), 3000);
                        }
                        _deferredInstallPrompt = null;
                    });
                    // Insert before bridge-status
                    const bridgeEl = document.getElementById('bridge-status');
                    if (bridgeEl) toolbar.insertBefore(btn, bridgeEl);
                    else toolbar.appendChild(btn);
                }
            });

            window.addEventListener('appinstalled', () => {
                console.log('âš¡ uvspeed PWA installed');
                _deferredInstallPrompt = null;
                const btn = document.getElementById('pwa-install-btn');
                if (btn) btn.remove();
            });

            // ===== QUANTUM PREFIX LIVE SYNC (cross-app BroadcastChannel) =====
            (function initQPSync() {
                const QP = window.QuantumPrefixes;
                if (!QP || !window.notebook) return;

                // Broadcast full notepad state periodically (on save, cell change, etc.)
                function broadcastNotebookState() {
                    let totalLines = 0, totalClassified = 0, globalCounts = {};
                    (notebook.cells || []).forEach(cell => {
                        const meta = notebook.prefixMetadata(cell);
                        totalLines += meta.totalLines;
                        totalClassified += meta.classifiedLines;
                        for (const [cat, count] of Object.entries(meta.prefixCounts)) {
                            globalCounts[cat] = (globalCounts[cat] || 0) + count;
                        }
                    });
                    QP.broadcastState('quantum-notepad', {
                        coverage: totalLines > 0 ? Math.round((totalClassified / totalLines) * 100) : 0,
                        totalLines,
                        classifiedLines: totalClassified,
                        prefixCounts: globalCounts,
                        cellCount: (notebook.cells || []).length,
                        position: notebook.quantumPosition
                    });
                }

                // Hook into notebook save to auto-broadcast
                const origSave = notebook.saveNotebook.bind(notebook);
                notebook.saveNotebook = function() {
                    origSave();
                    broadcastNotebookState();
                };

                // Hook into _saveToLocalStorage as well
                const origLS = notebook._saveToLocalStorage.bind(notebook);
                notebook._saveToLocalStorage = function() {
                    origLS();
                    broadcastNotebookState();
                };

                // Listen for state from other apps
                QP.onStateChange(function(source, state, global) {
                    if (source === 'quantum-notepad' || !state) return;
                    // Update syncing panel if it exists
                    if (window._tpLogOutput) {
                        window._tpLogOutput('quantum-sync', `[${source}] coverage: ${state.coverage || 0}% | lines: ${state.totalLines || 0}`, 'info');
                    }
                });

                // Initial broadcast & request sync
                broadcastNotebookState();
                QP.requestStateSync();

                // Re-broadcast on cell content changes (debounced 3s)
                let _nbSyncDebounce;
                const origUpdateContent = notebook.updateCellContent.bind(notebook);
                notebook.updateCellContent = function(cellId, content) {
                    origUpdateContent(cellId, content);
                    clearTimeout(_nbSyncDebounce);
                    _nbSyncDebounce = setTimeout(broadcastNotebookState, 3000);
                };

                console.log('âš› Quantum Prefix Live Sync active â€” broadcasting to all UV-Speed apps');
            })();

            // ===== HEX STREAM CHAT WIDGET =====
            (function initHexStream() {
                try {
                const toggle = document.getElementById('hxs-toggle');
                const panel  = document.getElementById('hxs-panel');
                const dot    = document.getElementById('hxs-dot');
                const msgs   = document.getElementById('hxs-msgs');
                const input  = document.getElementById('hxs-input');
                const sendBtn= document.getElementById('hxs-send-btn');
                const vidEl  = document.getElementById('hxs-vid');
                const canvas = document.getElementById('hxs-canvas');
                const vidPh  = document.getElementById('hxs-vid-ph');
                const vidArea= document.getElementById('hxs-video-area');
                const camBtn = document.getElementById('hxs-cam-btn');
                const scrBtn = document.getElementById('hxs-scr-btn');
                const stopBtn= document.getElementById('hxs-stop-btn');

                let stream = null;
                let animId = null;
                let hexFrameId = 0;
                const bc = new BroadcastChannel('hexstream-chat');
                const bcVid = new BroadcastChannel('hexcast-stream');
                const username = 'User-' + Math.random().toString(36).slice(2,6).toUpperCase();

                // --- toggle panel ---
                toggle.addEventListener('click', () => {
                    panel.classList.toggle('open');
                    if(panel.classList.contains('open')) input.focus();
                });

                // --- close on Escape ---
                document.addEventListener('keydown', e => {
                    if(e.key === 'Escape' && panel.classList.contains('open')) panel.classList.remove('open');
                });

                // --- add message to feed ---
                function addMsg(user, text, isSystem) {
                    const d = document.createElement('div');
                    d.className = 'hxs-msg' + (isSystem ? ' system' : '');
                    const now = new Date();
                    const ts = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
                    if(isSystem) { d.textContent = text; }
                    else {
                        d.innerHTML = '<span class="hxs-msg-time">' + ts + '</span><span class="hxs-msg-user">' + user + '</span>' + escHtml(text);
                    }
                    msgs.appendChild(d);
                    msgs.scrollTop = msgs.scrollHeight;
                    // keep last 100 messages
                    while(msgs.children.length > 100) msgs.removeChild(msgs.firstChild);
                }
                function escHtml(s) { const d = document.createElement('span'); d.textContent = s; return d.innerHTML; }

                // --- send message ---
                function sendMessage() {
                    const txt = input.value.trim();
                    if(!txt) return;
                    addMsg(username, txt, false);
                    bc.postMessage({ type:'chat', user: username, text: txt, ts: Date.now() });
                    input.value = '';
                    input.focus();
                }
                sendBtn.addEventListener('click', sendMessage);
                input.addEventListener('keydown', e => { if(e.key === 'Enter') sendMessage(); });

                // --- receive messages ---
                bc.onmessage = ev => {
                    const d = ev.data;
                    if(d.type === 'chat') addMsg(d.user, d.text, false);
                    else if(d.type === 'join') addMsg(null, d.user + ' joined HexStream', true);
                    else if(d.type === 'leave') addMsg(null, d.user + ' left', true);
                    else if(d.type === 'stream-start') {
                        addMsg(null, d.user + ' started sharing ' + (d.source||''), true);
                        dot.classList.add('live');
                    }
                    else if(d.type === 'stream-stop') {
                        addMsg(null, d.user + ' stopped sharing', true);
                    }
                };

                // --- receive video frames from hexcast-stream ---
                const ctxRx = canvas.getContext('2d');
                bcVid.onmessage = ev => {
                    try {
                        const d = ev.data;
                        if(d && d.imageData) {
                            // Received raw ImageData from another tab
                            vidEl.style.display = 'none';
                            canvas.style.display = 'block';
                            vidPh.style.display = 'none';
                            vidArea.classList.add('active');
                            const img = new Image();
                            if(typeof d.imageData === 'string') {
                                img.onload = () => { ctxRx.drawImage(img, 0, 0, 280, 140); };
                                img.src = d.imageData;
                            }
                        } else if(d && d.frame) {
                            vidEl.style.display = 'none';
                            canvas.style.display = 'block';
                            vidPh.style.display = 'none';
                            vidArea.classList.add('active');
                            const img = new Image();
                            img.onload = () => { ctxRx.drawImage(img, 0, 0, 280, 140); };
                            img.src = d.frame;
                        }
                    } catch(e) {}
                };

                // --- camera ---
                async function startCam() {
                    stopStream();
                    try {
                        stream = await navigator.mediaDevices.getUserMedia({ video: { width: {ideal:280}, height: {ideal:140} }, audio: false });
                        vidEl.srcObject = stream;
                        vidEl.style.display = 'block';
                        canvas.style.display = 'none';
                        vidPh.style.display = 'none';
                        vidArea.classList.add('active');
                        camBtn.classList.add('active');
                        dot.classList.add('live');
                        bc.postMessage({ type:'stream-start', user: username, source: 'camera' });
                        addMsg(null, 'Camera streaming â€” visible to other tabs', true);
                        startBroadcast();
                    } catch(e) {
                        addMsg(null, 'Camera error: ' + e.message, true);
                    }
                }

                // --- screen share ---
                async function startScreen() {
                    stopStream();
                    try {
                        stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                        vidEl.srcObject = stream;
                        vidEl.style.display = 'block';
                        canvas.style.display = 'none';
                        vidPh.style.display = 'none';
                        vidArea.classList.add('active');
                        scrBtn.classList.add('active');
                        dot.classList.add('live');
                        stream.getVideoTracks()[0].onended = () => stopStream();
                        bc.postMessage({ type:'stream-start', user: username, source: 'screen' });
                        addMsg(null, 'Screen sharing â€” visible to other tabs', true);
                        startBroadcast();
                    } catch(e) {
                        if(e.name !== 'AbortError') addMsg(null, 'Screen share error: ' + e.message, true);
                    }
                }

                // --- broadcast video frames to hexcast-stream ---
                function startBroadcast() {
                    if(animId) cancelAnimationFrame(animId);
                    const cvBroadcast = document.createElement('canvas');
                    cvBroadcast.width = 160; cvBroadcast.height = 90;
                    const ctxB = cvBroadcast.getContext('2d');
                    function sendFrame() {
                        try {
                            if(stream && vidEl.readyState >= 2) {
                                ctxB.drawImage(vidEl, 0, 0, 160, 90);
                                const dataUrl = cvBroadcast.toDataURL('image/jpeg', 0.5);
                                bcVid.postMessage({ frame: dataUrl, id: hexFrameId++, user: username });
                            }
                        } catch(e) {}
                        animId = requestAnimationFrame(sendFrame);
                    }
                    sendFrame();
                }

                // --- stop ---
                function stopStream() {
                    if(stream) { stream.getTracks().forEach(t => t.stop()); stream = null; }
                    if(animId) { cancelAnimationFrame(animId); animId = null; }
                    vidEl.srcObject = null;
                    vidEl.style.display = 'none';
                    canvas.style.display = 'none';
                    vidPh.style.display = 'flex';
                    vidArea.classList.remove('active');
                    camBtn.classList.remove('active');
                    scrBtn.classList.remove('active');
                    dot.classList.remove('live');
                    bc.postMessage({ type:'stream-stop', user: username });
                }

                camBtn.addEventListener('click', startCam);
                scrBtn.addEventListener('click', startScreen);
                stopBtn.addEventListener('click', () => { stopStream(); addMsg(null, 'Stream stopped', true); });

                // announce presence
                bc.postMessage({ type:'join', user: username });
                window.addEventListener('beforeunload', () => { stopStream(); bc.postMessage({ type:'leave', user: username }); });

                // expose API
                window.hexStream = { sendMessage: (txt) => { addMsg(username, txt, false); bc.postMessage({ type:'chat', user: username, text: txt, ts: Date.now() }); }, username };
                } catch(e) { console.warn('HexStream init error:', e); }
            })();

            // ===== CHALK / HANDWRITTEN MODE TOGGLE =====
            (function initChalkMode() {
                const btn = document.createElement('button');
                btn.className = 'chalk-toggle-btn';
                btn.title = 'Toggle handwritten / chalkboard style';
                btn.textContent = 'âœï¸';
                document.body.appendChild(btn);

                // Restore from localStorage
                const saved = localStorage.getItem('uvspeed-chalk-mode');
                if (saved === 'on') {
                    document.body.setAttribute('data-chalk', 'on');
                    btn.classList.add('active');
                }

                btn.addEventListener('click', () => {
                    const isOn = document.body.getAttribute('data-chalk') === 'on';
                    document.body.setAttribute('data-chalk', isOn ? 'off' : 'on');
                    btn.classList.toggle('active', !isOn);
                    localStorage.setItem('uvspeed-chalk-mode', isOn ? 'off' : 'on');
                });
            })();
        })();
    </script>

    <!-- ====== XTERM.JS TERMINAL PANEL ====== -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5/css/xterm.min.css">
    <style>
        #terminal-panel{position:fixed;bottom:0;left:0;right:0;height:0;background:#0d1117;border-top:2px solid #30363d;z-index:9999;transition:height .25s ease;overflow:hidden;display:flex;flex-direction:column}
        #terminal-panel.open{height:320px}
        #terminal-panel-hdr{display:flex;align-items:center;gap:8px;padding:4px 12px;background:#161b22;border-bottom:1px solid #30363d;flex-shrink:0;cursor:row-resize}
        #terminal-panel-hdr .t-title{font-size:.6875rem;font-weight:600;color:#e6edf3;font-family:'SF Mono','Fira Code',monospace}
        #terminal-panel-hdr .t-badge{font-size:.5rem;padding:1px 6px;border-radius:8px;border:1px solid #3fb950;color:#3fb950;font-weight:600}
        #terminal-panel-hdr .t-close{margin-left:auto;background:none;border:1px solid #30363d;color:#8b949e;padding:2px 8px;border-radius:4px;cursor:pointer;font-size:.625rem}
        #terminal-panel-hdr .t-close:hover{color:#f85149;border-color:#f85149}

        /* Terminal tab bar */
        .tp-tabs{display:flex;gap:0;background:#161b22;border-bottom:1px solid #30363d;flex-shrink:0;overflow-x:auto}
        .tp-tab{padding:5px 14px;font-size:.625rem;font-weight:600;color:#8b949e;background:none;border:none;
            border-bottom:2px solid transparent;cursor:pointer;white-space:nowrap;transition:all .12s;
            font-family:'SF Mono','Fira Code',monospace;text-transform:uppercase;letter-spacing:.3px}
        .tp-tab:hover{color:#c9d1d9;background:rgba(255,255,255,.03)}
        .tp-tab.active{color:#58a6ff;border-bottom-color:#58a6ff}
        .tp-tab .tp-tab-badge{display:inline-block;min-width:14px;padding:0 4px;margin-left:4px;
            font-size:.5rem;line-height:14px;text-align:center;border-radius:7px;
            background:#30363d;color:#8b949e;font-weight:700}
        .tp-tab.active .tp-tab-badge{background:rgba(88,166,255,.15);color:#58a6ff}
        .tp-tab .tp-tab-badge.has-items{background:rgba(248,81,73,.15);color:#f85149}

        .tp-content{flex:1;overflow:hidden;position:relative}
        .tp-pane{position:absolute;inset:0;display:none;overflow-y:auto}
        .tp-pane.active{display:block}
        .tp-pane-inner{padding:8px 12px;font-family:'SF Mono','Fira Code',monospace;font-size:.6875rem;color:#e6edf3;line-height:1.6}
        #xterm-container{position:absolute;inset:0;padding:4px;overflow:hidden}
        .xterm .xterm-viewport{overflow-y:auto !important}

        /* Problems list */
        .tp-problem{display:flex;align-items:flex-start;gap:8px;padding:4px 0;border-bottom:1px solid #21262d}
        .tp-problem:last-child{border-bottom:none}
        .tp-problem-icon{flex-shrink:0;font-size:.75rem;line-height:1}
        .tp-problem-text{font-size:.625rem;color:#c9d1d9;line-height:1.4}
        .tp-problem-file{font-size:.5625rem;color:#8b949e}
        .tp-problem-sev-error .tp-problem-icon{color:#f85149}
        .tp-problem-sev-warn .tp-problem-icon{color:#f0883e}
        .tp-problem-sev-info .tp-problem-icon{color:#58a6ff}

        /* Output lines */
        .tp-out-line{padding:1px 0;color:#8b949e;white-space:pre-wrap;word-break:break-all;font-size:.625rem}
        .tp-out-line.tp-out-info{color:#c9d1d9}
        .tp-out-line.tp-out-warn{color:#f0883e}
        .tp-out-line.tp-out-error{color:#f85149}

        /* Debug console */
        .tp-debug-input{display:flex;gap:4px;padding:6px 0;border-top:1px solid #21262d;margin-top:6px}
        .tp-debug-input input{flex:1;background:#0d1117;border:1px solid #30363d;border-radius:4px;
            padding:4px 8px;color:#e6edf3;font-size:.625rem;font-family:'SF Mono',monospace}
        .tp-debug-input button{padding:4px 10px;border:1px solid #30363d;border-radius:4px;
            background:#161b22;color:#8b949e;font-size:.625rem;cursor:pointer;font-weight:600}
        .tp-debug-input button:hover{color:#e6edf3;border-color:#484f58}

        /* Ports table */
        .tp-ports-table{width:100%;border-collapse:collapse;font-size:.625rem}
        .tp-ports-table th{text-align:left;padding:4px 8px;color:#8b949e;border-bottom:1px solid #30363d;font-weight:600}
        .tp-ports-table td{padding:4px 8px;color:#c9d1d9;border-bottom:1px solid #21262d}
        .tp-port-status{display:inline-block;width:6px;height:6px;border-radius:50%;margin-right:4px}
        .tp-port-active{background:#3fb950}
        .tp-port-inactive{background:#484f58}

        /* Syncing */
        .tp-sync-row{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px solid #21262d}
        .tp-sync-icon{font-size:.875rem}
        .tp-sync-label{font-size:.625rem;color:#c9d1d9;flex:1}
        .tp-sync-status{font-size:.5625rem;padding:2px 8px;border-radius:8px;font-weight:600}
        .tp-sync-on{background:rgba(63,185,80,.15);color:#3fb950;border:1px solid rgba(63,185,80,.3)}
        .tp-sync-off{background:rgba(72,79,88,.2);color:#8b949e;border:1px solid #30363d}
    </style>
    <div id="terminal-panel">
        <div id="terminal-panel-hdr">
            <span class="t-title">ðŸ’» Terminal</span>
            <span class="t-badge">xterm.js</span>
            <span style="font-size:.5rem;color:#8b949e;font-family:'SF Mono',monospace" id="term-status">local</span>
            <button class="t-close" id="term-close">âœ• Close</button>
        </div>

        <!-- Tab Bar -->
        <div class="tp-tabs" id="tp-tabs">
            <button class="tp-tab" data-tp="problems">Problems <span class="tp-tab-badge" id="tp-problems-count">0</span></button>
            <button class="tp-tab" data-tp="output">Output</button>
            <button class="tp-tab" data-tp="debug">Debug Console</button>
            <button class="tp-tab active" data-tp="terminal">Terminal</button>
            <button class="tp-tab" data-tp="ports">Ports</button>
            <button class="tp-tab" data-tp="syncing">Syncing</button>
        </div>

        <!-- Tab Content -->
        <div class="tp-content">
            <!-- Problems -->
            <div class="tp-pane" id="tp-pane-problems">
                <div class="tp-pane-inner">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                        <span style="font-size:.625rem;font-weight:700;color:#e6edf3;">PROBLEMS</span>
                        <span style="font-size:.5rem;color:#8b949e;">Filter (e.g. errors, warnings)</span>
                        <input type="text" id="tp-problems-filter" placeholder="Filter problems..." style="margin-left:auto;padding:2px 8px;font-size:.5625rem;background:#0d1117;border:1px solid #30363d;border-radius:3px;color:#c9d1d9;font-family:'SF Mono',monospace;width:160px;">
                    </div>
                    <div id="tp-problems-list">
                        <div style="color:#8b949e;font-size:.625rem;padding:20px 0;text-align:center;">No problems detected in workspace</div>
                    </div>
                </div>
            </div>

            <!-- Output -->
            <div class="tp-pane" id="tp-pane-output">
                <div class="tp-pane-inner">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                        <span style="font-size:.625rem;font-weight:700;color:#e6edf3;">OUTPUT</span>
                        <select id="tp-output-channel" style="padding:2px 6px;font-size:.5625rem;background:#0d1117;border:1px solid #30363d;border-radius:3px;color:#c9d1d9;font-family:'SF Mono',monospace">
                            <option value="quantum-bridge">Quantum Bridge</option>
                            <option value="prefix-engine">Prefix Engine</option>
                            <option value="cell-execution">Cell Execution</option>
                            <option value="mcp-server">MCP Server</option>
                            <option value="git">Git</option>
                        </select>
                        <button id="tp-output-clear" style="margin-left:auto;padding:2px 8px;font-size:.5625rem;background:none;border:1px solid #30363d;border-radius:3px;color:#8b949e;cursor:pointer">Clear</button>
                    </div>
                    <div id="tp-output-log">
                        <div class="tp-out-line tp-out-info">[quantum-bridge] Waiting for connection...</div>
                    </div>
                </div>
            </div>

            <!-- Debug Console -->
            <div class="tp-pane" id="tp-pane-debug">
                <div class="tp-pane-inner">
                    <div style="font-size:.625rem;font-weight:700;color:#e6edf3;margin-bottom:8px">DEBUG CONSOLE</div>
                    <div id="tp-debug-log">
                        <div class="tp-out-line tp-out-info">Debug console ready. Use the input below to evaluate expressions.</div>
                    </div>
                    <div class="tp-debug-input">
                        <input type="text" id="tp-debug-input" placeholder="Evaluate expression..." autocomplete="off">
                        <button id="tp-debug-run">â–¶ Run</button>
                    </div>
                </div>
            </div>

            <!-- Terminal (xterm) -->
            <div class="tp-pane active" id="tp-pane-terminal">
                <div id="xterm-container"></div>
            </div>

            <!-- Ports -->
            <div class="tp-pane" id="tp-pane-ports">
                <div class="tp-pane-inner">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                        <span style="font-size:.625rem;font-weight:700;color:#e6edf3;">PORTS</span>
                        <button id="tp-port-add" style="margin-left:auto;padding:2px 8px;font-size:.5625rem;background:none;border:1px solid #30363d;border-radius:3px;color:#8b949e;cursor:pointer">+ Forward Port</button>
                    </div>
                    <table class="tp-ports-table">
                        <thead><tr><th>Port</th><th>Address</th><th>Protocol</th><th>Source</th><th>Status</th></tr></thead>
                        <tbody id="tp-ports-body">
                            <tr><td><span class="tp-port-status tp-port-active"></span>8000</td><td>localhost:8000</td><td>HTTP</td><td>Quantum Bridge</td><td style="color:#3fb950">Active</td></tr>
                            <tr><td><span class="tp-port-status tp-port-inactive"></span>8765</td><td>localhost:8765</td><td>WS</td><td>Bridge WebSocket</td><td style="color:#8b949e">Idle</td></tr>
                            <tr><td><span class="tp-port-status tp-port-inactive"></span>11434</td><td>localhost:11434</td><td>HTTP</td><td>Ollama</td><td style="color:#8b949e">Idle</td></tr>
                            <tr><td><span class="tp-port-status tp-port-inactive"></span>5037</td><td>localhost:5037</td><td>TCP</td><td>ADB (Quest)</td><td style="color:#8b949e">Idle</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Syncing -->
            <div class="tp-pane" id="tp-pane-syncing">
                <div class="tp-pane-inner">
                    <div style="font-size:.625rem;font-weight:700;color:#e6edf3;margin-bottom:8px">SYNC STATUS</div>
                    <div id="tp-sync-list">
                        <div class="tp-sync-row">
                            <span class="tp-sync-icon">ðŸ”Œ</span>
                            <span class="tp-sync-label">Quantum Bridge Server</span>
                            <span class="tp-sync-status tp-sync-off" id="tp-sync-bridge">Disconnected</span>
                        </div>
                        <div class="tp-sync-row">
                            <span class="tp-sync-icon">ðŸ’»</span>
                            <span class="tp-sync-label">hexterm Terminal</span>
                            <span class="tp-sync-status tp-sync-off" id="tp-sync-hexterm">Not linked</span>
                        </div>
                        <div class="tp-sync-row">
                            <span class="tp-sync-icon">âš¡</span>
                            <span class="tp-sync-label">hexbench Workbench</span>
                            <span class="tp-sync-status tp-sync-off" id="tp-sync-hexbench">Not linked</span>
                        </div>
                        <div class="tp-sync-row">
                            <span class="tp-sync-icon">ðŸ¤–</span>
                            <span class="tp-sync-label">Ollama / LLM</span>
                            <span class="tp-sync-status tp-sync-off" id="tp-sync-ollama">Offline</span>
                        </div>
                        <div class="tp-sync-row">
                            <span class="tp-sync-icon">ðŸ¥½</span>
                            <span class="tp-sync-label">Meta Quest Device</span>
                            <span class="tp-sync-status tp-sync-off" id="tp-sync-quest">Not detected</span>
                        </div>
                        <div class="tp-sync-row">
                            <span class="tp-sync-icon">ðŸ“¡</span>
                            <span class="tp-sync-label">BroadcastChannel (tabs)</span>
                            <span class="tp-sync-status tp-sync-on" id="tp-sync-broadcast">Active</span>
                        </div>
                        <div class="tp-sync-row">
                            <span class="tp-sync-icon">ðŸ’¾</span>
                            <span class="tp-sync-label">LocalStorage</span>
                            <span class="tp-sync-status tp-sync-on" id="tp-sync-storage">Available</span>
                        </div>
                        <div class="tp-sync-row">
                            <span class="tp-sync-icon">ðŸŒ</span>
                            <span class="tp-sync-label">Service Worker (PWA)</span>
                            <span class="tp-sync-status tp-sync-off" id="tp-sync-sw">Checking...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0/lib/addon-fit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-web-links@0/lib/addon-web-links.min.js"></script>
    <script>
    (() => {
        'use strict';
        const panel = document.getElementById('terminal-panel');
        const toggleBtn = document.getElementById('terminal-btn');
        const closeBtn = document.getElementById('term-close');
        const container = document.getElementById('xterm-container');
        const statusEl = document.getElementById('term-status');

        // ===== TAB SWITCHING =====
        document.querySelectorAll('#tp-tabs .tp-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('#tp-tabs .tp-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tp-pane').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                const pane = document.getElementById('tp-pane-' + tab.dataset.tp);
                if (pane) pane.classList.add('active');
                // Re-fit xterm when switching back to terminal
                if (tab.dataset.tp === 'terminal' && fitAddon) {
                    setTimeout(() => fitAddon.fit(), 50);
                }
            });
        });

        // ===== PROBLEMS PANEL =====
        const problemsList = document.getElementById('tp-problems-list');
        const problemsBadge = document.getElementById('tp-problems-count');
        const problemsFilter = document.getElementById('tp-problems-filter');

        window._tpAddProblem = function(severity, message, file, line) {
            const icon = severity === 'error' ? 'âœ•' : severity === 'warn' ? 'âš ' : 'â„¹';
            const el = document.createElement('div');
            el.className = `tp-problem tp-problem-sev-${severity}`;
            el.dataset.text = (message + ' ' + file).toLowerCase();
            el.innerHTML = `<span class="tp-problem-icon">${icon}</span><div><div class="tp-problem-text">${message}</div><div class="tp-problem-file">${file}${line ? ':' + line : ''}</div></div>`;
            // Remove "no problems" placeholder
            const placeholder = problemsList.querySelector('div[style]');
            if (placeholder && placeholder.textContent.includes('No problems')) placeholder.remove();
            problemsList.appendChild(el);
            const count = problemsList.querySelectorAll('.tp-problem').length;
            problemsBadge.textContent = count;
            if (count > 0) problemsBadge.classList.add('has-items');
        };

        if (problemsFilter) {
            problemsFilter.addEventListener('input', () => {
                const q = problemsFilter.value.toLowerCase();
                problemsList.querySelectorAll('.tp-problem').forEach(p => {
                    p.style.display = !q || (p.dataset.text && p.dataset.text.includes(q)) ? '' : 'none';
                });
            });
        }

        // ===== OUTPUT PANEL =====
        const outputLog = document.getElementById('tp-output-log');
        const outputChannel = document.getElementById('tp-output-channel');
        const outputClear = document.getElementById('tp-output-clear');
        const outputChannelData = { 'quantum-bridge': [], 'prefix-engine': [], 'cell-execution': [], 'mcp-server': [], 'git': [] };
        outputChannelData['quantum-bridge'].push({ cls: 'tp-out-info', text: '[quantum-bridge] Waiting for connection...' });

        window._tpLogOutput = function(channel, text, level) {
            const cls = level === 'error' ? 'tp-out-error' : level === 'warn' ? 'tp-out-warn' : 'tp-out-info';
            if (!outputChannelData[channel]) outputChannelData[channel] = [];
            outputChannelData[channel].push({ cls, text: `[${channel}] ${text}` });
            if (outputChannel && outputChannel.value === channel) {
                const line = document.createElement('div');
                line.className = 'tp-out-line ' + cls;
                line.textContent = `[${channel}] ${text}`;
                outputLog.appendChild(line);
                outputLog.scrollTop = outputLog.scrollHeight;
            }
        };

        if (outputChannel) {
            outputChannel.addEventListener('change', () => {
                const ch = outputChannel.value;
                outputLog.innerHTML = '';
                (outputChannelData[ch] || []).forEach(entry => {
                    const line = document.createElement('div');
                    line.className = 'tp-out-line ' + entry.cls;
                    line.textContent = entry.text;
                    outputLog.appendChild(line);
                });
            });
        }
        if (outputClear) {
            outputClear.addEventListener('click', () => {
                const ch = outputChannel ? outputChannel.value : 'quantum-bridge';
                outputChannelData[ch] = [];
                outputLog.innerHTML = '<div class="tp-out-line" style="color:#484f58">Output cleared</div>';
            });
        }

        // ===== DEBUG CONSOLE =====
        const debugLog = document.getElementById('tp-debug-log');
        const debugInput = document.getElementById('tp-debug-input');
        const debugRun = document.getElementById('tp-debug-run');

        function runDebugExpr() {
            if (!debugInput || !debugInput.value.trim()) return;
            const expr = debugInput.value.trim();
            debugInput.value = '';
            const line = document.createElement('div');
            line.className = 'tp-out-line';
            line.innerHTML = `<span style="color:#58a6ff">â€º</span> <span style="color:#c9d1d9">${expr}</span>`;
            debugLog.appendChild(line);
            try {
                const result = eval(expr);
                const out = document.createElement('div');
                out.className = 'tp-out-line tp-out-info';
                out.textContent = typeof result === 'object' ? JSON.stringify(result, null, 2) : String(result);
                debugLog.appendChild(out);
            } catch (e) {
                const err = document.createElement('div');
                err.className = 'tp-out-line tp-out-error';
                err.textContent = e.message;
                debugLog.appendChild(err);
            }
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        if (debugRun) debugRun.addEventListener('click', runDebugExpr);
        if (debugInput) debugInput.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); runDebugExpr(); } });

        // ===== PORTS =====
        window._tpUpdatePort = function(port, status, source) {
            const tbody = document.getElementById('tp-ports-body');
            if (!tbody) return;
            const rows = tbody.querySelectorAll('tr');
            for (const row of rows) {
                if (row.cells[0] && row.cells[0].textContent.includes(String(port))) {
                    const dot = row.querySelector('.tp-port-status');
                    if (dot) { dot.className = 'tp-port-status ' + (status === 'active' ? 'tp-port-active' : 'tp-port-inactive'); }
                    if (row.cells[4]) row.cells[4].textContent = status === 'active' ? 'Active' : 'Idle';
                    if (row.cells[4]) row.cells[4].style.color = status === 'active' ? '#3fb950' : '#8b949e';
                    return;
                }
            }
        };

        // ===== SYNCING â€” live status checks =====
        function checkSyncStatus() {
            // Bridge
            const bridgeEl = document.getElementById('tp-sync-bridge');
            if (bridgeEl) {
                const connected = window.notebook && window.notebook.wsConnected;
                bridgeEl.textContent = connected ? 'Connected' : 'Disconnected';
                bridgeEl.className = 'tp-sync-status ' + (connected ? 'tp-sync-on' : 'tp-sync-off');
                if (connected) window._tpUpdatePort(8000, 'active');
            }
            // hexterm BroadcastChannel
            const hextermEl = document.getElementById('tp-sync-hexterm');
            if (hextermEl) {
                const linked = window._hextermLinked || false;
                hextermEl.textContent = linked ? 'Linked' : 'Not linked';
                hextermEl.className = 'tp-sync-status ' + (linked ? 'tp-sync-on' : 'tp-sync-off');
            }
            // hexbench
            const benchEl = document.getElementById('tp-sync-hexbench');
            if (benchEl) {
                const linked = window._hexbenchLinked || false;
                benchEl.textContent = linked ? 'Linked' : 'Not linked';
                benchEl.className = 'tp-sync-status ' + (linked ? 'tp-sync-on' : 'tp-sync-off');
            }
            // Service Worker
            const swEl = document.getElementById('tp-sync-sw');
            if (swEl && 'serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(reg => {
                    swEl.textContent = reg ? 'Registered' : 'Not registered';
                    swEl.className = 'tp-sync-status ' + (reg ? 'tp-sync-on' : 'tp-sync-off');
                }).catch(() => {
                    swEl.textContent = 'Unavailable';
                    swEl.className = 'tp-sync-status tp-sync-off';
                });
            }
        }
        setTimeout(checkSyncStatus, 1000);
        setInterval(checkSyncStatus, 5000);

        // Hook into notebook to capture problems and output
        const origConsoleError = console.error;
        console.error = function() {
            origConsoleError.apply(console, arguments);
            const msg = Array.from(arguments).map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
            if (window._tpAddProblem) window._tpAddProblem('error', msg, 'console', '');
            if (window._tpLogOutput) window._tpLogOutput('cell-execution', msg, 'error');
        };
        const origConsoleWarn = console.warn;
        console.warn = function() {
            origConsoleWarn.apply(console, arguments);
            const msg = Array.from(arguments).map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
            if (window._tpAddProblem) window._tpAddProblem('warn', msg, 'console', '');
            if (window._tpLogOutput) window._tpLogOutput('cell-execution', msg, 'warn');
        };

        let term = null;
        let fitAddon = null;
        let ws = null;
        let initialized = false;
        let cmdBuffer = '';
        const history = [];
        let histIdx = -1;

        function initTerminal() {
            if (initialized) return;
            initialized = true;

            if (typeof Terminal === 'undefined') {
                container.innerHTML = '<div style="padding:12px;color:#f85149;font-size:.75rem;">xterm.js CDN not loaded â€” check network</div>';
                return;
            }

            term = new Terminal({
                theme: {
                    background: '#0d1117',
                    foreground: '#e6edf3',
                    cursor: '#58a6ff',
                    cursorAccent: '#0d1117',
                    selectionBackground: 'rgba(88,166,255,.25)',
                    black: '#0d1117', red: '#f85149', green: '#3fb950', yellow: '#f0883e',
                    blue: '#58a6ff', magenta: '#a78bfa', cyan: '#56d4dd', white: '#e6edf3',
                    brightBlack: '#484f58', brightRed: '#f85149', brightGreen: '#7ee787',
                    brightYellow: '#f0883e', brightBlue: '#79c0ff', brightMagenta: '#d2a8ff',
                    brightCyan: '#56d4dd', brightWhite: '#ffffff',
                },
                fontFamily: "'SF Mono','Fira Code','JetBrains Mono','Cascadia Code',monospace",
                fontSize: 13,
                cursorBlink: true,
                cursorStyle: 'bar',
                scrollback: 5000,
                allowProposedApi: true,
            });

            if (typeof FitAddon !== 'undefined') {
                fitAddon = new FitAddon.FitAddon();
                term.loadAddon(fitAddon);
            }

            if (typeof WebLinksAddon !== 'undefined') {
                term.loadAddon(new WebLinksAddon.WebLinksAddon());
            }

            term.open(container);
            if (fitAddon) fitAddon.fit();

            // Show welcome banner
            term.writeln('\x1b[35mâš› uvspeed terminal\x1b[0m â€” \x1b[36mbeyondBINARY\x1b[0m {+1, 1, -1, +0, 0, -0, +n, n, -n}');
            term.writeln('\x1b[90mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\x1b[0m');

            // Try to connect to bridge WebSocket for real shell
            connectBridgeWS();

            // Local command handler (fallback when no bridge)
            term.onKey(({ key, domEvent }) => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    // Send to bridge PTY
                    ws.send(JSON.stringify({ type: 'input', data: key }));
                    return;
                }

                // Local mode â€” basic command line emulator
                const code = domEvent.keyCode;
                if (code === 13) { // Enter
                    term.writeln('');
                    processLocalCommand(cmdBuffer);
                    if (cmdBuffer.trim()) {
                        history.push(cmdBuffer);
                        if (history.length > 200) history.shift(); // cap at 200
                    }
                    histIdx = history.length;
                    cmdBuffer = '';
                } else if (code === 8) { // Backspace
                    if (cmdBuffer.length > 0) {
                        cmdBuffer = cmdBuffer.slice(0, -1);
                        term.write('\b \b');
                    }
                } else if (code === 38) { // Up arrow
                    if (histIdx > 0) {
                        histIdx--;
                        clearLine();
                        cmdBuffer = history[histIdx];
                        term.write(cmdBuffer);
                    }
                } else if (code === 40) { // Down arrow
                    if (histIdx < history.length - 1) {
                        histIdx++;
                        clearLine();
                        cmdBuffer = history[histIdx];
                        term.write(cmdBuffer);
                    } else {
                        histIdx = history.length;
                        clearLine();
                        cmdBuffer = '';
                    }
                } else if (key.length === 1 && !domEvent.ctrlKey && !domEvent.altKey && !domEvent.metaKey) {
                    cmdBuffer += key;
                    term.write(key);
                } else if (domEvent.ctrlKey && domEvent.key === 'c') {
                    term.writeln('^C');
                    cmdBuffer = '';
                    showPrompt();
                } else if (domEvent.ctrlKey && domEvent.key === 'l') {
                    term.clear();
                    showPrompt();
                }
            });

            showPrompt();

            new ResizeObserver(() => {
                if (fitAddon && panel.classList.contains('open')) fitAddon.fit();
            }).observe(container);
        }

        function clearLine() {
            term.write('\x1b[2K\r');
            showPromptInline();
        }

        function showPrompt() {
            term.write('\x1b[32mâš›\x1b[0m \x1b[34muvspeed\x1b[0m \x1b[90m$\x1b[0m ');
        }

        function showPromptInline() {
            term.write('\x1b[32mâš›\x1b[0m \x1b[34muvspeed\x1b[0m \x1b[90m$\x1b[0m ');
        }

        function processLocalCommand(cmd) {
            const c = cmd.trim();
            if (!c) { showPrompt(); return; }

            const parts = c.split(/\s+/);
            const command = parts[0].toLowerCase();

            switch (command) {
                case 'help':
                    term.writeln('\x1b[36m  Available commands:\x1b[0m');
                    term.writeln('  help              â€” show this help');
                    term.writeln('  clear             â€” clear terminal');
                    term.writeln('  version           â€” show uvspeed version');
                    term.writeln('  status            â€” bridge server status');
                    term.writeln('  prefix <line>     â€” classify a code line');
                    term.writeln('  cells             â€” list notebook cells');
                    term.writeln('  run <id>          â€” run a notebook cell');
                    term.writeln('  eval <expr>       â€” evaluate JavaScript');
                    term.writeln('  echo <text>       â€” print text');
                    term.writeln('  date              â€” show date/time + unix');
                    term.writeln('  uname             â€” show platform info');
                    term.writeln('  open <page>       â€” open uvspeed web page');
                    term.writeln('  \x1b[36mhexcast\x1b[0m            â€” live camera â†’ terminal (truecolor)');
                    term.writeln('  \x1b[36mhexcast front\x1b[0m      â€” front camera');
                    term.writeln('  \x1b[36mhexcast back\x1b[0m       â€” back/rear camera');
                    term.writeln('  \x1b[36mhexcast screen\x1b[0m     â€” screen capture â†’ terminal');
                    term.writeln('  \x1b[36mhexcast test\x1b[0m       â€” test color bars â†’ terminal');
                    term.writeln('  \x1b[36mhexcast send <IP>\x1b[0m  â€” stream camera to remote terminal');
                    term.writeln('  \x1b[36mhexcast stop\x1b[0m       â€” stop live feed');
                    term.writeln('  connect           â€” connect to bridge WS');
                    term.writeln('\x1b[90m  Connect bridge for full shell (PTY)\x1b[0m');
                    break;
                case 'clear': term.clear(); break;
                case 'version':
                    term.writeln(`\x1b[35m  uvspeed v3.5 Â· Phase 3.5 Â· beyondBINARY\x1b[0m`);
                    term.writeln(`  {+1, 1, -1, +0, 0, -0, +n, n, -n}`);
                    break;
                case 'status':
                    term.writeln(`  Bridge: ${ws && ws.readyState === WebSocket.OPEN ? '\x1b[32mconnected\x1b[0m' : '\x1b[31moffline\x1b[0m'}`);
                    term.writeln(`  Mode: ${ws && ws.readyState === WebSocket.OPEN ? 'PTY (bridge)' : 'local (emulated)'}`);
                    term.writeln(`  Online: ${navigator.onLine}`);
                    break;
                case 'prefix': {
                    const line = parts.slice(1).join(' ');
                    if (!line) { term.writeln('\x1b[33m  Usage: prefix <code line>\x1b[0m'); break; }
                    const result = classifyLocal(line);
                    term.writeln(`  \x1b[36m${result.symbol}\x1b[0m  \x1b[33m${result.category}\x1b[0m  ${line}`);
                    break;
                }
                case 'cells':
                    if (window.notebook && notebook.cells) {
                        notebook.cells.forEach((c, i) => {
                            term.writeln(`  \x1b[90m[${i}]\x1b[0m ${c.id.slice(0,8)} \x1b[33m${c.type}\x1b[0m ${(c.code||'').slice(0,40).replace(/\n/g,' ')}`);
                        });
                    } else { term.writeln('\x1b[31m  No notebook loaded\x1b[0m'); }
                    break;
                case 'run':
                    if (parts[1] && window.notebook) {
                        const cell = notebook.cells?.find(c => c.id.startsWith(parts[1]));
                        if (cell) { notebook.executeCell(cell.id); term.writeln(`\x1b[32m  Running cell ${parts[1]}...\x1b[0m`); }
                        else term.writeln(`\x1b[31m  Cell not found: ${parts[1]}\x1b[0m`);
                    } else term.writeln('\x1b[33m  Usage: run <cell-id-prefix>\x1b[0m');
                    break;
                case 'eval':
                case 'js': {
                    const expr = parts.slice(1).join(' ');
                    try {
                        const result = eval(expr);
                        term.writeln(`  \x1b[32m${String(result)}\x1b[0m`);
                    } catch(e) { term.writeln(`  \x1b[31m${e.message}\x1b[0m`); }
                    break;
                }
                case 'echo': term.writeln('  ' + parts.slice(1).join(' ')); break;
                case 'date': {
                    const now = new Date();
                    term.writeln(`  ${now.toISOString()}`);
                    term.writeln(`  \x1b[90munix\x1b[0m ${Math.floor(now.getTime()/1000)}`);
                    break;
                }
                case 'uname':
                    term.writeln(`  ${navigator.platform} | ${navigator.userAgent.slice(0,60)}...`);
                    break;
                case 'open': {
                    const pages = { notepad:'quantum-notepad.html', archflow:'archflow.html', blackwell:'blackwell.html',
                                    questcast:'questcast.html', jawta:'jawta-audio.html', hexcast:'hexcast.html',
                                    game:'brothernumsy.html', dashboard:'github-dashboard.html', lab:'research-lab.html',
                                                    terminal:'terminal.html', send:'hexcast-send.html' };
                    const target = pages[parts[1]];
                    if (target) { openOverlay(target, parts[1]); term.writeln(`\x1b[32m  Opening ${target}\x1b[0m`); }
                    else { term.writeln(`\x1b[33m  Pages: ${Object.keys(pages).join(', ')}\x1b[0m`); }
                    break;
                }
                case 'connect': connectBridgeWS(); break;

                // ===== HEXCAST LIVE CAMERA IN TERMINAL =====
                case 'hexcast':
                case 'camera': {
                    const sub = (parts[1] || '').toLowerCase();
                    if (sub === 'stop' || sub === 'off' || sub === 'quit') {
                        if (window._hexTermFeed) {
                            window._hexTermFeed.stop();
                            term.writeln('\x1b[33m  hexcast stopped\x1b[0m');
                        }
                        if (window._hexTermSend) {
                            window._hexTermSend.stop();
                            term.writeln('\x1b[33m  hexcast send stopped\x1b[0m');
                        }
                        if (!window._hexTermFeed && !window._hexTermSend) {
                            term.writeln('\x1b[90m  No active feed\x1b[0m');
                        }
                        break;
                    }
                    // â”€â”€ hexcast send <host> â€” stream camera to remote terminal â”€â”€
                    if (sub === 'send') {
                        let sendHost = parts[2] || '';
                        if (!sendHost) {
                            term.writeln('\x1b[33m  Usage: hexcast send <IP>\x1b[0m');
                            term.writeln('\x1b[90m  e.g. hexcast send 192.168.1.42\x1b[0m');
                            break;
                        }
                        if (!sendHost.includes(':')) sendHost += ':9876';
                        if (!sendHost.startsWith('ws://')) sendHost = 'ws://' + sendHost;
                        term.writeln(`\x1b[36m  hexcast send\x1b[0m â†’ ${sendHost}`);
                        term.writeln('\x1b[90m  Connecting + streaming camera... hexcast stop to end\x1b[0m');

                        (async function() {
                            try {
                                const sendFacing = (parts[3] === 'back') ? 'environment' : 'user';
                                const stream = await navigator.mediaDevices.getUserMedia({
                                    video: { facingMode: sendFacing, width: { ideal: 480 }, height: { ideal: 360 } },
                                    audio: false
                                });
                                const vid = document.createElement('video');
                                vid.setAttribute('playsinline', '');
                                vid.muted = true;
                                vid.srcObject = stream;
                                await vid.play();

                                const cvs = document.createElement('canvas');
                                cvs.width = 480; cvs.height = 360;
                                const cctx = cvs.getContext('2d');

                                const sendWs = new WebSocket(sendHost);
                                let sendN = 0, running = true, sendTimer = null;

                                sendWs.onopen = () => {
                                    term.writeln(`\x1b[32m  Connected! Streaming ${sendFacing === 'user' ? 'front' : 'back'} camera\x1b[0m`);
                                    sendTimer = setInterval(() => {
                                        if (!running) return;
                                        cctx.drawImage(vid, 0, 0, 480, 360);
                                        const dataUrl = cvs.toDataURL('image/jpeg', 0.5);
                                        const b64 = dataUrl.split(',')[1];
                                        const sz = Math.round(b64.length * 0.75);
                                        const packet = JSON.stringify({
                                            type: 'frame', v: '3.6.0',
                                            src: `phone:${sendFacing === 'user' ? 'front' : 'back'}`,
                                            w: 480, h: 360, sz, t: Date.now() / 1000,
                                        }) + '\n' + b64;
                                        try { sendWs.send(packet); sendN++; } catch(e) {}
                                    }, 67); // ~15 fps
                                };
                                sendWs.onerror = () => term.writeln('\x1b[31m  Connection error\x1b[0m');
                                sendWs.onclose = () => {
                                    running = false;
                                    if (sendTimer) clearInterval(sendTimer);
                                    stream.getTracks().forEach(t => t.stop());
                                    term.writeln(`\x1b[33m  Send ended â€” ${sendN} frames\x1b[0m`);
                                    window._hexTermSend = null;
                                    showPrompt();
                                };

                                window._hexTermSend = {
                                    stop() {
                                        running = false;
                                        if (sendTimer) clearInterval(sendTimer);
                                        sendWs.close();
                                        stream.getTracks().forEach(t => t.stop());
                                        window._hexTermSend = null;
                                    },
                                    get frameCount() { return sendN; }
                                };
                            } catch (e) {
                                term.writeln(`\x1b[31m  Error: ${e.message}\x1b[0m`);
                                showPrompt();
                            }
                        })();
                        return; // don't show prompt â€” send takes over
                    }
                    // Source: camera (default), front, back, screen, test
                    const source = (sub === 'screen') ? 'screen' : (sub === 'test') ? 'test' : 'camera';
                    const facingMode = (sub === 'back' || sub === 'rear') ? 'environment' : 'user';
                    const cols = term.cols || 80;
                    const res = Math.floor(cols / 2); // 2 chars per pixel (half-blocks)
                    const rows = Math.floor((term.rows || 24) - 3); // leave room for prompt
                    const pixH = Math.floor(rows * 2); // 2 vertical pixels per row (upper/lower block)

                    term.writeln(`\x1b[36m  hexcast â€” live ${source} â†’ terminal\x1b[0m`);
                    term.writeln(`\x1b[90m  ${res}Ã—${pixH} pixels â†’ ${res}Ã—${rows} chars | 'hexcast stop' to end\x1b[0m`);

                    (async function startHexTermFeed() {
                        let stream = null, video = null, canvas = null, ctx = null, running = true, animId = null;

                        try {
                            video = document.createElement('video');
                            video.setAttribute('playsinline', '');
                            video.muted = true;
                            canvas = document.createElement('canvas');
                            canvas.width = res;
                            canvas.height = pixH;
                            ctx = canvas.getContext('2d', { willReadFrequently: true });

                            if (source === 'camera') {
                                stream = await navigator.mediaDevices.getUserMedia({ video: { width: { ideal: res }, height: { ideal: pixH }, facingMode: facingMode }, audio: false });
                            } else if (source === 'screen') {
                                stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false });
                            }

                            if (stream) {
                                video.srcObject = stream;
                                await video.play();
                            }

                            // Thermal palette: maps 0-255 to ANSI truecolor
                            function thermalRGB(v) {
                                if (v < 64)  return [0, Math.round(v * 2), Math.round(v * 4)];         // dark blue â†’ cyan
                                if (v < 128) return [0, Math.round((v-64)*4), 255-Math.round((v-64)*2)]; // cyan â†’ green
                                if (v < 192) return [Math.round((v-128)*4), 255-Math.round((v-128)*2), 0]; // green â†’ red
                                return [255, Math.round((v-192)*4), Math.round((v-192)*2)];               // red â†’ white-hot
                            }

                            let frameN = 0;
                            const fps = 12;
                            const interval = 1000 / fps;
                            let lastFrame = 0;

                            function renderFrame(ts) {
                                if (!running) return;
                                if (ts - lastFrame < interval) { animId = requestAnimationFrame(renderFrame); return; }
                                lastFrame = ts;
                                frameN++;

                                if (source === 'test') {
                                    // Synthetic test pattern
                                    for (let y = 0; y < pixH; y++) {
                                        for (let x = 0; x < res; x++) {
                                            const bar = Math.floor(x / (res / 8));
                                            const colors = [[255,255,255],[255,255,0],[0,255,255],[0,255,0],[255,0,255],[255,0,0],[0,0,255],[0,0,0]];
                                            const c = colors[bar % 8];
                                            const scan = (y + frameN * 2) % pixH;
                                            const fade = Math.abs(y - scan) < 3 ? 0.5 : 1;
                                            ctx.fillStyle = `rgb(${Math.round(c[0]*fade)},${Math.round(c[1]*fade)},${Math.round(c[2]*fade)})`;
                                            ctx.fillRect(x, y, 1, 1);
                                        }
                                    }
                                } else {
                                    ctx.drawImage(video, 0, 0, res, pixH);
                                }

                                const imgData = ctx.getImageData(0, 0, res, pixH);
                                const px = imgData.data;

                                // Build ANSI frame using half-block characters
                                // â–€ (upper half block) with fg=top pixel, bg=bottom pixel
                                let frame = `\x1b[H`; // cursor home (top of terminal)
                                for (let row = 0; row < rows; row++) {
                                    let line = '';
                                    const y0 = row * 2;      // top pixel
                                    const y1 = row * 2 + 1;  // bottom pixel
                                    for (let x = 0; x < res; x++) {
                                        const i0 = (y0 * res + x) * 4;
                                        const i1 = (y1 * res + x) * 4;
                                        const r0 = px[i0], g0 = px[i0+1], b0 = px[i0+2];
                                        const r1 = px[i1], g1 = px[i1+1], b1 = px[i1+2];
                                        // fg = top pixel (â–€ upper half), bg = bottom pixel
                                        line += `\x1b[38;2;${r0};${g0};${b0}m\x1b[48;2;${r1};${g1};${b1}mâ–€`;
                                    }
                                    line += '\x1b[0m';
                                    frame += line + (row < rows - 1 ? '\r\n' : '');
                                }
                                // Status bar
                                const luma = Math.round(Array.from(px).filter((_,i) => i%4===0).reduce((a,b) => a+b, 0) / (res*pixH));
                                frame += `\r\n\x1b[36m hexcast\x1b[0m \x1b[90m${source} ${res}Ã—${pixH} f:${frameN} luma:${luma}\x1b[0m`;

                                term.write(frame);
                                animId = requestAnimationFrame(renderFrame);
                            }

                            animId = requestAnimationFrame(renderFrame);

                            window._hexTermFeed = {
                                stop() {
                                    running = false;
                                    if (animId) cancelAnimationFrame(animId);
                                    if (stream) stream.getTracks().forEach(t => t.stop());
                                    video = null; canvas = null; ctx = null;
                                    window._hexTermFeed = null;
                                    term.write('\x1b[0m\x1b[2J\x1b[H'); // reset + clear
                                    showPrompt();
                                },
                                get frameCount() { return frameN; },
                                get source() { return source; },
                            };

                        } catch (e) {
                            term.writeln(`\x1b[31m  Error: ${e.message}\x1b[0m`);
                            term.writeln(`\x1b[90m  Tip: try 'hexcast test' for synthetic pattern\x1b[0m`);
                            showPrompt();
                            return;
                        }
                    })();
                    return; // don't show prompt â€” feed takes over terminal
                }

                default:
                    term.writeln(`\x1b[31m  Command not found: ${command}\x1b[0m`);
                    term.writeln(`\x1b[90m  Type 'help' for available commands. Connect bridge for full shell.\x1b[0m`);
            }
            showPrompt();
        }

        function classifyLocal(line) {
            const t = line.trim();
            if (!t) return { symbol: '0', category: 'neutral' };
            if (t.startsWith('//') || t.startsWith('#') || t.startsWith('/*')) return { symbol: '-0', category: 'comment' };
            if (/^(import |from |use |require|#include)/.test(t)) return { symbol: 'n', category: 'import' };
            if (/^(fn |function |def |class |struct |enum |const |let |var |type )/.test(t)) return { symbol: '+1', category: 'declaration' };
            if (/^(if |else|for |while |match |switch |case )/.test(t)) return { symbol: '1', category: 'logic' };
            if (/^(return |yield |break|continue)/.test(t)) return { symbol: '+n', category: 'modifier' };
            if (/print|console\.|log\(|write\(|read\(|fetch\(/.test(t)) return { symbol: '-1', category: 'io' };
            if (/ = | := | \+= | -= | \*= /.test(t)) return { symbol: '+0', category: 'assignment' };
            return { symbol: '-n', category: 'unknown' };
        }

        function connectBridgeWS() {
            if (ws && ws.readyState === WebSocket.OPEN) return;
            statusEl.textContent = 'connecting...';
            try {
                ws = new WebSocket('ws://localhost:8086');
                ws.onopen = () => {
                    statusEl.textContent = 'bridge:8086';
                    statusEl.style.color = '#3fb950';
                    if (term) {
                        term.writeln('\x1b[32m  Connected to bridge server (PTY mode)\x1b[0m');
                        term.writeln('\x1b[90m  Full shell access via bridge WebSocket\x1b[0m');
                    }
                };
                ws.onmessage = (e) => {
                    try {
                        const msg = JSON.parse(e.data);
                        if (msg.type === 'output' && term) term.write(msg.data);
                    } catch { if (term) term.write(e.data); }
                };
                ws.onclose = () => {
                    statusEl.textContent = 'local';
                    statusEl.style.color = '#8b949e';
                    ws = null;
                };
                ws.onerror = () => {
                    statusEl.textContent = 'local';
                    statusEl.style.color = '#8b949e';
                    ws = null;
                };
            } catch {
                statusEl.textContent = 'local';
                statusEl.style.color = '#8b949e';
            }
        }

        // Toggle
        function toggleTerminal() {
            if (!initialized) initTerminal();
            panel.classList.toggle('open');
            if (panel.classList.contains('open') && fitAddon) {
                setTimeout(() => fitAddon.fit(), 100);
                term?.focus();
            }
        }

        if (toggleBtn) toggleBtn.addEventListener('click', toggleTerminal);
        if (closeBtn) closeBtn.addEventListener('click', () => panel.classList.remove('open'));

        // Keyboard shortcut: Ctrl+` to toggle
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.key === '`') { e.preventDefault(); toggleTerminal(); }
        });

        // Resize handle on header
        const hdr = document.getElementById('terminal-panel-hdr');
        let resizing = false, startY, startH;
        hdr?.addEventListener('mousedown', e => {
            if (e.target.tagName === 'BUTTON') return;
            resizing = true; startY = e.clientY; startH = panel.offsetHeight;
            document.body.style.cursor = 'row-resize'; document.body.style.userSelect = 'none';
        });
        document.addEventListener('mousemove', e => {
            if (!resizing) return;
            const h = startH + (startY - e.clientY);
            panel.style.height = Math.max(80, Math.min(window.innerHeight * 0.7, h)) + 'px';
            if (fitAddon) fitAddon.fit();
        });
        document.addEventListener('mouseup', () => {
            if (resizing) { resizing = false; document.body.style.cursor = ''; document.body.style.userSelect = ''; }
        });

        console.log('ðŸ’» xterm.js terminal panel loaded (Ctrl+` to toggle)');
    })();
    </script>

    <!-- ====== SUB-PAGE OVERLAY (iframe, preserves notepad state) ====== -->
    <style>
        #page-overlay{position:fixed;inset:0;z-index:90000;display:none;background:#0d1117;flex-direction:column}
        #page-overlay.open{display:flex}
        #page-overlay-bar{display:flex;align-items:center;gap:8px;padding:4px 10px;background:#161b22;border-bottom:1px solid #30363d;flex-shrink:0;height:36px}
        #page-overlay-bar .overlay-title{flex:1;font-size:.8125rem;color:#8b949e;font-family:'SF Mono',monospace;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        #page-overlay-bar button{background:#21262d;border:1px solid #30363d;color:#e6edf3;border-radius:4px;padding:3px 10px;font-size:.75rem;cursor:pointer}
        #page-overlay-bar button:hover{background:#30363d}
        #page-overlay-bar .close-btn{background:#da3633;border-color:#da3633;color:#fff;font-weight:700}
        #page-overlay-bar .close-btn:hover{background:#f85149}
        #page-overlay-frame{flex:1;border:none;width:100%;background:#0d1117}
    </style>
    <div id="page-overlay">
        <div id="page-overlay-bar">
            <button class="close-btn" onclick="closeOverlay()" title="Close and return to notepad">âœ• Back to Notepad</button>
            <span class="overlay-title" id="page-overlay-title"></span>
            <button onclick="document.getElementById('page-overlay-frame').contentWindow.location.reload()" title="Reload page">â†»</button>
        </div>
        <iframe id="page-overlay-frame" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
    </div>
    <script>
    function openOverlay(url, title) {
        const overlay = document.getElementById('page-overlay');
        const frame = document.getElementById('page-overlay-frame');
        const titleEl = document.getElementById('page-overlay-title');
        frame.src = url;
        titleEl.textContent = title || url;
        overlay.classList.add('open');
    }
    function closeOverlay() {
        const overlay = document.getElementById('page-overlay');
        const frame = document.getElementById('page-overlay-frame');
        overlay.classList.remove('open');
        frame.src = 'about:blank';
    }
    // Escape key closes overlay
    document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && document.getElementById('page-overlay').classList.contains('open')) {
            closeOverlay();
        }
    });
    </script>

    <!-- ====== NUMSY HEADER COMPANION (logo position) ====== -->
    <script>
    (() => {
        'use strict';
        const logo = document.getElementById('numsy-logo');
        const body = document.getElementById('numsy-body');
        const bubble = document.getElementById('numsy-bubble');
        const mouth = document.getElementById('numsy-mouth');
        const tail = document.getElementById('numsy-tail');
        if (!logo || !body) return;

        let state = 'idle';
        let mood = 100;
        let energy = 100;
        let bubbleTimer = null;
        let idleCounter = 0;

        const messages = {
            easy: ['meow! âœ¨', 'easy peasy~', 'nyan~', '*purrs*', 'ðŸ’š nice!'],
            medium: ['hmm... ðŸ¤”', 'thinking...', '*concentrates*', 'working on it~'],
            hard: ['complex! ðŸ§ ', '*sweats*', 'quantum thinking...', 'âš¡ power mode!'],
            extreme: ['ðŸŒ€ OVERLOAD', '*vibrating*', 'âš› beyond binary!', 'ðŸš€ OVERDRIVE'],
            idle: ['zzz...', '*yawns*', 'pet me?', '*stretches*'],
            greeting: ['hello! ðŸ±', 'nyan!', 'ready to code!', 'âš› quantum cat!'],
            click: ['*purrr*', 'meow!', 'hi!', '*nuzzle*'],
        };

        function say(text, duration) {
            clearTimeout(bubbleTimer);
            bubble.textContent = text;
            bubble.classList.add('show');
            bubbleTimer = setTimeout(() => bubble.classList.remove('show'), duration || 2500);
        }

        function randomMsg(key) {
            const arr = messages[key] || messages.idle;
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function setState(s) {
            state = s;
            body.className = 'numsy-logo-body ' + s;
            switch (s) {
                case 'happy': mouth.textContent = 'â–½'; break;
                case 'thinking': mouth.textContent = '~'; break;
                case 'dance': case 'fly': mouth.textContent = 'â–½'; break;
                case 'sleepy': mouth.textContent = '-'; break;
                default: mouth.textContent = 'w';
            }
            if (tail && (s === 'happy' || s === 'dance')) {
                tail.style.animation = 'nl-wobble 0.3s ease infinite';
            } else if (tail) {
                tail.style.animation = 'nl-wobble 2s ease-in-out infinite';
            }
        }

        window._numsyReact = function(difficulty) {
            switch (difficulty) {
                case 'easy': setState('happy'); say(randomMsg('easy')); break;
                case 'medium': setState('thinking'); say(randomMsg('medium')); break;
                case 'hard': setState('wiggle'); say(randomMsg('hard')); break;
                case 'extreme': setState('fly'); say(randomMsg('extreme'), 4000); break;
                default: setState('idle'); say(randomMsg('idle'));
            }
            setTimeout(() => setState('idle'), 4000);
        };

        logo.addEventListener('click', () => {
            say(randomMsg('click'));
            setState('dance');
            mood = Math.min(100, mood + 10);
            setTimeout(() => setState('idle'), 2000);
        });

        logo.addEventListener('dblclick', () => {
            setState('fly');
            say('ðŸš€ wheeeee!', 3000);
            setTimeout(() => setState('idle'), 3000);
        });

        // Eye tracking
        document.addEventListener('mousemove', e => {
            const eyeL = document.getElementById('numsy-eye-l');
            const eyeR = document.getElementById('numsy-eye-r');
            if (!eyeL || !eyeR) return;
            const rect = logo.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height / 2;
            const dx = Math.max(-1, Math.min(1, (e.clientX - cx) / 200));
            const dy = Math.max(-1, Math.min(1, (e.clientY - cy) / 200));
            [eyeL, eyeR].forEach(eye => {
                eye.style.transform = `translate(${dx}px, ${dy}px)`;
            });
        });

        // Idle tick
        setInterval(() => {
            if (state !== 'idle') return;
            idleCounter++;
            energy = Math.max(0, energy - 1);
            mood = Math.max(0, mood - 0.5);
            if (energy < 20) { setState('sleepy'); say('zzz...'); }
            else if (idleCounter > 40 && Math.random() < 0.1) {
                setState(Math.random() < 0.5 ? 'wiggle' : 'dance');
                say(randomMsg('idle'));
                idleCounter = 0;
                setTimeout(() => setState('idle'), 3000);
            }
        }, 6000);

        // Wake on typing
        let lastKeyTime = 0;
        document.addEventListener('keydown', () => {
            const now = Date.now();
            if (now - lastKeyTime > 10000 && state === 'sleepy') {
                energy = Math.min(100, energy + 30);
                setState('idle');
                say('*wakes up* meow!');
            }
            lastKeyTime = now;
            idleCounter = 0;
        });

        // Greeting
        setTimeout(() => say(randomMsg('greeting'), 3000), 2000);

        // Hook cell execution
        const origExec = window.notebook?.executeCell;
        if (origExec) {
            window.notebook.executeCell = function(cellId) {
                const cell = this.cells?.find(c => c.id === cellId);
                if (cell) {
                    const code = cell.code || '';
                    const lines = code.split('\n').length;
                    let diff = 'easy';
                    if (lines > 50 || code.includes('async') || code.includes('quantum')) diff = 'extreme';
                    else if (lines > 20 || code.includes('class') || code.includes('import')) diff = 'hard';
                    else if (lines > 5) diff = 'medium';
                    window._numsyReact(diff);
                }
                return origExec.apply(this, arguments);
            };
        }

        // API
        window.numsy = {
            say, setState, react: window._numsyReact,
            get mood() { return mood; },
            get energy() { return energy; },
            feed() { energy = Math.min(100, energy + 30); mood = Math.min(100, mood + 20); setState('happy'); say('yum! ðŸŸ'); },
            pet() { mood = Math.min(100, mood + 15); setState('happy'); say('*purrs loudly*'); },
        };
        console.log('ðŸ± Numsy logo companion loaded â€” click to interact, API: window.numsy');
    })();
    </script>
</body>
</html>
